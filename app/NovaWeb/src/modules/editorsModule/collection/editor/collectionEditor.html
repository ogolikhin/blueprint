<div ng-if="$ctrl.isLoading" class="app-loading">
    <span class="glyphicon glyphicon-refresh spin"></span>
    <span>Loading...</span>
</div>

<div class="artifact-overview" ng-if="!$ctrl.isLoading">
    <div class="content">
        <form novalidate>
            <div class="properties system-properties__container" ng-class="{'is-collapsed': $ctrl.isSystemPropertiesCollapsed}"
                 ng-if="$ctrl.isSystemPropertyAvailable">
                <div class="heading" ng-click="$ctrl.isSystemPropertiesCollapsed = !$ctrl.isSystemPropertiesCollapsed">
                    {{::$root.config.labels['App_Properties_System_Properties_Label']}}
                </div>
                <div class="system-properties content"
                     ng-class="{'is-collapsed': $ctrl.isSystemPropertiesCollapsed}">
                    <formly-form model="$ctrl.model" fields="$ctrl.systemFields">
                    </formly-form>
                </div>
            </div>

            <div class="properties" ng-if="$ctrl.artifact.rapidReviewCreated">
                <div class="collection__heading clearfix">
                    <div class="collection__heading__review__name">
                        <i class="icon fonticon2-rapid-review"></i> {{::$ctrl.artifact.reviewName}} <a ng-href="{{::$ctrl.reviewUrl}}"
                             class="collection__heading__link collection__heading__link__review">{{::$ctrl.reviewUrl}}</a>
                    </div>
                    <div class="collection__heading__review__edit text-right" ng-if="$ctrl.hasRequiredPermissions()">
                        <a ng-href="Web/#/RapidReview/{{::$ctrl.artifact.id}}/edit" class="collection__heading__link">{{::$ctrl.localization.get('Artifact_Collection_Edit_Rapid_Review')}}</a>
                    </div>
                </div>
            </div>

            <div class="properties specific-properties__container" ng-class="{'is-collapsed': isSpecificPropertiesCollapsed}">
                <div class="heading" ng-click="isSpecificPropertiesCollapsed = !isSpecificPropertiesCollapsed">
                    {{::$ctrl.localization.get('Artifact_Collection_Content_Header')}}
                </div>
                <div class="specific-properties content"
                     ng-class="{'is-collapsed': isSpecificPropertiesCollapsed}"
                     ng-if="$ctrl.rowData && $ctrl.rowData.length > 0">
                    <div class="collection__bulk__actions text-right" ng-show="$ctrl.selectedVMs.length">
                        {{$ctrl.itemsSelected}} <i class="icon icon__normal fonticon2-delete" ng-click="$ctrl.bulkDelete()"
                                                   bp-tooltip=" {{::$ctrl.localization.get('Artifact_Collection_Delete_Selected')}}"></i>
                    </div>
                    <bp-tree-view
                          grid-class="project-tree collections-list"
                          api="$ctrl.api"
                          selection-mode="'checkbox'"
                          row-height="53"
                          row-buffer="15"
                          row-data="$ctrl.rowData"
                          columns="$ctrl.columns"
                          header-height="33"
                          size-columns-to-fit="true"
                          on-select="$ctrl.onSelect(vm, isSelected)"
                          on-grid-reset="$ctrl.onGridReset(isExpanding)"/>
                </div>
                <div class="specific-properties content"
                     ng-class="{'is-collapsed': isSpecificPropertiesCollapsed}"
                     ng-hide="$ctrl.rowData && $ctrl.rowData.length > 0">
                        <div class="empty-collection text-center" >
                            <table class="empty-collection__table">
                                <thead>
                                <tr>
                                    <th class="empty-collection__table-th empty-collection__table-th--first">&nbsp; </th>
                                    <th class="empty-collection__table-th">{{::$ctrl.localization.get('Label_ID')}}</th>
                                    <th class="empty-collection__table-th">{{::$ctrl.localization.get('Label_Name')}}</th>
                                    <th class="empty-collection__table-th">{{::$ctrl.localization.get('Label_Description')}}</th>
                                    <th class="empty-collection__table-th">{{::$ctrl.localization.get('Label_Options')}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td colspan="5" class="empty-collection__table-td">{{::$ctrl.localization.get('Artifact_Collection_No_Artifacts_In_Collection')}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                </div>
            </div>
            <div class="properties additional-properties__container" ng-class="{'is-collapsed': isAdditionalPropertiesCollapsed}"
                 ng-if="$ctrl.isCustomPropertyAvailable">
                <div class="heading" ng-click="isAdditionalPropertiesCollapsed = !isAdditionalPropertiesCollapsed">
                    {{::$root.config.labels['App_Properties_Additional_Properties_Label']}}
                </div>
                <div class="additional-properties content" ng-class="{'is-collapsed': isAdditionalPropertiesCollapsed}">
                    <formly-form model="$ctrl.model" fields="$ctrl.customFields">
                    </formly-form>
                </div>
            </div>

            <tab-slider responsive="true" slide-selector=".uib-tab__tab" slide-select="$ctrl.setActive" ng-if="$ctrl.isRichTextPropertyAvailable">
                <uib-tabset active="$ctrl.activeTab">
                    <uib-tab ng-repeat="field in $ctrl.richTextFields track by $index"
                             select="$ctrl.activeTab = $index"
                             heading="{{field.data.name}}"
                             bp-tooltip="{{field.data.name}}" bp-tooltip-truncated="true"
                             class="uib-tab__tab {{field.templateOptions['isInvalid'] || !$ctrl.isRtfFieldValid(field) ? 'invalid' : ''}}">
                        <formly-form model="$ctrl.model" fields="[field]" ng-if="$ctrl.activeTab === $index" class="rich-text-wrapper">
                        </formly-form>
                    </uib-tab>
                </uib-tabset>
            </tab-slider>
        </form>
    </div>
</div>
