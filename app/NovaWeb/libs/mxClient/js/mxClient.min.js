function mxDictionary(){this.clear()}function mxPoint(n,t){this.x=n!=null?n:0;this.y=t!=null?t:0}function mxRectangle(n,t,i,r){mxPoint.call(this,n,t);this.width=i!=null?i:0;this.height=r!=null?r:0}function mxEventObject(n){this.name=n;this.properties=[];for(var t=1;t<arguments.length;t+=2)arguments[t+1]!=null&&(this.properties[arguments[t]]=arguments[t+1])}function mxMouseEvent(n,t){this.evt=n;this.state=t;this.sourceState=t}function mxEventSource(n){this.setEventSource(n)}function mxXmlRequest(n,t,i,r,u,f){this.url=n;this.params=t;this.method=i||"POST";this.async=r!=null?r:!0;this.username=u;this.password=f}function mxWindow(n,t,i,r,u,f,e,o,s,h){t!=null&&(e=e!=null?e:!0,this.content=t,this.init(i,r,u,f,h),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(e),this.setTitle(n),(o==null||o)&&this.installMoveHandler(),s!=null&&s.parentNode!=null?s.parentNode.replaceChild(this.div,s):document.body.appendChild(this.div))}function mxForm(n){this.table=document.createElement("table");this.table.className=n;this.body=document.createElement("tbody");this.table.appendChild(this.body)}function mxImage(n,t,i){this.src=n;this.width=t;this.height=i}function mxDivResizer(n,t){if(n.nodeName.toLowerCase()=="div"){t==null&&(t=window);this.div=n;var i=mxUtils.getCurrentStyle(n);i!=null&&(this.resizeWidth=i.width=="auto",this.resizeHeight=i.height=="auto");mxEvent.addListener(t,"resize",mxUtils.bind(this,function(){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}));this.resize()}}function mxDragSource(n,t){this.element=n;this.dropHandler=t;mxEvent.addGestureListeners(n,mxUtils.bind(this,function(n){this.mouseDown(n)}));this.eventConsumer=function(n,t){var i=t.getProperty("eventName"),r=t.getProperty("event");i!=mxEvent.MOUSE_DOWN&&r.consume()}}function mxToolbar(n){this.container=n}function mxUndoableEdit(n,t){this.source=n;this.changes=[];this.significant=t!=null?t:!0}function mxUndoManager(n){this.size=n!=null?n:100;this.clear()}function mxPanningManager(n){this.thread=null;this.active=!1;this.tdx=0;this.tdy=0;this.t0x=0;this.t0y=0;this.dx=0;this.dy=0;this.scrollbars=!1;this.scrollLeft=0;this.scrollTop=0;this.mouseListener={mouseDown:function(){},mouseMove:function(){},mouseUp:mxUtils.bind(this,function(){this.active&&this.stop()})};n.addMouseListener(this.mouseListener);mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.active&&this.stop()}));var t=mxUtils.bind(this,function(){return this.scrollbars=mxUtils.hasScrollbars(n.container),this.scrollLeft=n.container.scrollLeft,this.scrollTop=n.container.scrollTop,window.setInterval(mxUtils.bind(this,function(){if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){var t=-n.container.scrollLeft-Math.ceil(this.dx),i=-n.container.scrollTop-Math.ceil(this.dy);n.panGraph(t,i);n.panDx=this.scrollLeft-n.container.scrollLeft;n.panDy=this.scrollTop-n.container.scrollTop;n.fireEvent(new mxEventObject(mxEvent.PAN))}else n.panGraph(this.getDx(),this.getDy())}),this.delay)});this.isActive=function(){return active};this.getDx=function(){return Math.round(this.tdx)};this.getDy=function(){return Math.round(this.tdy)};this.start=function(){this.t0x=n.view.translate.x;this.t0y=n.view.translate.y;this.active=!0};this.panTo=function(i,r,u,f){this.active||this.start();this.scrollLeft=n.container.scrollLeft;this.scrollTop=n.container.scrollTop;u=u!=null?u:0;f=f!=null?f:0;var e=n.container;this.dx=i+u-e.scrollLeft-e.clientWidth;this.dx=this.dx<0&&Math.abs(this.dx)<this.border?this.border+this.dx:this.handleMouseOut?Math.max(this.dx,0):0;this.dx==0&&(this.dx=i-e.scrollLeft,this.dx=this.dx>0&&this.dx<this.border?this.dx-this.border:this.handleMouseOut?Math.min(0,this.dx):0);this.dy=r+f-e.scrollTop-e.clientHeight;this.dy=this.dy<0&&Math.abs(this.dy)<this.border?this.border+this.dy:this.handleMouseOut?Math.max(this.dy,0):0;this.dy==0&&(this.dy=r-e.scrollTop,this.dy=this.dy>0&&this.dy<this.border?this.dy-this.border:this.handleMouseOut?Math.min(0,this.dy):0);this.dx!=0||this.dy!=0?(this.dx*=this.damper,this.dy*=this.damper,this.thread==null&&(this.thread=t())):this.thread!=null&&(window.clearInterval(this.thread),this.thread=null)};this.stop=function(){if(this.active)if(this.active=!1,this.thread!=null&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)n.panDx=0,n.panDy=0,n.fireEvent(new mxEventObject(mxEvent.PAN));else{var t=n.panDx,i=n.panDy;(t!=0||i!=0)&&(n.panGraph(0,0),n.view.setTranslate(this.t0x+t/n.view.scale,this.t0y+i/n.view.scale))}};this.destroy=function(){n.removeMouseListener(this.mouseListener)}}function mxPopupMenu(n){this.factoryMethod=n;n!=null&&this.init()}function mxAutoSaveManager(n){this.changeHandler=mxUtils.bind(this,function(n,t){this.isEnabled()&&this.graphModelChanged(t.getProperty("edit").changes)});this.setGraph(n)}function mxAnimation(n){this.delay=n!=null?n:20}function mxMorphing(n,t,i,r){mxAnimation.call(this,r);this.graph=n;this.steps=t!=null?t:6;this.ease=i!=null?i:1.5}function mxImageBundle(n){this.images=[];this.alt=n!=null?n:!1}function mxImageExport(){}function mxAbstractCanvas2D(){this.converter=this.createUrlConverter();this.reset()}function mxXmlCanvas2D(n){mxAbstractCanvas2D.call(this);this.root=n;this.writeDefaults()}function mxSvgCanvas2D(n,t){var i,r,u;if(mxAbstractCanvas2D.call(this),this.root=n,this.gradients=[],this.defs=null,this.styleEnabled=t!=null?t:!1,i=null,n.ownerDocument!=document){for(r=n;r!=null&&r.nodeName!="svg";)r=r.parentNode;i=r}i!=null&&(u=i.getElementsByTagName("defs"),u.length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs==null&&(this.defs=this.createElement("defs"),i.firstChild!=null?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}function mxGuide(n,t){this.graph=n;this.setStates(t)}function mxStencil(n){this.desc=n;this.parseDescription();this.parseConstraints()}function mxShape(n){this.stencil=n;this.strokewidth=1;this.rotation=0;this.opacity=100;this.flipH=!1;this.flipV=!1}function mxActor(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxCloud(n,t,i,r){mxActor.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxRectangleShape(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxEllipse(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxDoubleEllipse(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxRhombus(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxPolyline(n,t,i){mxShape.call(this);this.points=n;this.stroke=t;this.strokewidth=i!=null?i:1}function mxArrow(n,t,i,r,u,f,e){mxShape.call(this);this.points=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1;this.arrowWidth=u!=null?u:mxConstants.ARROW_WIDTH;this.spacing=f!=null?f:mxConstants.ARROW_SPACING;this.endSize=e!=null?e:mxConstants.ARROW_SIZE}function mxArrowConnector(n,t,i,r,u,f){mxShape.call(this);this.points=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1;this.arrowWidth=u!=null?u:mxConstants.ARROW_WIDTH;this.spacing=f!=null?f:mxConstants.ARROW_SPACING;this.startSize=mxConstants.ARROW_SIZE/5;this.endSize=mxConstants.ARROW_SIZE/5}function mxText(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){mxShape.call(this);this.value=n;this.bounds=t;this.color=u!=null?u:"black";this.align=i!=null?i:"";this.valign=r!=null?r:"";this.family=f!=null?f:mxConstants.DEFAULT_FONTFAMILY;this.size=e!=null?e:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=o!=null?o:mxConstants.DEFAULT_FONTSTYLE;this.spacing=parseInt(s||2);this.spacingTop=this.spacing+parseInt(h||0);this.spacingRight=this.spacing+parseInt(c||0);this.spacingBottom=this.spacing+parseInt(l||0);this.spacingLeft=this.spacing+parseInt(a||0);this.horizontal=v!=null?v:!0;this.background=y;this.border=p;this.wrap=w!=null?w:!1;this.clipped=b!=null?b:!1;this.overflow=k!=null?k:"visible";this.labelPadding=d!=null?d:0;this.textDirection=g;this.rotation=0;this.updateMargin()}function mxTriangle(){mxActor.call(this)}function mxHexagon(){mxActor.call(this)}function mxLine(n,t,i){mxShape.call(this);this.bounds=n;this.stroke=t;this.strokewidth=i!=null?i:1}function mxImageShape(n,t,i,r,u){mxShape.call(this);this.bounds=n;this.image=t;this.fill=i;this.stroke=r;this.strokewidth=u!=null?u:1;this.shadow=!1}function mxLabel(n,t,i,r){mxRectangleShape.call(this,n,t,i,r)}function mxCylinder(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxConnector(n,t,i){mxPolyline.call(this,n,t,i)}function mxSwimlane(n,t,i,r){mxShape.call(this);this.bounds=n;this.fill=t;this.stroke=i;this.strokewidth=r!=null?r:1}function mxGraphLayout(n){this.graph=n}function mxStackLayout(n,t,i,r,u,f){mxGraphLayout.call(this,n);this.horizontal=t!=null?t:!0;this.spacing=i!=null?i:0;this.x0=r!=null?r:0;this.y0=u!=null?u:0;this.border=f!=null?f:0}function mxPartitionLayout(n,t,i,r){mxGraphLayout.call(this,n);this.horizontal=t!=null?t:!0;this.spacing=i||0;this.border=r||0}function mxCompactTreeLayout(n,t,i){mxGraphLayout.call(this,n);this.horizontal=t!=null?t:!0;this.invert=i!=null?i:!1}function WeightedCellSorter(n,t){this.cell=n;this.weightedValue=t}function mxRadialTreeLayout(n){mxCompactTreeLayout.call(this,n,!1)}function mxFastOrganicLayout(n){mxGraphLayout.call(this,n)}function mxCircleLayout(n,t){mxGraphLayout.call(this,n);this.radius=t!=null?t:100}function mxParallelEdgeLayout(n){mxGraphLayout.call(this,n)}function mxCompositeLayout(n,t,i){mxGraphLayout.call(this,n);this.layouts=t;this.master=i}function mxEdgeLabelLayout(n){mxGraphLayout.call(this,n)}function mxGraphAbstractHierarchyCell(){this.x=[];this.y=[];this.temp=[]}function mxGraphHierarchyNode(n){mxGraphAbstractHierarchyCell.apply(this,arguments);this.cell=n;this.id=mxObjectIdentity.get(n);this.connectsAsTarget=[];this.connectsAsSource=[]}function mxGraphHierarchyEdge(n){mxGraphAbstractHierarchyCell.apply(this,arguments);this.edges=n;this.ids=[];for(var t=0;t<n.length;t++)this.ids.push(mxObjectIdentity.get(n[t]))}function mxGraphHierarchyModel(n,t,i,r,u){var y=n.getGraph(),o,e,l,h,s,c;for(this.tightenToSource=u,this.roots=i,this.parent=r,this.vertexMapper=new mxDictionary,this.edgeMapper=new mxDictionary,this.maxRank=0,o=[],t==null&&(t=this.graph.getChildVertices(r)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(n,t,o),e=0;e<t.length;e++){for(l=o[e].connectsAsSource,h=0;h<l.length;h++)if(s=l[h],c=s.edges,c!=null&&c.length>0){var v=c[0],a=n.getVisibleTerminal(v,!1),f=this.vertexMapper.get(a);o[e]==f&&(a=n.getVisibleTerminal(v,!0),f=this.vertexMapper.get(a));f!=null&&o[e]!=f&&(s.target=f,f.connectsAsTarget.length==0&&(f.connectsAsTarget=[]),mxUtils.indexOf(f.connectsAsTarget,s)<0&&f.connectsAsTarget.push(s))}o[e].temp[0]=1}}function mxSwimlaneModel(n,t,i,r,u){var p=n.getGraph(),o,e,l,h,s,c;for(this.tightenToSource=u,this.roots=i,this.parent=r,this.vertexMapper={},this.edgeMapper={},this.maxRank=0,o=[],t==null&&(t=this.graph.getChildVertices(r)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(n,t,o),e=0;e<t.length;e++){for(l=o[e].connectsAsSource,h=0;h<l.length;h++)if(s=l[h],c=s.edges,c!=null&&c.length>0){var y=c[0],a=n.getVisibleTerminal(y,!1),v=mxCellPath.create(a),f=this.vertexMapper[v];o[e]==f&&(a=n.getVisibleTerminal(y,!0),v=mxCellPath.create(a),f=this.vertexMapper[v]);f!=null&&o[e]!=f&&(s.target=f,f.connectsAsTarget.length==0&&(f.connectsAsTarget=[]),mxUtils.indexOf(f.connectsAsTarget,s)<0&&f.connectsAsTarget.push(s))}o[e].temp[0]=1}}function mxHierarchicalLayoutStage(){}function mxMedianHybridCrossingReduction(n){this.layout=n}function MedianCellSorter(){}function mxMinimumCycleRemover(n){this.layout=n}function mxCoordinateAssignment(n,t,i,r,u,f){this.layout=n;this.intraCellSpacing=t;this.interRankCellSpacing=i;this.orientation=r;this.initialX=u;this.parallelEdgeSpacing=f}function WeightedCellSorter(n,t){this.cell=n;this.weightedValue=t}function mxSwimlaneOrdering(n){this.layout=n}function mxHierarchicalLayout(n,t,i){mxGraphLayout.call(this,n);this.orientation=t!=null?t:mxConstants.DIRECTION_NORTH;this.deterministic=i!=null?i:!0}function mxSwimlaneLayout(n,t,i){mxGraphLayout.call(this,n);this.orientation=t!=null?t:mxConstants.DIRECTION_NORTH;this.deterministic=i!=null?i:!0}function mxGraphModel(n){this.currentEdit=this.createUndoableEdit();n!=null?this.setRoot(n):this.clear()}function mxRootChange(n,t){this.model=n;this.root=t;this.previous=t}function mxChildChange(n,t,i,r){this.model=n;this.parent=t;this.previous=t;this.child=i;this.index=r;this.previousIndex=r}function mxTerminalChange(n,t,i,r){this.model=n;this.cell=t;this.terminal=i;this.previous=i;this.source=r}function mxValueChange(n,t,i){this.model=n;this.cell=t;this.value=i;this.previous=i}function mxStyleChange(n,t,i){this.model=n;this.cell=t;this.style=i;this.previous=i}function mxGeometryChange(n,t,i){this.model=n;this.cell=t;this.geometry=i;this.previous=i}function mxCollapseChange(n,t,i){this.model=n;this.cell=t;this.collapsed=i;this.previous=i}function mxVisibleChange(n,t,i){this.model=n;this.cell=t;this.visible=i;this.previous=i}function mxCellAttributeChange(n,t,i){this.cell=n;this.attribute=t;this.value=i;this.previous=i}function mxCell(n,t,i){this.value=n;this.setGeometry(t);this.setStyle(i);this.onInit!=null&&this.onInit()}function mxGeometry(n,t,i,r){mxRectangle.call(this,n,t,i,r)}function mxPrintPreview(n,t,i,r,u,f,e,o,s){this.graph=n;this.scale=t!=null?t:1/n.pageScale;this.border=r!=null?r:0;this.pageFormat=i!=null?i:n.pageFormat;this.title=o!=null?o:"Printer-friendly version";this.x0=u!=null?u:0;this.y0=f!=null?f:0;this.borderColor=e;this.pageSelector=s!=null?s:!0}function mxStylesheet(){this.styles={};this.putDefaultVertexStyle(this.createDefaultVertexStyle());this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}function mxCellState(n,t,i){this.view=n;this.cell=t;this.style=i;this.origin=new mxPoint;this.absoluteOffset=new mxPoint}function mxGraphSelectionModel(n){this.graph=n;this.cells=[]}function mxSelectionChange(n,t,i){this.selectionModel=n;this.added=t!=null?t.slice():null;this.removed=i!=null?i.slice():null}function mxCellEditor(n){this.graph=n}function mxCellRenderer(){}function mxGraphView(n){this.graph=n;this.translate=new mxPoint;this.graphBounds=new mxRectangle;this.states=new mxDictionary}function mxCurrentRootChange(n,t){if(this.view=n,this.root=t,this.previous=t,this.isUp=t==null,!this.isUp)for(var i=this.view.currentRoot,r=this.view.graph.getModel();i!=null;){if(i==t){this.isUp=!0;break}i=r.getParent(i)}}function mxGraph(n,t,i,r){this.mouseListeners=null;this.renderHint=i;this.dialect=mxClient.IS_SVG?mxConstants.DIALECT_SVG:i==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?mxConstants.DIALECT_VML:i==mxConstants.RENDERING_HINT_FASTEST?mxConstants.DIALECT_STRICTHTML:i==mxConstants.RENDERING_HINT_FASTER?mxConstants.DIALECT_PREFERHTML:mxConstants.DIALECT_MIXEDHTML;this.model=t!=null?t:new mxGraphModel;this.multiplicities=[];this.imageBundles=[];this.cellRenderer=this.createCellRenderer();this.setSelectionModel(this.createSelectionModel());this.setStylesheet(r!=null?r:this.createStylesheet());this.view=this.createGraphView();this.graphModelChangeListener=mxUtils.bind(this,function(n,t){this.graphModelChanged(t.getProperty("edit").changes)});this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener);this.createHandlers();n!=null&&this.init(n);this.view.revalidate()}function mxCellOverlay(n,t,i,r,u,f){this.image=n;this.tooltip=t;this.align=i!=null?i:this.align;this.verticalAlign=r!=null?r:this.verticalAlign;this.offset=u!=null?u:new mxPoint;this.cursor=f!=null?f:"help"}function mxOutline(n,t){this.source=n;t!=null&&this.init(t)}function mxMultiplicity(n,t,i,r,u,f,e,o,s,h){this.source=n;this.type=t;this.attr=i;this.value=r;this.min=u!=null?u:0;this.max=f!=null?f:"n";this.validNeighbors=e;this.countError=mxResources.get(o)||o;this.typeError=mxResources.get(s)||s;this.validNeighborsAllowed=h!=null?h:!0}function mxLayoutManager(n){this.undoHandler=mxUtils.bind(this,function(n,t){this.isEnabled()&&this.beforeUndo(t.getProperty("edit"))});this.moveHandler=mxUtils.bind(this,function(n,t){this.isEnabled()&&this.cellsMoved(t.getProperty("cells"),t.getProperty("event"))});this.setGraph(n)}function mxSwimlaneManager(n,t,i,r){this.horizontal=t!=null?t:!0;this.addEnabled=i!=null?i:!0;this.resizeEnabled=r!=null?r:!0;this.addHandler=mxUtils.bind(this,function(n,t){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(t.getProperty("cells"))});this.resizeHandler=mxUtils.bind(this,function(n,t){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(t.getProperty("cells"))});this.setGraph(n)}function mxTemporaryCellStates(n,t,i,r){var o,u,f,e;if(t=t!=null?t:1,this.view=n,this.oldValidateCellState=n.validateCellState,this.oldBounds=n.getGraphBounds(),this.oldStates=n.getStates(),this.oldScale=n.getScale(),o=this,n.validateCellState=function(t){return t==null||r==null||r(t)?o.oldValidateCellState.apply(n,arguments):null},n.setStates(new mxDictionary),n.setScale(t),i!=null){for(n.resetValidationState(),u=null,f=0;f<i.length;f++)e=n.getBoundingBox(n.validateCellState(n.validateCell(i[f]))),u==null?u=e:u.add(e);n.setGraphBounds(u||new mxRectangle)}}function mxCellStatePreview(n){this.deltas=new mxDictionary;this.graph=n}function mxConnectionConstraint(n,t){this.point=n;this.perimeter=t!=null?t:!0}function mxGraphHandler(n){this.graph=n;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape();this.updateHint()});this.graph.addListener(mxEvent.PAN,this.panHandler);this.escapeHandler=mxUtils.bind(this,function(){this.reset()});this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler)}function mxPanningHandler(n){n!=null&&(this.graph=n,this.graph.addMouseListener(this),this.forcePanningHandler=mxUtils.bind(this,function(n,t){var r=t.getProperty("eventName"),i=t.getProperty("event");r==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(i)&&(this.start(i),this.active=!0,this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",i)),i.consume())}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=mxUtils.bind(this,function(n,t){var r,i;this.isPinchEnabled()&&(r=t.getProperty("event"),mxEvent.isConsumed(r)||r.type!="gesturestart"?r.type=="gestureend"&&this.initialScale==null&&(this.initialScale=null):(this.initialScale=this.graph.view.scale,this.active||this.mouseDownEvent==null||(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),this.initialScale!=null&&(i=Math.round(this.initialScale*r.scale*100)/100,this.minScale!=null&&(i=Math.max(this.minScale,i)),this.maxScale!=null&&(i=Math.min(this.maxScale,i)),this.graph.view.scale!=i&&(this.graph.zoomTo(i),mxEvent.consume(r))))}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler))}function mxPopupMenuHandler(n,t){n!=null&&(this.graph=n,this.factoryMethod=t,this.graph.addMouseListener(this),this.gestureHandler=mxUtils.bind(this,function(){this.inTolerance=!1}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.init())}function mxCellMarker(n,t,i,r){mxEventSource.call(this);n!=null&&(this.graph=n,this.validColor=t!=null?t:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=t!=null?i:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=r!=null?r:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(n))}function mxSelectionCellsHandler(n){mxEventSource.call(this);this.graph=n;this.handlers=new mxDictionary;this.graph.addMouseListener(this);this.refreshHandler=mxUtils.bind(this,function(){this.isEnabled()&&this.refresh()});this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler);this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}function mxConnectionHandler(n,t){mxEventSource.call(this);n!=null&&(this.graph=n,this.factoryMethod=t,this.init(),this.escapeHandler=mxUtils.bind(this,function(){this.reset()}),this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxConstraintHandler(n){this.graph=n}function mxRubberband(n){n!=null&&(this.graph=n,this.graph.addMouseListener(this),this.forceRubberbandHandler=mxUtils.bind(this,function(n,t){var f=t.getProperty("eventName"),r=t.getProperty("event"),u,i;f==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(r)&&(u=mxUtils.getOffset(this.graph.container),i=mxUtils.getScrollOrigin(this.graph.container),i.x-=u.x,i.y-=u.y,this.start(r.getX()+i.x,r.getY()+i.y),r.consume(!1))}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),this.gestureHandler=mxUtils.bind(this,function(){this.first!=null&&this.reset()}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}function mxHandle(n,t,i){this.graph=n.view.graph;this.state=n;this.cursor=t!=null?t:this.cursor;this.image=i!=null?i:this.image;this.init()}function mxVertexHandler(n){n!=null&&(this.state=n,this.init(),this.escapeHandler=mxUtils.bind(this,function(){this.livePreview&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate());this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxEdgeHandler(n){n!=null&&(this.state=n,this.init(),this.escapeHandler=mxUtils.bind(this,function(){this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}function mxElbowEdgeHandler(n){mxEdgeHandler.call(this,n)}function mxEdgeSegmentHandler(n){mxEdgeHandler.call(this,n)}function mxKeyHandler(n,t){n!=null&&(this.graph=n,this.target=t||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=mxUtils.bind(this,function(n){this.keyDown(n)}),mxEvent.addListener(this.target,"keydown",this.keydownHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}function mxTooltipHandler(n,t){n!=null&&(this.graph=n,this.delay=t||500,this.graph.addMouseListener(this))}function mxCellTracker(n,t,i){mxCellMarker.call(this,n,t);this.graph.addMouseListener(this);i!=null&&(this.getCell=i);mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}function mxCellHighlight(n,t,i,r){n!=null&&(this.graph=n,this.highlightColor=t!=null?t:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=i!=null?i:mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=r!=null?r:!1,this.repaintHandler=mxUtils.bind(this,function(){if(this.state!=null){var n=this.graph.view.getState(this.state.cell);n==null?this.hide():(this.state=n,this.repaint())}}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}function mxDefaultKeyHandler(n){if(n!=null){this.editor=n;this.handler=new mxKeyHandler(n.graph);var t=this.handler.escape;this.handler.escape=function(i){t.apply(this,arguments);n.hideProperties();n.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",i))}}}function mxDefaultPopupMenu(n){this.config=n}function mxDefaultToolbar(n,t){this.editor=t;n!=null&&t!=null&&this.init(n)}function mxEditor(n){this.actions=[];this.addActions();document.body!=null&&(this.cycleAttributeValues=[],this.popupHandler=new mxDefaultPopupMenu,this.undoManager=new mxUndoManager,this.graph=this.createGraph(),this.toolbar=this.createToolbar(),this.keyHandler=new mxDefaultKeyHandler(this),this.configure(n),this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName,this.onInit!=null&&this.onInit(),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}function mxCodec(n){this.document=n||mxUtils.createXmlDocument();this.objects=[]}function mxObjectCodec(n,t,i,r){this.template=n;this.exclude=t!=null?t:[];this.idrefs=i!=null?i:[];this.mapping=r!=null?r:[];this.reverse={};for(var u in this.mapping)this.reverse[this.mapping[u]]=u}var mxClient={VERSION:"3.3.0.1",IS_IE:navigator.userAgent.indexOf("MSIE")>=0,IS_IE6:navigator.userAgent.indexOf("MSIE 6")>=0,IS_IE11:!!navigator.userAgent.match(/Trident\/7\./),IS_QUIRKS:navigator.userAgent.indexOf("MSIE")>=0&&(document.documentMode==null||document.documentMode==5),IS_EM:"spellcheck"in document.createElement("textarea")&&document.documentMode==8,VML_PREFIX:"v",OFFICE_PREFIX:"o",IS_NS:navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0,IS_OP:navigator.userAgent.indexOf("Opera/")>=0||navigator.userAgent.indexOf("OPR/")>=0,IS_OT:navigator.userAgent.indexOf("Presto/")>=0&&navigator.userAgent.indexOf("Presto/2.4.")<0&&navigator.userAgent.indexOf("Presto/2.3.")<0&&navigator.userAgent.indexOf("Presto/2.2.")<0&&navigator.userAgent.indexOf("Presto/2.1.")<0&&navigator.userAgent.indexOf("Presto/2.0.")<0&&navigator.userAgent.indexOf("Presto/1.")<0,IS_SF:navigator.userAgent.indexOf("AppleWebKit/")>=0&&navigator.userAgent.indexOf("Chrome/")<0,IS_IOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,IS_GC:navigator.userAgent.indexOf("Chrome/")>=0,IS_FF:navigator.userAgent.indexOf("Firefox/")>=0,IS_MT:navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0,IS_SVG:navigator.userAgent.indexOf("Firefox/")>=0||navigator.userAgent.indexOf("Iceweasel/")>=0||navigator.userAgent.indexOf("Seamonkey/")>=0||navigator.userAgent.indexOf("Iceape/")>=0||navigator.userAgent.indexOf("Galeon/")>=0||navigator.userAgent.indexOf("Epiphany/")>=0||navigator.userAgent.indexOf("AppleWebKit/")>=0||navigator.userAgent.indexOf("Gecko/")>=0||navigator.userAgent.indexOf("Opera/")>=0||document.documentMode!=null&&document.documentMode>=9,NO_FO:!document.createElementNS||document.createElementNS("http://www.w3.org/2000/svg","foreignObject")!="[object SVGForeignObjectElement]"||navigator.userAgent.indexOf("Opera/")>=0,IS_VML:navigator.appName.toUpperCase()=="MICROSOFT INTERNET EXPLORER",IS_WIN:navigator.appVersion.indexOf("Win")>0,IS_MAC:navigator.appVersion.indexOf("Mac")>0,IS_TOUCH:"ontouchstart"in document.documentElement,IS_POINTER:window.navigator.msPointerEnabled!=null?window.navigator.msPointerEnabled:!1,IS_LOCAL:document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0,isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(n,t,i){var r,u;i=i||document;mxClient.IS_IE6?i.write('<link rel="'+n+'" href="'+t+'" charset="ISO-8859-1" type="text/css"/>'):(r=i.createElement("link"),r.setAttribute("rel",n),r.setAttribute("href",t),r.setAttribute("charset","ISO-8859-1"),r.setAttribute("type","text/css"),u=i.getElementsByTagName("head")[0],u.appendChild(r))},include:function(n){document.write('<script src="'+n+'"><\/script>')},dispose:function(){for(var n=0;n<mxEvent.objects.length;n++)mxEvent.objects[n].mxListenerList!=null&&mxEvent.removeAllListeners(mxEvent.objects[n])}},mxLog,mxObjectIdentity,mxResources,mxEvent,mxClipboard,mxUrlConverter,mxVmlCanvas2D,mxStencilRegistry,mxMarker,mxHierarchicalEdgeStyle,mxCellPath,mxPerimeter,mxEdgeStyle,mxStyleRegistry,mxCodecRegistry,mxGenericChangeCodec,mxStylesheetCodec,mxDefaultToolbarCodec;typeof mxLoadResources=="undefined"&&(mxLoadResources=!0);typeof mxResourceExtension=="undefined"&&(mxResourceExtension=".txt");typeof mxLoadStylesheets=="undefined"&&(mxLoadStylesheets=!0);typeof mxBasePath!="undefined"&&mxBasePath.length>0?(mxBasePath.substring(mxBasePath.length-1)=="/"&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".";typeof mxImageBasePath!="undefined"&&mxImageBasePath.length>0?(mxImageBasePath.substring(mxImageBasePath.length-1)=="/"&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images";mxClient.language=typeof mxLanguage!="undefined"&&mxLanguage!=null?mxLanguage:mxClient.IS_IE?navigator.userLanguage:navigator.language;mxClient.defaultLanguage=typeof mxDefaultLanguage!="undefined"&&mxDefaultLanguage!=null?mxDefaultLanguage:"en";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css");typeof mxLanguages!="undefined"&&mxLanguages!=null&&(mxClient.languages=mxLanguages);mxClient.IS_VML&&(mxClient.IS_SVG?mxClient.IS_VML=!1:(document.documentMode==8?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office")),mxClient.IS_QUIRKS&&document.styleSheets.length>=30?function(){var n=document.createElement("style");n.type="text/css";n.styleSheet.cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}";document.getElementsByTagName("head")[0].appendChild(n)}():document.createStyleSheet().cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css"),window.attachEvent("onunload",mxClient.dispose)));mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){var o,n,i,r,s,u;if(mxLog.window==null&&document.body!=null){o=mxLog.consoleName+" - mxGraph "+mxClient.VERSION;n=document.createElement("table");n.setAttribute("width","100%");n.setAttribute("height","100%");var f=document.createElement("tbody"),t=document.createElement("tr"),e=document.createElement("td");e.style.verticalAlign="top";mxLog.textarea=document.createElement("textarea");mxLog.textarea.setAttribute("readOnly","true");mxLog.textarea.style.height="100%";mxLog.textarea.style.resize="none";mxLog.textarea.value=mxLog.buffer;mxLog.textarea.style.width=mxClient.IS_NS&&document.compatMode!="BackCompat"?"99%":"100%";e.appendChild(mxLog.textarea);t.appendChild(e);f.appendChild(t);t=document.createElement("tr");mxLog.td=document.createElement("td");mxLog.td.style.verticalAlign="top";mxLog.td.setAttribute("height","30px");t.appendChild(mxLog.td);f.appendChild(t);n.appendChild(f);mxLog.addButton("Info",function(){mxLog.info()});mxLog.addButton("DOM",function(){var n=mxUtils.getInnerHtml(document.body);mxLog.debug(n)});mxLog.addButton("Trace",function(){mxLog.TRACE=!mxLog.TRACE;mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")});mxLog.addButton("Copy",function(){try{mxUtils.copy(mxLog.textarea.value)}catch(n){mxUtils.alert(n)}});mxLog.addButton("Show",function(){try{mxUtils.popup(mxLog.textarea.value)}catch(n){mxUtils.alert(n)}});mxLog.addButton("Clear",function(){mxLog.textarea.value=""});i=0;r=0;typeof innerWidth=="number"?(i=window.innerHeight,r=window.innerWidth):(i=document.documentElement.clientHeight||document.body.clientHeight,r=document.body.clientWidth);mxLog.window=new mxWindow(o,n,Math.max(0,r-320),Math.max(0,i-210),300,160);mxLog.window.setMaximizable(!0);mxLog.window.setScrollable(!1);mxLog.window.setResizable(!0);mxLog.window.setClosable(!0);mxLog.window.destroyOnClose=!1;(!(mxClient.IS_NS||mxClient.IS_IE)||mxClient.IS_GC||mxClient.IS_SF||document.compatMode=="BackCompat")&&document.documentMode!=11||(s=mxLog.window.getElement(),u=function(){mxLog.textarea.style.height=Math.max(0,s.offsetHeight-70)+"px"},mxLog.window.addListener(mxEvent.RESIZE_END,u),mxLog.window.addListener(mxEvent.MAXIMIZE,u),mxLog.window.addListener(mxEvent.NORMALIZE,u),mxLog.textarea.style.height="92px")}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(n,t){var i=document.createElement("button");mxUtils.write(i,n);mxEvent.addListener(i,"click",t);mxLog.td.appendChild(i)},isVisible:function(){return mxLog.window!=null?mxLog.window.isVisible():!1},show:function(){mxLog.setVisible(!0)},setVisible:function(n){mxLog.window==null&&mxLog.init();mxLog.window!=null&&mxLog.window.setVisible(n)},enter:function(n){if(mxLog.TRACE)return mxLog.writeln("Entering "+n),(new Date).getTime()},leave:function(n,t){if(mxLog.TRACE){var i=t!=0?" ("+((new Date).getTime()-t)+" ms)":"";mxLog.writeln("Leaving "+n+i)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,arguments)},write:function(){for(var n="",t=0;t<arguments.length;t++)n+=arguments[t],t<arguments.length-1&&(n+=" ");mxLog.textarea!=null?(mxLog.textarea.value=mxLog.textarea.value+n,navigator.userAgent.indexOf("Presto/2.5")>=0&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=n},writeln:function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n],n<arguments.length-1&&(t+=" ");mxLog.write(t+"\n")}};mxObjectIdentity={FIELD_NAME:"mxObjectId",counter:0,get:function(n){if(n[mxObjectIdentity.FIELD_NAME]==null)if(typeof n=="object"){var t=mxUtils.getFunctionName(n.constructor);n[mxObjectIdentity.FIELD_NAME]=t+"#"+mxObjectIdentity.counter++}else typeof n=="function"&&(n[mxObjectIdentity.FIELD_NAME]="Function#"+mxObjectIdentity.counter++);return n[mxObjectIdentity.FIELD_NAME]},clear:function(n){(typeof n=="object"||typeof n=="function")&&delete n[mxObjectIdentity.FIELD_NAME]}};mxDictionary.prototype.map=null;mxDictionary.prototype.clear=function(){this.map={}};mxDictionary.prototype.get=function(n){var t=mxObjectIdentity.get(n);return this.map[t]};mxDictionary.prototype.put=function(n,t){var i=mxObjectIdentity.get(n),r=this.map[i];return this.map[i]=t,r};mxDictionary.prototype.remove=function(n){var t=mxObjectIdentity.get(n),i=this.map[t];return delete this.map[t],i};mxDictionary.prototype.getKeys=function(){var n=[];for(var t in this.map)n.push(t);return n};mxDictionary.prototype.getValues=function(){var n=[];for(var t in this.map)n.push(this.map[t]);return n};mxDictionary.prototype.visit=function(n){for(var t in this.map)n(t,this.map[t])};mxResources={resources:[],extension:mxResourceExtension,resourcesEncoded:!1,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(n){return mxClient.languages!=null?mxUtils.indexOf(mxClient.languages,n)>=0:!0},getDefaultBundle:function(n,t){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(t)?n+mxResources.extension:null},getSpecialBundle:function(n,t){if(mxClient.languages==null||!this.isLanguageSupported(t)){var i=t.indexOf("-");i>0&&(t=t.substring(0,i))}return mxResources.loadSpecialBundle&&mxResources.isLanguageSupported(t)&&t!=mxClient.defaultLanguage?n+"_"+t+mxResources.extension:null},add:function(n,t){var r,u,i;if(t=t!=null?t:mxClient.language!=null?mxClient.language.toLowerCase():mxConstants.NONE,t!=mxConstants.NONE){if(r=mxResources.getDefaultBundle(n,t),r!=null)try{i=mxUtils.load(r);i.isReady()&&mxResources.parse(i.getText())}catch(f){}if(u=mxResources.getSpecialBundle(n,t),u!=null)try{i=mxUtils.load(u);i.isReady()&&mxResources.parse(i.getText())}catch(f){}}},parse:function(n){var i,t,u,e,f,r;if(n!=null)for(i=n.split("\n"),t=0;t<i.length;t++)i[t].charAt(0)!="#"&&(u=i[t].indexOf("="),u>0&&(e=i[t].substring(0,u),f=i[t].length,i[t].charCodeAt(f-1)==13&&f--,r=i[t].substring(u+1,f),this.resourcesEncoded?(r=r.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[e]=unescape(r)):mxResources.resources[e]=r))},get:function(n,t,i){var u=mxResources.resources[n],e,r,o,f;if(u==null&&(u=i),u!=null&&t!=null){for(e=[],r=null,o=0;o<u.length;o++)f=u.charAt(o),f=="{"?r="":r!=null&&f=="}"?(r=parseInt(r)-1,r>=0&&r<t.length&&e.push(t[r]),r=null):r!=null?r+=f:e.push(f);u=e.join("")}return u}};mxPoint.prototype.x=null;mxPoint.prototype.y=null;mxPoint.prototype.equals=function(n){return n!=null&&n.x==this.x&&n.y==this.y};mxPoint.prototype.clone=function(){return mxUtils.clone(this)};mxRectangle.prototype=new mxPoint;mxRectangle.prototype.constructor=mxRectangle;mxRectangle.prototype.width=null;mxRectangle.prototype.height=null;mxRectangle.prototype.setRect=function(n,t,i,r){this.x=n;this.y=t;this.width=i;this.height=r};mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2};mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2};mxRectangle.prototype.add=function(n){if(n!=null){var t=Math.min(this.x,n.x),i=Math.min(this.y,n.y),r=Math.max(this.x+this.width,n.x+n.width),u=Math.max(this.y+this.height,n.y+n.height);this.x=t;this.y=i;this.width=r-t;this.height=u-i}};mxRectangle.prototype.grow=function(n){this.x-=n;this.y-=n;this.width+=2*n;this.height+=2*n};mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)};mxRectangle.prototype.rotate90=function(){var n=(this.width-this.height)/2,t;this.x+=n;this.y-=n;t=this.width;this.width=this.height;this.height=t};mxRectangle.prototype.equals=function(n){return n!=null&&n.x==this.x&&n.y==this.y&&n.width==this.width&&n.height==this.height};mxRectangle.fromRectangle=function(n){return new mxRectangle(n.x,n.y,n.width,n.height)};var mxEffects={animateChanges:function(n,t,i){var r=10,u=0,f=function(){for(var o,s,l=!1,c=0;c<t.length;c++)if(o=t[c],(o instanceof mxGeometryChange||o instanceof mxTerminalChange||o instanceof mxValueChange||o instanceof mxChildChange||o instanceof mxStyleChange)&&(s=n.getView().getState(o.cell||o.child,!1),s!=null))if(l=!0,o.constructor!=mxGeometryChange||n.model.isEdge(o.cell))mxUtils.setOpacity(s.shape.node,100*u/r);else{var h=n.getView().scale,a=(o.geometry.x-o.previous.x)*h,v=(o.geometry.y-o.previous.y)*h,y=(o.geometry.width-o.previous.width)*h,p=(o.geometry.height-o.previous.height)*h;u==0?(s.x-=a,s.y-=v,s.width-=y,s.height-=p):(s.x+=a/r,s.y+=v/r,s.width+=y/r,s.height+=p/r);n.cellRenderer.redraw(s);mxEffects.cascadeOpacity(n,o.cell,100*u/r)}u<r&&l?(u++,window.setTimeout(f,e)):i!=null&&i()},e=30;f()},cascadeOpacity:function(n,t,i){for(var f,e,u,o,s=n.model.getChildCount(t),r=0;r<s;r++)f=n.model.getChildAt(t,r),e=n.getView().getState(f),e!=null&&(mxUtils.setOpacity(e.shape.node,i),mxEffects.cascadeOpacity(n,f,i));if(u=n.model.getEdges(t),u!=null)for(r=0;r<u.length;r++)o=n.getView().getState(u[r]),o!=null&&mxUtils.setOpacity(o.shape.node,i)},fadeOut:function(n,t,i,r,u,f){var e,o;r=r||40;u=u||30;e=t||100;mxUtils.setOpacity(n,e);f||f==null?(o=function(){e=Math.max(e-r,0);mxUtils.setOpacity(n,e);e>0?window.setTimeout(o,u):(n.style.visibility="hidden",i&&n.parentNode&&n.parentNode.removeChild(n))},window.setTimeout(o,u)):(n.style.visibility="hidden",i&&n.parentNode&&n.parentNode.removeChild(n))}},mxUtils={errorResource:mxClient.language!="none"?"error":"",closeResource:mxClient.language!="none"?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(n){var t,r,i;if(n.style!=null&&(n.style.cursor=""),t=n.childNodes,t!=null)for(r=t.length,i=0;i<r;i+=1)mxUtils.removeCursors(t[i])},getCurrentStyle:function(){return mxClient.IS_IE?function(n){return n!=null?n.currentStyle:null}:function(n){return n!=null?window.getComputedStyle(n,""):null}}(),setPrefixedStyle:function(){var n=null;return mxClient.IS_OT?n="O":mxClient.IS_SF||mxClient.IS_GC?n="Webkit":mxClient.IS_MT?n="Moz":mxClient.IS_IE&&document.documentMode>=9&&document.documentMode<10&&(n="ms"),function(t,i,r){t[i]=r;n!=null&&i.length>0&&(i=n+i.substring(0,1).toUpperCase()+i.substring(1),t[i]=r)}}(),hasScrollbars:function(n){var t=mxUtils.getCurrentStyle(n);return t!=null&&(t.overflow=="scroll"||t.overflow=="auto")},bind:function(n,t){return function(){return t.apply(n,arguments)}},eval:function(expr){var result=null;if(expr.indexOf("function")>=0)try{eval("var _mxJavaScriptExpression="+expr);result=_mxJavaScriptExpression;_mxJavaScriptExpression=null}catch(e){mxLog.warn(e.message+" while evaluating "+expr)}else try{result=eval(expr)}catch(e){mxLog.warn(e.message+" while evaluating "+expr)}return result},findNode:function(n,t,i){var r,u;if(n.nodeType==mxConstants.NODETYPE_ELEMENT&&(r=n.getAttribute(t),r!=null&&r==i))return n;for(n=n.firstChild;n!=null;){if(u=mxUtils.findNode(n,t,i),u!=null)return u;n=n.nextSibling}return null},getFunctionName:function(n){var r=null,i,t,u;if(n!=null)if(n.name!=null)r=n.name;else{for(i=n.toString(),t=9;i.charAt(t)==" ";)t++;u=i.indexOf("(",t);r=i.substring(t,u)}return r},indexOf:function(n,t){if(n!=null&&t!=null)for(var i=0;i<n.length;i++)if(n[i]==t)return i;return-1},remove:function(n,t){var r=null,i,u;if(typeof t=="object")for(i=mxUtils.indexOf(t,n);i>=0;)t.splice(i,1),r=n,i=mxUtils.indexOf(t,n);for(u in t)t[u]==n&&(delete t[u],r=n);return r},isNode:function(n,t,i,r){return n!=null&&!isNaN(n.nodeType)&&(t==null||n.nodeName.toLowerCase()==t.toLowerCase())?i==null||n.getAttribute(i)==r:!1},isAncestorNode:function(n,t){for(var i=t;i!=null;){if(i==n)return!0;i=i.parentNode}return!1},getChildNodes:function(n,t){t=t||mxConstants.NODETYPE_ELEMENT;for(var r=[],i=n.firstChild;i!=null;)i.nodeType==t&&r.push(i),i=i.nextSibling;return r},importNode:function(n,t,i){var u,r;if(mxClient.IS_IE&&(document.documentMode==null||document.documentMode<10))switch(t.nodeType){case 1:if(u=n.createElement(t.nodeName),t.attributes&&t.attributes.length>0){for(r=0;r<t.attributes.length;r++)u.setAttribute(t.attributes[r].nodeName,t.getAttribute(t.attributes[r].nodeName));if(i&&t.childNodes&&t.childNodes.length>0)for(r=0;r<t.childNodes.length;r++)u.appendChild(mxUtils.importNode(n,t.childNodes[r],i))}return u;case 3:case 4:case 8:return n.createTextNode(t.value)}else return n.importNode(t,i)},createXmlDocument:function(){var n=null;return document.implementation&&document.implementation.createDocument?n=document.implementation.createDocument("","",null):window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLDOM")),n},parseXml:function(){return window.DOMParser?function(n){var t=new DOMParser;return t.parseFromString(n,"text/xml")}:function(n){var t=mxUtils.createXmlDocument();return t.async="false",t.loadXML(n),t}}(),clearSelection:function(){return document.selection?function(){document.selection.empty()}:window.getSelection?function(){window.getSelection().removeAllRanges()}:function(){}}(),getPrettyXml:function(n,t,i){var r=[],f,e,o,u;if(n!=null)if(t=t||"  ",i=i||"",n.nodeType==mxConstants.NODETYPE_TEXT)r.push(n.value);else{if(r.push(i+"<"+n.nodeName),f=n.attributes,f!=null)for(e=0;e<f.length;e++)o=mxUtils.htmlEntities(f[e].value),r.push(" "+f[e].nodeName+'="'+o+'"');if(u=n.firstChild,u!=null){for(r.push(">\n");u!=null;)r.push(mxUtils.getPrettyXml(u,t,i+t)),u=u.nextSibling;r.push(i+"<\/"+n.nodeName+">\n")}else r.push("/>\n")}return r.join("")},removeWhitespace:function(n,t){for(var i=t?n.previousSibling:n.nextSibling,r,u;i!=null&&i.nodeType==mxConstants.NODETYPE_TEXT;)r=t?i.previousSibling:i.nextSibling,u=mxUtils.getTextContent(i),mxUtils.trim(u).length==0&&i.parentNode.removeChild(i),i=r},htmlEntities:function(n,t){return n=n||"",n=n.replace(/&/g,"&amp;"),n=n.replace(/"/g,"&quot;"),n=n.replace(/\'/g,"&#39;"),n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),(t==null||t)&&(n=n.replace(/\n/g,"&#xa;")),n},isVml:function(n){return n!=null&&n.tagUrn=="urn:schemas-microsoft-com:vml"},getXml:function(n,t){var i="",r;return window.XMLSerializer!=null?(r=new XMLSerializer,i=r.serializeToString(n)):n.xml!=null&&(i=n.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,">").replace(/\r\n/g,"\n")),t=t||"&#xa;",i.replace(/\n/g,t)},getTextContent:function(n){return n.innerText!==undefined?n.innerText:n!=null?n[n.textContent===undefined?"text":"textContent"]:""},setTextContent:function(n,t){n.innerText!==undefined?n.innerText=t:n[n.textContent===undefined?"text":"textContent"]=t},getInnerHtml:function(){return mxClient.IS_IE?function(n){return n!=null?n.innerHTML:""}:function(n){if(n!=null){var t=new XMLSerializer;return t.serializeToString(n)}return""}}(),getOuterHtml:function(){return mxClient.IS_IE?function(n){var t,i,r,u;if(n!=null){if(n.outerHTML!=null)return n.outerHTML;if(t=[],t.push("<"+n.nodeName),i=n.attributes,i!=null)for(r=0;r<i.length;r++)u=i[r].value,u!=null&&u.length>0&&(t.push(" "),t.push(i[r].nodeName),t.push('="'),t.push(u),t.push('"'));return n.innerHTML.length==0?t.push("/>"):(t.push(">"),t.push(n.innerHTML),t.push("<\/"+n.nodeName+">")),t.join("")}return""}:function(n){if(n!=null){var t=new XMLSerializer;return t.serializeToString(n)}return""}}(),write:function(n,t){var r=n.ownerDocument,i=r.createTextNode(t);return n!=null&&n.appendChild(i),i},writeln:function(n,t){var r=n.ownerDocument,i=r.createTextNode(t);return n!=null&&(n.appendChild(i),n.appendChild(document.createElement("br"))),i},br:function(n,t){var i,r;for(t=t||1,i=null,r=0;r<t;r++)n!=null&&(i=n.ownerDocument.createElement("br"),n.appendChild(i));return i},button:function(n,t,i){i=i!=null?i:document;var r=i.createElement("button");return mxUtils.write(r,n),mxEvent.addListener(r,"click",function(n){t(n)}),r},para:function(n,t){var i=document.createElement("p");return mxUtils.write(i,t),n!=null&&n.appendChild(i),i},addTransparentBackgroundFilter:function(n){n.style.filter+="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"},linkAction:function(n,t,i,r,u){return mxUtils.link(n,t,function(){i.execute(r)},u)},linkInvoke:function(n,t,i,r,u,f){return mxUtils.link(n,t,function(){i[r](u)},f)},link:function(n,t,i,r){var u=document.createElement("span");return u.style.color="blue",u.style.textDecoration="underline",u.style.cursor="pointer",r!=null&&(u.style.paddingLeft=r+"px"),mxEvent.addListener(u,"click",i),mxUtils.write(u,t),n!=null&&n.appendChild(u),u},fit:function(n){var c=parseInt(n.offsetLeft),t=parseInt(n.offsetWidth),i=mxUtils.getDocumentScrollOrigin(n.ownerDocument),r=i.x,u=i.y,f=document.body,e=document.documentElement,o=r+(f.clientWidth||e.clientWidth);c+t>o&&(n.style.left=Math.max(r,o-t)+"px");var l=parseInt(n.offsetTop),s=parseInt(n.offsetHeight),h=u+Math.max(f.clientHeight||0,e.clientHeight);l+s>h&&(n.style.top=Math.max(u,h-s)+"px")},load:function(n){var t=new mxXmlRequest(n,null,"GET",!1);return t.send(),t},get:function(n,t,i,r,u,f){var e=new mxXmlRequest(n,null,"GET");return r!=null&&e.setBinary(r),e.send(t,i,u,f),e},post:function(n,t,i,r){return new mxXmlRequest(n,t).send(i,r)},submit:function(n,t,i,r){return new mxXmlRequest(n,t).simulate(i,r)},loadInto:function(n,t,i){mxClient.IS_IE?t.onreadystatechange=function(){t.readyState==4&&i()}:t.addEventListener("load",i,!1);t.load(n)},getValue:function(n,t,i){var r=n!=null?n[t]:null;return r==null&&(r=i),r},getNumber:function(n,t,i){var r=n!=null?n[t]:null;return r==null&&(r=i||0),Number(r)},getColor:function(n,t,i){var r=n!=null?n[t]:null;return r==null?r=i:r==mxConstants.NONE&&(r=null),r},clone:function(n,t,i){var u,r;if(i=i!=null?i:!1,u=null,n!=null&&typeof n.constructor=="function"){u=new n.constructor;for(r in n)r!=mxObjectIdentity.FIELD_NAME&&(t==null||mxUtils.indexOf(t,r)<0)&&(u[r]=i||typeof n[r]!="object"?n[r]:mxUtils.clone(n[r]))}return u},equalPoints:function(n,t){if(n==null&&t!=null||n!=null&&t==null||n!=null&&t!=null&&n.length!=t.length)return!1;if(n!=null&&t!=null)for(var i=0;i<n.length;i++)if(n[i]==t[i]||n[i]!=null&&!n[i].equals(t[i]))return!1;return!0},equalEntries:function(n,t){if(n==null&&t!=null||n!=null&&t==null||n!=null&&t!=null&&n.length!=t.length)return!1;if(n!=null&&t!=null)for(var i in n)if((!mxUtils.isNaN(n[i])||!mxUtils.isNaN(t[i]))&&n[i]!=t[i])return!1;return!0},isNaN:function(n){return typeof n=="number"&&isNaN(n)},extend:function(n,t){var i=function(){};i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n},toString:function(n){var i="",t,r;for(t in n)try{n[t]==null?i+=t+" = [null]\n":typeof n[t]=="function"?i+=t+" => [Function]\n":typeof n[t]=="object"?(r=mxUtils.getFunctionName(n[t].constructor),i+=t+" => ["+r+"]\n"):i+=t+" = "+n[t]+"\n"}catch(u){i+=t+"="+u.message}return i},toRadians:function(n){return Math.PI*n/180},toDegree:function(n){return n*180/Math.PI},arcToCurves:function(n,t,i,r,u,f,e,o,s){var tt,ct,yt,l,ht;if(o-=n,s-=t,i===0||r===0)return h;tt=e;ct=u;i=Math.abs(i);r=Math.abs(r);var gt=-o/2,ni=-s/2,y=Math.cos(ct*Math.PI/180),p=Math.sin(ct*Math.PI/180),w=y*gt+p*ni,b=-1*p*gt+y*ni,lt=w*w,at=b*b,it=i*i,rt=r*r,vt=lt/it+at/rt,ut;vt>1?(i=Math.sqrt(vt)*i,r=Math.sqrt(vt)*r,ut=0):(yt=1,f===tt&&(yt=-1),ut=yt*Math.sqrt((it*rt-it*at-rt*lt)/(it*at+rt*lt)));var d=ut*i*b/r,g=-1*ut*r*w/i,ei=y*d-p*g+o/2,oi=p*d+y*g+s/2,c=Math.atan2((b-g)/r,(w-d)/i)-Math.atan2(0,1),nt=c>=0?c:2*Math.PI+c;c=Math.atan2((-b-g)/r,(-w-d)/i)-Math.atan2((b-g)/r,(w-d)/i);l=c>=0?c:2*Math.PI+c;tt==0&&l>0?l-=2*Math.PI:tt!=0&&l<0&&(l+=2*Math.PI);var pt=l*2/Math.PI,ti=Math.ceil(pt<0?-1*pt:pt),ft=l/ti,et=8/3*Math.sin(ft/4)*Math.sin(ft/4)/Math.sin(ft/2),wt=y*i,bt=y*r,kt=p*i,dt=p*r,a=Math.cos(nt),v=Math.sin(nt),ii=-et*(wt*v+dt*a),ri=-et*(kt*v-bt*a),ot=0,st=0,h=[];for(ht=0;ht<ti;++ht){nt+=ft;a=Math.cos(nt);v=Math.sin(nt);ot=wt*a-dt*v+ei;st=kt*a+bt*v+oi;var ui=-et*(wt*v+dt*a),fi=-et*(kt*v-bt*a),k=ht*6;h[k]=Number(ii+n);h[k+1]=Number(ri+t);h[k+2]=Number(ot-ui+n);h[k+3]=Number(st-fi+t);h[k+4]=Number(ot+n);h[k+5]=Number(st+t);ii=ot+ui;ri=st+fi}return h},getBoundingBox:function(n,t,i){var r=null;if(n!=null&&t!=null&&t!=0){var c=mxUtils.toRadians(t),e=Math.cos(c),o=Math.sin(c);i=i!=null?i:new mxPoint(n.x+n.width/2,n.y+n.height/2);var s=new mxPoint(n.x,n.y),u=new mxPoint(n.x+n.width,n.y),f=new mxPoint(u.x,n.y+n.height),h=new mxPoint(n.x,f.y);s=mxUtils.getRotatedPoint(s,e,o,i);u=mxUtils.getRotatedPoint(u,e,o,i);f=mxUtils.getRotatedPoint(f,e,o,i);h=mxUtils.getRotatedPoint(h,e,o,i);r=new mxRectangle(s.x,s.y,0,0);r.add(new mxRectangle(u.x,u.y,0,0));r.add(new mxRectangle(f.x,f.y,0,0));r.add(new mxRectangle(h.x,h.y,0,0))}return r},getRotatedPoint:function(n,t,i,r){r=r!=null?r:new mxPoint;var u=n.x-r.x,f=n.y-r.y,e=u*t-f*i,o=f*t+u*i;return new mxPoint(e+r.x,o+r.y)},getPortConstraints:function(n,t,i,r){var s=mxUtils.getValue(n.style,mxConstants.STYLE_PORT_CONSTRAINT,null),f;if(s==null)return r;var o=s.toString(),u=mxConstants.DIRECTION_MASK_NONE,h=mxUtils.getValue(n.style,mxConstants.STYLE_PORT_CONSTRAINT_ROTATION,0),e=0;if(h==1&&(e=mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION,0)),f=0,e>45?(f=1,e>=135&&(f=2)):e<-45&&(f=3,e<=-135&&(f=2)),o.indexOf(mxConstants.DIRECTION_NORTH)>=0)switch(f){case 0:u|=mxConstants.DIRECTION_MASK_NORTH;break;case 1:u|=mxConstants.DIRECTION_MASK_EAST;break;case 2:u|=mxConstants.DIRECTION_MASK_SOUTH;break;case 3:u|=mxConstants.DIRECTION_MASK_WEST}if(o.indexOf(mxConstants.DIRECTION_WEST)>=0)switch(f){case 0:u|=mxConstants.DIRECTION_MASK_WEST;break;case 1:u|=mxConstants.DIRECTION_MASK_NORTH;break;case 2:u|=mxConstants.DIRECTION_MASK_EAST;break;case 3:u|=mxConstants.DIRECTION_MASK_SOUTH}if(o.indexOf(mxConstants.DIRECTION_SOUTH)>=0)switch(f){case 0:u|=mxConstants.DIRECTION_MASK_SOUTH;break;case 1:u|=mxConstants.DIRECTION_MASK_WEST;break;case 2:u|=mxConstants.DIRECTION_MASK_NORTH;break;case 3:u|=mxConstants.DIRECTION_MASK_EAST}if(o.indexOf(mxConstants.DIRECTION_EAST)>=0)switch(f){case 0:u|=mxConstants.DIRECTION_MASK_EAST;break;case 1:u|=mxConstants.DIRECTION_MASK_SOUTH;break;case 2:u|=mxConstants.DIRECTION_MASK_WEST;break;case 3:u|=mxConstants.DIRECTION_MASK_NORTH}return u},reversePortConstraints:function(n){var t=0;return t=(n&mxConstants.DIRECTION_MASK_WEST)<<3,t|=(n&mxConstants.DIRECTION_MASK_NORTH)<<1,t|=(n&mxConstants.DIRECTION_MASK_SOUTH)>>1,t|(n&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(n,t,i){var s=-1,u,f,r,e,o;if(n.absolutePoints.length>0)for(u=n.absolutePoints[0],f=null,r=1;r<n.absolutePoints.length;r++)e=n.absolutePoints[r],o=mxUtils.ptSegDistSq(u.x,u.y,e.x,e.y,t,i),(f==null||o<f)&&(f=o,s=r-1),u=e;return s},rectangleIntersectsSegment:function(n,t,i){var s=n.y,h=n.x,l=s+n.height,a=h+n.width,f=t.x,e=i.x,o,c,y;if(t.x>i.x&&(f=i.x,e=t.x),e>a&&(e=a),f<h&&(f=h),f>e)return!1;var r=t.y,u=i.y,v=i.x-t.x;return(Math.abs(v)>1e-7&&(o=(i.y-t.y)/v,c=t.y-o*t.x,r=o*f+c,u=o*e+c),r>u&&(y=u,u=r,r=y),u>l&&(u=l),r<s&&(r=s),r>u)?!1:!0},contains:function(n,t,i){return n.x<=t&&n.x+n.width>=t&&n.y<=i&&n.y+n.height>=i},intersects:function(n,t){var i=n.width,r=n.height,u=t.width,f=t.height;if(u<=0||f<=0||i<=0||r<=0)return!1;var e=n.x,o=n.y,s=t.x,h=t.y;return u+=s,f+=h,i+=e,r+=o,(u<s||u>e)&&(f<h||f>o)&&(i<e||i>s)&&(r<o||r>h)},intersectsHotspot:function(n,t,i,r,u,f){var a,h;if(r=r!=null?r:1,u=u!=null?u:0,f=f!=null?f:0,r>0){var c=n.getCenterX(),l=n.getCenterY(),e=n.width,o=n.height,s=mxUtils.getValue(n.style,mxConstants.STYLE_STARTSIZE)*n.view.scale;if(s>0&&(mxUtils.getValue(n.style,mxConstants.STYLE_HORIZONTAL,!0)?(l=n.y+s/2,o=s):(c=n.x+s/2,e=s)),e=Math.max(u,e*r),o=Math.max(u,o*r),f>0&&(e=Math.min(e,f),o=Math.min(o,f)),a=new mxRectangle(c-e/2,l-o/2,e,o),h=mxUtils.toRadians(mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION)||0),h!=0){var y=Math.cos(-h),p=Math.sin(-h),c=new mxPoint(n.getCenterX(),n.getCenterY()),v=mxUtils.getRotatedPoint(new mxPoint(t,i),y,p,c);t=v.x;i=v.y}return mxUtils.contains(a,t,i)}return!0},getOffset:function(n,t){var i=0,r=0,u;for(t!=null&&t&&(u=mxUtils.getDocumentScrollOrigin(n.ownerDocument),i+=u.x,r+=u.y);n.offsetParent;)i+=n.offsetLeft,r+=n.offsetTop,n=n.offsetParent;return new mxPoint(i,r)},getDocumentScrollOrigin:function(n){if(mxClient.IS_QUIRKS)return new mxPoint(n.body.scrollLeft,n.body.scrollTop);var t=n.defaultView||n.parentWindow,i=t!=null&&window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,r=t!=null&&window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new mxPoint(i,r)},getScrollOrigin:function(n){for(var i=document.body,r=document.documentElement,t=mxUtils.getDocumentScrollOrigin(n!=null?n.ownerDocument:document);n!=null&&n!=i&&n!=r;)isNaN(n.scrollLeft)||isNaN(n.scrollTop)||(t.x+=n.scrollLeft,t.y+=n.scrollTop),n=n.parentNode;return t},convertPoint:function(n,t,i){var u=mxUtils.getScrollOrigin(n),r=mxUtils.getOffset(n);return r.x-=u.x,r.y-=u.y,new mxPoint(t-r.x,i-r.y)},ltrim:function(n,t){return t=t||"\\s",n.replace(new RegExp("^["+t+"]+","g"),"")},rtrim:function(n,t){return t=t||"\\s",n.replace(new RegExp("["+t+"]+$","g"),"")},trim:function(n,t){return mxUtils.ltrim(mxUtils.rtrim(n,t),t)},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)&&(typeof n!="string"||n.toLowerCase().indexOf("0x")<0)},isInteger:function(n){return String(parseInt(n))===String(n)},mod:function(n,t){return(n%t+t)%t},intersection:function(n,t,i,r,u,f,e,o){var h=(o-f)*(i-n)-(e-u)*(r-t),v=(e-u)*(t-f)-(o-f)*(n-u),y=(i-n)*(t-f)-(r-t)*(n-u),s=v/h,c=y/h,l,a;return s>=0&&s<=1&&c>=0&&c<=1?(l=n+s*(i-n),a=t+s*(r-t),new mxPoint(l,a)):null},ptSegDistSq:function(n,t,i,r,u,f){var e,s,o;return i-=n,r-=t,u-=n,f-=t,e=u*i+f*r,e<=0?s=0:(u=i-u,f=r-f,e=u*i+f*r,s=e<=0?0:e*e/(i*i+r*r)),o=u*u+f*f-s,o<0&&(o=0),o},ptLineDist:function(n,t,i,r,u,f){return Math.abs((r-t)*u-(i-n)*f+i*t-r*n)/Math.sqrt((r-t)*(r-t)+(i-n)*(i-n))},relativeCcw:function(n,t,i,r,u,f){i-=n;r-=t;u-=n;f-=t;var e=u*r-f*i;return e==0&&(e=u*i+f*r,e>0&&(u-=i,f-=r,e=u*i+f*r,e<0&&(e=0))),e<0?-1:e>0?1:0},animateChanges:function(){mxEffects.animateChanges.apply(this,arguments)},cascadeOpacity:function(){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(n,t){mxUtils.isVml(n)?n.style.filter=t>=100?"":"alpha(opacity="+t/5+")":mxClient.IS_IE&&(typeof document.documentMode=="undefined"||document.documentMode<9)?n.style.filter=t>=100?"":"alpha(opacity="+t+")":n.style.opacity=t/100},createImage:function(n){var t=null;return mxClient.IS_IE6&&document.compatMode!="CSS1Compat"?(t=document.createElement(mxClient.VML_PREFIX+":image"),t.setAttribute("src",n),t.style.borderStyle="none"):(t=document.createElement("img"),t.setAttribute("src",n),t.setAttribute("border","0")),t},sortCells:function(n,t){t=t!=null?t:!0;var i=new mxDictionary;return n.sort(function(n,r){var f=i.get(n),u,e;return f==null&&(f=mxCellPath.create(n).split(mxCellPath.PATH_SEPARATOR),i.put(n,f)),u=i.get(r),u==null&&(u=mxCellPath.create(r).split(mxCellPath.PATH_SEPARATOR),i.put(r,u)),e=mxCellPath.compare(f,u),e==0?0:e>0==t?1:-1}),n},getStylename:function(n){if(n!=null){var i=n.split(";"),t=i[0];if(t.indexOf("=")<0)return t}return""},getStylenames:function(n){var r=[],i,t;if(n!=null)for(i=n.split(";"),t=0;t<i.length;t++)i[t].indexOf("=")<0&&r.push(i[t]);return r},indexOfStylename:function(n,t){var r,u,i;if(n!=null&&t!=null)for(r=n.split(";"),u=0,i=0;i<r.length;i++){if(r[i]==t)return u;u+=r[i].length+1}return-1},addStylename:function(n,t){return mxUtils.indexOfStylename(n,t)<0&&(n==null?n="":n.length>0&&n.charAt(n.length-1)!=";"&&(n+=";"),n+=t),n},removeStylename:function(n,t){var u=[],r,i;if(n!=null)for(r=n.split(";"),i=0;i<r.length;i++)r[i]!=t&&u.push(r[i]);return u.join(";")},removeAllStylenames:function(n){var r=[],i,t;if(n!=null)for(i=n.split(";"),t=0;t<i.length;t++)i[t].indexOf("=")>=0&&r.push(i[t]);return r.join(";")},setCellStyles:function(n,t,i,r){var u,f;if(t!=null&&t.length>0){n.beginUpdate();try{for(u=0;u<t.length;u++)t[u]!=null&&(f=mxUtils.setStyle(n.getStyle(t[u]),i,r),n.setStyle(t[u],f))}finally{n.endUpdate()}}},setStyle:function(n,t,i){var f=i!=null&&(typeof i.length=="undefined"||i.length>0),u,e,r;return n==null||n.length==0?f&&(n=t+"="+i+";"):n.substring(0,t.length+1)==t+"="?(r=n.indexOf(";"),n=f?t+"="+i+(r<0?";":n.substring(r)):r<0||r==n.length-1?"":n.substring(r+1)):(u=n.indexOf(";"+t+"="),u<0?f&&(e=n.charAt(n.length-1)==";"?"":";",n=n+e+t+"="+i+";"):(r=n.indexOf(";",u+1),n=f?n.substring(0,u+1)+t+"="+i+(r<0?";":n.substring(r)):n.substring(0,u)+(r<0?";":n.substring(r)))),n},setCellStyleFlags:function(n,t,i,r,u){var f,e;if(t!=null&&t.length>0){n.beginUpdate();try{for(f=0;f<t.length;f++)t[f]!=null&&(e=mxUtils.setStyleFlag(n.getStyle(t[f]),i,r,u),n.setStyle(t[f],e))}finally{n.endUpdate()}}},setStyleFlag:function(n,t,i,r){var f,o,e,u;return n==null||n.length==0?n=r||r==null?t+"="+i:t+"=0":(f=n.indexOf(t+"="),f<0?(o=n.charAt(n.length-1)==";"?"":";",n=r||r==null?n+o+t+"="+i:n+o+t+"=0"):(e=n.indexOf(";",f),u="",u=e<0?n.substring(f+t.length+1):n.substring(f+t.length+1,e),u=r==null?parseInt(u)^i:r?parseInt(u)|i:parseInt(u)&~i,n=n.substring(0,f)+t+"="+u+(e>=0?n.substring(e):""))),n},getAlignmentAsPoint:function(n,t){var i=0,r=0;return n==mxConstants.ALIGN_CENTER?i=-.5:n==mxConstants.ALIGN_RIGHT&&(i=-1),t==mxConstants.ALIGN_MIDDLE?r=-.5:t==mxConstants.ALIGN_BOTTOM&&(r=-1),new mxPoint(i,r)},getSizeForString:function(n,t,i,r){var u,f;return t=t!=null?t:mxConstants.DEFAULT_FONTSIZE,i=i!=null?i:mxConstants.DEFAULT_FONTFAMILY,u=document.createElement("div"),u.style.fontFamily=i,u.style.fontSize=Math.round(t)+"px",u.style.lineHeight=Math.round(t*mxConstants.LINE_HEIGHT)+"px",u.style.position="absolute",u.style.visibility="hidden",u.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",u.style.zoom="1",r!=null?(u.style.width=r+"px",u.style.whiteSpace="normal"):u.style.whiteSpace="nowrap",u.innerHTML=n,document.body.appendChild(u),f=new mxRectangle(0,0,u.offsetWidth,u.offsetHeight),document.body.removeChild(u),f},getViewXml:function(n,t,i,r,u){var e,s,h,c,l,a;r=r!=null?r:0;u=u!=null?u:0;t=t!=null?t:1;i==null&&(e=n.getModel(),i=[e.getRoot()]);var f=n.getView(),o=null,v=f.isEventsEnabled();f.setEventsEnabled(!1);s=f.drawPane;h=f.overlayPane;n.dialect==mxConstants.DIALECT_SVG?(f.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),f.canvas.appendChild(f.drawPane),f.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g"),f.canvas.appendChild(f.overlayPane)):(f.drawPane=f.drawPane.cloneNode(!1),f.canvas.appendChild(f.drawPane),f.overlayPane=f.overlayPane.cloneNode(!1),f.canvas.appendChild(f.overlayPane));c=f.getTranslate();f.translate=new mxPoint(r,u);l=new mxTemporaryCellStates(n.getView(),t,i);try{a=new mxCodec;o=a.encode(n.getView())}finally{l.destroy();f.translate=c;f.canvas.removeChild(f.drawPane);f.canvas.removeChild(f.overlayPane);f.drawPane=s;f.overlayPane=h;f.setEventsEnabled(v)}return o},getScaleForPageCount:function(n,t,i,r){var c,l,o,s,e,k;if(n<1)return 1;i=i!=null?i:mxConstants.PAGE_FORMAT_A4_PORTRAIT;r=r!=null?r:0;var a=i.width-r*2,d=i.height-r*2,h=t.getGraphBounds().clone(),v=t.getView().getScale();h.width/=v;h.height/=v;var y=h.width,g=h.height,p=1,nt=a/d,tt=y/g,it=tt/nt,w=Math.sqrt(n),b=Math.sqrt(it),u=w*b,f=w/b;for(u<1&&f>n&&(e=f/n,f=n,u/=e),f<1&&u>n&&(e=u/n,u=n,f/=e),c=Math.ceil(u)*Math.ceil(f),l=0;c>n;)if(o=Math.floor(u)/u,s=Math.floor(f)/f,o==1&&(o=Math.floor(u-1)/u),s==1&&(s=Math.floor(f-1)/f),e=1,e=o>s?o:s,u=u*e,f=f*e,c=Math.ceil(u)*Math.ceil(f),l++,l>10)break;return k=a*u,p=k/y,p*.99999},show:function(n,t,i,r,u,f){var d,o,l,b,k,e,h,c,a,v,y;i=i!=null?i:0;r=r!=null?r:0;t==null?(d=window.open(),t=d.document):t.open();document.documentMode==9&&t.writeln('<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=9"><![endif]-->');var s=n.getGraphBounds(),p=Math.ceil(i-s.x),w=Math.ceil(r-s.y);if(u==null&&(u=Math.ceil(s.width+i)+Math.ceil(Math.ceil(s.x)-s.x)),f==null&&(f=Math.ceil(s.height+r)+Math.ceil(Math.ceil(s.y)-s.y)),mxClient.IS_IE||document.documentMode==11){for(o="<html><head>",l=document.getElementsByTagName("base"),e=0;e<l.length;e++)o+=l[e].outerHTML;for(o+="<style>",e=0;e<document.styleSheets.length;e++)try{o+=document.styleSheets(e).cssText}catch(g){}o+='<\/style><\/head><body style="margin:0px;">';o+='<div style="position:absolute;overflow:hidden;width:'+u+"px;height:"+f+'px;"><div style="position:relative;left:'+p+"px;top:"+w+'px;">';o+=n.container.innerHTML;o+="<\/div><\/div><\/body><html>";t.writeln(o);t.close()}else{for(t.writeln("<html><head>"),l=document.getElementsByTagName("base"),e=0;e<l.length;e++)t.writeln(mxUtils.getOuterHtml(l[e]));for(b=document.getElementsByTagName("link"),e=0;e<b.length;e++)t.writeln(mxUtils.getOuterHtml(b[e]));for(k=document.getElementsByTagName("style"),e=0;e<k.length;e++)t.writeln(mxUtils.getOuterHtml(k[e]));for(t.writeln('<\/head><body style="margin:0px;"><\/body><\/html>'),t.close(),h=t.createElement("div"),h.position="absolute",h.overflow="hidden",h.style.width=u+"px",h.style.height=f+"px",c=t.createElement("div"),c.style.position="absolute",c.style.left=p+"px",c.style.top=w+"px",a=n.container.firstChild,v=null;a!=null;)y=a.cloneNode(!0),a==n.view.drawPane.ownerSVGElement?(h.appendChild(y),v=y):c.appendChild(y),a=a.nextSibling;t.body.appendChild(h);c.firstChild!=null&&t.body.appendChild(c);v!=null&&(v.style.minWidth="",v.style.minHeight="",v.firstChild.setAttribute("transform","translate("+p+","+w+")"))}return mxUtils.removeCursors(t.body),t},printScreen:function(n){var t=window.open(),r=n.getGraphBounds(),i;mxUtils.show(n,t.document);i=function(){t.focus();t.print();t.close()};mxClient.IS_GC?t.setTimeout(i,500):i()},popup:function(n,t){var r,i,u;if(t){r=document.createElement("div");r.style.overflow="scroll";r.style.width="636px";r.style.height="460px";u=document.createElement("pre");u.innerHTML=mxUtils.htmlEntities(n,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");r.appendChild(u);var f=document.body.clientWidth,e=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight),i=new mxWindow("Popup Window",r,f/2-320,e/2-240,640,480,!1,!0);i.setClosable(!0);i.setVisible(!0)}else mxClient.IS_NS?(i=window.open(),i.document.writeln("<pre>"+mxUtils.htmlEntities(n)+"<\/pre"),i.document.close()):(i=window.open(),u=i.document.createElement("pre"),u.innerHTML=mxUtils.htmlEntities(n,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),i.document.body.appendChild(u))},alert:function(n){alert(n)},prompt:function(n,t){return prompt(n,t!=null?t:"")},confirm:function(n){return confirm(n)},error:function(n,t,i,r){var u=document.createElement("div"),e,s,f;u.style.padding="20px";e=document.createElement("img");e.setAttribute("src",r||mxUtils.errorImage);e.setAttribute("valign","bottom");e.style.verticalAlign="middle";u.appendChild(e);u.appendChild(document.createTextNode(" "));u.appendChild(document.createTextNode(" "));u.appendChild(document.createTextNode(" "));mxUtils.write(u,n);var h=document.body.clientWidth,c=document.body.clientHeight||document.documentElement.clientHeight,o=new mxWindow(mxResources.get(mxUtils.errorResource)||mxUtils.errorResource,u,(h-t)/2,c/4,t,null,!1,!0);return i&&(mxUtils.br(u),s=document.createElement("p"),f=document.createElement("button"),mxClient.IS_IE?f.style.cssText="float:right":f.setAttribute("style","float:right"),mxEvent.addListener(f,"click",function(){o.destroy()}),mxUtils.write(f,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),s.appendChild(f),u.appendChild(s),mxUtils.br(u),o.setClosable(!0)),o.setVisible(!0),o},makeDraggable:function(n,t,i,r,u,f,e,o,s,h){var c=new mxDragSource(n,i);return c.dragOffset=new mxPoint(u!=null?u:0,f!=null?f:mxConstants.TOOLTIP_VERTICAL_OFFSET),c.autoscroll=e,c.setGuidesEnabled(!1),s!=null&&(c.highlightDropTargets=s),h!=null&&(c.getDropTarget=h),c.getGraphForEvent=function(n){return typeof t=="function"?t(n):t},r!=null&&(c.createDragElement=function(){return r.cloneNode(!0)},o&&(c.createPreviewElement=function(n){var t=r.cloneNode(!0),i=parseInt(t.style.width),u=parseInt(t.style.height);return t.style.width=Math.round(i*n.view.scale)+"px",t.style.height=Math.round(u*n.view.scale)+"px",t})),c}},mxConstants={DEFAULT_HOTSPOT:.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",OUTLINE_HIGHLIGHT_COLOR:"#00FF00",OUTLINE_HIGHLIGHT_STROKEWIDTH:5,HIGHLIGHT_STROKEWIDTH:3,CURSOR_MOVABLE_VERTEX:"move",CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_TERMINAL_HANDLE:"pointer",CURSOR_BEND_HANDLE:"crosshair",CURSOR_VIRTUAL_BEND_HANDLE:"crosshair",CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:7,LABEL_HANDLE_SIZE:4,HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,DEFAULT_TEXT_DIRECTION:"",LINE_HEIGHT:1.2,ABSOLUTE_LINE_HEIGHT:!1,DEFAULT_FONTSTYLE:0,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:.15,LINE_ARCSIZE:20,ARROW_SPACING:10,ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,0,826,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,826),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_PORT_CONSTRAINT_ROTATION:"portConstraintRotation",STYLE_OPACITY:"opacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_TEXT_DIRECTION:"textDirection",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_POINTER_EVENTS:"pointerEvents",STYLE_SWIMLANE_FILLCOLOR:"swimlaneFillColor",STYLE_MARGIN:"margin",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_WIDTH:"labelWidth",STYLE_LABEL_POSITION:"labelPosition",STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_FLIPH:"flipH",STYLE_FLIPV:"flipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",STYLE_STARTSIZE:"startSize",STYLE_SWIMLANE_LINE:"swimlaneLine",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_SMOOTH:"smooth",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_ASPECT:"aspect",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",STYLE_ROTATABLE:"rotatable",STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_LOOP:"loopStyle",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_ARROW_CONNECTOR:"arrowConnector",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_BLOCK:"block",ARROW_OPEN:"open",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",TEXT_DIRECTION_DEFAULT:"",TEXT_DIRECTION_AUTO:"auto",TEXT_DIRECTION_LTR:"ltr",TEXT_DIRECTION_RTL:"rtl",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_HEXAGON:"hexagonPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};mxEventObject.prototype.name=null;mxEventObject.prototype.properties=null;mxEventObject.prototype.consumed=!1;mxEventObject.prototype.getName=function(){return this.name};mxEventObject.prototype.getProperties=function(){return this.properties};mxEventObject.prototype.getProperty=function(n){return this.properties[n]};mxEventObject.prototype.isConsumed=function(){return this.consumed};mxEventObject.prototype.consume=function(){this.consumed=!0};mxMouseEvent.prototype.consumed=!1;mxMouseEvent.prototype.evt=null;mxMouseEvent.prototype.graphX=null;mxMouseEvent.prototype.graphY=null;mxMouseEvent.prototype.state=null;mxMouseEvent.prototype.sourceState=null;mxMouseEvent.prototype.getEvent=function(){return this.evt};mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)};mxMouseEvent.prototype.isSource=function(n){return n!=null?mxUtils.isAncestorNode(n.node,this.getSource()):!1};mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())};mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())};mxMouseEvent.prototype.getGraphX=function(){return this.graphX};mxMouseEvent.prototype.getGraphY=function(){return this.graphY};mxMouseEvent.prototype.getState=function(){return this.state};mxMouseEvent.prototype.getCell=function(){var n=this.getState();return n!=null?n.cell:null};mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())};mxMouseEvent.prototype.isConsumed=function(){return this.consumed};mxMouseEvent.prototype.consume=function(n){n=n!=null?n:!0;n&&this.evt.preventDefault&&this.evt.preventDefault();mxClient.IS_IE&&(this.evt.returnValue=!0);this.consumed=!0};mxEventSource.prototype.eventListeners=null;mxEventSource.prototype.eventsEnabled=!0;mxEventSource.prototype.eventSource=null;mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled};mxEventSource.prototype.setEventsEnabled=function(n){this.eventsEnabled=n};mxEventSource.prototype.getEventSource=function(){return this.eventSource};mxEventSource.prototype.setEventSource=function(n){this.eventSource=n};mxEventSource.prototype.addListener=function(n,t){this.eventListeners==null&&(this.eventListeners=[]);this.eventListeners.push(n);this.eventListeners.push(t)};mxEventSource.prototype.removeListener=function(n){if(this.eventListeners!=null)for(var t=0;t<this.eventListeners.length;)this.eventListeners[t+1]==n?this.eventListeners.splice(t,2):t+=2};mxEventSource.prototype.fireEvent=function(n,t){var u,i,r;if(this.eventListeners!=null&&this.isEventsEnabled())for(n==null&&(n=new mxEventObject),t==null&&(t=this.getEventSource()),t==null&&(t=this),u=[t,n],i=0;i<this.eventListeners.length;i+=2)r=this.eventListeners[i],(r==null||r==n.getName())&&this.eventListeners[i+1].apply(this,u)};mxEvent={objects:[],addListener:function(){var n=function(n,t,i){n.mxListenerList==null&&(n.mxListenerList=[],mxEvent.objects.push(n));var r={name:t,f:i};n.mxListenerList.push(r)};return window.addEventListener?function(t,i,r){t.addEventListener(i,r,!1);n(t,i,r)}:function(t,i,r){t.attachEvent("on"+i,r);n(t,i,r)}}(),removeListener:function(){var n=function(n,t,i){var f,r,e,u;if(n.mxListenerList!=null){for(f=n.mxListenerList.length,r=0;r<f;r++)if(e=n.mxListenerList[r],e.f==i){n.mxListenerList.splice(r,1);break}n.mxListenerList.length==0&&(n.mxListenerList=null,u=mxUtils.indexOf(mxEvent.objects,n),u>=0&&mxEvent.objects.splice(u,1))}};return window.removeEventListener?function(t,i,r){t.removeEventListener(i,r,!1);n(t,i,r)}:function(t,i,r){t.detachEvent("on"+i,r);n(t,i,r)}}(),removeAllListeners:function(n){var t=n.mxListenerList,i;if(t!=null)while(t.length>0)i=t[0],mxEvent.removeListener(n,i.name,i.f)},addGestureListeners:function(n,t,i,r){t!=null&&mxEvent.addListener(n,mxClient.IS_POINTER?"MSPointerDown":"mousedown",t);i!=null&&mxEvent.addListener(n,mxClient.IS_POINTER?"MSPointerMove":"mousemove",i);r!=null&&mxEvent.addListener(n,mxClient.IS_POINTER?"MSPointerUp":"mouseup",r);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(t!=null&&mxEvent.addListener(n,"touchstart",t),i!=null&&mxEvent.addListener(n,"touchmove",i),r!=null&&mxEvent.addListener(n,"touchend",r))},removeGestureListeners:function(n,t,i,r){t!=null&&mxEvent.removeListener(n,mxClient.IS_POINTER?"MSPointerDown":"mousedown",t);i!=null&&mxEvent.removeListener(n,mxClient.IS_POINTER?"MSPointerMove":"mousemove",i);r!=null&&mxEvent.removeListener(n,mxClient.IS_POINTER?"MSPointerUp":"mouseup",r);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(t!=null&&mxEvent.removeListener(n,"touchstart",t),i!=null&&mxEvent.removeListener(n,"touchmove",i),r!=null&&mxEvent.removeListener(n,"touchend",r))},redirectMouseEvents:function(n,t,i,r,u,f,e){var o=function(n){return typeof i=="function"?i(n):i};mxEvent.addGestureListeners(n,function(n){r!=null?r(n):mxEvent.isConsumed(n)||t.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n,o(n)))},function(n){u!=null?u(n):mxEvent.isConsumed(n)||t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n,o(n)))},function(n){f!=null?f(n):mxEvent.isConsumed(n)||t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n,o(n)))});mxEvent.addListener(n,"dblclick",function(n){if(e!=null)e(n);else if(!mxEvent.isConsumed(n)){var i=o(n);t.dblClick(n,i!=null?i.cell:null)}})},release:function(n){var t,r,i;if(n!=null&&(mxEvent.removeAllListeners(n),t=n.childNodes,t!=null))for(r=t.length,i=0;i<r;i+=1)mxEvent.release(t[i])},addMouseWheelListener:function(n){var t,i;n!=null&&(t=function(t){t==null&&(t=window.event);var i=0;i=mxClient.IS_FF?-t.detail/2:t.wheelDelta/120;i!=0&&n(t,i>0)},mxClient.IS_NS&&document.documentMode==null?(i=mxClient.IS_SF||mxClient.IS_GC?"mousewheel":"DOMMouseScroll",mxEvent.addListener(window,i,t)):mxEvent.addListener(document,"mousewheel",t))},disableContextMenu:function(){return mxClient.IS_IE&&(typeof document.documentMode=="undefined"||document.documentMode<9)?function(n){mxEvent.addListener(n,"contextmenu",function(){return!1})}:function(n){n.setAttribute("oncontextmenu","return false;")}}(),getSource:function(n){return n.srcElement!=null?n.srcElement:n.target},isConsumed:function(n){return n.isConsumed!=null&&n.isConsumed},isTouchEvent:function(n){return n.pointerType!=null?n.pointerType=="touch"||n.pointerType===n.MSPOINTER_TYPE_TOUCH:n.mozInputSource!=null?n.mozInputSource==5:n.type.indexOf("touch")==0},isMultiTouchEvent:function(n){return n.type!=null&&n.type.indexOf("touch")==0&&n.touches!=null&&n.touches.length>1},isMouseEvent:function(n){return n.pointerType!=null?n.pointerType=="mouse"||n.pointerType===n.MSPOINTER_TYPE_MOUSE:n.mozInputSource!=null?n.mozInputSource==1:n.type.indexOf("mouse")==0},isLeftMouseButton:function(n){return n.button==(mxClient.IS_IE&&(typeof document.documentMode=="undefined"||document.documentMode<9)?1:0)},isMiddleMouseButton:function(n){return n.button==(mxClient.IS_IE&&(typeof document.documentMode=="undefined"||document.documentMode<9)?4:1)},isRightMouseButton:function(n){return n.button==2},isPopupTrigger:function(n){return mxEvent.isRightMouseButton(n)||mxClient.IS_MAC&&mxEvent.isControlDown(n)&&!mxEvent.isShiftDown(n)&&!mxEvent.isMetaDown(n)&&!mxEvent.isAltDown(n)},isShiftDown:function(n){return n!=null?n.shiftKey:!1},isAltDown:function(n){return n!=null?n.altKey:!1},isControlDown:function(n){return n!=null?n.ctrlKey:!1},isMetaDown:function(n){return n!=null?n.metaKey:!1},getMainEvent:function(n){return(n.type=="touchstart"||n.type=="touchmove")&&n.touches!=null&&n.touches[0]!=null?n=n.touches[0]:n.type=="touchend"&&n.changedTouches!=null&&n.changedTouches[0]!=null&&(n=n.changedTouches[0]),n},getClientX:function(n){return mxEvent.getMainEvent(n).clientX},getClientY:function(n){return mxEvent.getMainEvent(n).clientY},consume:function(n,t,i){t=t!=null?t:!0;i=i!=null?i:!0;t&&(n.preventDefault?(i&&n.stopPropagation(),n.preventDefault()):i&&(n.cancelBubble=!0));n.isConsumed=!0;n.preventDefault||(n.returnValue=!1)},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,CUSTOM_HANDLE:-100,VIRTUAL_HANDLE:-1e5,MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",FIRE_MOUSE_EVENT:"fireMouseEvent",GESTURE:"gesture",TAP_AND_HOLD:"tapAndHold",GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",MARK:"mark",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",EXECUTED:"executed",BEGIN_UPDATE:"beginUpdate",START_EDIT:"startEdit",END_UPDATE:"endUpdate",END_EDIT:"endEdit",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",EDITING_STARTED:"editingStarted",EDITING_STOPPED:"editingStopped",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",CLICK:"click",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};mxXmlRequest.prototype.url=null;mxXmlRequest.prototype.params=null;mxXmlRequest.prototype.method=null;mxXmlRequest.prototype.async=null;mxXmlRequest.prototype.binary=!1;mxXmlRequest.prototype.withCredentials=!1;mxXmlRequest.prototype.username=null;mxXmlRequest.prototype.password=null;mxXmlRequest.prototype.request=null;mxXmlRequest.prototype.decodeSimulateValues=!1;mxXmlRequest.prototype.isBinary=function(){return this.binary};mxXmlRequest.prototype.setBinary=function(n){this.binary=n};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.isReady=function(){return this.request.readyState==4};mxXmlRequest.prototype.getDocumentElement=function(){var n=this.getXml();return n!=null?n.documentElement:null};mxXmlRequest.prototype.getXml=function(){var n=this.request.responseXML;return(document.documentMode>=9||n==null||n.documentElement==null)&&(n=mxUtils.parseXml(this.request.responseText)),n};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.getStatus=function(){return this.request.status};mxXmlRequest.prototype.create=function(){return window.XMLHttpRequest?function(){var n=new XMLHttpRequest;return this.isBinary()&&n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n}:typeof ActiveXObject!="undefined"?function(){return new ActiveXObject("Microsoft.XMLHTTP")}:void 0}();mxXmlRequest.prototype.send=function(n,t,i,r){this.request=this.create();this.request!=null&&(n!=null&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(n(this),this.onreadystatechaange=null)})),!mxClient.IS_QUIRKS&&(document.documentMode==null||document.documentMode>10)&&window.XMLHttpRequest&&i!=null&&r!=null&&(this.request.timeout=i,this.request.ontimeout=r),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),this.request.send(this.params))};mxXmlRequest.prototype.setRequestHeaders=function(n,t){t!=null&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded")};mxXmlRequest.prototype.simulate=function(n,t){var f,i,u,r,e,h,o,s;for(n=n||document,f=null,n==document&&(f=window.onbeforeunload,window.onbeforeunload=null),i=n.createElement("form"),i.setAttribute("method",this.method),i.setAttribute("action",this.url),t!=null&&i.setAttribute("target",t),i.style.display="none",i.style.visibility="hidden",u=this.params.indexOf("&")>0?this.params.split("&"):this.params.split(),r=0;r<u.length;r++)e=u[r].indexOf("="),e>0&&(h=u[r].substring(0,e),o=u[r].substring(e+1),this.decodeSimulateValues&&(o=decodeURIComponent(o)),s=n.createElement("textarea"),s.setAttribute("name",h),mxUtils.write(s,o),i.appendChild(s));n.body.appendChild(i);i.submit();n.body.removeChild(i);f!=null&&(window.onbeforeunload=f)};mxClipboard={STEPSIZE:10,insertCount:1,cells:null,setCells:function(n){mxClipboard.cells=n},getCells:function(){return mxClipboard.cells},isEmpty:function(){return mxClipboard.getCells()==null},cut:function(n,t){return t=mxClipboard.copy(n,t),mxClipboard.insertCount=0,mxClipboard.removeCells(n,t),t},removeCells:function(n,t){n.removeCells(t)},copy:function(n,t){t=t||n.getSelectionCells();var i=n.getExportableCells(n.model.getTopmostCells(t));return mxClipboard.insertCount=1,mxClipboard.setCells(n.cloneCells(i)),i},paste:function(n){var t=null,i,r;return mxClipboard.isEmpty()||(t=n.getImportableCells(mxClipboard.getCells()),i=mxClipboard.insertCount*mxClipboard.STEPSIZE,r=n.getDefaultParent(),t=n.importCells(t,i,i,r),mxClipboard.insertCount++,n.setSelectionCells(t)),t}};mxWindow.prototype=new mxEventSource;mxWindow.prototype.constructor=mxWindow;mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif";mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif";mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif";mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif";mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif";mxWindow.prototype.visible=!1;mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40);mxWindow.prototype.destroyOnClose=!0;mxWindow.prototype.contentHeightCorrection=document.documentMode==8||document.documentMode==7?6:2;mxWindow.prototype.title=null;mxWindow.prototype.content=null;mxWindow.prototype.init=function(n,t,i,r,u){var e,f,o;u=u!=null?u:"mxWindow";this.div=document.createElement("div");this.div.className=u;this.div.style.left=n+"px";this.div.style.top=t+"px";this.table=document.createElement("table");this.table.className=u;mxClient.IS_POINTER&&(this.div.style.msTouchAction="none");i!=null&&(mxClient.IS_QUIRKS||(this.div.style.width=i+"px"),this.table.style.width=i+"px");r!=null&&(mxClient.IS_QUIRKS||(this.div.style.height=r+"px"),this.table.style.height=r+"px");e=document.createElement("tbody");f=document.createElement("tr");this.title=document.createElement("td");this.title.className=u+"Title";f.appendChild(this.title);e.appendChild(f);f=document.createElement("tr");this.td=document.createElement("td");this.td.className=u+"Pane";document.documentMode==7&&(this.td.style.height="100%");this.contentWrapper=document.createElement("div");this.contentWrapper.className=u+"Pane";this.contentWrapper.style.width="100%";this.contentWrapper.appendChild(this.content);(mxClient.IS_QUIRKS||this.content.nodeName.toUpperCase()!="DIV")&&(this.contentWrapper.style.height="100%");this.td.appendChild(this.contentWrapper);f.appendChild(this.td);e.appendChild(f);this.table.appendChild(e);this.div.appendChild(this.table);o=mxUtils.bind(this,function(){this.activate()});mxEvent.addGestureListeners(this.title,o);mxEvent.addGestureListeners(this.table,o);this.hide()};mxWindow.prototype.setTitle=function(n){for(var t=this.title.firstChild,i;t!=null;)i=t.nextSibling,t.nodeType==mxConstants.NODETYPE_TEXT&&t.parentNode.removeChild(t),t=i;mxUtils.write(this.title,n||"")};mxWindow.prototype.setScrollable=function(n){navigator.userAgent.indexOf("Presto/2.5")<0&&(this.contentWrapper.style.overflow=n?"auto":"hidden")};mxWindow.prototype.activate=function(){var t,i,n,r;mxWindow.activeWindow!=this&&(t=mxUtils.getCurrentStyle(this.getElement()),i=t!=null?t.zIndex:3,mxWindow.activeWindow&&(n=mxWindow.activeWindow.getElement(),n!=null&&n.style!=null&&(n.style.zIndex=i)),r=mxWindow.activeWindow,this.getElement().style.zIndex=parseInt(i)+1,mxWindow.activeWindow=this,this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",r)))};mxWindow.prototype.getElement=function(){return this.div};mxWindow.prototype.fit=function(){mxUtils.fit(this.div)};mxWindow.prototype.isResizable=function(){return this.resize!=null?this.resize.style.display!="none":!1};mxWindow.prototype.setResizable=function(n){if(n)if(this.resize==null){this.resize=document.createElement("img");this.resize.style.position="absolute";this.resize.style.bottom="2px";this.resize.style.right="2px";this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif");this.resize.style.cursor="nw-resize";var t=null,i=null,f=null,e=null,o=mxUtils.bind(this,function(n){this.activate();t=mxEvent.getClientX(n);i=mxEvent.getClientY(n);f=this.div.offsetWidth;e=this.div.offsetHeight;mxEvent.addGestureListeners(document,null,r,u);this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",n));mxEvent.consume(n)}),r=mxUtils.bind(this,function(n){if(t!=null&&i!=null){var r=mxEvent.getClientX(n)-t,u=mxEvent.getClientY(n)-i;this.setSize(f+r,e+u);this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",n));mxEvent.consume(n)}}),u=mxUtils.bind(this,function(n){t!=null&&i!=null&&(t=null,i=null,mxEvent.removeGestureListeners(document,null,r,u),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",n)),mxEvent.consume(n))});mxEvent.addGestureListeners(this.resize,o,r,u);this.div.appendChild(this.resize)}else this.resize.style.display="inline";else this.resize!=null&&(this.resize.style.display="none")};mxWindow.prototype.setSize=function(n,t){n=Math.max(this.minimumSize.width,n);t=Math.max(this.minimumSize.height,t);mxClient.IS_QUIRKS||(this.div.style.width=n+"px",this.div.style.height=t+"px");this.table.style.width=n+"px";this.table.style.height=t+"px";mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")};mxWindow.prototype.setMinimizable=function(n){this.minimize.style.display=n?"":"none"};mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)};mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img");this.minimize.setAttribute("src",this.minimizeImage);this.minimize.setAttribute("align","right");this.minimize.setAttribute("title","Minimize");this.minimize.style.cursor="pointer";this.minimize.style.marginRight="1px";this.minimize.style.display="none";this.title.appendChild(this.minimize);var n=!1,i=null,t=null,r=mxUtils.bind(this,function(r){if(this.activate(),n)n=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=i,mxClient.IS_QUIRKS||(this.div.style.height=t),this.table.style.height=t,this.resize!=null&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",r));else{n=!0;this.minimize.setAttribute("src",this.normalizeImage);this.minimize.setAttribute("title","Normalize");this.contentWrapper.style.display="none";i=this.maximize.style.display;this.maximize.style.display="none";t=this.table.style.height;var u=this.getMinimumSize();u.height>0&&(mxClient.IS_QUIRKS||(this.div.style.height=u.height+"px"),this.table.style.height=u.height+"px");u.width>0&&(mxClient.IS_QUIRKS||(this.div.style.width=u.width+"px"),this.table.style.width=u.width+"px");this.resize!=null&&(this.resize.style.visibility="hidden");this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",r))}mxEvent.consume(r)});mxEvent.addGestureListeners(this.minimize,r)};mxWindow.prototype.setMaximizable=function(n){this.maximize.style.display=n?"":"none"};mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img");this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("align","right");this.maximize.setAttribute("title","Maximize");this.maximize.style.cursor="default";this.maximize.style.marginLeft="1px";this.maximize.style.cursor="pointer";this.maximize.style.display="none";this.title.appendChild(this.maximize);var n=!1,r=null,u=null,t=null,i=null,f=mxUtils.bind(this,function(f){var o,e;this.activate();this.maximize.style.display!="none"&&(n?(n=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",this.minimize.style.visibility="",this.div.style.left=r+"px",this.div.style.top=u+"px",mxClient.IS_QUIRKS||(this.div.style.height=t,this.div.style.width=i,e=mxUtils.getCurrentStyle(this.contentWrapper),(e.overflow=="auto"||this.resize!=null)&&(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")),this.table.style.height=t,this.table.style.width=i,this.resize!=null&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",f))):(n=!0,this.maximize.setAttribute("src",this.normalizeImage),this.maximize.setAttribute("title","Normalize"),this.contentWrapper.style.display="",this.minimize.style.visibility="hidden",r=parseInt(this.div.style.left),u=parseInt(this.div.style.top),t=this.table.style.height,i=this.table.style.width,this.div.style.left="0px",this.div.style.top="0px",o=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0),mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=o-2+"px"),this.table.style.width=document.body.clientWidth-2+"px",this.table.style.height=o-2+"px",this.resize!=null&&(this.resize.style.visibility="hidden"),mxClient.IS_QUIRKS||(e=mxUtils.getCurrentStyle(this.contentWrapper),(e.overflow=="auto"||this.resize!=null)&&(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")),this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",f))),mxEvent.consume(f))});mxEvent.addGestureListeners(this.maximize,f);mxEvent.addListener(this.title,"dblclick",f)};mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move";mxEvent.addGestureListeners(this.title,mxUtils.bind(this,function(n){var r=mxEvent.getClientX(n),u=mxEvent.getClientY(n),f=this.getX(),e=this.getY(),t=mxUtils.bind(this,function(n){var t=mxEvent.getClientX(n)-r,i=mxEvent.getClientY(n)-u;this.setLocation(f+t,e+i);this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",n));mxEvent.consume(n)}),i=mxUtils.bind(this,function(n){mxEvent.removeGestureListeners(document,null,t,i);this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",n));mxEvent.consume(n)});mxEvent.addGestureListeners(document,null,t,i);this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",n));mxEvent.consume(n)}));mxClient.IS_POINTER&&(this.title.style.msTouchAction="none")};mxWindow.prototype.setLocation=function(n,t){this.div.style.left=n+"px";this.div.style.top=t+"px"};mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)};mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)};mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img");this.closeImg.setAttribute("src",this.closeImage);this.closeImg.setAttribute("align","right");this.closeImg.setAttribute("title","Close");this.closeImg.style.marginLeft="2px";this.closeImg.style.cursor="pointer";this.closeImg.style.display="none";this.title.insertBefore(this.closeImg,this.title.firstChild);mxEvent.addGestureListeners(this.closeImg,mxUtils.bind(this,function(n){this.fireEvent(new mxEventObject(mxEvent.CLOSE,"event",n));this.destroyOnClose?this.destroy():this.setVisible(!1);mxEvent.consume(n)}))};mxWindow.prototype.setImage=function(n){this.image=document.createElement("img");this.image.setAttribute("src",n);this.image.setAttribute("align","left");this.image.style.marginRight="4px";this.image.style.marginLeft="0px";this.image.style.marginTop="-2px";this.title.insertBefore(this.image,this.title.firstChild)};mxWindow.prototype.setClosable=function(n){this.closeImg.style.display=n?"":"none"};mxWindow.prototype.isVisible=function(){return this.div!=null?this.div.style.display!="none":!1};mxWindow.prototype.setVisible=function(n){this.div!=null&&this.isVisible()!=n&&(n?this.show():this.hide())};mxWindow.prototype.show=function(){this.div.style.display="";this.activate();var n=mxUtils.getCurrentStyle(this.contentWrapper);mxClient.IS_QUIRKS||n.overflow!="auto"&&this.resize==null||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px");this.fireEvent(new mxEventObject(mxEvent.SHOW))};mxWindow.prototype.hide=function(){this.div.style.display="none";this.fireEvent(new mxEventObject(mxEvent.HIDE))};mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY));this.div!=null&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null);this.title=null;this.content=null;this.contentWrapper=null};mxForm.prototype.table=null;mxForm.prototype.body=!1;mxForm.prototype.getTable=function(){return this.table};mxForm.prototype.addButtons=function(n,t){var u=document.createElement("tr"),r=document.createElement("td"),i;u.appendChild(r);r=document.createElement("td");i=document.createElement("button");mxUtils.write(i,mxResources.get("ok")||"OK");r.appendChild(i);mxEvent.addListener(i,"click",function(){n()});i=document.createElement("button");mxUtils.write(i,mxResources.get("cancel")||"Cancel");r.appendChild(i);mxEvent.addListener(i,"click",function(){t()});u.appendChild(r);this.body.appendChild(u)};mxForm.prototype.addText=function(n,t){var i=document.createElement("input");return i.setAttribute("type","text"),i.value=t,this.addField(n,i)};mxForm.prototype.addCheckbox=function(n,t){var i=document.createElement("input");return i.setAttribute("type","checkbox"),this.addField(n,i),t&&(i.checked=!0),i};mxForm.prototype.addTextarea=function(n,t,i){var r=document.createElement("textarea");return mxClient.IS_NS&&i--,r.setAttribute("rows",i||2),r.value=t,this.addField(n,r)};mxForm.prototype.addCombo=function(n,t,i){var r=document.createElement("select");return i!=null&&r.setAttribute("size",i),t&&r.setAttribute("multiple","true"),this.addField(n,r)};mxForm.prototype.addOption=function(n,t,i,r){var u=document.createElement("option");mxUtils.writeln(u,t);u.setAttribute("value",i);r&&u.setAttribute("selected",r);n.appendChild(u)};mxForm.prototype.addField=function(n,t){var r=document.createElement("tr"),i=document.createElement("td");return mxUtils.write(i,n),r.appendChild(i),i=document.createElement("td"),i.appendChild(t),r.appendChild(i),this.body.appendChild(r),t};mxImage.prototype.src=null;mxImage.prototype.width=null;mxImage.prototype.height=null;mxDivResizer.prototype.resizeWidth=!0;mxDivResizer.prototype.resizeHeight=!0;mxDivResizer.prototype.handlingResize=!1;mxDivResizer.prototype.resize=function(){var u=this.getDocumentWidth(),f=this.getDocumentHeight(),n=parseInt(this.div.style.left),t=parseInt(this.div.style.right),i=parseInt(this.div.style.top),r=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(n)&&!isNaN(t)&&n>=0&&t>=0&&u-t-n>0&&(this.div.style.width=u-t-n+"px");this.resizeHeight&&!isNaN(i)&&!isNaN(r)&&i>=0&&r>=0&&f-i-r>0&&(this.div.style.height=f-i-r+"px")};mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth};mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight};mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=!0;mxDragSource.prototype.currentGraph=null;mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=!0;mxDragSource.prototype.guidesEnabled=!0;mxDragSource.prototype.gridEnabled=!0;mxDragSource.prototype.highlightDropTargets=!0;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};mxDragSource.prototype.setEnabled=function(n){this.enabled=n};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(n){this.guidesEnabled=n};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(n){this.gridEnabled=n};mxDragSource.prototype.getGraphForEvent=function(){return null};mxDragSource.prototype.getDropTarget=function(n,t,i){return n.getCellAt(t,i)};mxDragSource.prototype.createDragElement=function(){return this.element.cloneNode(!0)};mxDragSource.prototype.createPreviewElement=function(){return null};mxDragSource.prototype.isActive=function(){return this.mouseMoveHandler!=null};mxDragSource.prototype.reset=function(){this.currentGraph!=null&&(this.dragExit(this.currentGraph),this.currentGraph=null);this.removeDragElement();this.removeListeners();this.stopDrag()};mxDragSource.prototype.mouseDown=function(n){this.enabled&&!mxEvent.isConsumed(n)&&this.mouseMoveHandler==null&&(this.startDrag(n),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(n)&&(this.eventSource=mxEvent.getSource(n),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)),mxEvent.consume(n,!0,!1))};mxDragSource.prototype.startDrag=function(n){this.dragElement=this.createDragElement(n);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(){this.removeDragElement()};mxDragSource.prototype.removeDragElement=function(){this.dragElement!=null&&(this.dragElement.parentNode!=null&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)};mxDragSource.prototype.graphContainsEvent=function(n,t){var u=mxEvent.getClientX(t),f=mxEvent.getClientY(t),i=mxUtils.getOffset(n.container),r=mxUtils.getScrollOrigin();return u>=i.x-r.x&&f>=i.y-r.y&&u<=i.x-r.x+n.container.offsetWidth&&f<=i.y-r.y+n.container.offsetHeight};mxDragSource.prototype.mouseMove=function(n){var t=this.getGraphForEvent(n),i,r,u;t==null||this.graphContainsEvent(t,n)||(t=null);t!=this.currentGraph&&(this.currentGraph!=null&&this.dragExit(this.currentGraph,n),this.currentGraph=t,this.currentGraph!=null&&this.dragEnter(this.currentGraph,n));this.currentGraph!=null&&this.dragOver(this.currentGraph,n);this.dragElement!=null&&(this.previewElement==null||this.previewElement.style.visibility!="visible")?(i=mxEvent.getClientX(n),r=mxEvent.getClientY(n),this.dragElement.parentNode==null&&document.body.appendChild(this.dragElement),this.dragElement.style.visibility="visible",this.dragOffset!=null&&(i+=this.dragOffset.x,r+=this.dragOffset.y),u=mxUtils.getDocumentScrollOrigin(document),this.dragElement.style.left=i+u.x+"px",this.dragElement.style.top=r+u.y+"px"):this.dragElement!=null&&(this.dragElement.style.visibility="hidden");mxEvent.consume(n)};mxDragSource.prototype.mouseUp=function(n){if(this.currentGraph!=null){if(this.currentPoint!=null&&(this.previewElement==null||this.previewElement.style.visibility!="hidden")){var t=this.currentGraph.view.scale,i=this.currentGraph.view.translate,r=this.currentPoint.x/t-i.x,u=this.currentPoint.y/t-i.y;this.drop(this.currentGraph,n,this.currentDropTarget,r,u)}this.dragExit(this.currentGraph);this.currentGraph=null}this.stopDrag();this.removeListeners();mxEvent.consume(n)};mxDragSource.prototype.removeListeners=function(){this.eventSource!=null&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null);mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);this.mouseMoveHandler=null;this.mouseUpHandler=null};mxDragSource.prototype.dragEnter=function(n,t){n.isMouseDown=!0;n.isMouseTrigger=mxEvent.isMouseEvent(t);this.previewElement=this.createPreviewElement(n);this.isGuidesEnabled()&&this.previewElement!=null&&(this.currentGuide=new mxGuide(n,n.graphHandler.getGuideStates()));this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(n,mxConstants.DROP_TARGET_COLOR));n.addListener(mxEvent.FIRE_MOUSE_EVENT,this.eventConsumer)};mxDragSource.prototype.dragExit=function(n){this.currentDropTarget=null;this.currentPoint=null;n.isMouseDown=!1;n.removeListener(this.eventConsumer);this.previewElement!=null&&(this.previewElement.parentNode!=null&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null);this.currentGuide!=null&&(this.currentGuide.destroy(),this.currentGuide=null);this.currentHighlight!=null&&(this.currentHighlight.destroy(),this.currentHighlight=null)};mxDragSource.prototype.dragOver=function(n,t){var h=mxUtils.getOffset(n.container),c=mxUtils.getScrollOrigin(n.container),i=mxEvent.getClientX(t)-h.x+c.x,r=mxEvent.getClientY(t)-h.y+c.y,l,o,s;if(n.autoScroll&&(this.autoscroll==null||this.autoscroll)&&n.scrollPointToVisible(i,r,n.autoExtend),this.currentHighlight!=null&&n.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(n,i,r,t),l=n.getView().getState(this.currentDropTarget),this.currentHighlight.highlight(l)),this.previewElement!=null){if(this.previewElement.parentNode==null&&(n.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute"),o=this.isGridEnabled()&&n.isGridEnabledEvent(t),s=!0,this.currentGuide!=null&&this.currentGuide.isEnabledForEvent(t)){var v=parseInt(this.previewElement.style.width),y=parseInt(this.previewElement.style.height),p=new mxRectangle(0,0,v,y),u=new mxPoint(i,r);u=this.currentGuide.move(p,u,o);s=!1;i=u.x;r=u.y}else if(o){var f=n.view.scale,e=n.view.translate,a=n.gridSize/2;i=(n.snap(i/f-e.x-a)+e.x)*f;r=(n.snap(r/f-e.y-a)+e.y)*f}this.currentGuide!=null&&s&&this.currentGuide.hide();this.previewOffset!=null&&(i+=this.previewOffset.x,r+=this.previewOffset.y);this.previewElement.style.left=Math.round(i)+"px";this.previewElement.style.top=Math.round(r)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(i,r)};mxDragSource.prototype.drop=function(n,t,i,r,u){this.dropHandler(n,t,i,r,u);n.container.style.visibility!="hidden"&&n.container.focus()};mxToolbar.prototype=new mxEventSource;mxToolbar.prototype.constructor=mxToolbar;mxToolbar.prototype.container=null;mxToolbar.prototype.enabled=!0;mxToolbar.prototype.noReset=!1;mxToolbar.prototype.updateDefaultMode=!0;mxToolbar.prototype.addItem=function(n,t,i,r,u,f){var e=document.createElement(t!=null?"img":"button"),o=u||(f!=null?"mxToolbarMode":"mxToolbarItem"),s;return e.className=o,e.setAttribute("src",t),n!=null&&(t!=null?e.setAttribute("title",n):mxUtils.write(e,n)),this.container.appendChild(e),i!=null&&(mxEvent.addListener(e,"click",i),mxClient.IS_TOUCH&&mxEvent.addListener(e,"touchend",i)),s=mxUtils.bind(this,function(){r!=null?e.setAttribute("src",t):e.style.backgroundColor=""}),mxEvent.addGestureListeners(e,mxUtils.bind(this,function(n){var i,t;r!=null?e.setAttribute("src",r):e.style.backgroundColor="gray";f!=null&&(this.menu==null&&(this.menu=new mxPopupMenu,this.menu.init()),i=this.currentImg,this.menu.isMenuShowing()&&this.menu.hideMenu(),i!=e&&(this.currentImg=e,this.menu.factoryMethod=f,t=new mxPoint(e.offsetLeft,e.offsetTop+e.offsetHeight),this.menu.popup(t.x,t.y,null,n),this.menu.isMenuShowing()&&(e.className=o+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this);e.className=o;this.currentImg=null})))}),null,s),mxEvent.addListener(e,"mouseout",s),e};mxToolbar.prototype.addCombo=function(n){var t=document.createElement("div"),i;return t.style.display="inline",t.className="mxToolbarComboContainer",i=document.createElement("select"),i.className=n||"mxToolbarCombo",t.appendChild(i),this.container.appendChild(t),i};mxToolbar.prototype.addActionCombo=function(n,t){var i=document.createElement("select");return i.className=t||"mxToolbarCombo",this.addOption(i,n,null),mxEvent.addListener(i,"change",function(n){var t=i.options[i.selectedIndex];i.selectedIndex=0;t.funct!=null&&t.funct(n)}),this.container.appendChild(i),i};mxToolbar.prototype.addOption=function(n,t,i){var r=document.createElement("option");return mxUtils.writeln(r,t),typeof i=="function"?r.funct=i:r.setAttribute("value",i),n.appendChild(r),r};mxToolbar.prototype.addSwitchMode=function(n,t,i,r,u){var f=document.createElement("img");return f.initialClassName=u||"mxToolbarMode",f.className=f.initialClassName,f.setAttribute("src",t),f.altIcon=r,n!=null&&f.setAttribute("title",n),mxEvent.addListener(f,"click",mxUtils.bind(this,function(){var n=this.selectedMode.altIcon;n!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",n)):this.selectedMode.className=this.selectedMode.initialClassName;this.updateDefaultMode&&(this.defaultMode=f);this.selectedMode=f;n=f.altIcon;n!=null?(f.altIcon=f.getAttribute("src"),f.setAttribute("src",n)):f.className=f.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT));i()})),this.container.appendChild(f),this.defaultMode==null&&(this.defaultMode=f,this.selectMode(f),i()),f};mxToolbar.prototype.addMode=function(n,t,i,r,u,f){f=f!=null?f:!0;var e=document.createElement(t!=null?"img":"button");return e.initialClassName=u||"mxToolbarMode",e.className=e.initialClassName,e.setAttribute("src",t),e.altIcon=r,n!=null&&e.setAttribute("title",n),this.enabled&&f&&(mxEvent.addListener(e,"click",mxUtils.bind(this,function(){this.selectMode(e,i);this.noReset=!1})),mxEvent.addListener(e,"dblclick",mxUtils.bind(this,function(){this.selectMode(e,i);this.noReset=!0})),this.defaultMode==null&&(this.defaultMode=e,this.defaultFunction=i,this.selectMode(e,i))),this.container.appendChild(e),e};mxToolbar.prototype.selectMode=function(n,t){var i;this.selectedMode!=n&&(this.selectedMode!=null&&(i=this.selectedMode.altIcon,i!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",i)):this.selectedMode.className=this.selectedMode.initialClassName),this.selectedMode=n,i=this.selectedMode.altIcon,i!=null?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",i)):this.selectedMode.className=this.selectedMode.initialClassName+"Selected",this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",t)))};mxToolbar.prototype.resetMode=function(n){(n||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)};mxToolbar.prototype.addSeparator=function(n){return this.addItem(null,n,null)};mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)};mxToolbar.prototype.addLine=function(){var n=document.createElement("hr");n.style.marginRight="6px";n.setAttribute("size","1");this.container.appendChild(n)};mxToolbar.prototype.destroy=function(){mxEvent.release(this.container);this.container=null;this.defaultMode=null;this.defaultFunction=null;this.selectedMode=null;this.menu!=null&&this.menu.destroy()};mxUndoableEdit.prototype.source=null;mxUndoableEdit.prototype.changes=null;mxUndoableEdit.prototype.significant=null;mxUndoableEdit.prototype.undone=!1;mxUndoableEdit.prototype.redone=!1;mxUndoableEdit.prototype.isEmpty=function(){return this.changes.length==0};mxUndoableEdit.prototype.isSignificant=function(){return this.significant};mxUndoableEdit.prototype.add=function(n){this.changes.push(n)};mxUndoableEdit.prototype.notify=function(){};mxUndoableEdit.prototype.die=function(){};mxUndoableEdit.prototype.undo=function(){var i,t,n;if(!this.undone){for(this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT)),i=this.changes.length,t=i-1;t>=0;t--)n=this.changes[t],n.execute!=null?n.execute():n.undo!=null&&n.undo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",n));this.undone=!0;this.redone=!1;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};mxUndoableEdit.prototype.redo=function(){var i,t,n;if(!this.redone){for(this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT)),i=this.changes.length,t=0;t<i;t++)n=this.changes[t],n.execute!=null?n.execute():n.redo!=null&&n.redo(),this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",n));this.undone=!1;this.redone=!0;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};mxUndoManager.prototype=new mxEventSource;mxUndoManager.prototype.constructor=mxUndoManager;mxUndoManager.prototype.size=null;mxUndoManager.prototype.history=null;mxUndoManager.prototype.indexOfNextAdd=0;mxUndoManager.prototype.isEmpty=function(){return this.history.length==0};mxUndoManager.prototype.clear=function(){this.history=[];this.indexOfNextAdd=0;this.fireEvent(new mxEventObject(mxEvent.CLEAR))};mxUndoManager.prototype.canUndo=function(){return this.indexOfNextAdd>0};mxUndoManager.prototype.undo=function(){while(this.indexOfNextAdd>0){var n=this.history[--this.indexOfNextAdd];if(n.undo(),n.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",n));break}}};mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length};mxUndoManager.prototype.redo=function(){for(var t=this.history.length,n;this.indexOfNextAdd<t;)if(n=this.history[this.indexOfNextAdd++],n.redo(),n.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",n));break}};mxUndoManager.prototype.undoableEditHappened=function(n){this.trim();this.size>0&&this.size==this.history.length&&this.history.shift();this.history.push(n);this.indexOfNextAdd=this.history.length;this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",n))};mxUndoManager.prototype.trim=function(){var t,n;if(this.history.length>this.indexOfNextAdd)for(t=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),n=0;n<t.length;n++)t[n].die()};mxUrlConverter=function(){};mxUrlConverter.prototype.enabled=!0;mxUrlConverter.prototype.baseUrl=null;mxUrlConverter.prototype.baseDomain=null;mxUrlConverter.prototype.updateBaseUrl=function(){this.baseDomain=location.protocol+"//"+location.host;this.baseUrl=this.baseDomain+location.pathname;var n=this.baseUrl.lastIndexOf("/");n>0&&(this.baseUrl=this.baseUrl.substring(0,n+1))};mxUrlConverter.prototype.isEnabled=function(){return this.enabled};mxUrlConverter.prototype.setEnabled=function(n){this.enabled=n};mxUrlConverter.prototype.getBaseUrl=function(){return this.baseUrl};mxUrlConverter.prototype.setBaseUrl=function(n){this.baseUrl=n};mxUrlConverter.prototype.getBaseDomain=function(){return this.baseDomain};mxUrlConverter.prototype.setBaseDomain=function(n){this.baseDomain=n};mxUrlConverter.prototype.isRelativeUrl=function(n){return n.substring(0,2)!="//"&&n.substring(0,7)!="http://"&&n.substring(0,8)!="https://"&&n.substring(0,10)!="data:image"};mxUrlConverter.prototype.convert=function(n){return this.isEnabled()&&this.isRelativeUrl(n)&&(this.getBaseUrl()==null&&this.updateBaseUrl(),n=n.charAt(0)=="/"?this.getBaseDomain()+n:this.getBaseUrl()+n),n};mxPanningManager.prototype.damper=1/6;mxPanningManager.prototype.delay=10;mxPanningManager.prototype.handleMouseOut=!0;mxPanningManager.prototype.border=0;mxPopupMenu.prototype=new mxEventSource;mxPopupMenu.prototype.constructor=mxPopupMenu;mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif";mxPopupMenu.prototype.zIndex=10006;mxPopupMenu.prototype.factoryMethod=null;mxPopupMenu.prototype.useLeftButtonForPopup=!1;mxPopupMenu.prototype.enabled=!0;mxPopupMenu.prototype.itemCount=0;mxPopupMenu.prototype.autoExpand=!1;mxPopupMenu.prototype.smartSeparators=!1;mxPopupMenu.prototype.labels=!0;mxPopupMenu.prototype.init=function(){this.table=document.createElement("table");this.table.className="mxPopupMenu";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.div=document.createElement("div");this.div.className="mxPopupMenu";this.div.style.display="inline";this.div.style.zIndex=this.zIndex;this.div.appendChild(this.table);mxEvent.disableContextMenu(this.div)};mxPopupMenu.prototype.isEnabled=function(){return this.enabled};mxPopupMenu.prototype.setEnabled=function(n){this.enabled=n};mxPopupMenu.prototype.isPopupTrigger=function(n){return n.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(n.getEvent())};mxPopupMenu.prototype.addItem=function(n,t,i,r,u,f,e){var o,s,a,v,h,c,l;return r=r||this,this.itemCount++,r.willAddSeparator&&(r.containsItems&&this.addSeparator(r,!0),r.willAddSeparator=!1),r.containsItems=!0,o=document.createElement("tr"),o.className="mxPopupMenuItem",s=document.createElement("td"),s.className="mxPopupMenuIcon",t!=null?(a=document.createElement("img"),a.src=t,s.appendChild(a)):u!=null&&(v=document.createElement("div"),v.className=u,s.appendChild(v)),o.appendChild(s),this.labels&&(h=document.createElement("td"),h.className="mxPopupMenuItem"+(f!=null&&!f?" mxDisabled":""),mxUtils.write(h,n),h.align="left",o.appendChild(h),c=document.createElement("td"),c.className="mxPopupMenuItem"+(f!=null&&!f?" mxDisabled":""),c.style.paddingRight="6px",c.style.textAlign="right",o.appendChild(c),r.div==null&&this.createSubmenu(r)),r.tbody.appendChild(o),e!=!1&&f!=!1&&(l=null,mxEvent.addGestureListeners(o,mxUtils.bind(this,function(n){this.eventReceiver=o;r.activeRow!=o&&r.activeRow!=r&&(r.activeRow!=null&&r.activeRow.div.parentNode!=null&&this.hideSubmenu(r),o.div!=null&&(this.showSubmenu(r,o),r.activeRow=o));(mxClient.IS_QUIRKS||document.documentMode==8)&&(l=document.selection.createRange());mxEvent.consume(n)}),mxUtils.bind(this,function(){r.activeRow!=o&&r.activeRow!=r&&(r.activeRow!=null&&r.activeRow.div.parentNode!=null&&this.hideSubmenu(r),this.autoExpand&&o.div!=null&&(this.showSubmenu(r,o),r.activeRow=o));o.className="mxPopupMenuItemHover"}),mxUtils.bind(this,function(n){if(this.eventReceiver==o){if(r.activeRow!=o&&this.hideMenu(),l!=null){try{l.select()}catch(t){}l=null}i!=null&&i(n)}this.eventReceiver=null;mxEvent.consume(n)})),mxEvent.addListener(o,"mouseout",mxUtils.bind(this,function(){o.className="mxPopupMenuItem"}))),o};mxPopupMenu.prototype.createSubmenu=function(n){n.table=document.createElement("table");n.table.className="mxPopupMenu";n.tbody=document.createElement("tbody");n.table.appendChild(n.tbody);n.div=document.createElement("div");n.div.className="mxPopupMenu";n.div.style.position="absolute";n.div.style.display="inline";n.div.style.zIndex=this.zIndex;n.div.appendChild(n.table);var t=document.createElement("img");t.setAttribute("src",this.submenuImage);td=n.firstChild.nextSibling.nextSibling;td.appendChild(t)};mxPopupMenu.prototype.showSubmenu=function(n,t){if(t.div!=null){t.div.style.left=n.div.offsetLeft+t.offsetLeft+t.offsetWidth-1+"px";t.div.style.top=n.div.offsetTop+t.offsetTop+"px";document.body.appendChild(t.div);var r=parseInt(t.div.offsetLeft),i=parseInt(t.div.offsetWidth),u=mxUtils.getDocumentScrollOrigin(document),f=document.body,e=document.documentElement,o=u.x+(f.clientWidth||e.clientWidth);r+i>o&&(t.div.style.left=n.div.offsetLeft-i+(mxClient.IS_IE?6:-6)+"px");mxUtils.fit(t.div)}};mxPopupMenu.prototype.addSeparator=function(n,t){var r,u,i,f;n=n||this;this.smartSeparators&&!t?n.willAddSeparator=!0:n.tbody!=null&&(n.willAddSeparator=!1,r=document.createElement("tr"),u=document.createElement("td"),u.className="mxPopupMenuIcon",u.style.padding="0 0 0 0px",r.appendChild(u),i=document.createElement("td"),i.style.padding="0 0 0 0px",i.setAttribute("colSpan","2"),f=document.createElement("hr"),f.setAttribute("size","1"),i.appendChild(f),r.appendChild(i),n.tbody.appendChild(r))};mxPopupMenu.prototype.popup=function(n,t,i,r){if(this.div!=null&&this.tbody!=null&&this.factoryMethod!=null){for(this.div.style.left=n+"px",this.div.style.top=t+"px";this.tbody.firstChild!=null;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0;this.factoryMethod(this,i,r);this.itemCount>0&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}};mxPopupMenu.prototype.isMenuShowing=function(){return this.div!=null&&this.div.parentNode==document.body};mxPopupMenu.prototype.showMenu=function(){document.documentMode>=9&&(this.div.style.filter="none");document.body.appendChild(this.div);mxUtils.fit(this.div)};mxPopupMenu.prototype.hideMenu=function(){this.div!=null&&(this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new mxEventObject(mxEvent.HIDE)))};mxPopupMenu.prototype.hideSubmenu=function(n){n.activeRow!=null&&(this.hideSubmenu(n.activeRow),n.activeRow.div.parentNode!=null&&n.activeRow.div.parentNode.removeChild(n.activeRow.div),n.activeRow=null)};mxPopupMenu.prototype.destroy=function(){this.div!=null&&(mxEvent.release(this.div),this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.div=null)};mxAutoSaveManager.prototype=new mxEventSource;mxAutoSaveManager.prototype.constructor=mxAutoSaveManager;mxAutoSaveManager.prototype.graph=null;mxAutoSaveManager.prototype.autoSaveDelay=10;mxAutoSaveManager.prototype.autoSaveThrottle=2;mxAutoSaveManager.prototype.autoSaveThreshold=5;mxAutoSaveManager.prototype.ignoredChanges=0;mxAutoSaveManager.prototype.lastSnapshot=0;mxAutoSaveManager.prototype.enabled=!0;mxAutoSaveManager.prototype.changeHandler=null;mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled};mxAutoSaveManager.prototype.setEnabled=function(n){this.enabled=n};mxAutoSaveManager.prototype.setGraph=function(n){this.graph!=null&&this.graph.getModel().removeListener(this.changeHandler);this.graph=n;this.graph!=null&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)};mxAutoSaveManager.prototype.save=function(){};mxAutoSaveManager.prototype.graphModelChanged=function(){var t=(new Date).getTime(),n=(t-this.lastSnapshot)/1e3;n>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&n>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++};mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime();this.ignoredChanges=0};mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)};mxAnimation.prototype=new mxEventSource;mxAnimation.prototype.constructor=mxAnimation;mxAnimation.prototype.delay=null;mxAnimation.prototype.thread=null;mxAnimation.prototype.isRunning=function(){return this.thread!=null};mxAnimation.prototype.startAnimation=function(){this.thread==null&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))};mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))};mxAnimation.prototype.stopAnimation=function(){this.thread!=null&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))};mxMorphing.prototype=new mxAnimation;mxMorphing.prototype.constructor=mxMorphing;mxMorphing.prototype.graph=null;mxMorphing.prototype.steps=null;mxMorphing.prototype.step=0;mxMorphing.prototype.ease=null;mxMorphing.prototype.cells=null;mxMorphing.prototype.updateAnimation=function(){var n=new mxCellStatePreview(this.graph),t;if(this.cells!=null)for(t=0;t<this.cells.length;t++)this.animateCell(this.cells[t],n,!1);else this.animateCell(this.graph.getModel().getRoot(),n,!0);this.show(n);(n.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()};mxMorphing.prototype.show=function(n){n.show()};mxMorphing.prototype.animateCell=function(n,t,i){var u=this.graph.getView().getState(n),r=null,e,o,s,f;if(u!=null&&(r=this.getDelta(u),this.graph.getModel().isVertex(n)&&(r.x!=0||r.y!=0)&&(e=this.graph.view.getTranslate(),o=this.graph.view.getScale(),r.x+=e.x*o,r.y+=e.y*o,t.moveState(u,-r.x/this.ease,-r.y/this.ease))),i&&!this.stopRecursion(u,r))for(s=this.graph.getModel().getChildCount(n),f=0;f<s;f++)this.animateCell(this.graph.getModel().getChildAt(n,f),t,i)};mxMorphing.prototype.stopRecursion=function(n,t){return t!=null&&(t.x!=0||t.y!=0)};mxMorphing.prototype.getDelta=function(n){var i=this.getOriginForCell(n.cell),r=this.graph.getView().getTranslate(),t=this.graph.getView().getScale(),u=n.x/t-r.x,f=n.y/t-r.y;return new mxPoint((i.x-u)*t,(i.y-f)*t)};mxMorphing.prototype.getOriginForCell=function(n){var t=null,u,i,r,f;return n!=null&&(u=this.graph.getModel().getParent(n),i=this.graph.getCellGeometry(n),t=this.getOriginForCell(u),i!=null&&(i.relative?(r=this.graph.getCellGeometry(u),r!=null&&(t.x+=i.x*r.width,t.y+=i.y*r.height)):(t.x+=i.x,t.y+=i.y))),t==null&&(f=this.graph.view.getTranslate(),t=new mxPoint(-f.x,-f.y)),t};mxImageBundle.prototype.images=null;mxImageBundle.prototype.images=null;mxImageBundle.prototype.putImage=function(n,t,i){this.images[n]={value:t,fallback:i}};mxImageBundle.prototype.getImage=function(n){var i=null,t;return n!=null&&(t=this.images[n],t!=null&&(i=this.alt?t.fallback:t.value)),i};mxImageExport.prototype.includeOverlays=!1;mxImageExport.prototype.drawState=function(n,t){n!=null&&(this.visitStatesRecursive(n,t,mxUtils.bind(this,function(){this.drawCellState.apply(this,arguments)})),this.includeOverlays&&this.visitStatesRecursive(n,t,mxUtils.bind(this,function(){this.drawOverlays.apply(this,arguments)})))};mxImageExport.prototype.visitStatesRecursive=function(n,t,i){var r,f,u,e;if(n!=null)for(i(n,t),r=n.view.graph,f=r.model.getChildCount(n.cell),u=0;u<f;u++)e=r.view.getState(r.model.getChildAt(n.cell,u)),this.visitStatesRecursive(e,t,i)};mxImageExport.prototype.getLinkForCellState=function(){return null};mxImageExport.prototype.drawCellState=function(n,t){var i=this.getLinkForCellState(n,t);i!=null&&t.setLink(i);this.drawShape(n,t);this.drawText(n,t);i!=null&&t.setLink(null)};mxImageExport.prototype.drawShape=function(n,t){n.shape instanceof mxShape&&n.shape.checkBounds()&&(t.save(),n.shape.paint(t),t.restore())};mxImageExport.prototype.drawText=function(n,t){n.text!=null&&n.text.checkBounds()&&(t.save(),n.text.paint(t),t.restore())};mxImageExport.prototype.drawOverlays=function(n,t){n.overlays!=null&&n.overlays.visit(function(n,i){i instanceof mxShape&&i.paint(t)})};mxAbstractCanvas2D.prototype.state=null;mxAbstractCanvas2D.prototype.states=null;mxAbstractCanvas2D.prototype.path=null;mxAbstractCanvas2D.prototype.rotateHtml=!0;mxAbstractCanvas2D.prototype.lastX=0;mxAbstractCanvas2D.prototype.lastY=0;mxAbstractCanvas2D.prototype.moveOp="M";mxAbstractCanvas2D.prototype.lineOp="L";mxAbstractCanvas2D.prototype.quadOp="Q";mxAbstractCanvas2D.prototype.curveOp="C";mxAbstractCanvas2D.prototype.closeOp="Z";mxAbstractCanvas2D.prototype.pointerEvents=!1;mxAbstractCanvas2D.prototype.createUrlConverter=function(){return new mxUrlConverter};mxAbstractCanvas2D.prototype.reset=function(){this.state=this.createState();this.states=[]};mxAbstractCanvas2D.prototype.createState=function(){return{dx:0,dy:0,scale:1,alpha:1,fillColor:null,fillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}};mxAbstractCanvas2D.prototype.format=function(n){return Math.round(parseFloat(n))};mxAbstractCanvas2D.prototype.addOp=function(){var n,t;if(this.path!=null&&(this.path.push(arguments[0]),arguments.length>2))for(n=this.state,t=2;t<arguments.length;t+=2)this.lastX=arguments[t-1],this.lastY=arguments[t],this.path.push(this.format((this.lastX+n.dx)*n.scale)),this.path.push(this.format((this.lastY+n.dy)*n.scale))};mxAbstractCanvas2D.prototype.rotatePoint=function(n,t,i,r,u){var f=i*(Math.PI/180);return mxUtils.getRotatedPoint(new mxPoint(n,t),Math.cos(f),Math.sin(f),new mxPoint(r,u))};mxAbstractCanvas2D.prototype.save=function(){this.states.push(this.state);this.state=mxUtils.clone(this.state)};mxAbstractCanvas2D.prototype.restore=function(){this.states.length>0&&(this.state=this.states.pop())};mxAbstractCanvas2D.prototype.setLink=function(){};mxAbstractCanvas2D.prototype.scale=function(n){this.state.scale*=n;this.state.strokeWidth*=n};mxAbstractCanvas2D.prototype.translate=function(n,t){this.state.dx+=n;this.state.dy+=t};mxAbstractCanvas2D.prototype.setAlpha=function(n){this.state.alpha=n};mxAbstractCanvas2D.prototype.setFillColor=function(n){n==mxConstants.NONE&&(n=null);this.state.fillColor=n;this.state.gradientColor=null};mxAbstractCanvas2D.prototype.setGradient=function(n,t,i,r,u,f,e,o,s){var h=this.state;h.fillColor=n;h.fillAlpha=o!=null?o:1;h.gradientColor=t;h.gradientAlpha=s!=null?s:1;h.gradientDirection=e};mxAbstractCanvas2D.prototype.setStrokeColor=function(n){n==mxConstants.NONE&&(n=null);this.state.strokeColor=n};mxAbstractCanvas2D.prototype.setStrokeWidth=function(n){this.state.strokeWidth=n};mxAbstractCanvas2D.prototype.setDashed=function(n){this.state.dashed=n};mxAbstractCanvas2D.prototype.setDashPattern=function(n){this.state.dashPattern=n};mxAbstractCanvas2D.prototype.setLineCap=function(n){this.state.lineCap=n};mxAbstractCanvas2D.prototype.setLineJoin=function(n){this.state.lineJoin=n};mxAbstractCanvas2D.prototype.setMiterLimit=function(n){this.state.miterLimit=n};mxAbstractCanvas2D.prototype.setFontColor=function(n){n==mxConstants.NONE&&(n=null);this.state.fontColor=n};mxAbstractCanvas2D.prototype.setFontBackgroundColor=function(n){n==mxConstants.NONE&&(n=null);this.state.fontBackgroundColor=n};mxAbstractCanvas2D.prototype.setFontBorderColor=function(n){n==mxConstants.NONE&&(n=null);this.state.fontBorderColor=n};mxAbstractCanvas2D.prototype.setFontSize=function(n){this.state.fontSize=n};mxAbstractCanvas2D.prototype.setFontFamily=function(n){this.state.fontFamily=n};mxAbstractCanvas2D.prototype.setFontStyle=function(n){n==null&&(n=0);this.state.fontStyle=n};mxAbstractCanvas2D.prototype.setShadow=function(n){this.state.shadow=n};mxAbstractCanvas2D.prototype.setShadowColor=function(n){n==mxConstants.NONE&&(n=null);this.state.shadowColor=n};mxAbstractCanvas2D.prototype.setShadowAlpha=function(n){this.state.shadowAlpha=n};mxAbstractCanvas2D.prototype.setShadowOffset=function(n,t){this.state.shadowDx=n;this.state.shadowDy=t};mxAbstractCanvas2D.prototype.begin=function(){this.lastX=0;this.lastY=0;this.path=[]};mxAbstractCanvas2D.prototype.moveTo=function(n,t){this.addOp(this.moveOp,n,t)};mxAbstractCanvas2D.prototype.lineTo=function(n,t){this.addOp(this.lineOp,n,t)};mxAbstractCanvas2D.prototype.quadTo=function(n,t,i,r){this.addOp(this.quadOp,n,t,i,r)};mxAbstractCanvas2D.prototype.curveTo=function(n,t,i,r,u,f){this.addOp(this.curveOp,n,t,i,r,u,f)};mxAbstractCanvas2D.prototype.arcTo=function(n,t,i,r,u,f,e){var s=mxUtils.arcToCurves(this.lastX,this.lastY,n,t,i,r,u,f,e),o;if(s!=null)for(o=0;o<s.length;o+=6)this.curveTo(s[o],s[o+1],s[o+2],s[o+3],s[o+4],s[o+5])};mxAbstractCanvas2D.prototype.close=function(){this.addOp(this.closeOp)};mxAbstractCanvas2D.prototype.end=function(){};mxUtils.extend(mxXmlCanvas2D,mxAbstractCanvas2D);mxXmlCanvas2D.prototype.textEnabled=!0;mxXmlCanvas2D.prototype.compressed=!0;mxXmlCanvas2D.prototype.writeDefaults=function(){var n;n=this.createElement("fontfamily");n.setAttribute("family",mxConstants.DEFAULT_FONTFAMILY);this.root.appendChild(n);n=this.createElement("fontsize");n.setAttribute("size",mxConstants.DEFAULT_FONTSIZE);this.root.appendChild(n);n=this.createElement("shadowcolor");n.setAttribute("color",mxConstants.SHADOWCOLOR);this.root.appendChild(n);n=this.createElement("shadowalpha");n.setAttribute("alpha",mxConstants.SHADOW_OPACITY);this.root.appendChild(n);n=this.createElement("shadowoffset");n.setAttribute("dx",mxConstants.SHADOW_OFFSET_X);n.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y);this.root.appendChild(n)};mxXmlCanvas2D.prototype.format=function(n){return parseFloat(parseFloat(n).toFixed(2))};mxXmlCanvas2D.prototype.createElement=function(n){return this.root.ownerDocument.createElement(n)};mxXmlCanvas2D.prototype.save=function(){this.compressed&&mxAbstractCanvas2D.prototype.save.apply(this,arguments);this.root.appendChild(this.createElement("save"))};mxXmlCanvas2D.prototype.restore=function(){this.compressed&&mxAbstractCanvas2D.prototype.restore.apply(this,arguments);this.root.appendChild(this.createElement("restore"))};mxXmlCanvas2D.prototype.scale=function(n){if(this.compressed){if(this.state.scale==n)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var t=this.createElement("scale");t.setAttribute("scale",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.translate=function(n,t){var i=this.createElement("translate");i.setAttribute("dx",this.format(n));i.setAttribute("dy",this.format(t));this.root.appendChild(i)};mxXmlCanvas2D.prototype.rotate=function(n,t,i,r,u){var f=this.createElement("rotate");(n!=0||t||i)&&(f.setAttribute("theta",this.format(n)),f.setAttribute("flipH",t?"1":"0"),f.setAttribute("flipV",i?"1":"0"),f.setAttribute("cx",this.format(r)),f.setAttribute("cy",this.format(u)),this.root.appendChild(f))};mxXmlCanvas2D.prototype.setAlpha=function(n){if(this.compressed){if(this.state.alpha==n)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var t=this.createElement("alpha");t.setAttribute("alpha",this.format(n));this.root.appendChild(t)};mxXmlCanvas2D.prototype.setFillColor=function(n){if(n==mxConstants.NONE&&(n=null),this.compressed){if(this.state.fillColor==n)return;mxAbstractCanvas2D.prototype.setFillColor.apply(this,arguments)}var t=this.createElement("fillcolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setGradient=function(n,t,i,r,u,f,e,o,s){if(n!=null&&t!=null){mxAbstractCanvas2D.prototype.setGradient.apply(this,arguments);var h=this.createElement("gradient");h.setAttribute("c1",n);h.setAttribute("c2",t);h.setAttribute("x",this.format(i));h.setAttribute("y",this.format(r));h.setAttribute("w",this.format(u));h.setAttribute("h",this.format(f));e!=null&&h.setAttribute("direction",e);o!=null&&h.setAttribute("alpha1",o);s!=null&&h.setAttribute("alpha2",s);this.root.appendChild(h)}};mxXmlCanvas2D.prototype.setStrokeColor=function(n){if(n==mxConstants.NONE&&(n=null),this.compressed){if(this.state.strokeColor==n)return;mxAbstractCanvas2D.prototype.setStrokeColor.apply(this,arguments)}var t=this.createElement("strokecolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setStrokeWidth=function(n){if(this.compressed){if(this.state.strokeWidth==n)return;mxAbstractCanvas2D.prototype.setStrokeWidth.apply(this,arguments)}var t=this.createElement("strokewidth");t.setAttribute("width",this.format(n));this.root.appendChild(t)};mxXmlCanvas2D.prototype.setDashed=function(n){if(this.compressed){if(this.state.dashed==n)return;mxAbstractCanvas2D.prototype.setDashed.apply(this,arguments)}var t=this.createElement("dashed");t.setAttribute("dashed",n?"1":"0");this.root.appendChild(t)};mxXmlCanvas2D.prototype.setDashPattern=function(n){if(this.compressed){if(this.state.dashPattern==n)return;mxAbstractCanvas2D.prototype.setDashPattern.apply(this,arguments)}var t=this.createElement("dashpattern");t.setAttribute("pattern",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setLineCap=function(n){if(this.compressed){if(this.state.lineCap==n)return;mxAbstractCanvas2D.prototype.setLineCap.apply(this,arguments)}var t=this.createElement("linecap");t.setAttribute("cap",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setLineJoin=function(n){if(this.compressed){if(this.state.lineJoin==n)return;mxAbstractCanvas2D.prototype.setLineJoin.apply(this,arguments)}var t=this.createElement("linejoin");t.setAttribute("join",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setMiterLimit=function(n){if(this.compressed){if(this.state.miterLimit==n)return;mxAbstractCanvas2D.prototype.setMiterLimit.apply(this,arguments)}var t=this.createElement("miterlimit");t.setAttribute("limit",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setFontColor=function(n){if(this.textEnabled){if(n==mxConstants.NONE&&(n=null),this.compressed){if(this.state.fontColor==n)return;mxAbstractCanvas2D.prototype.setFontColor.apply(this,arguments)}var t=this.createElement("fontcolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setFontBackgroundColor=function(n){if(this.textEnabled){if(n==mxConstants.NONE&&(n=null),this.compressed){if(this.state.fontBackgroundColor==n)return;mxAbstractCanvas2D.prototype.setFontBackgroundColor.apply(this,arguments)}var t=this.createElement("fontbackgroundcolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setFontBorderColor=function(n){if(this.textEnabled){if(n==mxConstants.NONE&&(n=null),this.compressed){if(this.state.fontBorderColor==n)return;mxAbstractCanvas2D.prototype.setFontBorderColor.apply(this,arguments)}var t=this.createElement("fontbordercolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setFontSize=function(n){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==n)return;mxAbstractCanvas2D.prototype.setFontSize.apply(this,arguments)}var t=this.createElement("fontsize");t.setAttribute("size",n);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setFontFamily=function(n){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==n)return;mxAbstractCanvas2D.prototype.setFontFamily.apply(this,arguments)}var t=this.createElement("fontfamily");t.setAttribute("family",n);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setFontStyle=function(n){if(this.textEnabled){if(n==null&&(n=0),this.compressed){if(this.state.fontStyle==n)return;mxAbstractCanvas2D.prototype.setFontStyle.apply(this,arguments)}var t=this.createElement("fontstyle");t.setAttribute("style",n);this.root.appendChild(t)}};mxXmlCanvas2D.prototype.setShadow=function(n){if(this.compressed){if(this.state.shadow==n)return;mxAbstractCanvas2D.prototype.setShadow.apply(this,arguments)}var t=this.createElement("shadow");t.setAttribute("enabled",n?"1":"0");this.root.appendChild(t)};mxXmlCanvas2D.prototype.setShadowColor=function(n){if(this.compressed){if(n==mxConstants.NONE&&(n=null),this.state.shadowColor==n)return;mxAbstractCanvas2D.prototype.setShadowColor.apply(this,arguments)}var t=this.createElement("shadowcolor");t.setAttribute("color",n!=null?n:mxConstants.NONE);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setShadowAlpha=function(n){if(this.compressed){if(this.state.shadowAlpha==n)return;mxAbstractCanvas2D.prototype.setShadowAlpha.apply(this,arguments)}var t=this.createElement("shadowalpha");t.setAttribute("alpha",n);this.root.appendChild(t)};mxXmlCanvas2D.prototype.setShadowOffset=function(n,t){if(this.compressed){if(this.state.shadowDx==n&&this.state.shadowDy==t)return;mxAbstractCanvas2D.prototype.setShadowOffset.apply(this,arguments)}var i=this.createElement("shadowoffset");i.setAttribute("dx",n);i.setAttribute("dy",t);this.root.appendChild(i)};mxXmlCanvas2D.prototype.rect=function(n,t,i,r){var u=this.createElement("rect");u.setAttribute("x",this.format(n));u.setAttribute("y",this.format(t));u.setAttribute("w",this.format(i));u.setAttribute("h",this.format(r));this.root.appendChild(u)};mxXmlCanvas2D.prototype.roundrect=function(n,t,i,r,u,f){var e=this.createElement("roundrect");e.setAttribute("x",this.format(n));e.setAttribute("y",this.format(t));e.setAttribute("w",this.format(i));e.setAttribute("h",this.format(r));e.setAttribute("dx",this.format(u));e.setAttribute("dy",this.format(f));this.root.appendChild(e)};mxXmlCanvas2D.prototype.ellipse=function(n,t,i,r){var u=this.createElement("ellipse");u.setAttribute("x",this.format(n));u.setAttribute("y",this.format(t));u.setAttribute("w",this.format(i));u.setAttribute("h",this.format(r));this.root.appendChild(u)};mxXmlCanvas2D.prototype.image=function(n,t,i,r,u,f,e,o){u=this.converter.convert(u);var s=this.createElement("image");s.setAttribute("x",this.format(n));s.setAttribute("y",this.format(t));s.setAttribute("w",this.format(i));s.setAttribute("h",this.format(r));s.setAttribute("src",u);s.setAttribute("aspect",f?"1":"0");s.setAttribute("flipH",e?"1":"0");s.setAttribute("flipV",o?"1":"0");this.root.appendChild(s)};mxXmlCanvas2D.prototype.begin=function(){this.root.appendChild(this.createElement("begin"));this.lastX=0;this.lastY=0};mxXmlCanvas2D.prototype.moveTo=function(n,t){var i=this.createElement("move");i.setAttribute("x",this.format(n));i.setAttribute("y",this.format(t));this.root.appendChild(i);this.lastX=n;this.lastY=t};mxXmlCanvas2D.prototype.lineTo=function(n,t){var i=this.createElement("line");i.setAttribute("x",this.format(n));i.setAttribute("y",this.format(t));this.root.appendChild(i);this.lastX=n;this.lastY=t};mxXmlCanvas2D.prototype.quadTo=function(n,t,i,r){var u=this.createElement("quad");u.setAttribute("x1",this.format(n));u.setAttribute("y1",this.format(t));u.setAttribute("x2",this.format(i));u.setAttribute("y2",this.format(r));this.root.appendChild(u);this.lastX=i;this.lastY=r};mxXmlCanvas2D.prototype.curveTo=function(n,t,i,r,u,f){var e=this.createElement("curve");e.setAttribute("x1",this.format(n));e.setAttribute("y1",this.format(t));e.setAttribute("x2",this.format(i));e.setAttribute("y2",this.format(r));e.setAttribute("x3",this.format(u));e.setAttribute("y3",this.format(f));this.root.appendChild(e);this.lastX=u;this.lastY=f};mxXmlCanvas2D.prototype.close=function(){this.root.appendChild(this.createElement("close"))};mxXmlCanvas2D.prototype.text=function(n,t,i,r,u,f,e,o,s,h,c,l,a){if(this.textEnabled&&u!=null){mxUtils.isNode(u)&&(u=mxUtils.getOuterHtml(u));var v=this.createElement("text");v.setAttribute("x",this.format(n));v.setAttribute("y",this.format(t));v.setAttribute("w",this.format(i));v.setAttribute("h",this.format(r));v.setAttribute("str",u);f!=null&&v.setAttribute("align",f);e!=null&&v.setAttribute("valign",e);v.setAttribute("wrap",o?"1":"0");s==null&&(s="");v.setAttribute("format",s);h!=null&&v.setAttribute("overflow",h);c!=null&&v.setAttribute("clip",c?"1":"0");l!=null&&v.setAttribute("rotation",l);a!=null&&v.setAttribute("dir",a);this.root.appendChild(v)}};mxXmlCanvas2D.prototype.stroke=function(){this.root.appendChild(this.createElement("stroke"))};mxXmlCanvas2D.prototype.fill=function(){this.root.appendChild(this.createElement("fill"))};mxXmlCanvas2D.prototype.fillAndStroke=function(){this.root.appendChild(this.createElement("fillstroke"))};mxUtils.extend(mxSvgCanvas2D,mxAbstractCanvas2D),function(){if(mxSvgCanvas2D.prototype.useDomParser=!mxClient.IS_IE&&typeof DOMParser=="function"&&typeof XMLSerializer=="function",mxSvgCanvas2D.prototype.useDomParser){var n=(new DOMParser).parseFromString("test text","text/html");mxSvgCanvas2D.prototype.useDomParser=n!=null}}();mxSvgCanvas2D.prototype.node=null;mxSvgCanvas2D.prototype.matchHtmlAlignment=!0;mxSvgCanvas2D.prototype.textEnabled=!0;mxSvgCanvas2D.prototype.foEnabled=!0;mxSvgCanvas2D.prototype.foAltText="[Object]";mxSvgCanvas2D.prototype.strokeTolerance=0;mxSvgCanvas2D.prototype.refCount=0;mxSvgCanvas2D.prototype.blockImagePointerEvents=!1;mxSvgCanvas2D.prototype.lineHeightCorrection=1.05;mxSvgCanvas2D.prototype.pointerEventsValue="all";mxSvgCanvas2D.prototype.fontMetricsPadding=10;mxSvgCanvas2D.prototype.format=function(n){return parseFloat(parseFloat(n).toFixed(2))};mxSvgCanvas2D.prototype.getBaseUrl=function(){var n=window.location.href,t=n.lastIndexOf("#");return t>0&&(n=n.substring(0,t)),n};mxSvgCanvas2D.prototype.reset=function(){mxAbstractCanvas2D.prototype.reset.apply(this,arguments);this.gradients=[]};mxSvgCanvas2D.prototype.createStyle=function(){var n=this.createElement("style");return n.setAttribute("type","text/css"),mxUtils.write(n,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}"),n};mxSvgCanvas2D.prototype.createElement=function(n,t){if(this.root.ownerDocument.createElementNS!=null)return this.root.ownerDocument.createElementNS(t||mxConstants.NS_SVG,n);var i=this.root.ownerDocument.createElement(n);return t!=null&&i.setAttribute("xmlns",t),i};mxSvgCanvas2D.prototype.createAlternateContent=function(n,t,i,r,u){if(this.foAltText!=null){var e=this.state,f=this.createElement("text");return f.setAttribute("x",Math.round(r/2)),f.setAttribute("y",Math.round((u+e.fontSize)/2)),f.setAttribute("fill",e.fontColor||"black"),f.setAttribute("text-anchor","middle"),f.setAttribute("font-size",Math.round(e.fontSize)+"px"),f.setAttribute("font-family",e.fontFamily),(e.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&f.setAttribute("font-weight","bold"),(e.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&f.setAttribute("font-style","italic"),(e.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&f.setAttribute("text-decoration","underline"),mxUtils.write(f,this.foAltText),f}return null};mxSvgCanvas2D.prototype.createGradientId=function(n,t,i,r,u){var f,e;return n.charAt(0)=="#"&&(n=n.substring(1)),t.charAt(0)=="#"&&(t=t.substring(1)),n=n.toLowerCase()+"-"+i,t=t.toLowerCase()+"-"+r,f=null,u==null||u==mxConstants.DIRECTION_SOUTH?f="s":u==mxConstants.DIRECTION_EAST?f="e":(e=n,n=t,t=e,u==mxConstants.DIRECTION_NORTH?f="s":u==mxConstants.DIRECTION_WEST&&(f="e")),"mx-gradient-"+n+"-"+t+"-"+f};mxSvgCanvas2D.prototype.getSvgGradient=function(n,t,i,r,u){var s=this.createGradientId(n,t,i,r,u),f=this.gradients[s];if(f==null){var e=this.root.ownerSVGElement,h=0,o=s+"-"+h;if(e!=null)for(f=e.ownerDocument.getElementById(o);f!=null&&f.ownerSVGElement!=e;)o=s+"-"+h++,f=e.ownerDocument.getElementById(o);else o="id"+ ++this.refCount;f==null&&(f=this.createSvgGradient(n,t,i,r,u),f.setAttribute("id",o),this.defs!=null?this.defs.appendChild(f):e.appendChild(f));this.gradients[s]=f}return f.getAttribute("id")};mxSvgCanvas2D.prototype.createSvgGradient=function(n,t,i,r,u){var f=this.createElement("linearGradient"),o,e;return f.setAttribute("x1","0%"),f.setAttribute("y1","0%"),f.setAttribute("x2","0%"),f.setAttribute("y2","0%"),u==null||u==mxConstants.DIRECTION_SOUTH?f.setAttribute("y2","100%"):u==mxConstants.DIRECTION_EAST?f.setAttribute("x2","100%"):u==mxConstants.DIRECTION_NORTH?f.setAttribute("y1","100%"):u==mxConstants.DIRECTION_WEST&&f.setAttribute("x1","100%"),o=i<1?";stop-opacity:"+i:"",e=this.createElement("stop"),e.setAttribute("offset","0%"),e.setAttribute("style","stop-color:"+n+o),f.appendChild(e),o=r<1?";stop-opacity:"+r:"",e=this.createElement("stop"),e.setAttribute("offset","100%"),e.setAttribute("style","stop-color:"+t+o),f.appendChild(e),f};mxSvgCanvas2D.prototype.addNode=function(n,t){var i=this.node,r=this.state;if(i!=null){if(i.nodeName=="path")if(this.path!=null&&this.path.length>0)i.setAttribute("d",this.path.join(" "));else return;n&&r.fillColor!=null?this.updateFill():this.styleEnabled||(i.nodeName=="ellipse"&&mxClient.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill","none"),n=!1);t&&r.strokeColor!=null?this.updateStroke():this.styleEnabled||i.setAttribute("stroke","none");r.transform!=null&&r.transform.length>0&&i.setAttribute("transform",r.transform);r.shadow&&this.root.appendChild(this.createShadow(i));this.strokeTolerance>0&&!n&&this.root.appendChild(this.createTolerance(i));this.pointerEvents&&(i.nodeName!="path"||this.path[this.path.length-1]==this.closeOp)?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot!=null||i.setAttribute("pointer-events","none");this.root.appendChild(i)}};mxSvgCanvas2D.prototype.updateFill=function(){var n=this.state,t,i;n.alpha<1&&this.node.setAttribute("fill-opacity",n.alpha);n.fillColor!=null&&(n.gradientColor!=null?(t=this.getSvgGradient(n.fillColor,n.gradientColor,n.fillAlpha,n.gradientAlpha,n.gradientDirection),mxClient.IS_IE||this.root.ownerDocument!=document?this.node.setAttribute("fill","url(#"+t+")"):(i=this.getBaseUrl().replace(/([\(\)])/g,"\\$1"),this.node.setAttribute("fill","url("+i+"#"+t+")"))):this.node.setAttribute("fill",n.fillColor.toLowerCase()))};mxSvgCanvas2D.prototype.getCurrentStrokeWidth=function(){return Math.max(1,this.format(this.state.strokeWidth*this.state.scale))};mxSvgCanvas2D.prototype.updateStroke=function(){var n=this.state,t;this.node.setAttribute("stroke",n.strokeColor.toLowerCase());n.alpha<1&&this.node.setAttribute("stroke-opacity",n.alpha);t=this.getCurrentStrokeWidth();t!=1&&this.node.setAttribute("stroke-width",t);this.node.nodeName=="path"&&this.updateStrokeAttributes();n.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern(n.strokeWidth*n.scale))};mxSvgCanvas2D.prototype.updateStrokeAttributes=function(){var n=this.state,t;n.lineJoin!=null&&n.lineJoin!="miter"&&this.node.setAttribute("stroke-linejoin",n.lineJoin);n.lineCap!=null&&(t=n.lineCap,t=="flat"&&(t="butt"),t!="butt"&&this.node.setAttribute("stroke-linecap",t));n.miterLimit==null||this.styleEnabled&&n.miterLimit==10||this.node.setAttribute("stroke-miterlimit",n.miterLimit)};mxSvgCanvas2D.prototype.createDashPattern=function(n){var r=[],i,t;if(typeof this.state.dashPattern=="string"&&(i=this.state.dashPattern.split(" "),i.length>0))for(t=0;t<i.length;t++)r[t]=Number(i[t])*n;return r.join(" ")};mxSvgCanvas2D.prototype.createTolerance=function(n){var t=n.cloneNode(!0),i=parseFloat(t.getAttribute("stroke-width")||1)+this.strokeTolerance;return t.setAttribute("pointer-events","stroke"),t.setAttribute("visibility","hidden"),t.removeAttribute("stroke-dasharray"),t.setAttribute("stroke-width",i),t.setAttribute("fill","none"),t.setAttribute("stroke",mxClient.IS_OT?"none":"white"),t};mxSvgCanvas2D.prototype.createShadow=function(n){var t=n.cloneNode(!0),i=this.state;return t.getAttribute("fill")=="none"||mxClient.IS_FF&&t.getAttribute("fill")=="transparent"||t.setAttribute("fill",i.shadowColor),t.getAttribute("stroke")!="none"&&t.setAttribute("stroke",i.shadowColor),t.setAttribute("transform","translate("+this.format(i.shadowDx*i.scale)+","+this.format(i.shadowDy*i.scale)+")"+(i.transform||"")),t.setAttribute("opacity",i.shadowAlpha),t};mxSvgCanvas2D.prototype.setLink=function(n){if(n==null)this.root=this.originalRoot;else{this.originalRoot=this.root;var t=this.createElement("a");t.setAttributeNS==null||this.root.ownerDocument!=document&&document.documentMode==null?t.setAttribute("xlink:href",n):t.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",n);this.root.appendChild(t);this.root=t}};mxSvgCanvas2D.prototype.rotate=function(n,t,i,r,u){var f;if(n!=0||t||i){if(f=this.state,r+=f.dx,u+=f.dy,r*=f.scale,u*=f.scale,f.transform=f.transform||"",t&&i)n+=180;else if(t!=i){var e=t?r:0,s=t?-1:1,o=i?u:0,h=i?-1:1;f.transform+="translate("+this.format(e)+","+this.format(o)+")scale("+this.format(s)+","+this.format(h)+")translate("+this.format(-e)+","+this.format(-o)+")"}(t?!i:i)&&(n*=-1);n!=0&&(f.transform+="rotate("+this.format(n)+","+this.format(r)+","+this.format(u)+")");f.rotation=f.rotation+n;f.rotationCx=r;f.rotationCy=u}};mxSvgCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createElement("path")};mxSvgCanvas2D.prototype.rect=function(n,t,i,r){var u=this.state,f=this.createElement("rect");f.setAttribute("x",this.format((n+u.dx)*u.scale));f.setAttribute("y",this.format((t+u.dy)*u.scale));f.setAttribute("width",this.format(i*u.scale));f.setAttribute("height",this.format(r*u.scale));this.node=f};mxSvgCanvas2D.prototype.roundrect=function(n,t,i,r,u,f){this.rect(n,t,i,r);u>0&&this.node.setAttribute("rx",this.format(u*this.state.scale));f>0&&this.node.setAttribute("ry",this.format(f*this.state.scale))};mxSvgCanvas2D.prototype.ellipse=function(n,t,i,r){var u=this.state,f=this.createElement("ellipse");f.setAttribute("cx",Math.round((n+i/2+u.dx)*u.scale));f.setAttribute("cy",Math.round((t+r/2+u.dy)*u.scale));f.setAttribute("rx",i/2*u.scale);f.setAttribute("ry",r/2*u.scale);this.node=f};mxSvgCanvas2D.prototype.image=function(n,t,i,r,u,f,e,o){var h,s,c;if(u=this.converter.convert(u),f=f!=null?f:!0,e=e!=null?e:!1,o=o!=null?o:!1,h=this.state,n+=h.dx,t+=h.dy,s=this.createElement("image"),s.setAttribute("x",this.format(n*h.scale)),s.setAttribute("y",this.format(t*h.scale)),s.setAttribute("width",this.format(i*h.scale)),s.setAttribute("height",this.format(r*h.scale)),s.setAttributeNS==null?s.setAttribute("xlink:href",u):s.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",u),f||s.setAttribute("preserveAspectRatio","none"),h.alpha<1&&s.setAttribute("opacity",h.alpha),c=this.state.transform||"",e||o){var l=1,a=1,v=0,y=0;e&&(l=-1,v=-i-2*n);o&&(a=-1,y=-r-2*t);c+="scale("+l+","+a+")translate("+v*h.scale+","+y*h.scale+")"}c.length>0&&s.setAttribute("transform",c);this.pointerEvents||s.setAttribute("pointer-events","none");this.root.appendChild(s);this.blockImagePointerEvents&&(s.setAttribute("style","pointer-events:none"),s=this.createElement("rect"),s.setAttribute("visibility","hidden"),s.setAttribute("pointer-events","fill"),s.setAttribute("x",this.format(n*h.scale)),s.setAttribute("y",this.format(t*h.scale)),s.setAttribute("width",this.format(i*h.scale)),s.setAttribute("height",this.format(r*h.scale)),this.root.appendChild(s))};mxSvgCanvas2D.prototype.convertHtml=function(n){var t,i;return this.useDomParser?(t=(new DOMParser).parseFromString(n,"text/html"),t!=null&&(n=(new XMLSerializer).serializeToString(t.body),n.substring(0,5)=="<body"&&(n=n.substring(n.indexOf(">",5)+1)),n.substring(n.length-7,n.length)=="<\/body>"&&(n=n.substring(0,n.length-7)))):(i=document.createElement("textarea"),i.innerHTML=n.replace(/&amp;/g,"&amp;amp;").replace(/&#60;/g,"&amp;lt;").replace(/&#62;/g,"&amp;gt;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n=i.value.replace(/&/g,"&amp;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;amp;/g,"&amp;").replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />").replace(/(<img[^>]+)>/gm,"$1 />")),n};mxSvgCanvas2D.prototype.createDiv=function(n,t,i,r,u){var e=this.state,h=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(e.fontSize*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT*this.lineHeightCorrection,s,f,o;return r="display:inline-block;font-size:"+Math.round(e.fontSize)+"px;font-family:"+e.fontFamily+";color:"+e.fontColor+";line-height:"+h+";"+r,(e.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(r+="font-weight:bold;"),(e.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(r+="font-style:italic;"),(e.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(r+="text-decoration:underline;"),t==mxConstants.ALIGN_CENTER?r+="text-align:center;":t==mxConstants.ALIGN_RIGHT&&(r+="text-align:right;"),s="",e.fontBackgroundColor!=null&&(s+="background-color:"+e.fontBackgroundColor+";"),e.fontBorderColor!=null&&(s+="border:1px solid "+e.fontBorderColor+";"),f=n,mxUtils.isNode(f)||(f=this.convertHtml(f),u!="fill"&&u!="width"?f='<div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;'+s+'">'+f+"<\/div>":r+=s),!mxClient.IS_IE&&document.createElementNS?(o=document.createElementNS("http://www.w3.org/1999/xhtml","div"),o.setAttribute("style",r),mxUtils.isNode(f)?this.root.ownerDocument!=document?o.appendChild(f.cloneNode(!0)):o.appendChild(f):o.innerHTML=f,o):(mxUtils.isNode(f)&&this.root.ownerDocument!=document&&(f=f.outerHTML),mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+r+'">'+f+"<\/div>").documentElement)};mxSvgCanvas2D.prototype.text=function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v,it,rt,b,p,y,k,ct,g,d,et,ft,ut,ot,lt,at,st;if(this.textEnabled&&u!=null)if(l=l!=null?l:0,v=this.state,n+=v.dx,t+=v.dy,this.foEnabled&&s=="html"){if(it="vertical-align:top;",c?it+="overflow:hidden;max-height:"+Math.round(r)+"px;max-width:"+Math.round(i)+"px;":h=="fill"?it+="width:"+Math.round(i)+"px;height:"+Math.round(r)+"px;":h=="width"&&(it+="width:"+Math.round(i)+"px;",r>0&&(it+="max-height:"+Math.round(r)+"px;")),it+=o&&i>0?"width:"+Math.round(i)+"px;white-space:normal;":"white-space:nowrap;",rt=this.createElement("g"),v.alpha<1&&rt.setAttribute("opacity",v.alpha),b=this.createElement("foreignObject"),b.setAttribute("pointer-events","all"),p=this.createDiv(u,f,e,it,h),p==null)return;a!=null&&p.setAttribute("dir",a);rt.appendChild(b);this.root.appendChild(rt);var w=0,nt=0,tt=2,ht=2;mxClient.IS_IE&&(document.documentMode==9||!mxClient.IS_SVG)?(y=document.createElement("div"),y.style.cssText=p.getAttribute("style"),y.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",y.style.position="absolute",y.style.visibility="hidden",k=document.createElement("div"),k.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",k.innerHTML=mxUtils.isNode(u)?u.outerHTML:u,y.appendChild(k),document.body.appendChild(y),document.documentMode!=8&&document.documentMode!=9&&v.fontBorderColor!=null&&(tt+=2,ht+=2),o&&i>0?(d=k.offsetWidth,ct=0,c||this.root.ownerDocument==document||(et=y.style.whiteSpace,y.style.whiteSpace="nowrap",d==k.offsetWidth?tt+=this.fontMetricsPadding:(document.documentMode==8||document.documentMode==9)&&(ct=-2),y.style.whiteSpace=et),d=d+tt,c&&(d=Math.min(d,i)),y.style.width=d+"px",w=k.offsetWidth+tt+ct,nt=k.offsetHeight+ht,y.style.display="inline-block",y.style.position="",y.style.visibility="",y.style.width=w+"px",p.setAttribute("style",y.style.cssText)):(w=k.offsetWidth+tt,nt=k.offsetHeight+ht),y.parentNode.removeChild(y),b.appendChild(p)):(this.root.ownerDocument!=document||mxClient.IS_FF?(p.style.visibility="hidden",document.body.appendChild(p)):b.appendChild(p),g=p,g.firstChild!=null&&g.firstChild.nodeName=="DIV"&&(g=g.firstChild),d=g.offsetWidth,!c&&o&&i>0&&this.root.ownerDocument!=document&&(et=p.style.whiteSpace,p.style.whiteSpace="nowrap",d==g.offsetWidth&&(tt+=this.fontMetricsPadding),p.style.whiteSpace=et),w=d+tt,o&&(c&&(w=Math.min(w,i)),p.style.width=w+"px"),w=g.offsetWidth+tt,nt=g.offsetHeight+2,p.parentNode!=b&&(b.appendChild(p),p.style.visibility=""));c&&(nt=Math.min(nt,r),w=Math.min(w,i));h=="fill"?(i=Math.max(i,w),r=Math.max(r,nt)):h=="width"?(i=Math.max(i,w),r=nt):(i=w,r=nt);v.alpha<1&&rt.setAttribute("opacity",v.alpha);ft=0;ut=0;f==mxConstants.ALIGN_CENTER?ft-=i/2:f==mxConstants.ALIGN_RIGHT&&(ft-=i);n+=ft;e==mxConstants.ALIGN_MIDDLE?ut-=r/2-2:e==mxConstants.ALIGN_BOTTOM&&(ut-=r-3);!mxClient.IS_OP&&mxClient.IS_GC&&mxClient.IS_MAC?ut+=1:mxClient.IS_FF&&mxClient.IS_WIN&&(ut-=1);t+=ut;ot=v.scale!=1?"scale("+v.scale+")":"";v.rotation!=0&&this.rotateHtml?(ot+="rotate("+v.rotation+","+i/2+","+r/2+")",lt=this.rotatePoint((n+i/2)*v.scale,(t+r/2)*v.scale,v.rotation,v.rotationCx,v.rotationCy),n=lt.x-i*v.scale/2,t=lt.y-r*v.scale/2):(n*=v.scale,t*=v.scale);l!=0&&(ot+="rotate("+l+","+-ft+","+-ut+")");rt.setAttribute("transform","translate("+Math.round(n)+","+Math.round(t)+")"+ot);b.setAttribute("width",Math.round(Math.max(1,i)));b.setAttribute("height",Math.round(Math.max(1,r)));this.root.ownerDocument!=document&&(at=this.createAlternateContent(b,n,t,i,r,u,f,e,o,s,h,c,l),at!=null&&(b.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility"),st=this.createElement("switch"),st.appendChild(b),st.appendChild(at),rt.appendChild(st)))}else this.plainText(n,t,i,r,u,f,e,o,h,c,l,a)};mxSvgCanvas2D.prototype.createClip=function(n,t,i,r){var u;n=Math.round(n);t=Math.round(t);i=Math.round(i);r=Math.round(r);for(var e="mx-clip-"+n+"-"+t+"-"+i+"-"+r,o=0,f=e+"-"+o;document.getElementById(f)!=null;)f=e+"-"+ ++o;return clip=this.createElement("clipPath"),clip.setAttribute("id",f),u=this.createElement("rect"),u.setAttribute("x",n),u.setAttribute("y",t),u.setAttribute("width",i),u.setAttribute("height",r),clip.appendChild(u),clip};mxSvgCanvas2D.prototype.plainText=function(n,t,i,r,u,f,e,o,s,h,c,l){var nt,y,b,ut,rt,tt,p,g;c=c!=null?c:0;var a=this.state,w=Math.round(a.fontSize),v=this.createElement("g"),it=a.transform||"";this.updateFont(v);c!=0&&(it+="rotate("+c+","+this.format(n*a.scale)+","+this.format(t*a.scale)+")");l!=null&&v.setAttribute("direction",l);h&&i>0&&r>0&&(nt=n,y=t,f==mxConstants.ALIGN_CENTER?nt-=i/2:f==mxConstants.ALIGN_RIGHT&&(nt-=i),s!="fill"&&(e==mxConstants.ALIGN_MIDDLE?y-=r/2:e==mxConstants.ALIGN_BOTTOM&&(y-=r)),b=this.createClip(nt*a.scale-2,y*a.scale-2,i*a.scale+4,r*a.scale+4),this.defs!=null?this.defs.appendChild(b):this.root.appendChild(b),mxClient.IS_IE||this.root.ownerDocument!=document?v.setAttribute("clip-path","url(#"+b.getAttribute("id")+")"):(ut=this.getBaseUrl().replace(/([\(\)])/g,"\\$1"),v.setAttribute("clip-path","url("+ut+"#"+b.getAttribute("id")+")")));rt=f==mxConstants.ALIGN_RIGHT?"end":f==mxConstants.ALIGN_CENTER?"middle":"start";rt!="start"&&v.setAttribute("text-anchor",rt);this.styleEnabled&&w==mxConstants.DEFAULT_FONTSIZE||v.setAttribute("font-size",Math.round(w*a.scale)+"px");it.length>0&&v.setAttribute("transform",it);a.alpha<1&&v.setAttribute("opacity",a.alpha);var k=u.split("\n"),ft=Math.round(w*mxConstants.LINE_HEIGHT),d=w+(k.length-1)*ft,y=t+w-1;for(e==mxConstants.ALIGN_MIDDLE?s=="fill"?y-=r/2:(tt=(this.matchHtmlAlignment&&h&&r>0?Math.min(d,r):d)/2,y-=tt+1):e==mxConstants.ALIGN_BOTTOM&&(s=="fill"?y-=r:(tt=this.matchHtmlAlignment&&h&&r>0?Math.min(d,r):d,y-=tt+2)),p=0;p<k.length;p++)k[p].length>0&&mxUtils.trim(k[p]).length>0&&(g=this.createElement("text"),g.setAttribute("x",this.format(n*a.scale)),g.setAttribute("y",this.format(y*a.scale)),mxUtils.write(g,k[p]),v.appendChild(g)),y+=ft;this.root.appendChild(v);this.addTextBackground(v,u,n,t,i,s=="fill"?r:d,f,e,s)};mxSvgCanvas2D.prototype.updateFont=function(n){var t=this.state;n.setAttribute("fill",t.fontColor);this.styleEnabled&&t.fontFamily==mxConstants.DEFAULT_FONTFAMILY||n.setAttribute("font-family",t.fontFamily);(t.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&n.setAttribute("font-weight","bold");(t.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&n.setAttribute("font-style","italic");(t.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&n.setAttribute("text-decoration","underline")};mxSvgCanvas2D.prototype.addTextBackground=function(n,t,i,r,u,f,e,o,s){var h=this.state,l,v,c,u,f,a,y;if(h.fontBackgroundColor!=null||h.fontBorderColor!=null){if(l=null,s=="fill"||s=="width")e==mxConstants.ALIGN_CENTER?i-=u/2:e==mxConstants.ALIGN_RIGHT&&(i-=u),o==mxConstants.ALIGN_MIDDLE?r-=f/2:o==mxConstants.ALIGN_BOTTOM&&(r-=f),l=new mxRectangle((i+1)*h.scale,r*h.scale,(u-2)*h.scale,(f+2)*h.scale);else if(n.getBBox!=null&&this.root.ownerDocument==document)try{l=n.getBBox();v=mxClient.IS_IE&&mxClient.IS_SVG;l=new mxRectangle(l.x,l.y+(v?0:1),l.width,l.height+(v?1:0))}catch(p){}else c=document.createElement("div"),c.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(h.fontSize*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT,c.style.fontSize=Math.round(h.fontSize)+"px",c.style.fontFamily=h.fontFamily,c.style.whiteSpace="nowrap",c.style.position="absolute",c.style.visibility="hidden",c.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",c.style.zoom="1",(h.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(c.style.fontWeight="bold"),(h.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(c.style.fontStyle="italic"),t=mxUtils.htmlEntities(t,!1),c.innerHTML=t.replace(/\n/g,"<br/>"),document.body.appendChild(c),u=c.offsetWidth,f=c.offsetHeight,c.parentNode.removeChild(c),e==mxConstants.ALIGN_CENTER?i-=u/2:e==mxConstants.ALIGN_RIGHT&&(i-=u),o==mxConstants.ALIGN_MIDDLE?r-=f/2:o==mxConstants.ALIGN_BOTTOM&&(r-=f),l=new mxRectangle((i+1)*h.scale,(r+2)*h.scale,u*h.scale,(f+1)*h.scale);l!=null&&(a=this.createElement("rect"),a.setAttribute("fill",h.fontBackgroundColor||"none"),a.setAttribute("stroke",h.fontBorderColor||"none"),a.setAttribute("x",Math.floor(l.x-1)),a.setAttribute("y",Math.floor(l.y-1)),a.setAttribute("width",Math.ceil(l.width+2)),a.setAttribute("height",Math.ceil(l.height)),y=h.fontBorderColor!=null?Math.max(1,this.format(h.scale)):0,a.setAttribute("stroke-width",y),this.root.ownerDocument==document&&mxUtils.mod(y,2)==1&&a.setAttribute("transform","translate(0.5, 0.5)"),n.insertBefore(a,n.firstChild))}};mxSvgCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxSvgCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxSvgCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};mxVmlCanvas2D=function(n){mxAbstractCanvas2D.call(this);this.root=n};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D);mxVmlCanvas2D.prototype.node=null;mxVmlCanvas2D.prototype.textEnabled=!0;mxVmlCanvas2D.prototype.moveOp="m";mxVmlCanvas2D.prototype.lineOp="l";mxVmlCanvas2D.prototype.curveOp="c";mxVmlCanvas2D.prototype.closeOp="x";mxVmlCanvas2D.prototype.rotatedHtmlBackground="";mxVmlCanvas2D.prototype.vmlScale=1;mxVmlCanvas2D.prototype.createElement=function(n){return document.createElement(n)};mxVmlCanvas2D.prototype.createVmlElement=function(n){return this.createElement(mxClient.VML_PREFIX+":"+n)};mxVmlCanvas2D.prototype.addNode=function(n,t){var i=this.node,r=this.state;if(i!=null){if(i.nodeName=="shape")if(this.path!=null&&this.path.length>0)i.path=this.path.join(" ")+" e",i.style.width=this.root.style.width,i.style.height=this.root.style.height,i.coordsize=parseInt(i.style.width)+" "+parseInt(i.style.height);else return;i.strokeweight=this.format(Math.max(1,r.strokeWidth*r.scale/this.vmlScale))+"px";r.shadow&&this.root.appendChild(this.createShadow(i,n&&r.fillColor!=null,t&&r.strokeColor!=null));t&&r.strokeColor!=null?(i.stroked="true",i.strokecolor=r.strokeColor):i.stroked="false";i.appendChild(this.createStroke());n&&r.fillColor!=null?i.appendChild(this.createFill()):this.pointerEvents&&(i.nodeName!="shape"||this.path[this.path.length-1]==this.closeOp)?i.appendChild(this.createTransparentFill()):i.filled="false";this.root.appendChild(i)}};mxVmlCanvas2D.prototype.createTransparentFill=function(){var n=this.createVmlElement("fill");return n.src=mxClient.imageBasePath+"/transparent.gif",n.type="tile",n};mxVmlCanvas2D.prototype.createFill=function(){var n=this.state,t=this.createVmlElement("fill"),i;return t.color=n.fillColor,n.gradientColor!=null?(t.type="gradient",t.method="none",t.color2=n.gradientColor,i=180-n.rotation,n.gradientDirection==mxConstants.DIRECTION_WEST?i-=90+(this.root.style.flip=="x"?180:0):n.gradientDirection==mxConstants.DIRECTION_EAST?i+=90+(this.root.style.flip=="x"?180:0):n.gradientDirection==mxConstants.DIRECTION_NORTH?i-=180+(this.root.style.flip=="y"?-180:0):i+=this.root.style.flip=="y"?-180:0,(this.root.style.flip=="x"||this.root.style.flip=="y")&&(i*=-1),t.angle=mxUtils.mod(i,360),t.opacity=n.alpha*n.fillAlpha*100+"%",t.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",n.alpha*n.gradientAlpha*100+"%")):n.alpha<1&&(t.opacity=n.alpha*100+"%"),t};mxVmlCanvas2D.prototype.createStroke=function(){var n=this.state,t=this.createVmlElement("stroke");return t.endcap=n.lineCap||"flat",t.joinstyle=n.lineJoin||"miter",t.miterlimit=n.miterLimit||"10",n.alpha<1&&(t.opacity=n.alpha*100+"%"),n.dashed&&(t.dashstyle=this.getVmlDashStyle()),t};mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var t="dash",n;return typeof this.state.dashPattern=="string"&&(n=this.state.dashPattern.split(" "),n.length>0&&n[0]==1&&(t="0 2")),t};mxVmlCanvas2D.prototype.createShadow=function(n,t,i){var u=this.state,o=-u.rotation*(Math.PI/180),s=Math.cos(o),h=Math.sin(o),f=u.shadowDx*u.scale,e=u.shadowDy*u.scale,r;return this.root.style.flip=="x"?f*=-1:this.root.style.flip=="y"&&(e*=-1),r=n.cloneNode(!0),r.style.marginLeft=Math.round(f*s-e*h)+"px",r.style.marginTop=Math.round(f*h+e*s)+"px",document.documentMode==8&&(r.strokeweight=n.strokeweight,n.nodeName=="shape"&&(r.path=this.path.join(" ")+" e",r.style.width=this.root.style.width,r.style.height=this.root.style.height,r.coordsize=parseInt(n.style.width)+" "+parseInt(n.style.height))),i?(r.strokecolor=u.shadowColor,r.appendChild(this.createShadowStroke())):r.stroked="false",t?r.appendChild(this.createShadowFill()):r.filled="false",r};mxVmlCanvas2D.prototype.createShadowFill=function(){var n=this.createVmlElement("fill");return n.color=this.state.shadowColor,n.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",n};mxVmlCanvas2D.prototype.createShadowStroke=function(){var n=this.createStroke();return n.opacity=this.state.alpha*this.state.shadowAlpha*100+"%",n};mxVmlCanvas2D.prototype.rotate=function(n,t,i,r,u){t&&i?n+=180:t?this.root.style.flip="x":i&&(this.root.style.flip="y");(t?!i:i)&&(n*=-1);this.root.style.rotation=n;this.state.rotation=this.state.rotation+n;this.state.rotationCx=r;this.state.rotationCy=u};mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createVmlElement("shape");this.node.style.position="absolute"};mxVmlCanvas2D.prototype.quadTo=function(n,t,i,r){var u=this.state,o=(this.lastX+u.dx)*u.scale,s=(this.lastY+u.dy)*u.scale,h=(n+u.dx)*u.scale,c=(t+u.dy)*u.scale,f=(i+u.dx)*u.scale,e=(r+u.dy)*u.scale,l=o+2/3*(h-o),a=s+2/3*(c-s),v=f+2/3*(h-f),y=e+2/3*(c-e);this.path.push("c "+this.format(l)+" "+this.format(a)+" "+this.format(v)+" "+this.format(y)+" "+this.format(f)+" "+this.format(e));this.lastX=f/u.scale-u.dx;this.lastY=e/u.scale-u.dy};mxVmlCanvas2D.prototype.createRect=function(n,t,i,r,u){var f=this.state,e=this.createVmlElement(n);return e.style.position="absolute",e.style.left=this.format((t+f.dx)*f.scale)+"px",e.style.top=this.format((i+f.dy)*f.scale)+"px",e.style.width=this.format(r*f.scale)+"px",e.style.height=this.format(u*f.scale)+"px",e};mxVmlCanvas2D.prototype.rect=function(n,t,i,r){this.node=this.createRect("rect",n,t,i,r)};mxVmlCanvas2D.prototype.roundrect=function(n,t,i,r,u,f){this.node=this.createRect("roundrect",n,t,i,r);this.node.setAttribute("arcsize",Math.max(u*100/i,f*100/r)+"%")};mxVmlCanvas2D.prototype.ellipse=function(n,t,i,r){this.node=this.createRect("oval",n,t,i,r)};mxVmlCanvas2D.prototype.image=function(n,t,i,r,u,f,e,o){var s=null,h;f?(s=this.createRect("rect",n,t,i,r),s.stroked="false",h=this.createVmlElement("fill"),h.aspect=f?"atmost":"ignore",h.rotate="true",h.type="frame",h.src=u,s.appendChild(h)):(s=this.createRect("image",n,t,i,r),s.src=u);e&&o?s.style.rotation="180":e?s.style.flip="x":o&&(s.style.flip="y");this.state.alpha<1&&(s.style.filter+="alpha(opacity="+this.state.alpha*100+")");this.root.appendChild(s)};mxVmlCanvas2D.prototype.createDiv=function(n,t,i,r){var o=this.createElement("div"),u=this.state,s="",e,f;return u.fontBackgroundColor!=null&&(s+="background-color:"+u.fontBackgroundColor+";"),u.fontBorderColor!=null&&(s+="border:1px solid "+u.fontBorderColor+";"),mxUtils.isNode(n)?o.appendChild(n):r!="fill"&&r!="width"?(e=this.createElement("div"),e.style.cssText=s,e.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",e.style.zoom="1",e.style.textDecoration="inherit",e.innerHTML=n,o.appendChild(e)):(o.style.cssText=s,o.innerHTML=n),f=o.style,f.fontSize=Math.round(u.fontSize/this.vmlScale)+"px",f.fontFamily=u.fontFamily,f.color=u.fontColor,f.verticalAlign="top",f.textAlign=t||"left",f.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(u.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale)+"px":mxConstants.LINE_HEIGHT,(u.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(f.fontWeight="bold"),(u.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(f.fontStyle="italic"),(u.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(f.textDecoration="underline"),o};mxVmlCanvas2D.prototype.text=function(n,t,i,r,u,f,e,o,s,h,c,l,a){var p,ot,y,k,ut,tt,st,ht,g,ct,lt,at,nt,vt,pt,w;if(this.textEnabled&&u!=null)if(p=this.state,s=="html"){p.rotation!=null&&(ot=this.rotatePoint(n,t,p.rotation,p.rotationCx,p.rotationCy),n=ot.x,t=ot.y);document.documentMode!=8||mxClient.IS_EM?(n*=p.scale,t*=p.scale):(n+=p.dx,t+=p.dy,e==mxConstants.ALIGN_TOP&&(t-=1));y=document.documentMode==8&&!mxClient.IS_EM?this.createVmlElement("group"):this.createElement("div");y.style.position="absolute";y.style.display="inline";y.style.left=this.format(n)+"px";y.style.top=this.format(t)+"px";y.style.zoom=p.scale;k=this.createElement("div");k.style.position="relative";k.style.display="inline";var yt=mxUtils.getAlignmentAsPoint(f,e),it=yt.x,rt=yt.y,v=this.createDiv(u,f,e,h),d=this.createElement("div");if(a!=null&&v.setAttribute("dir",a),o&&i>0?(c||(v.style.width=Math.round(i)+"px"),v.style.whiteSpace="normal"):v.style.whiteSpace="nowrap",ut=p.rotation+(l||0),this.rotateHtml&&ut!=0?(d.style.display="inline",d.style.zoom="1",d.appendChild(v),document.documentMode!=8||mxClient.IS_EM||this.root.nodeName=="DIV"?y.appendChild(d):(k.appendChild(d),y.appendChild(k))):document.documentMode!=8||mxClient.IS_EM?(v.style.display="inline",y.appendChild(v)):(k.appendChild(v),y.appendChild(k)),this.root.nodeName!="DIV"?(tt=this.createVmlElement("rect"),tt.stroked="false",tt.filled="false",tt.appendChild(y),this.root.appendChild(tt)):this.root.appendChild(y),c?(v.style.overflow="hidden",v.style.width=Math.round(i)+"px",mxClient.IS_QUIRKS||(v.style.maxHeight=Math.round(r)+"px")):h=="fill"?(v.style.width=i+"px",v.style.height=r+"px"):h=="width"&&(v.style.width=i+"px",r>0&&(v.style.maxHeight=Math.round(r)+"px")),this.rotateHtml&&ut!=0){var b=ut*(Math.PI/180),ft=parseFloat(parseFloat(Math.cos(b)).toFixed(8)),et=parseFloat(parseFloat(Math.sin(-b)).toFixed(8));b%=2*Math.PI;b<0&&(b+=2*Math.PI);b%=Math.PI;b>Math.PI/2&&(b=Math.PI-b);st=Math.cos(b);ht=Math.sin(b);document.documentMode!=8||mxClient.IS_EM||(v.style.display="inline-block",d.style.display="inline-block",k.style.display="inline-block");v.style.visibility="hidden";v.style.position="absolute";document.body.appendChild(v);g=v;g.firstChild!=null&&g.firstChild.nodeName=="DIV"&&(g=g.firstChild);ct=g.offsetWidth+3;w=g.offsetHeight;c?(i=Math.min(i,ct),w=Math.min(w,r)):i=ct;o&&(v.style.width=i+"px");mxClient.IS_QUIRKS&&(c||h=="width")&&w>r&&(w=r,v.style.height=w+"px");r=w;lt=(r-r*st+i*-ht)/2-et*i*(it+.5)+ft*r*(rt+.5);at=(i-i*st+r*-ht)/2+ft*i*(it+.5)+et*r*(rt+.5);y.nodeName=="group"&&this.root.nodeName=="DIV"?(nt=this.createElement("div"),nt.style.display="inline-block",nt.style.position="absolute",nt.style.left=this.format(n+(at-i/2)*p.scale)+"px",nt.style.top=this.format(t+(lt-r/2)*p.scale)+"px",y.parentNode.appendChild(nt),nt.appendChild(y)):(vt=document.documentMode==8&&!mxClient.IS_EM?1:p.scale,y.style.left=this.format(n+(at-i/2)*vt)+"px",y.style.top=this.format(t+(lt-r/2)*vt)+"px");d.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+ft+", M12="+et+", M21="+-et+", M22="+ft+", sizingMethod='auto expand')";d.style.backgroundColor=this.rotatedHtmlBackground;this.state.alpha<1&&(d.style.filter+="alpha(opacity="+this.state.alpha*100+")");d.appendChild(v);v.style.position="";v.style.visibility=""}else document.documentMode!=8||mxClient.IS_EM?(v.style.verticalAlign="top",this.state.alpha<1&&(y.style.filter="alpha(opacity="+this.state.alpha*100+")"),pt=v.parentNode,v.style.visibility="hidden",document.body.appendChild(v),i=v.offsetWidth,w=v.offsetHeight,mxClient.IS_QUIRKS&&c&&w>r&&(w=r,v.style.height=w+"px"),r=w,v.style.visibility="",pt.appendChild(v),y.style.left=this.format(n+i*it*this.state.scale)+"px",y.style.top=this.format(t+r*rt*this.state.scale)+"px"):(this.state.alpha<1&&(v.style.filter="alpha(opacity="+this.state.alpha*100+")"),k.style.left=it*100+"%",k.style.top=rt*100+"%")}else this.plainText(n,t,i,r,mxUtils.htmlEntities(u,!1),f,e,o,s,h,c,l,a)};mxVmlCanvas2D.prototype.plainText=function(n,t,i,r,u,f,e,o,s,h,c,l){var a=this.state,v,w,b,y,k,d;n=(n+a.dx)*a.scale;t=(t+a.dy)*a.scale;v=this.createVmlElement("shape");v.style.width="1px";v.style.height="1px";v.stroked="false";w=this.createVmlElement("fill");w.color=a.fontColor;w.opacity=a.alpha*100+"%";v.appendChild(w);b=this.createVmlElement("path");b.textpathok="true";b.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0);v.appendChild(b);y=this.createVmlElement("textpath");y.style.cssText="v-text-align:"+f;y.style.align=f;y.style.fontFamily=a.fontFamily;y.string=u;y.on="true";k=Math.round(a.fontSize*a.scale/this.vmlScale);y.style.fontSize=k+"px";(a.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(y.style.fontWeight="bold");(a.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(y.style.fontStyle="italic");(a.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(y.style.textDecoration="underline");var tt=u.split("\n"),g=k+(tt.length-1)*k*mxConstants.LINE_HEIGHT,nt=0,p=0;e==mxConstants.ALIGN_BOTTOM?p=-g/2:e!=mxConstants.ALIGN_MIDDLE&&(p=g/2);l!=null&&(v.style.rotation=l,d=l*(Math.PI/180),nt=Math.sin(d)*p,p=Math.cos(d)*p);v.appendChild(y);v.style.left=this.format(n-nt)+"px";v.style.top=this.format(t+p)+"px";this.root.appendChild(v)};mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};mxGuide.prototype.graph=null;mxGuide.prototype.states=null;mxGuide.prototype.horizontal=!0;mxGuide.prototype.vertical=!0;mxGuide.prototype.guideX=null;mxGuide.prototype.guideY=null;mxGuide.prototype.setStates=function(n){this.states=n};mxGuide.prototype.isEnabledForEvent=function(){return!0};mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxGuide.prototype.createGuideShape=function(){var n=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);return n.isDashed=!0,n};mxGuide.prototype.move=function(n,t,i){var b,r,ot,st,g;if(this.states!=null&&(this.horizontal||this.vertical)&&n!=null&&t!=null){var y=this.graph.getView().translate,f=this.graph.getView().scale,e=t.x,o=t.y,p=!1,c=null,l=null,w=!1,a=null,v=null,nt=this.getGuideTolerance(),s=nt,h=nt,u=n.clone();u.x+=t.x;u.y+=t.y;var tt=u.x,it=u.x+u.width,rt=u.getCenterX(),ut=u.y,ft=u.y+u.height,et=u.getCenterY();function k(t,i){t+=this.graph.panDx;var r=!1;Math.abs(t-rt)<s?(e=t-n.getCenterX(),s=Math.abs(t-rt),r=!0):Math.abs(t-tt)<s?(e=t-n.x,s=Math.abs(t-tt),r=!0):Math.abs(t-it)<s&&(e=t-n.x-n.width,s=Math.abs(t-it),r=!0);r&&(c=i,l=Math.round(t-this.graph.panDx),this.guideX==null&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane())));p=p||r}function d(t){t+=this.graph.panDy;var i=!1;Math.abs(t-et)<h?(o=t-n.getCenterY(),h=Math.abs(t-et),i=!0):Math.abs(t-ut)<h?(o=t-n.y,h=Math.abs(t-ut),i=!0):Math.abs(t-ft)<h&&(o=t-n.y-n.height,h=Math.abs(t-ft),i=!0);i&&(a=r,v=Math.round(t-this.graph.panDy),this.guideY==null&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane())));w=w||i}for(b=0;b<this.states.length;b++)r=this.states[b],r!=null&&(this.horizontal&&(k.call(this,r.getCenterX(),r),k.call(this,r.x,r),k.call(this,r.x+r.width,r)),this.vertical&&(d.call(this,r.getCenterY(),r),d.call(this,r.y,r),d.call(this,r.y+r.height,r)));i&&(p||(ot=n.x-(this.graph.snap(n.x/f-y.x)+y.x)*f,e=this.graph.snap(e/f)*f-ot),w||(st=n.y-(this.graph.snap(n.y/f-y.y)+y.y)*f,o=this.graph.snap(o/f)*f-st));g=this.graph.container;p||this.guideX==null?this.guideX!=null&&(c!=null&&n!=null&&(minY=Math.min(n.y+o-this.graph.panDy,c.y),maxY=Math.max(n.y+n.height+o-this.graph.panDy,c.y+c.height)),this.guideX.points=minY!=null&&maxY!=null?[new mxPoint(l,minY),new mxPoint(l,maxY)]:[new mxPoint(l,-this.graph.panDy),new mxPoint(l,g.scrollHeight-3-this.graph.panDy)],this.guideX.node.style.visibility="visible",this.guideX.redraw()):this.guideX.node.style.visibility="hidden";w||this.guideY==null?this.guideY!=null&&(a!=null&&n!=null&&(minX=Math.min(n.x+e-this.graph.panDx,a.x),maxX=Math.max(n.x+n.width+e-this.graph.panDx,a.x+a.width)),this.guideY.points=minX!=null&&maxX!=null?[new mxPoint(minX,v),new mxPoint(maxX,v)]:[new mxPoint(-this.graph.panDx,v),new mxPoint(g.scrollWidth-3-this.graph.panDx,v)],this.guideY.node.style.visibility="visible",this.guideY.redraw()):this.guideY.node.style.visibility="hidden";t=new mxPoint(e,o)}return t};mxGuide.prototype.hide=function(){this.guideX!=null&&(this.guideX.node.style.visibility="hidden");this.guideY!=null&&(this.guideY.node.style.visibility="hidden")};mxGuide.prototype.destroy=function(){this.guideX!=null&&(this.guideX.destroy(),this.guideX=null);this.guideY!=null&&(this.guideY.destroy(),this.guideY=null)};mxStencil.defaultLocalized=!1;mxStencil.allowEval=!1;mxStencil.prototype.desc=null;mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;mxStencil.prototype.strokewidth=null;mxStencil.prototype.parseDescription=function(){var n,t;this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);n=this.desc.getAttribute("aspect");this.aspect=n!=null?n:"variable";t=this.desc.getAttribute("strokewidth");this.strokewidth=t!=null?t:"1"};mxStencil.prototype.parseConstraints=function(){var i=this.desc.getElementsByTagName("connections")[0],n,t;if(i!=null&&(n=mxUtils.getChildNodes(i),n!=null&&n.length>0))for(this.constraints=[],t=0;t<n.length;t++)this.constraints.push(this.parseConstraint(n[t]))};mxStencil.prototype.parseConstraint=function(n){var t=Number(n.getAttribute("x")),i=Number(n.getAttribute("y")),r=n.getAttribute("perimeter")=="1";return new mxConnectionConstraint(new mxPoint(t,i),r)};mxStencil.prototype.evaluateTextAttribute=function(n,t,i){var r=this.evaluateAttribute(n,t,i),u=n.getAttribute("localized");return(mxStencil.defaultLocalized&&u==null||u=="1")&&(r=mxResources.get(r)),r};mxStencil.prototype.evaluateAttribute=function(n,t,i){var r=n.getAttribute(t),u,f;return r==null&&(u=mxUtils.getTextContent(n),u!=null&&mxStencil.allowEval&&(f=mxUtils.eval(u),typeof f=="function"&&(r=f(i)))),r};mxStencil.prototype.drawShape=function(n,t,i,r,u,f){this.drawChildren(n,t,i,r,u,f,this.bgNode,!1);this.drawChildren(n,t,i,r,u,f,this.fgNode,!0)};mxStencil.prototype.drawChildren=function(n,t,i,r,u,f,e,o){var s;if(e!=null&&u>0&&f>0){var c=mxUtils.getValue(t.style,mxConstants.STYLE_DIRECTION,null),h=this.computeAspect(t.style,i,r,u,f,c),l=Math.min(h.width,h.height),a=this.strokewidth=="inherit"?Number(mxUtils.getNumber(t.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*l;for(n.setStrokeWidth(a),s=e.firstChild;s!=null;)s.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(n,t,s,h,o),s=s.nextSibling}};mxStencil.prototype.computeAspect=function(n,t,i,r,u,f){var s=t,h=i,o=r/this.w0,e=u/this.h0,l=f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH,c;return l&&(e=r/this.h0,o=u/this.w0,c=(r-u)/2,s+=c,h-=c),this.aspect=="fixed"&&(e=Math.min(o,e),o=e,l?(s+=(u-this.w0*o)/2,h+=(r-this.h0*e)/2):(s+=(r-this.w0*o)/2,h+=(u-this.h0*e)/2)),new mxRectangle(s,h,o,e)};mxStencil.prototype.drawNode=function(n,t,i,r,u){var f=i.nodeName,s=r.x,h=r.y,e=r.width,o=r.height,w=Math.min(e,o),c,y,rt,ut,l,g,ot,a,p,nt,v;if(f=="save")n.save();else if(f=="restore")n.restore();else if(f=="path")for(n.begin(),c=i.firstChild;c!=null;)c.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(n,t,c,r,u),c=c.nextSibling;else if(f=="close")n.close();else if(f=="move")n.moveTo(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o);else if(f=="line")n.lineTo(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o);else if(f=="quad")n.quadTo(s+Number(i.getAttribute("x1"))*e,h+Number(i.getAttribute("y1"))*o,s+Number(i.getAttribute("x2"))*e,h+Number(i.getAttribute("y2"))*o);else if(f=="curve")n.curveTo(s+Number(i.getAttribute("x1"))*e,h+Number(i.getAttribute("y1"))*o,s+Number(i.getAttribute("x2"))*e,h+Number(i.getAttribute("y2"))*o,s+Number(i.getAttribute("x3"))*e,h+Number(i.getAttribute("y3"))*o);else if(f=="arc")n.arcTo(Number(i.getAttribute("rx"))*e,Number(i.getAttribute("ry"))*o,Number(i.getAttribute("x-axis-rotation")),Number(i.getAttribute("large-arc-flag")),Number(i.getAttribute("sweep-flag")),s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o);else if(f=="rect")n.rect(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o,Number(i.getAttribute("w"))*e,Number(i.getAttribute("h"))*o);else if(f=="roundrect"){y=Number(i.getAttribute("arcsize"));y==0&&(y=mxConstants.RECTANGLE_ROUNDING_FACTOR*100);var b=Number(i.getAttribute("w"))*e,k=Number(i.getAttribute("h"))*o,tt=Number(y)/100,it=Math.min(b*tt,k*tt);n.roundrect(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o,b,k,it,it)}else if(f=="ellipse")n.ellipse(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o,Number(i.getAttribute("w"))*e,Number(i.getAttribute("h"))*o);else if(f=="image")t.outline||(rt=this.evaluateAttribute(i,"src",t),n.image(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o,Number(i.getAttribute("w"))*e,Number(i.getAttribute("h"))*o,rt,!1,i.getAttribute("flipH")=="1",i.getAttribute("flipV")=="1"));else if(f=="text"){if(!t.outline){if(ut=this.evaluateTextAttribute(i,"str",t),l=i.getAttribute("vertical")=="1"?-90:0,i.getAttribute("align-shape")=="0"){var d=t.rotation,ft=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPH,0)==1,et=mxUtils.getValue(t.style,mxConstants.STYLE_FLIPV,0)==1;ft&&et?l-=d:ft||et?l+=d:l-=d}l-=i.getAttribute("rotation");n.text(s+Number(i.getAttribute("x"))*e,h+Number(i.getAttribute("y"))*o,0,0,ut,i.getAttribute("align")||"left",i.getAttribute("valign")||"top",!1,"",null,!1,l)}}else if(f=="include-shape"){if(g=mxStencilRegistry.getStencil(i.getAttribute("name")),g!=null){var st=s+Number(i.getAttribute("x"))*e,ht=h+Number(i.getAttribute("y"))*o,b=Number(i.getAttribute("w"))*e,k=Number(i.getAttribute("h"))*o;g.drawShape(n,t,st,ht,b,k)}}else if(f=="fillstroke")n.fillAndStroke();else if(f=="fill")n.fill();else if(f=="stroke")n.stroke();else if(f=="strokewidth")ot=i.getAttribute("fixed")=="1"?1:w,n.setStrokeWidth(Number(i.getAttribute("width"))*ot);else if(f=="dashed")n.setDashed(i.getAttribute("dashed")=="1");else if(f=="dashpattern"){if(a=i.getAttribute("pattern"),a!=null){for(p=a.split(" "),nt=[],v=0;v<p.length;v++)p[v].length>0&&nt.push(Number(p[v])*w);a=nt.join(" ");n.setDashPattern(a)}}else f=="strokecolor"?n.setStrokeColor(i.getAttribute("color")):f=="linecap"?n.setLineCap(i.getAttribute("cap")):f=="linejoin"?n.setLineJoin(i.getAttribute("join")):f=="miterlimit"?n.setMiterLimit(Number(i.getAttribute("limit"))):f=="fillcolor"?n.setFillColor(i.getAttribute("color")):f=="alpha"?n.setAlpha(i.getAttribute("alpha")):f=="fontcolor"?n.setFontColor(i.getAttribute("color")):f=="fontstyle"?n.setFontStyle(i.getAttribute("style")):f=="fontfamily"?n.setFontFamily(i.getAttribute("family")):f=="fontsize"&&n.setFontSize(Number(i.getAttribute("size"))*w);u&&(f=="fillstroke"||f=="fill"||f=="stroke")&&(u=!1,n.setShadow(!1))};mxShape.prototype.dialect=null;mxShape.prototype.scale=1;mxShape.prototype.antiAlias=!0;mxShape.prototype.bounds=null;mxShape.prototype.points=null;mxShape.prototype.node=null;mxShape.prototype.state=null;mxShape.prototype.style=null;mxShape.prototype.boundingBox=null;mxShape.prototype.stencil=null;mxShape.prototype.svgStrokeTolerance=8;mxShape.prototype.pointerEvents=!0;mxShape.prototype.svgPointerEvents="all";mxShape.prototype.shapePointerEvents=!1;mxShape.prototype.stencilPointerEvents=!1;mxShape.prototype.vmlScale=1;mxShape.prototype.outline=!1;mxShape.prototype.visible=!0;mxShape.prototype.init=function(n){this.node==null&&(this.node=this.create(n),n!=null&&n.appendChild(this.node))};mxShape.prototype.isParseVml=function(){return!0};mxShape.prototype.isHtmlAllowed=function(){return!1};mxShape.prototype.getSvgScreenOffset=function(){var n=this.stencil&&this.stencil.strokewidth!="inherit"?Number(this.stencil.strokewidth):this.strokewidth;return mxUtils.mod(Math.max(1,Math.round(n*this.scale)),2)==1?.5:0};mxShape.prototype.create=function(n){return n!=null&&n.ownerSVGElement!=null?this.createSvg(n):document.documentMode==8||!mxClient.IS_VML||this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?this.createHtml(n):this.createVml(n)};mxShape.prototype.createSvg=function(){return document.createElementNS(mxConstants.NS_SVG,"g")};mxShape.prototype.createVml=function(){var n=document.createElement(mxClient.VML_PREFIX+":group");return n.style.position="absolute",n};mxShape.prototype.createHtml=function(){var n=document.createElement("div");return n.style.position="absolute",n};mxShape.prototype.reconfigure=function(){this.redraw()};mxShape.prototype.redraw=function(){this.updateBoundsFromPoints();this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.node.nodeName=="DIV"&&(this.isHtmlAllowed()||!mxClient.IS_VML)?this.redrawHtmlShape():this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)};mxShape.prototype.clear=function(){if(this.node.ownerSVGElement!=null)while(this.node.lastChild!=null)this.node.removeChild(this.node.lastChild);else this.node.style.cssText="position:absolute;"+(this.cursor!=null?"cursor:"+this.cursor+";":""),this.node.innerHTML=""};mxShape.prototype.updateBoundsFromPoints=function(){var n=this.points,t;if(n!=null&&n.length>0&&n[0]!=null)for(this.bounds=new mxRectangle(Number(n[0].x),Number(n[0].y),1,1),t=1;t<this.points.length;t++)n[t]!=null&&this.bounds.add(new mxRectangle(Number(n[t].x),Number(n[t].y),1,1))};mxShape.prototype.getLabelBounds=function(n){return n};mxShape.prototype.checkBounds=function(){return this.bounds!=null&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0};mxShape.prototype.createVmlGroup=function(){var n=document.createElement(mxClient.VML_PREFIX+":group");return n.style.position="absolute",n.style.width=this.node.style.width,n.style.height=this.node.style.height,n};mxShape.prototype.redrawShape=function(){var n=this.createCanvas();n!=null&&(n.pointerEvents=this.pointerEvents,this.paint(n),this.node!=n.root&&this.node.insertAdjacentHTML("beforeend",n.root.outerHTML),this.node.nodeName=="DIV"&&document.documentMode==8&&(this.node.style.filter="",mxUtils.addTransparentBackgroundFilter(this.node)),this.destroyCanvas(n))};mxShape.prototype.createCanvas=function(){var n=null;return this.node.ownerSVGElement!=null?n=this.createSvgCanvas():mxClient.IS_VML&&(this.updateVmlContainer(),n=this.createVmlCanvas()),this.outline&&(n.setStrokeWidth(this.strokewidth),n.setStrokeColor(this.stroke),this.isDashed!=null&&n.setDashed(this.isDashed),n.setStrokeWidth=function(){},n.setStrokeColor=function(){},n.setFillColor=function(){},n.setGradient=function(){},n.setDashed=function(){}),n};mxShape.prototype.createSvgCanvas=function(){var n=new mxSvgCanvas2D(this.node,!1),t;return n.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,n.pointerEventsValue=this.svgPointerEvents,n.blockImagePointerEvents=mxClient.IS_FF,t=this.getSvgScreenOffset(),t!=0?this.node.setAttribute("transform","translate("+t+","+t+")"):this.node.removeAttribute("transform"),this.antiAlias||(n.format=function(n){return Math.round(parseFloat(n))}),n};mxShape.prototype.createVmlCanvas=function(){var t=document.documentMode==8&&this.isParseVml()?this.createVmlGroup():this.node,n=new mxVmlCanvas2D(t,!1),r,u,i;return t.tagUrn!=""&&(r=Math.max(1,Math.round(this.bounds.width)),u=Math.max(1,Math.round(this.bounds.height)),t.coordsize=r*this.vmlScale+","+u*this.vmlScale,n.scale(this.vmlScale),n.vmlScale=this.vmlScale),i=this.scale,n.translate(-Math.round(this.bounds.x/i),-Math.round(this.bounds.y/i)),n};mxShape.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";var n=Math.max(1,Math.round(this.bounds.width)),t=Math.max(1,Math.round(this.bounds.height));this.node.style.width=n+"px";this.node.style.height=t+"px";this.node.style.overflow="visible"};mxShape.prototype.redrawHtmlShape=function(){this.updateHtmlBounds(this.node);this.updateHtmlFilters(this.node);this.updateHtmlColors(this.node)};mxShape.prototype.updateHtmlFilters=function(n){var u="",f;if(this.opacity<100&&(u+="alpha(opacity="+this.opacity+")"),this.isShadow&&(u+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.SHADOWCOLOR+"')"),this.fill!=null&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var t=this.fill,i=this.gradient,e="0",o={east:0,south:1,west:2,north:3},r=this.direction!=null?o[this.direction]:0;this.gradientDirection!=null&&(r=mxUtils.mod(r+o[this.gradientDirection]-1,4));r==1?(e="1",f=t,t=i,i=f):r==2?(f=t,t=i,i=f):r==3&&(e="1");u+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+t+"', endColorStr='"+i+"', gradientType='"+e+"')"}n.style.filter=u};mxShape.prototype.updateHtmlColors=function(n){var t=this.stroke;t!=null&&t!=mxConstants.NONE?(n.style.borderColor=t,this.isDashed?n.style.borderStyle="dashed":this.strokewidth>0&&(n.style.borderStyle="solid"),n.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):n.style.borderWidth="0px";t=this.outline?null:this.fill;t!=null&&t!=mxConstants.NONE?(n.style.backgroundColor=t,n.style.backgroundImage="none"):this.pointerEvents?n.style.backgroundColor="transparent":document.documentMode==8?mxUtils.addTransparentBackgroundFilter(n):this.setTransparentBackgroundImage(n)};mxShape.prototype.updateHtmlBounds=function(n){var t=document.documentMode>=9?0:Math.ceil(this.strokewidth*this.scale);n.style.borderWidth=Math.max(1,t)+"px";n.style.overflow="hidden";n.style.left=Math.round(this.bounds.x-t/2)+"px";n.style.top=Math.round(this.bounds.y-t/2)+"px";document.compatMode=="CSS1Compat"&&(t=-t);n.style.width=Math.round(Math.max(0,this.bounds.width+t))+"px";n.style.height=Math.round(Math.max(0,this.bounds.height+t))+"px"};mxShape.prototype.destroyCanvas=function(n){var i,t;if(n instanceof mxSvgCanvas2D){for(i in n.gradients)t=n.gradients[i],t!=null&&(t.mxRefCount=(t.mxRefCount||0)+1);this.releaseSvgGradients(this.oldGradients);this.oldGradients=n.gradients}};mxShape.prototype.paint=function(n){var t=this.scale,e=this.bounds.x/t,o=this.bounds.y/t,r=this.bounds.width/t,u=this.bounds.height/t,c,a,s,i,h,l,f;if(this.isPaintBoundsInverted()&&(c=(r-u)/2,e+=c,o-=c,a=r,r=u,u=a),this.updateTransform(n,e,o,r,u),this.configureCanvas(n,e,o,r,u),s=null,(this.stencil==null&&this.points==null&&this.shapePointerEvents||this.stencil!=null&&this.stencilPointerEvents)&&(i=this.createBoundingBox(),this.dialect==mxConstants.DIALECT_SVG?(s=this.createTransparentSvgRectangle(i.x,i.y,i.width,i.height),this.node.appendChild(s)):(h=n.createRect("rect",i.x/t,i.y/t,i.width/t,i.height/t),h.appendChild(n.createTransparentFill()),h.stroked="false",n.root.appendChild(h))),this.stencil!=null)this.stencil.drawShape(n,this,e,o,r,u);else if(n.setStrokeWidth(this.strokewidth),this.points!=null){for(l=[],f=0;f<this.points.length;f++)this.points[f]!=null&&l.push(new mxPoint(this.points[f].x/t,this.points[f].y/t));this.paintEdgeShape(n,l)}else this.paintVertexShape(n,e,o,r,u);s!=null&&n.state!=null&&n.state.transform!=null&&s.setAttribute("transform",n.state.transform)};mxShape.prototype.configureCanvas=function(n,t,i,r,u){var e=null,f;this.style!=null&&(e=this.style.dashPattern);n.setAlpha(this.opacity/100);this.isShadow!=null&&n.setShadow(this.isShadow);this.isDashed!=null&&n.setDashed(this.isDashed);e!=null&&n.setDashPattern(e);this.fill!=null&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE?(f=this.getGradientBounds(n,t,i,r,u),n.setGradient(this.fill,this.gradient,f.x,f.y,f.width,f.height,this.gradientDirection)):n.setFillColor(this.fill);n.setStrokeColor(this.stroke)};mxShape.prototype.getGradientBounds=function(n,t,i,r,u){return new mxRectangle(t,i,r,u)};mxShape.prototype.updateTransform=function(n,t,i,r,u){n.scale(this.scale);n.rotate(this.getShapeRotation(),this.flipH,this.flipV,t+r/2,i+u/2)};mxShape.prototype.paintVertexShape=function(n,t,i,r,u){this.paintBackground(n,t,i,r,u);n.setShadow(!1);this.paintForeground(n,t,i,r,u)};mxShape.prototype.paintBackground=function(){};mxShape.prototype.paintForeground=function(){};mxShape.prototype.paintEdgeShape=function(){};mxShape.prototype.getArcSize=function(n,t){var i=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100;return Math.min(n*i,t*i)};mxShape.prototype.paintGlassEffect=function(n,t,i,r,u,f){var e=Math.ceil(this.strokewidth/2),o=.4;n.setGradient("#ffffff","#ffffff",t,i,r,u*.6,"south",.9,.1);n.begin();f+=2*e;this.isRounded?(n.moveTo(t-e+f,i-e),n.quadTo(t-e,i-e,t-e,i-e+f),n.lineTo(t-e,i+u*o),n.quadTo(t+r*.5,i+u*.7,t+r+e,i+u*o),n.lineTo(t+r+e,i-e+f),n.quadTo(t+r+e,i-e,t+r+e-f,i-e)):(n.moveTo(t-e,i-e),n.lineTo(t-e,i+u*o),n.quadTo(t+r*.5,i+u*.7,t+r+e,i+u*o),n.lineTo(t+r+e,i-e));n.close();n.fill()};mxShape.prototype.addPoints=function(n,t,i,r,u){var c=t[t.length-1],v,y,l,o,a;for(u&&i&&(t=t.slice(),v=t[0],y=new mxPoint(c.x+(v.x-c.x)/2,c.y+(v.y-c.y)/2),t.splice(0,0,y)),l=t[0],o=1,n.moveTo(l.x,l.y);o<(u?t.length:t.length-1);){var f=t[mxUtils.mod(o,t.length)],s=l.x-f.x,h=l.y-f.y;if(i&&(s!=0||h!=0)){var e=Math.sqrt(s*s+h*h),b=s*Math.min(r,e/2)/e,k=h*Math.min(r,e/2)/e,d=f.x+b,g=f.y+k;for(n.lineTo(d,g),a=t[mxUtils.mod(o+1,t.length)];o<t.length-2&&Math.round(a.x-f.x)==0&&Math.round(a.y-f.y)==0;)a=t[mxUtils.mod(o+2,t.length)],o++;s=a.x-f.x;h=a.y-f.y;e=Math.max(1,Math.sqrt(s*s+h*h));var nt=s*Math.min(r,e/2)/e,tt=h*Math.min(r,e/2)/e,p=f.x+nt,w=f.y+tt;n.quadTo(f.x,f.y,p,w);f=new mxPoint(p,w)}else n.lineTo(f.x,f.y);l=f;o++}u?n.close():n.lineTo(c.x,c.y)};mxShape.prototype.apply=function(n){if(this.state=n,this.style=n.style,this.style!=null){if(this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill),this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient),this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection),this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity),this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,this.stroke),this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth),this.arrowStrokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth),this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing),this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize),this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize),this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow),this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,this.endArrow),this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation),this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction),this.flipH=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0)==1,this.flipV=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0)==1,this.stencil!=null&&(this.flipH=mxUtils.getValue(this.style,"stencilFlipH",0)==1||this.flipH,this.flipV=mxUtils.getValue(this.style,"stencilFlipV",0)==1||this.flipV),this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH){var t=this.flipH;this.flipH=this.flipV;this.flipV=t}this.isShadow=mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow)==1;this.isDashed=mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed)==1;this.isRounded=mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded)==1;this.glass=mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass)==1;this.fill==mxConstants.NONE&&(this.fill=null);this.gradient==mxConstants.NONE&&(this.gradient=null);this.stroke==mxConstants.NONE&&(this.stroke=null)}};mxShape.prototype.setCursor=function(n){n==null&&(n="");this.cursor=n;this.node!=null&&(this.node.style.cursor=n)};mxShape.prototype.getCursor=function(){return this.cursor};mxShape.prototype.updateBoundingBox=function(){var n,t;this.bounds!=null&&(n=this.createBoundingBox(),n!=null&&(this.augmentBoundingBox(n),t=this.getShapeRotation(),t!=0&&(n=mxUtils.getBoundingBox(n,t))),this.boundingBox=n)};mxShape.prototype.createBoundingBox=function(){var n=this.bounds.clone();return(this.stencil!=null&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted())&&n.rotate90(),n};mxShape.prototype.augmentBoundingBox=function(n){this.isShadow&&(n.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),n.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale));n.grow(this.strokewidth*this.scale/2)};mxShape.prototype.isPaintBoundsInverted=function(){return this.stencil==null&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)};mxShape.prototype.getRotation=function(){return this.rotation!=null?this.rotation:0};mxShape.prototype.getTextRotation=function(){var n=this.getRotation();return mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)!=1&&(n+=mxText.prototype.verticalTextRotation),n};mxShape.prototype.getShapeRotation=function(){var n=this.getRotation();return this.direction!=null&&(this.direction==mxConstants.DIRECTION_NORTH?n+=270:this.direction==mxConstants.DIRECTION_WEST?n+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(n+=90)),n};mxShape.prototype.createTransparentSvgRectangle=function(n,t,i,r){var u=document.createElementNS(mxConstants.NS_SVG,"rect");return u.setAttribute("x",n),u.setAttribute("y",t),u.setAttribute("width",i),u.setAttribute("height",r),u.setAttribute("fill","none"),u.setAttribute("stroke","none"),u.setAttribute("pointer-events","all"),u};mxShape.prototype.setTransparentBackgroundImage=function(n){n.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"};mxShape.prototype.releaseSvgGradients=function(n){var i,t;if(n!=null)for(i in n)t=n[i],t!=null&&(t.mxRefCount=(t.mxRefCount||0)-1,t.mxRefCount==0&&t.parentNode!=null&&t.parentNode.removeChild(t))};mxShape.prototype.destroy=function(){this.node!=null&&(mxEvent.release(this.node),this.node.parentNode!=null&&this.node.parentNode.removeChild(this.node),this.node=null);this.releaseSvgGradients(this.oldGradients);this.oldGradients=null};mxStencilRegistry={stencils:[],addStencil:function(n,t){mxStencilRegistry.stencils[n]=t},getStencil:function(n){return mxStencilRegistry.stencils[n]}};mxMarker={markers:[],addMarker:function(n,t){mxMarker.markers[n]=t},createMarker:function(n,t,i,r,u,f,e,o,s,h){var c=mxMarker.markers[i];return c!=null?c(n,t,i,r,u,f,e,o,s,h):null}},function(){function n(n,t,i,r,u,f,e,o,s,h){var a=u*s*1.118,v=f*s*1.118,c,l;return u=u*(e+s),f=f*(e+s),c=r.clone(),c.x-=a,c.y-=v,l=i!=mxConstants.ARROW_CLASSIC?1:3/4,r.x+=-u*l-a,r.y+=-f*l-v,function(){n.begin();n.moveTo(c.x,c.y);n.lineTo(c.x-u-f/2,c.y-f+u/2);i==mxConstants.ARROW_CLASSIC&&n.lineTo(c.x-u*3/4,c.y-f*3/4);n.lineTo(c.x+f/2-u,c.y-f-u/2);n.close();h?n.fillAndStroke():n.stroke()}}function t(n,t,i,r,u,f,e,o,s,h){var a=i==mxConstants.ARROW_DIAMOND?.7071:.9862,v=u*s*a,y=f*s*a,c,l;return u=u*(e+s),f=f*(e+s),c=r.clone(),c.x-=v,c.y-=y,r.x+=-u-v,r.y+=-f-y,l=i==mxConstants.ARROW_DIAMOND?2:3.4,function(){n.begin();n.moveTo(c.x,c.y);n.lineTo(c.x-u/2-f/l,c.y+u/l-f/2);n.lineTo(c.x-u,c.y-f);n.lineTo(c.x-u/2+f/l,c.y-f/2-u/l);n.close();h?n.fillAndStroke():n.stroke()}}mxMarker.addMarker("classic",n);mxMarker.addMarker("block",n);mxMarker.addMarker("open",function(n,t,i,r,u,f,e,o,s){var c=u*s*1.118,l=f*s*1.118,h;return u=u*(e+s),f=f*(e+s),h=r.clone(),h.x-=c,h.y-=l,r.x+=-c*2,r.y+=-l*2,function(){n.begin();n.moveTo(h.x-u-f/2,h.y-f+u/2);n.lineTo(h.x,h.y);n.lineTo(h.x+f/2-u,h.y-f-u/2);n.stroke()}});mxMarker.addMarker("oval",function(n,t,i,r,u,f,e,o,s,h){var c=e/2,l=r.clone();return r.x-=u*c,r.y-=f*c,function(){n.ellipse(l.x-c,l.y-c,e,e);h?n.fillAndStroke():n.stroke()}});mxMarker.addMarker("diamond",t);mxMarker.addMarker("diamondThin",t)}();mxUtils.extend(mxActor,mxShape);mxActor.prototype.paintVertexShape=function(n,t,i,r,u){n.translate(t,i);n.begin();this.redrawPath(n,t,i,r,u);n.fillAndStroke()};mxActor.prototype.redrawPath=function(n,t,i,r,u){var f=r/3;n.moveTo(0,u);n.curveTo(0,3*u/5,0,2*u/5,r/2,2*u/5);n.curveTo(r/2-f,2*u/5,r/2-f,0,r/2,0);n.curveTo(r/2+f,0,r/2+f,2*u/5,r/2,2*u/5);n.curveTo(r,2*u/5,r,3*u/5,r,u);n.close()};mxUtils.extend(mxCloud,mxActor);mxCloud.prototype.redrawPath=function(n,t,i,r,u){n.moveTo(.25*r,.25*u);n.curveTo(.05*r,.25*u,0,.5*u,.16*r,.55*u);n.curveTo(0,.66*u,.18*r,.9*u,.31*r,.8*u);n.curveTo(.4*r,u,.7*r,u,.8*r,.8*u);n.curveTo(r,.8*u,r,.6*u,.875*r,.5*u);n.curveTo(r,.3*u,.8*r,.1*u,.625*r,.2*u);n.curveTo(.5*r,.05*u,.3*r,.05*u,.25*r,.25*u);n.close()};mxUtils.extend(mxRectangleShape,mxShape);mxRectangleShape.prototype.isHtmlAllowed=function(){var n=!0;return this.style!=null&&(n=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"),!this.isRounded&&!this.glass&&this.rotation==0&&(n||this.fill!=null&&this.fill!=mxConstants.NONE)};mxRectangleShape.prototype.paintBackground=function(n,t,i,r,u){var f=!0,e,o;this.style!=null&&(f=mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1");(f||this.fill!=null&&this.fill!=mxConstants.NONE||this.stroke!=null&&this.stroke!=mxConstants.NONE)&&(f||this.fill!=null&&this.fill!=mxConstants.NONE||(n.pointerEvents=!1),this.isRounded?(e=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100,o=Math.min(r*e,u*e),n.roundrect(t,i,r,u,o,o)):n.rect(t,i,r,u),n.fillAndStroke())};mxRectangleShape.prototype.paintForeground=function(n,t,i,r,u){this.glass&&!this.outline&&this.fill!=null&&this.fill!=mxConstants.NONE&&this.paintGlassEffect(n,t,i,r,u,this.getArcSize(r+this.strokewidth,u+this.strokewidth))};mxUtils.extend(mxEllipse,mxShape);mxEllipse.prototype.paintVertexShape=function(n,t,i,r,u){n.ellipse(t,i,r,u);n.fillAndStroke()};mxUtils.extend(mxDoubleEllipse,mxShape);mxDoubleEllipse.prototype.vmlScale=10;mxDoubleEllipse.prototype.paintBackground=function(n,t,i,r,u){n.ellipse(t,i,r,u);n.fillAndStroke()};mxDoubleEllipse.prototype.paintForeground=function(n,t,i,r,u){if(!this.outline){var f=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(r/5,u/5)));t+=f;i+=f;r-=2*f;u-=2*f;r>0&&u>0&&n.ellipse(t,i,r,u);n.stroke()}};mxDoubleEllipse.prototype.getLabelBounds=function(n){var t=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(n.width/5/this.scale,n.height/5/this.scale)))*this.scale;return new mxRectangle(n.x+t,n.y+t,n.width-2*t,n.height-2*t)};mxUtils.extend(mxRhombus,mxShape);mxRhombus.prototype.paintVertexShape=function(n,t,i,r,u){var f=r/2,e=u/2,o=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;n.begin();this.addPoints(n,[new mxPoint(t+f,i),new mxPoint(t+r,i+e),new mxPoint(t+f,i+u),new mxPoint(t,i+e)],this.isRounded,o,!0);n.fillAndStroke()};mxUtils.extend(mxPolyline,mxShape);mxPolyline.prototype.getRotation=function(){return 0};mxPolyline.prototype.getShapeRotation=function(){return 0};mxPolyline.prototype.isPaintBoundsInverted=function(){return!1};mxPolyline.prototype.paintEdgeShape=function(n,t){this.style==null||this.style[mxConstants.STYLE_CURVED]!=1?this.paintLine(n,t,this.isRounded):this.paintCurvedLine(n,t)};mxPolyline.prototype.paintLine=function(n,t,i){var r=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;n.begin();this.addPoints(n,t,i,r,!1);n.stroke()};mxPolyline.prototype.paintCurvedLine=function(n,t){var e,f,r,i,u;for(n.begin(),e=t[0],f=t.length,n.moveTo(e.x,e.y),r=1;r<f-2;r++){var i=t[r],u=t[r+1],o=(i.x+u.x)/2,s=(i.y+u.y)/2;n.quadTo(i.x,i.y,o,s)}i=t[f-2];u=t[f-1];n.quadTo(i.x,i.y,u.x,u.y);n.stroke()};mxUtils.extend(mxArrow,mxShape);mxArrow.prototype.augmentBoundingBox=function(n){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var t=Math.max(this.arrowWidth,this.endSize);n.grow((t/2+this.strokewidth)*this.scale)};mxArrow.prototype.paintEdgeShape=function(n,t){var i=mxConstants.ARROW_SPACING,a=mxConstants.ARROW_WIDTH,rt=mxConstants.ARROW_SIZE,f=t[0],e=t[t.length-1],h=e.x-f.x,c=e.y-f.y,l=Math.sqrt(h*h+c*c),v=l-2*i-rt,o=h/l,s=c/l,ut=v*o,ft=v*s,r=a*s/3,u=-a*o/3,y=f.x-r/2+i*o,p=f.y-u/2+i*s,w=y+r,b=p+u,k=w+ut,d=b+ft,g=k+r,nt=d+u,tt=g-3*r,it=nt-3*u;n.begin();n.moveTo(y,p);n.lineTo(w,b);n.lineTo(k,d);n.lineTo(g,nt);n.lineTo(e.x-i*o,e.y-i*s);n.lineTo(tt,it);n.lineTo(tt+r,it+u);n.close();n.fillAndStroke()};mxUtils.extend(mxArrowConnector,mxShape);mxArrowConnector.prototype.apply=function(){mxShape.prototype.apply.apply(this,arguments);this.style!=null&&(this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.ARROW_SIZE/5)*3,this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.ARROW_SIZE/5)*3)};mxArrowConnector.prototype.augmentBoundingBox=function(n){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var t=this.getEdgeWidth();this.isMarkerStart()&&(t=Math.max(t,this.getStartArrowWidth()));this.isMarkerEnd()&&(t=Math.max(t,this.getEndArrowWidth()));n.grow((t/2+this.strokewidth)*this.scale)};mxArrowConnector.prototype.paintEdgeShape=function(n,t){var a=this.strokewidth,dt,gt,ut,ui,at,et,ot,i;this.outline&&(a=Math.max(1,mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth)));for(var vt=this.getStartArrowWidth()+a,yt=this.getEndArrowWidth()+a,r=this.outline?this.getEdgeWidth()+a:this.getEdgeWidth(),h=this.isOpenEnded(),pt=this.isMarkerStart(),wt=this.isMarkerEnd(),e=h?0:this.spacing+a/2,bt=this.startSize+a,kt=this.endSize+a,tt=this.isArrowRounded(),c=t[t.length-1],p=1;p<t.length-1&&t[p].x==t[0].x&&t[p].y==t[0].y;)p++;var st=t[p].x-t[0].x,ht=t[p].y-t[0].y,ct=Math.sqrt(st*st+ht*ht);if(ct!=0){var u=st/ct,v,o=u,f=ht/ct,y,s=f,w=r*f,b=-r*u,l=[];if(tt?n.setLineJoin("round"):t.length>2&&n.setMiterLimit(1.42),n.begin(),dt=u,gt=f,pt&&!h)this.paintMarker(n,t[0].x,t[0].y,u,f,bt,vt,r,e,!0);else{var ni=t[0].x+w/2+e*u,ti=t[0].y+b/2+e*f,ii=t[0].x-w/2+e*u,ri=t[0].y-b/2+e*f;h?(n.moveTo(ni,ti),l.push(function(){n.lineTo(ii,ri)})):(n.moveTo(ii,ri),n.lineTo(ni,ti))}var it=0,rt=0,lt=0;for(i=0;i<t.length-2;i++){ut=mxUtils.relativeCcw(t[i].x,t[i].y,t[i+1].x,t[i+1].y,t[i+2].x,t[i+2].y);it=t[i+2].x-t[i+1].x;rt=t[i+2].y-t[i+1].y;lt=Math.sqrt(it*it+rt*rt);o=it/lt;s=rt/lt;ui=u*o+f*s;tmp=Math.max(Math.sqrt((ui+1)/2),.04);v=u+o;y=f+s;at=Math.sqrt(v*v+y*y);v=v/at;y=y/at;var fi=Math.max(tmp,Math.min(this.strokewidth/200+.04,.35)),ft=ut!=0&&tt?Math.max(.1,fi):Math.max(tmp,.06),k=t[i+1].x+y*r/2/ft,d=t[i+1].y-v*r/2/ft,g=t[i+1].x-y*r/2/ft,nt=t[i+1].y+v*r/2/ft;if(ut!=0&&tt)if(ut==-1){var ei=g+f*r,oi=nt-u*r,si=g+s*r,hi=nt-o*r;n.lineTo(ei,oi);n.quadTo(k,d,si,hi),function(t,i){l.push(function(){n.lineTo(t,i)})}(g,nt)}else n.lineTo(k,d),function(t,i){var e=k-f*r,h=d+u*r,c=k-s*r,a=d+o*r;l.push(function(){n.quadTo(t,i,e,h)});l.push(function(){n.lineTo(c,a)})}(g,nt);else n.lineTo(k,d),function(t,i){l.push(function(){n.lineTo(t,i)})}(g,nt);u=o;f=s}for(w=r*s,b=-r*o,wt&&!h?this.paintMarker(n,c.x,c.y,-u,-f,kt,yt,r,e,!1):(n.lineTo(c.x-e*o+w/2,c.y-e*s+b/2),et=c.x-e*o-w/2,ot=c.y-e*s-b/2,h?(n.moveTo(et,ot),l.splice(0,0,function(){n.moveTo(et,ot)})):n.lineTo(et,ot)),i=l.length-1;i>=0;i--)l[i]();h?(n.end(),n.stroke()):(n.close(),n.fillAndStroke());n.setShadow(!1);n.setMiterLimit(4);tt&&n.setLineJoin("flat");t.length>2&&(n.setMiterLimit(4),pt&&!h&&(n.begin(),this.paintMarker(n,t[0].x,t[0].y,dt,gt,bt,vt,r,e,!0),n.stroke(),n.end()),wt&&!h&&(n.begin(),this.paintMarker(n,c.x,c.y,-u,-f,kt,yt,r,e,!0),n.stroke(),n.end()))}};mxArrowConnector.prototype.paintMarker=function(n,t,i,r,u,f,e,o,s,h){var y=o/e,c=o*u/2,l=-o*r/2,a=(s+f)*r,v=(s+f)*u;h?n.moveTo(t-c+a,i-l+v):n.lineTo(t-c+a,i-l+v);n.lineTo(t-c/y+a,i-l/y+v);n.lineTo(t+s*r,i+s*u);n.lineTo(t+c/y+a,i+l/y+v);n.lineTo(t+c+a,i+l+v)};mxArrowConnector.prototype.isArrowRounded=function(){return this.isRounded};mxArrowConnector.prototype.getStartArrowWidth=function(){return mxConstants.ARROW_WIDTH};mxArrowConnector.prototype.getEndArrowWidth=function(){return mxConstants.ARROW_WIDTH};mxArrowConnector.prototype.getEdgeWidth=function(){return mxConstants.ARROW_WIDTH/3};mxArrowConnector.prototype.isOpenEnded=function(){return!1};mxArrowConnector.prototype.isMarkerStart=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE};mxArrowConnector.prototype.isMarkerEnd=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE};mxUtils.extend(mxText,mxShape);mxText.prototype.baseSpacingTop=0;mxText.prototype.baseSpacingBottom=0;mxText.prototype.baseSpacingLeft=0;mxText.prototype.baseSpacingRight=0;mxText.prototype.replaceLinefeeds=!0;mxText.prototype.verticalTextRotation=-90;mxText.prototype.ignoreClippedStringSize=!0;mxText.prototype.ignoreStringSize=!1;mxText.prototype.textWidthPadding=document.documentMode==8&&!mxClient.IS_EM?4:3;mxText.prototype.isParseVml=function(){return!1};mxText.prototype.isHtmlAllowed=function(){return document.documentMode!=8||mxClient.IS_EM};mxText.prototype.getSvgScreenOffset=function(){return 0};mxText.prototype.checkBounds=function(){return this.bounds!=null&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)};mxText.prototype.apply=function(){mxShape.prototype.apply.apply(this,arguments);this.style!=null&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacingTop=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop),this.spacingRight=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight),this.spacingBottom=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom),this.spacingLeft=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft),this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION),this.updateMargin())};mxText.prototype.getAutoDirection=function(){var n=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return n!=null&&n.length>0&&n[0]>"z"?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR};mxText.prototype.updateBoundingBox=function(){var n=this.node,t,u,f,e,i,h,r,c,l,o;this.boundingBox=this.bounds.clone();var s=this.getTextRotation(),a=this.style!=null?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null,v=this.style!=null?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(this.ignoreStringSize||n==null||this.overflow=="fill"||this.clipped&&this.ignoreClippedStringSize&&a==mxConstants.ALIGN_CENTER&&v==mxConstants.ALIGN_MIDDLE)this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height;else{if(t=null,u=null,n.ownerSVGElement!=null)if(n.firstChild!=null&&n.firstChild.firstChild!=null&&n.firstChild.firstChild.nodeName=="foreignObject")n=n.firstChild.firstChild,t=parseInt(n.getAttribute("width"))*this.scale,u=parseInt(n.getAttribute("height"))*this.scale;else try{if(f=n.getBBox(),typeof this.value=="string"&&mxUtils.trim(this.value)==0)return;if(f.width==0&&f.height==0)return;this.boundingBox=new mxRectangle(f.x,f.y,f.width,f.height);s=0}catch(y){}else e=this.state!=null?this.state.view.textDiv:null,this.offsetWidth!=null&&this.offsetHeight!=null?(t=this.offsetWidth*this.scale,u=this.offsetHeight*this.scale):(e!=null&&(this.updateFont(e),this.updateSize(e,!1),this.updateInnerHtml(e),n=e),i=n,document.documentMode!=8||mxClient.IS_EM?i.firstChild!=null&&i.firstChild.nodeName=="DIV"&&(i=i.firstChild):(h=Math.round(this.bounds.width/this.scale),this.wrap&&h>0?(n.whiteSpace="normal",r=i.getElementsByTagName("div"),r.length>0&&(i=r[r.length-1]),t=i.offsetWidth+2,r=this.node.getElementsByTagName("div"),this.clipped&&(t=Math.min(h,t)),r.length>1&&(r[r.length-2].style.width=t+"px")):n.whiteSpace="nowrap"),t=(i.offsetWidth+this.textWidthPadding)*this.scale,u=i.offsetHeight*this.scale);t!=null&&u!=null&&(c=this.bounds.x+this.margin.x*t,l=this.bounds.y+this.margin.y*u,this.boundingBox=new mxRectangle(c,l,t,u))}this.boundingBox!=null&&s!=0&&(this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox),o=mxUtils.getBoundingBox(this.boundingBox,s),this.boundingBox.x=o.x,this.boundingBox.y=o.y,mxClient.IS_QUIRKS||(this.boundingBox.width=o.width,this.boundingBox.height=o.height))};mxText.prototype.getShapeRotation=function(){return 0};mxText.prototype.getTextRotation=function(){return this.state!=null&&this.state.shape!=null?this.state.shape.getTextRotation():0};mxText.prototype.isPaintBoundsInverted=function(){return!this.horizontal&&this.state!=null&&this.state.view.graph.model.isVertex(this.state.cell)};mxText.prototype.configureCanvas=function(n){mxShape.prototype.configureCanvas.apply(this,arguments);n.setFontColor(this.color);n.setFontBackgroundColor(this.background);n.setFontBorderColor(this.border);n.setFontFamily(this.family);n.setFontSize(this.size);n.setFontStyle(this.fontStyle)};mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width="1px";this.node.style.height="1px";this.node.style.overflow="visible"};mxText.prototype.paint=function(n){var r=this.scale,u=this.bounds.x/r,f=this.bounds.y/r,e=this.bounds.width/r,o=this.bounds.height/r,t;this.updateTransform(n,u,f,e,o);this.configureCanvas(n,u,f,e,o);var s=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,h=s||n instanceof mxVmlCanvas2D?"html":"",i=this.value;s||h!="html"||(i=mxUtils.htmlEntities(i,!1));i=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&h=="html"?i.replace(/\n/g,"<br/>"):i;t=this.textDirection;t!=mxConstants.TEXT_DIRECTION_AUTO||s||(t=this.getAutoDirection());t!=mxConstants.TEXT_DIRECTION_LTR&&t!=mxConstants.TEXT_DIRECTION_RTL&&(t=null);n.text(u,f,e,o,i,this.align,this.valign,this.wrap,h,this.overflow,this.clipped,this.getTextRotation(),t)};mxText.prototype.redrawHtmlShape=function(){var n=this.node.style;n.whiteSpace="normal";n.overflow="";n.width="";n.height="";this.updateValue();this.updateFont(this.node);this.updateSize(this.node,this.state==null||this.state.view.textDiv==null);this.offsetWidth=null;this.offsetHeight=null;mxClient.IS_IE&&(document.documentMode==null||document.documentMode<=8)?this.updateHtmlFilter():this.updateHtmlTransform()};mxText.prototype.updateHtmlTransform=function(){var r=this.getTextRotation(),t=this.node.style,i=this.margin.x,n=this.margin.y;r!=0?(mxUtils.setPrefixedStyle(t,"transformOrigin",-i*100+"% "+-n*100+"%"),mxUtils.setPrefixedStyle(t,"transform","translate("+i*100+"%,"+n*100+"%)scale("+this.scale+") rotate("+r+"deg)")):(mxUtils.setPrefixedStyle(t,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(t,"transform","scale("+this.scale+")translate("+i*100+"%,"+n*100+"%)"));n=0;document.documentMode>=10&&this.valign!=mxConstants.ALIGN_TOP?n+=1:document.documentMode==9&&this.valign==mxConstants.ALIGN_BOTTOM?n+=1:mxClient.IS_MAC&&!mxClient.IS_OP&&mxClient.IS_GC?mxClient.IS_MAC?n+=this.valign==mxConstants.ALIGN_BOTTOM?2:1:this.valign==mxConstants.ALIGN_BOTTOM&&(n+=1):mxClient.IS_MAC&&mxClient.IS_FF?this.valign==mxConstants.ALIGN_BOTTOM?n+=2:this.valign==mxConstants.ALIGN_MIDDLE&&(n+=1):!mxClient.IS_MAC&&(mxClient.IS_GC||mxClient.IS_FF)&&this.valign==mxConstants.ALIGN_BOTTOM&&(n+=1);t.left=Math.round(this.bounds.x)+"px";t.top=Math.round(this.bounds.y+n)+"px";t.opacity=this.opacity<100?this.opacity/100:""};mxText.prototype.updateInnerHtml=function(n){if(mxUtils.isNode(this.value))n.innerHTML=this.value.outerHTML;else{var t=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(t=mxUtils.htmlEntities(t,!1));t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t;t='<div style="display:inline-block;_display:inline;">'+t+"<\/div>";n.innerHTML=t}};mxText.prototype.updateHtmlFilter=function(){var e=this.node.style,b=this.margin.x,s=this.margin.y,h=this.scale,n,r,a;mxUtils.setOpacity(this.node,this.opacity);var f=0,o=0,i=this.state!=null?this.state.view.textDiv:null,t=this.node;i!=null?(i.style.overflow="",i.style.height="",i.style.width="",this.updateFont(i),this.updateSize(i,!1),this.updateInnerHtml(i),n=Math.round(this.bounds.width/this.scale),this.wrap&&n>0?(i.whiteSpace="normal",f=n,this.clipped&&(f=Math.min(f,this.bounds.width)),i.style.width=f+"px"):i.whiteSpace="nowrap",t=i,t.firstChild!=null&&t.firstChild.nodeName=="DIV"&&(t=t.firstChild),!this.clipped&&this.wrap&&n>0&&(f=t.offsetWidth+this.textWidthPadding,i.style.width=f+"px"),o=t.offsetHeight+2,mxClient.IS_QUIRKS&&this.border!=null&&this.border!=mxConstants.NONE&&(o+=3)):t.firstChild!=null&&t.firstChild.nodeName=="DIV"&&(t=t.firstChild,o=t.offsetHeight);f=t.offsetWidth+this.textWidthPadding;this.clipped&&(o=Math.min(o,this.bounds.height));this.offsetWidth=f;this.offsetHeight=o;n=this.bounds.width/h;r=this.bounds.height/h;mxClient.IS_QUIRKS&&(this.clipped||this.overflow=="width"&&r>0)?(r=Math.min(r,o),e.height=Math.round(r)+"px"):r=o;this.overflow!="fill"&&this.overflow!="width"&&(this.clipped&&(f=Math.min(n,f)),n=f,(mxClient.IS_QUIRKS&&this.clipped||this.wrap)&&(e.width=Math.round(n)+"px"));r*=h;n*=h;var u=this.getTextRotation()*(Math.PI/180),c=parseFloat(parseFloat(Math.cos(u)).toFixed(8)),l=parseFloat(parseFloat(Math.sin(-u)).toFixed(8));u%=2*Math.PI;u<0&&(u+=2*Math.PI);u%=Math.PI;u>Math.PI/2&&(u=Math.PI-u);var v=Math.cos(u),y=Math.sin(-u),p=n*-(b+.5),w=r*-(s+.5),k=(r-r*v+n*y)/2+l*p-c*w,d=(n-n*v+r*y)/2-c*p-l*w;u!=0&&(a="progid:DXImageTransform.Microsoft.Matrix(M11="+c+", M12="+l+", M21="+-l+", M22="+c+", sizingMethod='auto expand')",e.filter!=null&&e.filter.length>0?e.filter+=" "+a:e.filter=a);s=0;mxClient.IS_QUIRKS&&(this.valign==mxConstants.ALIGN_TOP?s-=1:s+=this.valign==mxConstants.ALIGN_BOTTOM?2:1);e.zoom=h;e.left=Math.round(this.bounds.x+d-n/2)+"px";e.top=Math.round(this.bounds.y+k-r/2+s)+"px"};mxText.prototype.updateValue=function(){var n,r,u,f,e,t,i;mxUtils.isNode(this.value)?(this.node.innerHTML="",this.node.appendChild(this.value)):(n=this.value,this.dialect!=mxConstants.DIALECT_STRICTHTML&&(n=mxUtils.htmlEntities(n,!1)),n=this.replaceLinefeeds?n.replace(/\n/g,"<br/>"):n,r=this.background!=null&&this.background!=mxConstants.NONE?this.background:null,u=this.border!=null&&this.border!=mxConstants.NONE?this.border:null,this.overflow=="fill"||this.overflow=="width"?(r!=null&&(this.node.style.backgroundColor=r),u!=null&&(this.node.style.border="1px solid "+u)):(f="",r!=null&&(f+="background-color:"+r+";"),u!=null&&(f+="border:1px solid "+u+";"),e=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT,n='<div style="zoom:1;'+f+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+e+'">'+n+"<\/div>"),this.node.innerHTML=n,t=this.node.getElementsByTagName("div"),t.length>0&&(i=this.textDirection,i==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML&&(i=this.getAutoDirection()),i==mxConstants.TEXT_DIRECTION_LTR||i==mxConstants.TEXT_DIRECTION_RTL?t[t.length-1].setAttribute("dir",i):t[t.length-1].removeAttribute("dir")))};mxText.prototype.updateFont=function(n){var t=n.style;t.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;t.fontSize=Math.round(this.size)+"px";t.fontFamily=this.family;t.verticalAlign="top";t.color=this.color;t.fontWeight=(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?"bold":"";t.fontStyle=(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?"italic":"";t.textDecoration=(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE?"underline":"";t.textAlign=this.align==mxConstants.ALIGN_CENTER?"center":this.align==mxConstants.ALIGN_RIGHT?"right":"left"};mxText.prototype.updateSize=function(n,t){var r=Math.round(this.bounds.width/this.scale),e=Math.round(this.bounds.height/this.scale),i=n.style,u,f;this.clipped?(i.overflow="hidden",mxClient.IS_QUIRKS?i.width=r+"px":(i.maxHeight=e+"px",i.maxWidth=r+"px")):this.overflow=="fill"?(i.width=r+"px",i.height=e+"px"):this.overflow=="width"&&(i.width=r+"px",i.maxHeight=e+"px");this.wrap&&r>0?(i.whiteSpace="normal",i.width=r+"px",t&&(u=n,u.firstChild!=null&&u.firstChild.nodeName=="DIV"&&(u=u.firstChild),f=u.offsetWidth+3,this.clipped&&(f=Math.min(f,r)),i.width=f+"px")):i.whiteSpace="nowrap"};mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)};mxText.prototype.getSpacing=function(){var n=0,t=0;return n=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,t=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new mxPoint(n,t)};mxUtils.extend(mxTriangle,mxActor);mxTriangle.prototype.redrawPath=function(n,t,i,r,u){var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(n,[new mxPoint(0,0),new mxPoint(r,.5*u),new mxPoint(0,u)],this.isRounded,f,!0)};mxUtils.extend(mxHexagon,mxActor);mxHexagon.prototype.redrawPath=function(n,t,i,r,u){var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(n,[new mxPoint(.25*r,0),new mxPoint(.75*r,0),new mxPoint(r,.5*u),new mxPoint(.75*r,u),new mxPoint(.25*r,u),new mxPoint(0,.5*u)],this.isRounded,f,!0)};mxUtils.extend(mxLine,mxShape);mxLine.prototype.paintVertexShape=function(n,t,i,r,u){var f=i+u/2;n.begin();n.moveTo(t,f);n.lineTo(t+r,f);n.stroke()};mxUtils.extend(mxImageShape,mxRectangleShape);mxImageShape.prototype.preserveImageAspect=!0;mxImageShape.prototype.getSvgScreenOffset=function(){return mxClient.IS_IE?0:.5};mxImageShape.prototype.apply=function(){mxShape.prototype.apply.apply(this,arguments);this.fill=null;this.stroke=null;this.gradient=null;this.style!=null&&(this.preserveImageAspect=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1)==1,this.flipH=this.flipH||mxUtils.getValue(this.style,"imageFlipH",0)==1,this.flipV=this.flipV||mxUtils.getValue(this.style,"imageFlipV",0)==1)};mxImageShape.prototype.isHtmlAllowed=function(){return!this.preserveImageAspect};mxImageShape.prototype.createHtml=function(){var n=document.createElement("div");return n.style.position="absolute",n};mxImageShape.prototype.paintVertexShape=function(n,t,i,r,u){var e,f;this.image!=null?(e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null),e!=null&&(n.setFillColor(e),n.setStrokeColor(f),n.rect(t,i,r,u),n.fillAndStroke()),n.image(t,i,r,u,this.image,this.preserveImageAspect,!1,!1),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null),f!=null&&(n.setShadow(!1),n.setStrokeColor(f),n.rect(t,i,r,u),n.stroke())):mxRectangleShape.prototype.paintBackground.apply(this,arguments)};mxImageShape.prototype.redrawHtmlShape=function(){var i,r,u,n,t;this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px";this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px";this.node.innerHTML="";this.image!=null?(i=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),r=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,""),this.node.style.backgroundColor=i,this.node.style.borderColor=r,u=mxClient.IS_IE6||(document.documentMode==null||document.documentMode<=8)&&this.rotation!=0,n=document.createElement(u?mxClient.VML_PREFIX+":image":"img"),n.style.position="absolute",n.src=this.image,t=this.opacity<100?"alpha(opacity="+this.opacity+")":"",this.node.style.filter=t,this.flipH&&this.flipV?t+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?t+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(t+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"),n.style.filter!=t&&(n.style.filter=t),n.nodeName=="image"?n.style.rotation=this.rotation:this.rotation!=0?mxUtils.setPrefixedStyle(n.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(n.style,"transform",""),n.style.width=this.node.style.width,n.style.height=this.node.style.height,this.node.style.backgroundImage="",this.node.appendChild(n)):this.setTransparentBackgroundImage(this.node)};mxUtils.extend(mxLabel,mxRectangleShape);mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE;mxLabel.prototype.spacing=2;mxLabel.prototype.indicatorSize=10;mxLabel.prototype.indicatorSpacing=2;mxLabel.prototype.init=function(){mxShape.prototype.init.apply(this,arguments);this.indicatorShape!=null&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))};mxLabel.prototype.redraw=function(){this.indicator!=null&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection);mxShape.prototype.redraw.apply(this,arguments)};mxLabel.prototype.isHtmlAllowed=function(){return mxRectangleShape.prototype.isHtmlAllowed.apply(this,arguments)&&this.indicatorColor==null&&this.indicatorShape==null};mxLabel.prototype.paintForeground=function(n,t,i,r,u){this.paintImage(n,t,i,r,u);this.paintIndicator(n,t,i,r,u);mxRectangleShape.prototype.paintForeground.apply(this,arguments)};mxLabel.prototype.paintImage=function(n,t,i,r,u){if(this.image!=null){var f=this.getImageBounds(t,i,r,u);n.image(f.x,f.y,f.width,f.height,this.image,!1,!1,!1)}};mxLabel.prototype.getImageBounds=function(n,t,i,r){var o=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),s=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),f=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),e=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),u=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5;return n+=o==mxConstants.ALIGN_CENTER?(i-f)/2:o==mxConstants.ALIGN_RIGHT?i-f-u:u,t+=s==mxConstants.ALIGN_TOP?u:s==mxConstants.ALIGN_BOTTOM?r-e-u:(r-e)/2,new mxRectangle(n,t,f,e)};mxLabel.prototype.paintIndicator=function(n,t,i,r,u){if(this.indicator!=null)this.indicator.bounds=this.getIndicatorBounds(t,i,r,u),this.indicator.paint(n);else if(this.indicatorImage!=null){var f=this.getIndicatorBounds(t,i,r,u);n.image(f.x,f.y,f.width,f.height,this.indicatorImage,!1,!1,!1)}};mxLabel.prototype.getIndicatorBounds=function(n,t,i,r){var o=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),s=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),f=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),e=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),u=this.spacing+5;return n+=o==mxConstants.ALIGN_RIGHT?i-f-u:o==mxConstants.ALIGN_CENTER?(i-f)/2:u,t+=s==mxConstants.ALIGN_BOTTOM?r-e-u:s==mxConstants.ALIGN_TOP?u:(r-e)/2,new mxRectangle(n,t,f,e)};mxLabel.prototype.redrawHtmlShape=function(){var n,t;for(mxRectangleShape.prototype.redrawHtmlShape.apply(this,arguments);this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);this.image!=null&&(n=document.createElement("img"),n.style.position="relative",n.setAttribute("border","0"),t=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height),t.x-=this.bounds.x,t.y-=this.bounds.y,n.style.left=Math.round(t.x)+"px",n.style.top=Math.round(t.y)+"px",n.style.width=Math.round(t.width)+"px",n.style.height=Math.round(t.height)+"px",n.src=this.image,this.node.appendChild(n))};mxUtils.extend(mxCylinder,mxShape);mxCylinder.prototype.maxHeight=40;mxCylinder.prototype.svgStrokeTolerance=0;mxCylinder.prototype.paintVertexShape=function(n,t,i,r,u){n.translate(t,i);n.begin();this.redrawPath(n,t,i,r,u,!1);n.fillAndStroke();n.setShadow(!1);n.begin();this.redrawPath(n,t,i,r,u,!0);n.stroke()};mxCylinder.prototype.redrawPath=function(n,t,i,r,u,f){var e=Math.min(this.maxHeight,Math.round(u/5));(f&&this.fill!=null||!f&&this.fill==null)&&(n.moveTo(0,e),n.curveTo(0,2*e,r,2*e,r,e),f||(n.stroke(),n.begin()));f||(n.moveTo(0,e),n.curveTo(0,-e/3,r,-e/3,r,e),n.lineTo(r,u-e),n.curveTo(r,u+e/3,0,u+e/3,0,u-e),n.close())};mxUtils.extend(mxConnector,mxPolyline);mxConnector.prototype.paintEdgeShape=function(n,t){var i=this.createMarker(n,t,!0),r=this.createMarker(n,t,!1);mxPolyline.prototype.paintEdgeShape.apply(this,arguments);n.setFillColor(this.stroke);n.setShadow(!1);n.setDashed(!1);i!=null&&i();r!=null&&r()};mxConnector.prototype.createMarker=function(n,t,i){var h=null,e=t.length,c=mxUtils.getValue(this.style,i?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW),r=i?t[1]:t[e-2],u=i?t[0]:t[e-1],f;if(c!=null&&r!=null&&u!=null){for(f=1;f<e-1&&Math.round(r.x-u.x)==0&&Math.round(r.y-u.y)==0;)r=i?t[1+f]:t[e-2-f],f++;var o=u.x-r.x,s=u.y-r.y,l=Math.max(1,Math.sqrt(o*o+s*s)),a=o/l,v=s/l,y=mxUtils.getNumber(this.style,i?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE),p=this.style[i?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL]!=0;h=mxMarker.createMarker(n,this,c,u,a,v,y,i,this.arrowStrokewidth,p)}return h};mxConnector.prototype.augmentBoundingBox=function(n){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var t=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(t=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1);mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(t=Math.max(t,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+1);n.grow(Math.ceil(t*this.scale))};mxUtils.extend(mxSwimlane,mxShape);mxSwimlane.prototype.imageSize=16;mxSwimlane.prototype.getTitleSize=function(){return Math.max(0,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE))};mxSwimlane.prototype.getLabelBounds=function(n){var r=this.getTitleSize(),t=new mxRectangle(n.x,n.y,n.width,n.height),s=this.isHorizontal(),h=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0)==1,c=mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0)==1,u=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH,f=s==!u,e=!f&&h!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST),o=f&&c!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST),i;return u?(i=Math.min(t.width,r*this.scale),(e||o)&&(t.x+=t.width-i),t.width=i):(i=Math.min(t.height,r*this.scale),(e||o)&&(t.y+=t.height-i),t.height=i),t};mxSwimlane.prototype.getGradientBounds=function(n,t,i,r,u){var f=this.getTitleSize();return this.isHorizontal()?(f=Math.min(f,u),new mxRectangle(t,i,r,f)):(f=Math.min(f,r),new mxRectangle(t,i,f,u))};mxSwimlane.prototype.getArcSize=function(n,t,i){var r=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.RECTANGLE_ROUNDING_FACTOR*100)/100;return i*r*3};mxSwimlane.prototype.isHorizontal=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)==1};mxSwimlane.prototype.paintVertexShape=function(n,t,i,r,u){var f=this.getTitleSize(),s=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),h=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1)==1,o=0,c,e;f=this.isHorizontal()?Math.min(f,u):Math.min(f,r);n.translate(t,i);this.isRounded?(o=this.getArcSize(r,u,f),this.paintRoundedSwimlane(n,t,i,r,u,f,o,s,h)):this.paintSwimlane(n,t,i,r,u,f,s,h);c=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,mxConstants.NONE);this.paintSeparator(n,t,i,r,u,f,c);this.image!=null&&(e=this.getImageBounds(t,i,r,u),n.image(e.x-t,e.y-i,e.width,e.height,this.image,!1,!1,!1));this.glass&&(n.setShadow(!1),this.paintGlassEffect(n,0,0,r,f,o))};mxSwimlane.prototype.paintSwimlane=function(n,t,i,r,u,f,e,o){e!=mxConstants.NONE&&(n.save(),n.setFillColor(e),n.rect(0,0,r,u),n.fillAndStroke(),n.restore(),n.setShadow(!1));n.begin();this.isHorizontal()?(n.moveTo(0,f),n.lineTo(0,0),n.lineTo(r,0),n.lineTo(r,f),o&&n.close(),n.fillAndStroke(),f<u&&e==mxConstants.NONE&&(n.pointerEvents=!1,n.begin(),n.moveTo(0,f),n.lineTo(0,u),n.lineTo(r,u),n.lineTo(r,f),n.stroke())):(n.moveTo(f,0),n.lineTo(0,0),n.lineTo(0,u),n.lineTo(f,u),o&&n.close(),n.fillAndStroke(),f<r&&e==mxConstants.NONE&&(n.pointerEvents=!1,n.begin(),n.moveTo(f,0),n.lineTo(r,0),n.lineTo(r,u),n.lineTo(f,u),n.stroke()))};mxSwimlane.prototype.paintRoundedSwimlane=function(n,t,i,r,u,f,e,o,s){o!=mxConstants.NONE&&(n.save(),n.setFillColor(o),n.roundrect(0,0,r,u,e,e),n.fillAndStroke(),n.restore(),n.setShadow(!1));n.begin();this.isHorizontal()?(n.moveTo(r,f),n.lineTo(r,e),n.quadTo(r,0,r-Math.min(r/2,e),0),n.lineTo(Math.min(r/2,e),0),n.quadTo(0,0,0,e),n.lineTo(0,f),s&&n.close(),n.fillAndStroke(),f<u&&o==mxConstants.NONE&&(n.pointerEvents=!1,n.begin(),n.moveTo(0,f),n.lineTo(0,u-e),n.quadTo(0,u,Math.min(r/2,e),u),n.lineTo(r-Math.min(r/2,e),u),n.quadTo(r,u,r,u-e),n.lineTo(r,f),n.stroke())):(n.moveTo(f,0),n.lineTo(e,0),n.quadTo(0,0,0,Math.min(u/2,e)),n.lineTo(0,u-Math.min(u/2,e)),n.quadTo(0,u,e,u),n.lineTo(f,u),s&&n.close(),n.fillAndStroke(),f<r&&o==mxConstants.NONE&&(n.pointerEvents=!1,n.begin(),n.moveTo(f,u),n.lineTo(r-e,u),n.quadTo(r,u,r,u-Math.min(u/2,e)),n.lineTo(r,Math.min(u/2,e)),n.quadTo(r,0,r-e,0),n.lineTo(f,0),n.stroke()))};mxSwimlane.prototype.paintSeparator=function(n,t,i,r,u,f,e){e!=mxConstants.NONE&&(n.setStrokeColor(e),n.setDashed(!0),n.begin(),this.isHorizontal()?(n.moveTo(r,f),n.lineTo(r,u)):(n.moveTo(f,0),n.lineTo(r,0)),n.stroke(),n.setDashed(!1))};mxSwimlane.prototype.getImageBounds=function(n,t,i){return this.isHorizontal()?new mxRectangle(n+i-this.imageSize,t,this.imageSize,this.imageSize):new mxRectangle(n,t,this.imageSize,this.imageSize)};mxGraphLayout.prototype.graph=null;mxGraphLayout.prototype.useBoundingBox=!0;mxGraphLayout.prototype.parent=null;mxGraphLayout.prototype.moveCell=function(){};mxGraphLayout.prototype.execute=function(){};mxGraphLayout.prototype.getGraph=function(){return this.graph};mxGraphLayout.prototype.getConstraint=function(n,t){var i=this.graph.view.getState(t),r=i!=null?i.style:this.graph.getCellStyle(t);return r!=null?r[n]:null};mxGraphLayout.traverse=function(n,t,i,r,u){var o,s,h,f,e,c,l;if(i!=null&&n!=null&&(t=t!=null?t:!0,u=u||[],o=mxCellPath.create(n),u[o]==null&&(u[o]=n,s=i(n,r),(s==null||s)&&(h=this.graph.model.getEdgeCount(n),h>0))))for(f=0;f<h;f++)e=this.graph.model.getEdgeAt(n,f),c=this.graph.model.getTerminal(e,!0)==n,(!t||c)&&(l=this.graph.view.getVisibleTerminal(e,!c),this.traverse(l,t,i,e,u))};mxGraphLayout.prototype.isVertexMovable=function(n){return this.graph.isCellMovable(n)};mxGraphLayout.prototype.isVertexIgnored=function(n){return!this.graph.getModel().isVertex(n)||!this.graph.isCellVisible(n)};mxGraphLayout.prototype.isEdgeIgnored=function(n){var t=this.graph.getModel();return!t.isEdge(n)||!this.graph.isCellVisible(n)||t.getTerminal(n,!0)==null||t.getTerminal(n,!1)==null};mxGraphLayout.prototype.setEdgeStyleEnabled=function(n,t){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,t?"0":"1",[n])};mxGraphLayout.prototype.setOrthogonalEdge=function(n,t){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,t?"1":"0",[n])};mxGraphLayout.prototype.getParentOffset=function(n){var t=new mxPoint,i,r;if(n!=null&&n!=this.parent&&(i=this.graph.getModel(),i.isAncestor(this.parent,n)))for(r=i.getGeometry(n);n!=this.parent;)t.x=t.x+r.x,t.y=t.y+r.y,n=i.getParent(n),r=i.getGeometry(n);return t};mxGraphLayout.prototype.setEdgePoints=function(n,t){var u,i,e,f,r;if(n!=null){if(u=this.graph.model,i=u.getGeometry(n),i==null?(i=new mxGeometry,i.setRelative(!0)):i=i.clone(),this.parent!=null&&t!=null)for(e=u.getParent(n),f=this.getParentOffset(e),r=0;r<t.length;r++)t[r].x=t[r].x-f.x,t[r].y=t[r].y-f.y;i.points=t;u.setGeometry(n,i)}};mxGraphLayout.prototype.setVertexLocation=function(n,t,i){var s=this.graph.getModel(),u=s.getGeometry(n),e=null,r,h,f,o,c;return u!=null&&(e=new mxRectangle(t,i,u.width,u.height),this.useBoundingBox&&(r=this.graph.getView().getState(n),r!=null&&r.text!=null&&r.text.boundingBox!=null&&(h=this.graph.getView().scale,f=r.text.boundingBox,r.text.boundingBox.x<r.x&&(t+=(r.x-f.x)/h,e.width=f.width),r.text.boundingBox.y<r.y&&(i+=(r.y-f.y)/h,e.height=f.height))),this.parent!=null&&(o=s.getParent(n),o!=null&&o!=this.parent&&(c=this.getParentOffset(o),t=t-c.x,i=i-c.y)),(u.x!=t||u.y!=i)&&(u=u.clone(),u.x=t,u.y=i,s.setGeometry(n,u))),e};mxGraphLayout.prototype.getVertexBounds=function(n){var t=this.graph.getModel().getGeometry(n),i,f,e;if(this.useBoundingBox&&(i=this.graph.getView().getState(n),i!=null&&i.text!=null&&i.text.boundingBox!=null)){var u=this.graph.getView().scale,r=i.text.boundingBox,o=Math.max(i.x-r.x,0)/u,s=Math.max(i.y-r.y,0)/u,h=Math.max(r.x+r.width-(i.x+i.width),0)/u,c=Math.max(r.y+r.height-(i.y+i.height),0)/u;t=new mxRectangle(t.x-o,t.y-s,t.width+o+h,t.height+s+c)}return this.parent!=null&&(f=this.graph.getModel().getParent(n),t=t.clone(),f!=null&&f!=this.parent&&(e=this.getParentOffset(f),t.x=t.x+e.x,t.y=t.y+e.y)),new mxRectangle(t.x,t.y,t.width,t.height)};mxGraphLayout.prototype.arrangeGroups=function(n,t,i,r,u,f){return this.graph.updateGroupBounds(n,t,!0,i,r,u,f)};mxStackLayout.prototype=new mxGraphLayout;mxStackLayout.prototype.constructor=mxStackLayout;mxStackLayout.prototype.horizontal=null;mxStackLayout.prototype.spacing=null;mxStackLayout.prototype.x0=null;mxStackLayout.prototype.y0=null;mxStackLayout.prototype.border=0;mxStackLayout.prototype.marginTop=0;mxStackLayout.prototype.marginLeft=0;mxStackLayout.prototype.marginRight=0;mxStackLayout.prototype.marginBottom=0;mxStackLayout.prototype.keepFirstLocation=!1;mxStackLayout.prototype.fill=!1;mxStackLayout.prototype.resizeParent=!1;mxStackLayout.prototype.resizeParentMax=!1;mxStackLayout.prototype.resizeLast=!1;mxStackLayout.prototype.wrap=null;mxStackLayout.prototype.borderCollapse=!0;mxStackLayout.prototype.isHorizontal=function(){return this.horizontal};mxStackLayout.prototype.moveCell=function(n,t,i){var e=this.graph.getModel(),r=e.getParent(n),h=this.isHorizontal(),l,f,a,s;if(n!=null&&r!=null){var u=0,v=0,y=e.getChildCount(r),o=h?t:i,c=this.graph.getView().getState(r);for(c!=null&&(o-=h?c.x:c.y),o/=this.graph.view.scale,u=0;u<y;u++)if(l=e.getChildAt(r,u),l!=n&&(f=e.getGeometry(l),f!=null)){if(a=h?f.x+f.width/2:f.y+f.height/2,v<o&&a>o)break;v=a}s=r.getIndex(n);s=Math.max(0,u-(u>s?1:0));e.add(r,n,s)}};mxStackLayout.prototype.getParentSize=function(n){var i=this.graph.getModel(),t=i.getGeometry(n),r,u;return this.graph.container!=null&&(t==null&&i.isLayer(n)||n==this.graph.getView().currentRoot)&&(r=this.graph.container.offsetWidth-1,u=this.graph.container.offsetHeight-1,t=new mxRectangle(0,0,r,u)),t};mxStackLayout.prototype.execute=function(n){var c,l,v,f,i,s,k;if(n!=null){var u=this.getParentSize(n),r=this.isHorizontal(),h=this.graph.getModel(),e=null;if(u!=null&&(e=r?u.height-this.marginTop-this.marginBottom:u.width-this.marginLeft-this.marginRight),e-=2*this.spacing+2*this.border,c=this.x0+this.border+this.marginLeft,l=this.y0+this.border+this.marginTop,this.graph.isSwimlane(n)){var b=this.graph.getCellStyle(n),o=mxUtils.getNumber(b,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),y=mxUtils.getValue(b,mxConstants.STYLE_HORIZONTAL,!0)==1;u!=null&&(o=y?Math.min(o,u.height):Math.min(o,u.width));r==y&&(e-=o);y?l+=o:c+=o}h.beginUpdate();try{var a=0,t=null,p=0,w=null,d=h.getChildCount(n);for(v=0;v<d;v++)f=h.getChildAt(n,v),!this.isVertexIgnored(f)&&this.isVertexMovable(f)&&(i=h.getGeometry(f),i!=null&&(i=i.clone(),this.wrap!=null&&t!=null&&(r&&t.x+t.width+i.width+2*this.spacing>this.wrap||!r&&t.y+t.height+i.height+2*this.spacing>this.wrap)&&(t=null,r?l+=a+this.spacing:c+=a+this.spacing,a=0),a=Math.max(a,r?i.height:i.width),s=0,this.borderCollapse||(k=this.graph.getCellStyle(f),s=mxUtils.getNumber(k,mxConstants.STYLE_STROKEWIDTH,1)),t!=null?r?i.x=p+this.spacing+Math.floor(s/2):i.y=p+this.spacing+Math.floor(s/2):this.keepFirstLocation||(r?i.x=c:i.y=l),r?i.y=l:i.x=c,this.fill&&e!=null&&(r?i.height=e:i.width=e),this.setChildGeometry(f,i),w=f,t=i,p=r?t.x+t.width+Math.floor(s/2):t.y+t.height+Math.floor(s/2)));this.resizeParent&&u!=null&&t!=null&&!this.graph.isCellCollapsed(n)?this.updateParentGeometry(n,u,t):this.resizeLast&&u!=null&&t!=null&&w!=null&&(r?t.width=u.width-t.x-this.spacing-this.marginRight-this.marginLeft:t.height=u.height-t.y-this.spacing-this.marginBottom,this.setChildGeometry(w,t))}finally{h.endUpdate()}}};mxStackLayout.prototype.setChildGeometry=function(n,t){var i=this.graph.getCellGeometry(n);(i==null||t.x!=i.x||t.y!=i.y||t.width!=i.width||t.height!=i.height)&&this.graph.getModel().setGeometry(n,t)};mxStackLayout.prototype.updateParentGeometry=function(n,t,i){var f=this.isHorizontal(),e=this.graph.getModel(),r=t.clone(),u;f?(u=i.x+i.width+this.spacing+this.marginRight,r.width=this.resizeParentMax?Math.max(r.width,u):u):(u=i.y+i.height+this.spacing+this.marginBottom,r.height=this.resizeParentMax?Math.max(r.height,u):u);(t.x!=r.x||t.y!=r.y||t.width!=r.width||t.height!=r.height)&&e.setGeometry(n,r)};mxPartitionLayout.prototype=new mxGraphLayout;mxPartitionLayout.prototype.constructor=mxPartitionLayout;mxPartitionLayout.prototype.horizontal=null;mxPartitionLayout.prototype.spacing=null;mxPartitionLayout.prototype.border=null;mxPartitionLayout.prototype.resizeVertices=!0;mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal};mxPartitionLayout.prototype.moveCell=function(n,t){var u=this.graph.getModel(),r=u.getParent(n),h,f,o,e;if(n!=null&&r!=null){for(var i=0,s=0,c=u.getChildCount(r),i=0;i<c;i++)if(h=u.getChildAt(r,i),f=this.getVertexBounds(h),f!=null){if(o=f.x+f.width/2,s<t&&o>t)break;s=o}e=r.getIndex(n);e=Math.max(0,i-(i>e?1:0));u.add(r,n,e)}};mxPartitionLayout.prototype.execute=function(n){var l=this.isHorizontal(),i=this.graph.getModel(),u=i.getGeometry(n),p,w,a,b,e,c,y,o,r,f,t;if(this.graph.container!=null&&(u==null&&i.isLayer(n)||n==this.graph.getView().currentRoot)&&(p=this.graph.container.offsetWidth-1,w=this.graph.container.offsetHeight-1,u=new mxRectangle(0,0,p,w)),u!=null){for(a=[],b=i.getChildCount(n),r=0;r<b;r++)f=i.getChildAt(n,r),!this.isVertexIgnored(f)&&this.isVertexMovable(f)&&a.push(f);if(e=a.length,e>0){var s=this.border,h=this.border,v=l?u.height:u.width;if(v-=2*this.border,c=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new mxRectangle,v-=l?c.height:c.width,s=s+c.width,h=h+c.height,y=this.border+(e-1)*this.spacing,o=l?(u.width-s-y)/e:(u.height-h-y)/e,o>0){i.beginUpdate();try{for(r=0;r<e;r++)f=a[r],t=i.getGeometry(f),t!=null&&(t=t.clone(),t.x=s,t.y=h,l?(this.resizeVertices&&(t.width=o,t.height=v),s+=o+this.spacing):(this.resizeVertices&&(t.height=o,t.width=v),h+=o+this.spacing),i.setGeometry(f,t))}finally{i.endUpdate()}}}}};mxCompactTreeLayout.prototype=new mxGraphLayout;mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=!0;mxCompactTreeLayout.prototype.maintainParentLocation=!1;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.groupPaddingTop=0;mxCompactTreeLayout.prototype.groupPaddingRight=0;mxCompactTreeLayout.prototype.groupPaddingBottom=0;mxCompactTreeLayout.prototype.groupPaddingLeft=0;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=!1;mxCompactTreeLayout.prototype.visited=null;mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=!0;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=!0;mxCompactTreeLayout.prototype.sortEdges=!1;mxCompactTreeLayout.prototype.alignRanks=!1;mxCompactTreeLayout.prototype.maxRankHeight=null;mxCompactTreeLayout.prototype.root=null;mxCompactTreeLayout.prototype.node=null;mxCompactTreeLayout.prototype.isVertexIgnored=function(n){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||this.graph.getConnections(n).length==0};mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};mxCompactTreeLayout.prototype.execute=function(n,t){var u,f,e,o,s,h,r,c,l,i;if(this.parent=n,u=this.graph.getModel(),t==null){if(this.graph.getEdges(n,u.getParent(n),this.invert,!this.invert,!1).length>0)this.root=n;else if(f=this.graph.findTreeRoots(n,!0,this.invert),f.length>0)for(e=0;e<f.length;e++)if(!this.isVertexIgnored(f[e])&&this.graph.getEdges(f[e],null,this.invert,!this.invert,!1).length>0){this.root=f[e];break}}else this.root=t;if(this.root!=null){this.parentsChanged=this.resizeParent?{}:null;this.parentX=null;this.parentY=null;n!=this.root&&u.isVertex(n)!=null&&this.maintainParentLocation&&(i=this.graph.getCellGeometry(n),i!=null&&(this.parentX=i.x,this.parentY=i.y));u.beginUpdate();try{this.visited={};this.node=this.dfs(this.root,n);this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0));this.node!=null&&(this.layout(this.node),o=this.graph.gridSize,s=o,this.moveTree||(h=this.getVertexBounds(this.root),h!=null&&(o=h.x,s=h.y)),r=null,r=this.isHorizontal()?this.horizontalLayout(this.node,o,s):this.verticalLayout(this.node,null,o,s),r!=null&&(c=0,l=0,r.x<0&&(c=Math.abs(o-r.x)),r.y<0&&(l=Math.abs(s-r.y)),(c!=0||l!=0)&&this.moveNode(this.node,c,l),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)),this.parentX!=null&&this.parentY!=null&&(i=this.graph.getCellGeometry(n),i!=null&&(i=i.clone(),i.x=this.parentX,i.y=this.parentY,u.setGeometry(n,i))))}finally{u.endUpdate()}}};mxCompactTreeLayout.prototype.moveNode=function(n,t,i){n.x+=t;n.y+=i;this.apply(n);for(var r=n.child;r!=null;)this.moveNode(r,t,i),r=r.next};mxCompactTreeLayout.prototype.sortOutgoingEdges=function(n,t){var i=new mxDictionary;t.sort(function(t,r){var o=t.getTerminal(t.getTerminal(!1)==n),f=i.get(o),e,u;return f==null&&(f=mxCellPath.create(o).split(mxCellPath.PATH_SEPARATOR),i.put(o,f)),e=r.getTerminal(r.getTerminal(!1)==n),u=i.get(e),u==null&&(u=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR),i.put(e,u)),mxCellPath.compare(f,u)})};mxCompactTreeLayout.prototype.findRankHeights=function(n,t){(this.maxRankHeight[t]==null||this.maxRankHeight[t]<n.height)&&(this.maxRankHeight[t]=n.height);for(var i=n.child;i!=null;)this.findRankHeights(i,t+1),i=i.next};mxCompactTreeLayout.prototype.setCellHeights=function(n,t){this.maxRankHeight[t]!=null&&this.maxRankHeight[t]>n.height&&(n.height=this.maxRankHeight[t]);for(var i=n.child;i!=null;)this.setCellHeights(i,t+1),i=i.next};mxCompactTreeLayout.prototype.dfs=function(n,t){var s=mxCellPath.create(n),f=null,r,i;if(n!=null&&this.visited[s]==null&&!this.isVertexIgnored(n)){this.visited[s]=n;f=this.createNode(n);var a=this.graph.getModel(),e=null,o=this.graph.getEdges(n,t,this.invert,!this.invert,!1,!0),h=this.graph.getView();for(this.sortEdges&&this.sortOutgoingEdges(n,o),r=0;r<o.length;r++)if(i=o[r],!this.isEdgeIgnored(i)){this.resetEdges&&this.setEdgePoints(i,null);this.edgeRouting&&(this.setEdgeStyleEnabled(i,!1),this.setEdgePoints(i,null));var c=h.getState(i),l=c!=null?c.getVisibleTerminal(this.invert):h.getVisibleTerminal(i,this.invert),u=this.dfs(l,t);u!=null&&a.getGeometry(l)!=null&&(e==null?f.child=u:e.next=u,e=u)}}return f};mxCompactTreeLayout.prototype.layout=function(n){if(n!=null){for(var t=n.child;t!=null;)this.layout(t),t=t.next;n.child!=null?this.attachParent(n,this.join(n)):this.layoutLeaf(n)}};mxCompactTreeLayout.prototype.horizontalLayout=function(n,t,i,r){var u,e,f;if(n.x+=t+n.offsetX,n.y+=i+n.offsetY,r=this.apply(n,r),u=n.child,u!=null)for(r=this.horizontalLayout(u,n.x,n.y,r),e=n.y+u.offsetY,f=u.next;f!=null;)r=this.horizontalLayout(f,n.x+u.offsetX,e,r),e+=f.offsetY,f=f.next;return r};mxCompactTreeLayout.prototype.verticalLayout=function(n,t,i,r,u){var f,o,e;if(n.x+=i+n.offsetY,n.y+=r+n.offsetX,u=this.apply(n,u),f=n.child,f!=null)for(u=this.verticalLayout(f,n,n.x,n.y,u),o=n.x+f.offsetY,e=f.next;e!=null;)u=this.verticalLayout(e,n,o,n.y+f.offsetX,u),o+=e.offsetY,e=e.next;return u};mxCompactTreeLayout.prototype.attachParent=function(n,t){var i=this.nodeDistance+this.levelDistance,r=(t-n.width)/2-this.nodeDistance,u=r+n.width+2*this.nodeDistance-t;n.child.offsetX=i+n.height;n.child.offsetY=u;n.contour.upperHead=this.createLine(n.height,0,this.createLine(i,u,n.contour.upperHead));n.contour.lowerHead=this.createLine(n.height,0,this.createLine(i,r,n.contour.lowerHead))};mxCompactTreeLayout.prototype.layoutLeaf=function(n){var t=2*this.nodeDistance;n.contour.upperTail=this.createLine(n.height+t,0);n.contour.upperHead=n.contour.upperTail;n.contour.lowerTail=this.createLine(0,-n.width-t);n.contour.lowerHead=this.createLine(n.height+t,0,n.contour.lowerTail)};mxCompactTreeLayout.prototype.join=function(n){var f=2*this.nodeDistance,t=n.child,i,r,u;for(n.contour=t.contour,i=t.width+f,r=i,t=t.next;t!=null;)u=this.merge(n.contour,t.contour),t.offsetY=u+i,t.offsetX=0,i=t.width+f,r+=u+i,t=t.next;return r};mxCompactTreeLayout.prototype.merge=function(n,t){for(var u=0,f=0,s=0,r=n.lowerHead,i=t.upperHead,o,e;i!=null&&r!=null;)o=this.offset(u,f,i.dx,i.dy,r.dx,r.dy),f+=o,s+=o,u+i.dx<=r.dx?(u+=i.dx,f+=i.dy,i=i.next):(u-=r.dx,f-=r.dy,r=r.next);return i!=null?(e=this.bridge(n.upperTail,0,0,i,u,f),n.upperTail=e.next!=null?t.upperTail:e,n.lowerTail=t.lowerTail):(e=this.bridge(t.lowerTail,u,f,r,0,0),e.next==null&&(n.lowerTail=e)),n.lowerHead=t.lowerHead,s};mxCompactTreeLayout.prototype.offset=function(n,t,i,r,u,f){var e=0,s,o;return u<=n||n+i<=0?0:(s=u*r-i*f,s>0?n<0?(o=n*r,e=o/i-t):n>0?(o=n*f,e=o/u-t):e=-t:u<n+i?(o=(u-n)*r,e=f-(t+o/i)):u>n+i?(o=(i+n)*f,e=o/u-(t+r)):e=f-(t+r),e>0?e:0)};mxCompactTreeLayout.prototype.bridge=function(n,t,i,r,u,f){var s=u+r.dx-t,e=0,h=0,o;return r.dx==0?e=r.dy:(h=s*r.dy,e=h/r.dx),o=this.createLine(s,e,r.next),n.next=this.createLine(0,f+r.dy-e-i,o),o};mxCompactTreeLayout.prototype.createNode=function(n){var t={},i;return t.cell=n,t.x=0,t.y=0,t.width=0,t.height=0,i=this.getVertexBounds(n),i!=null&&(this.isHorizontal()?(t.width=i.height,t.height=i.width):(t.width=i.width,t.height=i.height)),t.offsetX=0,t.offsetY=0,t.contour={},t};mxCompactTreeLayout.prototype.apply=function(n,t){var e=this.graph.getModel(),r=n.cell,i=e.getGeometry(r),u,f;return r!=null&&i!=null&&(this.isVertexMovable(r)&&(i=this.setVertexLocation(r,n.x,n.y),this.resizeParent&&(u=e.getParent(r),f=mxCellPath.create(u),this.parentsChanged[f]==null&&(this.parentsChanged[f]=u))),t=t==null?new mxRectangle(i.x,i.y,i.width,i.height):new mxRectangle(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.x+t.width,i.x+i.width),Math.max(t.y+t.height,i.y+i.height))),t};mxCompactTreeLayout.prototype.createLine=function(n,t,i){var r={};return r.dx=n,r.dy=t,r.next=i,r};mxCompactTreeLayout.prototype.adjustParents=function(){var n=[];for(var t in this.parentsChanged)n.push(this.parentsChanged[t]);this.arrangeGroups(mxUtils.sortCells(n,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(n){this.processNodeOutgoing(n);for(var t=n.child;t!=null;)this.localEdgeProcessing(t),t=t.next};mxCompactTreeLayout.prototype.processNodeOutgoing=function(n){for(var f=n.child,k=n.cell,o=0,a=[],y,s,p,w,h,e,l;f!=null;)o++,y=f.x,this.horizontal&&(y=f.y),a.push(new WeightedCellSorter(f,y)),f=f.next;a.sort(WeightedCellSorter.prototype.compare);s=n.width;p=(o+1)*this.prefHozEdgeSep;s>p+2*this.prefHozEdgeSep&&(s-=2*this.prefHozEdgeSep);w=s/o;h=w/2;s>p+2*this.prefHozEdgeSep&&(h+=this.prefHozEdgeSep);var c=this.minEdgeJetty-this.prefVertEdgeOff,d=0,t=this.getVertexBounds(k);for(f=n.child,e=0;e<a.length;e++){var g=a[e].cell.cell,v=this.getVertexBounds(g),b=this.graph.getEdgesBetween(k,g,!1),u=[],i=0,r=0;for(l=0;l<b.length;l++)this.horizontal?(i=t.x+t.width,r=t.y+h,u.push(new mxPoint(i,r)),i=t.x+t.width+c,u.push(new mxPoint(i,r)),r=v.y+v.height/2,u.push(new mxPoint(i,r)),this.setEdgePoints(b[l],u)):(i=t.x+h,r=t.y+t.height,u.push(new mxPoint(i,r)),r=t.y+t.height+c,u.push(new mxPoint(i,r)),i=v.x+v.width/2,u.push(new mxPoint(i,r)),this.setEdgePoints(b[l],u));e<o/2?c+=this.prefVertEdgeOff:e>o/2&&(c-=this.prefVertEdgeOff);h+=w;d=Math.max(d,c)}};WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(n,t){return n!=null&&t!=null?t.weightedValue>n.weightedValue?1:t.weightedValue<n.weightedValue?-1:t.nudge?1:-1:0};mxUtils.extend(mxRadialTreeLayout,mxCompactTreeLayout);mxRadialTreeLayout.prototype.angleOffset=.5;mxRadialTreeLayout.prototype.rootx=0;mxRadialTreeLayout.prototype.rooty=0;mxRadialTreeLayout.prototype.levelDistance=10;mxRadialTreeLayout.prototype.nodeDistance=20;mxRadialTreeLayout.prototype.autoRadius=!1;mxRadialTreeLayout.prototype.sortEdges=!1;mxRadialTreeLayout.prototype.rowMinX=[];mxRadialTreeLayout.prototype.rowMaxX=[];mxRadialTreeLayout.prototype.rowMinCenX=[];mxRadialTreeLayout.prototype.rowMaxCenX=[];mxRadialTreeLayout.prototype.rowRadi=[];mxRadialTreeLayout.prototype.row=[];mxRadialTreeLayout.prototype.isVertexIgnored=function(n){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||this.graph.getConnections(n).length==0};mxRadialTreeLayout.prototype.execute=function(n){var e,o,v,f,h,c,y,p,u,s,k,d,t,i;this.parent=n;this.useBoundingBox=!1;this.edgeRouting=!1;this.levelDistance=120;this.nodeDistance=10;mxCompactTreeLayout.prototype.execute.apply(this,arguments);e=null;o=this.getVertexBounds(this.root);this.centerX=o.x+o.width/2;this.centerY=o.y+o.height/2;for(v in this.visited)f=this.getVertexBounds(this.visited[v]),e=e!=null?e:f.clone(),e.add(f);for(this.calcRowDims([this.node],0),h=0,c=0,t=0;t<this.row.length;t++)y=(this.centerX-this.rowMinX[t]-this.nodeDistance)/this.rowRadi[t],p=(this.rowMaxX[t]-this.centerX-this.nodeDistance)/this.rowRadi[t],h=Math.max(h,y),c=Math.max(c,p);for(t=0;t<this.row.length;t++){var w=this.centerX-this.nodeDistance-h*this.rowRadi[t],g=this.centerX+this.nodeDistance+c*this.rowRadi[t],nt=g-w;for(i=0;i<this.row[t].length;i++){var u=this.row[t],r=u[i],f=this.getVertexBounds(r.cell),tt=(f.x+f.width/2-w)/nt,it=2*Math.PI*tt;r.theta=it}}for(t=this.row.length-2;t>=0;t--)for(u=this.row[t],i=0;i<u.length;i++){for(var r=u[i],l=r.child,a=0,b=0;l!=null;)b+=l.theta,a++,l=l.next;a>0&&(s=b/a,s>r.theta&&i<u.length-1?(k=u[i+1].theta,r.theta=Math.min(s,k-Math.PI/10)):s<r.theta&&i>0&&(d=u[i-1].theta,r.theta=Math.max(s,d+Math.PI/10)))}for(t=0;t<this.row.length;t++)for(i=0;i<this.row[t].length;i++){var u=this.row[t],r=u[i],f=this.getVertexBounds(r.cell);this.setVertexLocation(r.cell,this.centerX-f.width/2+this.rowRadi[t]*Math.cos(r.theta),this.centerY-f.height/2+this.rowRadi[t]*Math.sin(r.theta))}};mxRadialTreeLayout.prototype.calcRowDims=function(n,t){var u,r,i,f;if(n!=null&&n.length!=0){for(this.rowMinX[t]=this.centerX,this.rowMaxX[t]=this.centerX,this.rowMinCenX[t]=this.centerX,this.rowMaxCenX[t]=this.centerX,this.row[t]=[],u=!1,r=0;r<n.length;r++)for(i=n[r].child;i!=null;)f=i.cell,vertexBounds=this.getVertexBounds(f),this.rowMinX[t]=Math.min(vertexBounds.x,this.rowMinX[t]),this.rowMaxX[t]=Math.max(vertexBounds.x+vertexBounds.width,this.rowMaxX[t]),this.rowMinCenX[t]=Math.min(vertexBounds.x+vertexBounds.width/2,this.rowMinCenX[t]),this.rowMaxCenX[t]=Math.max(vertexBounds.x+vertexBounds.width/2,this.rowMaxCenX[t]),this.rowRadi[t]=vertexBounds.y-this.getVertexBounds(this.root).y,i.child!=null&&(u=!0),this.row[t].push(i),i=i.next;u&&this.calcRowDims(this.row[t],t+1)}};mxFastOrganicLayout.prototype=new mxGraphLayout;mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout;mxFastOrganicLayout.prototype.useInputOrigin=!0;mxFastOrganicLayout.prototype.resetEdges=!0;mxFastOrganicLayout.prototype.disableEdgeStyle=!0;mxFastOrganicLayout.prototype.forceConstant=50;mxFastOrganicLayout.prototype.forceConstantSquared=0;mxFastOrganicLayout.prototype.minDistanceLimit=2;mxFastOrganicLayout.prototype.maxDistanceLimit=500;mxFastOrganicLayout.prototype.minDistanceLimitSquared=4;mxFastOrganicLayout.prototype.initialTemp=200;mxFastOrganicLayout.prototype.temperature=0;mxFastOrganicLayout.prototype.maxIterations=0;mxFastOrganicLayout.prototype.iteration=0;mxFastOrganicLayout.prototype.vertexArray;mxFastOrganicLayout.prototype.dispX;mxFastOrganicLayout.prototype.dispY;mxFastOrganicLayout.prototype.cellLocation;mxFastOrganicLayout.prototype.radius;mxFastOrganicLayout.prototype.radiusSquared;mxFastOrganicLayout.prototype.isMoveable;mxFastOrganicLayout.prototype.neighbours;mxFastOrganicLayout.prototype.indices;mxFastOrganicLayout.prototype.allowedToRun=!0;mxFastOrganicLayout.prototype.isVertexIgnored=function(n){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||this.graph.getConnections(n).length==0};mxFastOrganicLayout.prototype.execute=function(n){var b=this.graph.getModel(),c,v,a,r,f,l,y,s,h,t,u,i,e,o,p,w;for(this.vertexArray=[],r=this.graph.getChildVertices(n),t=0;t<r.length;t++)this.isVertexIgnored(r[t])||this.vertexArray.push(r[t]);for(c=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,v=this.vertexArray.length,this.indices=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours=[],this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant,t=0;t<this.vertexArray.length;t++){u=this.vertexArray[t];this.cellLocation[t]=[];l=mxCellPath.create(u);this.indices[l]=t;var i=this.getVertexBounds(u),k=i.width,d=i.height,e=i.x,o=i.y;this.cellLocation[t][0]=e+k/2;this.cellLocation[t][1]=o+d/2;this.radius[t]=Math.min(k,d);this.radiusSquared[t]=this.radius[t]*this.radius[t]}b.beginUpdate();try{for(t=0;t<v;t++)for(this.dispX[t]=0,this.dispY[t]=0,this.isMoveable[t]=this.isVertexMovable(this.vertexArray[t]),a=this.graph.getConnections(this.vertexArray[t],n),r=this.graph.getOpposites(a,this.vertexArray[t]),this.neighbours[t]=[],f=0;f<r.length;f++)this.resetEdges&&this.graph.resetEdge(a[f]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(a[f],!1),l=mxCellPath.create(r[f]),y=this.indices[l],this.neighbours[t][f]=y!=null?y:t;for(this.temperature=this.initialTemp,this.maxIterations==0&&(this.maxIterations=20*Math.sqrt(v)),this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;this.calcRepulsion();this.calcAttraction();this.calcPositions();this.reduceTemperature()}for(s=null,h=null,t=0;t<this.vertexArray.length;t++)u=this.vertexArray[t],this.isVertexMovable(u)&&(i=this.getVertexBounds(u),i!=null&&(this.cellLocation[t][0]-=i.width/2,this.cellLocation[t][1]-=i.height/2,e=this.graph.snap(this.cellLocation[t][0]),o=this.graph.snap(this.cellLocation[t][1]),this.setVertexLocation(u,e,o),s=s==null?e:Math.min(s,e),h=h==null?o:Math.min(h,o)));p=-(s||0)+1;w=-(h||0)+1;c!=null&&(p+=c.x,w+=c.y);this.graph.moveCells(this.vertexArray,p,w)}finally{b.endUpdate()}};mxFastOrganicLayout.prototype.calcPositions=function(){for(var t,i,r,n=0;n<this.vertexArray.length;n++)this.isMoveable[n]&&(t=Math.sqrt(this.dispX[n]*this.dispX[n]+this.dispY[n]*this.dispY[n]),t<.001&&(t=.001),i=this.dispX[n]/t*Math.min(t,this.temperature),r=this.dispY[n]/t*Math.min(t,this.temperature),this.dispX[n]=0,this.dispY[n]=0,this.cellLocation[n][0]+=i,this.cellLocation[n][1]+=r)};mxFastOrganicLayout.prototype.calcAttraction=function(){for(var i,t,n=0;n<this.vertexArray.length;n++)for(i=0;i<this.neighbours[n].length;i++)if(t=this.neighbours[n][i],n!=t&&this.isMoveable[n]&&this.isMoveable[t]){var u=this.cellLocation[n][0]-this.cellLocation[t][0],f=this.cellLocation[n][1]-this.cellLocation[t][1],r=u*u+f*f-this.radiusSquared[n]-this.radiusSquared[t];r<this.minDistanceLimitSquared&&(r=this.minDistanceLimitSquared);var e=Math.sqrt(r),o=r/this.forceConstant,s=u/e*o,h=f/e*o;this.dispX[n]-=s;this.dispY[n]-=h;this.dispX[t]+=s;this.dispY[t]+=h}};mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var t,i,r,f,u,e=this.vertexArray.length,n=0;n<e;n++)for(t=n;t<e;t++){if(!this.allowedToRun)return;if(t!=n&&this.isMoveable[n]&&this.isMoveable[t]){if(i=this.cellLocation[n][0]-this.cellLocation[t][0],r=this.cellLocation[n][1]-this.cellLocation[t][1],i==0&&(i=.01+Math.random()),r==0&&(r=.01+Math.random()),f=Math.sqrt(i*i+r*r),u=f-this.radius[n]-this.radius[t],u>this.maxDistanceLimit)continue;u<this.minDistanceLimit&&(u=this.minDistanceLimit);var o=this.forceConstantSquared/u,s=i/f*o,h=r/f*o;this.dispX[n]+=s;this.dispY[n]+=h;this.dispX[t]-=s;this.dispY[t]-=h}}};mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)};mxCircleLayout.prototype=new mxGraphLayout;mxCircleLayout.prototype.constructor=mxCircleLayout;mxCircleLayout.prototype.radius=null;mxCircleLayout.prototype.moveCircle=!1;mxCircleLayout.prototype.x0=0;mxCircleLayout.prototype.y0=0;mxCircleLayout.prototype.resetEdges=!0;mxCircleLayout.prototype.disableEdgeStyle=!0;mxCircleLayout.prototype.execute=function(n){var f=this.graph.getModel(),e,t,i,h;f.beginUpdate();try{var o=0,r=null,u=null,s=[],c=f.getChildCount(n);for(e=0;e<c;e++)t=f.getChildAt(n,e),this.isVertexIgnored(t)?this.isEdgeIgnored(t)||(this.resetEdges&&this.graph.resetEdge(t),this.disableEdgeStyle&&this.setEdgeStyleEnabled(t,!1)):(s.push(t),i=this.getVertexBounds(t),r=r==null?i.y:Math.min(r,i.y),u=u==null?i.x:Math.min(u,i.x),o=Math.max(o,Math.max(i.width,i.height)));h=this.getRadius(s.length,o);this.moveCircle&&(u=this.x0,r=this.y0);this.circle(s,h,u,r)}finally{f.endUpdate()}};mxCircleLayout.prototype.getRadius=function(n,t){return Math.max(n*t/Math.PI,this.radius)};mxCircleLayout.prototype.circle=function(n,t,i,r){for(var f=n.length,e=2*Math.PI/f,u=0;u<f;u++)this.isVertexMovable(n[u])&&this.setVertexLocation(n[u],i+t+t*Math.sin(u*e),r+t+t*Math.cos(u*e))};mxParallelEdgeLayout.prototype=new mxGraphLayout;mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout;mxParallelEdgeLayout.prototype.spacing=20;mxParallelEdgeLayout.prototype.execute=function(n){var i=this.findParallels(n),r,t;this.graph.model.beginUpdate();try{for(r in i)t=i[r],t.length>1&&this.layout(t)}finally{this.graph.model.endUpdate()}};mxParallelEdgeLayout.prototype.findParallels=function(n){for(var r,t,f=this.graph.getModel(),i=[],e=f.getChildCount(n),u=0;u<e;u++)r=f.getChildAt(n,u),this.isEdgeIgnored(r)||(t=this.getEdgeId(r),t!=null&&(i[t]==null&&(i[t]=[]),i[t].push(r)));return i};mxParallelEdgeLayout.prototype.getEdgeId=function(n){var r=this.graph.getView(),t=r.getVisibleTerminal(n,!0),i=r.getVisibleTerminal(n,!1);return t!=null&&i!=null?(t=mxCellPath.create(t),i=mxCellPath.create(i),t>i?i+"-"+t:t+"-"+i):null};mxParallelEdgeLayout.prototype.layout=function(n){var h=n[0],c=this.graph.getView(),l=this.graph.getModel(),t=l.getGeometry(c.getVisibleTerminal(h,!0)),r=l.getGeometry(c.getVisibleTerminal(h,!1)),u,f,i;if(t==r)for(u=t.x+t.width+this.spacing,f=t.y+t.height/2,i=0;i<n.length;i++)this.route(n[i],u,f),u+=this.spacing;else if(t!=null&&r!=null){var a=t.x+t.width/2,v=t.y+t.height/2,w=r.x+r.width/2,b=r.y+r.height/2,e=w-a,o=b-v,s=Math.sqrt(e*e+o*o);if(s>0){var u=a+e/2,f=v+o/2,y=o*this.spacing/s,p=e*this.spacing/s;for(u+=y*(n.length-1)/2,f-=p*(n.length-1)/2,i=0;i<n.length;i++)this.route(n[i],u,f),u-=y,f+=p}}};mxParallelEdgeLayout.prototype.route=function(n,t,i){this.graph.isCellMovable(n)&&this.setEdgePoints(n,[new mxPoint(t,i)])};mxCompositeLayout.prototype=new mxGraphLayout;mxCompositeLayout.prototype.constructor=mxCompositeLayout;mxCompositeLayout.prototype.layouts=null;mxCompositeLayout.prototype.master=null;mxCompositeLayout.prototype.moveCell=function(){this.master!=null?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)};mxCompositeLayout.prototype.execute=function(){var t=this.graph.getModel(),n;t.beginUpdate();try{for(n=0;n<this.layouts.length;n++)this.layouts[n].execute.apply(this.layouts[n],arguments)}finally{t.endUpdate()}};mxEdgeLabelLayout.prototype=new mxGraphLayout;mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout;mxEdgeLabelLayout.prototype.execute=function(n){for(var t,i,o=this.graph.view,u=this.graph.getModel(),f=[],e=[],s=u.getChildCount(n),r=0;r<s;r++)t=u.getChildAt(n,r),i=o.getState(t),i!=null&&(this.isVertexIgnored(t)?this.isEdgeIgnored(t)||f.push(i):e.push(i));this.placeLabels(e,f)};mxEdgeLabelLayout.prototype.placeLabels=function(n,t){var e=this.graph.getModel(),r,i,u,f;e.beginUpdate();try{for(r=0;r<t.length;r++)if(i=t[r],i!=null&&i.text!=null&&i.text.boundingBox!=null)for(u=0;u<n.length;u++)f=n[u],f!=null&&this.avoid(i,f)}finally{e.endUpdate()}};mxEdgeLabelLayout.prototype.avoid=function(n,t){var e=this.graph.getModel(),r=n.text.boundingBox,i;if(mxUtils.intersects(r,t)){var o=-r.y-r.height+t.y,s=-r.y+t.y+t.height,u=Math.abs(o)<Math.abs(s)?o:s,h=-r.x-r.width+t.x,c=-r.x+t.x+t.width,f=Math.abs(h)<Math.abs(c)?h:c;Math.abs(f)<Math.abs(u)?u=0:f=0;i=e.getGeometry(n.cell);i!=null&&(i=i.clone(),i.offset!=null?(i.offset.x+=f,i.offset.y+=u):i.offset=new mxPoint(f,u),e.setGeometry(n.cell,i))}};mxGraphAbstractHierarchyCell.prototype.maxRank=-1;mxGraphAbstractHierarchyCell.prototype.minRank=-1;mxGraphAbstractHierarchyCell.prototype.x=null;mxGraphAbstractHierarchyCell.prototype.y=null;mxGraphAbstractHierarchyCell.prototype.width=0;mxGraphAbstractHierarchyCell.prototype.height=0;mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.temp=null;mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return!1};mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return!1};mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(){return null};mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(){return null};mxGraphAbstractHierarchyCell.prototype.setX=function(n,t){this.isVertex()?this.x[0]=t:this.isEdge()&&(this.x[n-this.minRank-1]=t)};mxGraphAbstractHierarchyCell.prototype.getX=function(n){return this.isVertex()?this.x[0]:this.isEdge()?this.x[n-this.minRank-1]:0};mxGraphAbstractHierarchyCell.prototype.setY=function(n,t){this.isVertex()?this.y[0]=t:this.isEdge()&&(this.y[n-this.minRank-1]=t)};mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode;mxGraphHierarchyNode.prototype.cell=null;mxGraphHierarchyNode.prototype.id=null;mxGraphHierarchyNode.prototype.connectsAsTarget=null;mxGraphHierarchyNode.prototype.connectsAsSource=null;mxGraphHierarchyNode.prototype.hashCode=!1;mxGraphHierarchyNode.prototype.getRankValue=function(){return this.maxRank};mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(n){var i,t;if(this.nextLayerConnectedCells==null)for(this.nextLayerConnectedCells=[],this.nextLayerConnectedCells[0]=[],i=0;i<this.connectsAsTarget.length;i++)t=this.connectsAsTarget[i],t.maxRank==-1||t.maxRank==n+1?this.nextLayerConnectedCells[0].push(t.source):this.nextLayerConnectedCells[0].push(t);return this.nextLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(n){var i,t;if(this.previousLayerConnectedCells==null)for(this.previousLayerConnectedCells=[],this.previousLayerConnectedCells[0]=[],i=0;i<this.connectsAsSource.length;i++)t=this.connectsAsSource[i],t.minRank==-1||t.minRank==n-1?this.previousLayerConnectedCells[0].push(t.target):this.previousLayerConnectedCells[0].push(t);return this.previousLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.isVertex=function(){return!0};mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(){return this.temp[0]};mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(n,t){this.temp[0]=t};mxGraphHierarchyNode.prototype.isAncestor=function(n){if(n!=null&&this.hashCode!=null&&n.hashCode!=null&&this.hashCode.length<n.hashCode.length){if(this.hashCode==n.hashCode)return!0;if(this.hashCode==null||this.hashCode==null)return!1;for(var t=0;t<this.hashCode.length;t++)if(this.hashCode[t]!=n.hashCode[t])return!1;return!0}return!1};mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell};mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge;mxGraphHierarchyEdge.prototype.edges=null;mxGraphHierarchyEdge.prototype.ids=null;mxGraphHierarchyEdge.prototype.source=null;mxGraphHierarchyEdge.prototype.target=null;mxGraphHierarchyEdge.prototype.isReversed=!1;mxGraphHierarchyEdge.prototype.invert=function(){var n=this.source;this.source=this.target;this.target=n;this.isReversed=!this.isReversed};mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(n){if(this.nextLayerConnectedCells==null){this.nextLayerConnectedCells=[];for(var t=0;t<this.temp.length;t++)this.nextLayerConnectedCells[t]=[],t==this.temp.length-1?this.nextLayerConnectedCells[t].push(this.source):this.nextLayerConnectedCells[t].push(this)}return this.nextLayerConnectedCells[n-this.minRank-1]};mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(n){if(this.previousLayerConnectedCells==null){this.previousLayerConnectedCells=[];for(var t=0;t<this.temp.length;t++)this.previousLayerConnectedCells[t]=[],t==0?this.previousLayerConnectedCells[t].push(this.target):this.previousLayerConnectedCells[t].push(this)}return this.previousLayerConnectedCells[n-this.minRank-1]};mxGraphHierarchyEdge.prototype.isEdge=function(){return!0};mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(n){return this.temp[n-this.minRank-1]};mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(n,t){this.temp[n-this.minRank-1]=t};mxGraphHierarchyEdge.prototype.getCoreCell=function(){return this.edges!=null&&this.edges.length>0?this.edges[0]:null};mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=1e8;mxGraphHierarchyModel.prototype.tightenToSource=!1;mxGraphHierarchyModel.prototype.createInternalCells=function(n,t,i){for(var c,s,f,u,l,e,h,o,a=n.getGraph(),r=0;r<t.length;r++){for(i[r]=new mxGraphHierarchyNode(t[r]),this.vertexMapper.put(t[r],i[r]),c=n.getEdges(t[r]),i[r].connectsAsSource=[],s=0;s<c.length;s++)if(f=n.getVisibleTerminal(c[s],!1),f!=t[r]&&n.graph.model.isVertex(f)&&!n.isVertexIgnored(f)&&(u=n.getEdgesBetween(t[r],f,!1),l=n.getEdgesBetween(t[r],f,!0),u!=null&&u.length>0&&this.edgeMapper.get(u[0])==null&&l.length*2>=u.length)){for(e=new mxGraphHierarchyEdge(u),h=0;h<u.length;h++)o=u[h],this.edgeMapper.put(o,e),a.resetEdge(o),n.disableEdgeStyle&&(n.setEdgeStyleEnabled(o,!1),n.setOrthogonalEdge(o,!0));e.source=i[r];mxUtils.indexOf(i[r].connectsAsSource,e)<0&&i[r].connectsAsSource.push(e)}i[r].temp[0]=0}};mxGraphHierarchyModel.prototype.initialRank=function(){var i=[],f,c,t,e,s,l,o,a,n,h,r,u;if(this.roots!=null)for(n=0;n<this.roots.length;n++)t=this.vertexMapper.get(this.roots[n]),t!=null&&i.push(t);for(f=this.vertexMapper.getValues(),n=0;n<f.length;n++)f[n].temp[0]=-1;for(c=i.slice();i.length>0;){for(t=i[0],e=t.connectsAsTarget,s=t.connectsAsSource,l=!0,o=this.SOURCESCANSTARTRANK,n=0;n<e.length;n++)if(r=e[n],r.temp[0]==5270620)u=r.source,o=Math.min(o,u.temp[0]-1);else{l=!1;break}if(l){if(t.temp[0]=o,this.maxRank=Math.min(this.maxRank,o),s!=null)for(n=0;n<s.length;n++)r=s[n],r.temp[0]=5270620,u=r.target,u.temp[0]==-1&&(i.push(u),u.temp[0]=-2);i.shift()}else if(a=i.shift(),i.push(t),a==t&&i.length==1)break}for(n=0;n<f.length;n++)f[n].temp[0]-=this.maxRank;for(n=0;n<c.length;n++){var t=c[n],v=0,e=t.connectsAsSource;for(h=0;h<e.length;h++)r=e[h],u=r.target,t.temp[0]=Math.max(v,u.temp[0]+1),v=t.temp[0]}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};mxGraphHierarchyModel.prototype.fixRanks=function(){var t=[],i,r,n,u,f;for(this.ranks=[],n=0;n<this.maxRank+1;n++)t[n]=[],this.ranks[n]=t[n];if(i=null,this.roots!=null)for(r=this.roots,i=[],n=0;n<r.length;n++)u=r[n],f=this.vertexMapper.get(u),i[n]=f;this.visit(function(n,i,r,u,f){var o,e;if(f==0&&i.maxRank<0&&i.minRank<0&&(t[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=t[i.maxRank].length-1),n!=null&&r!=null&&(o=n.maxRank-i.maxRank,o>1))for(r.maxRank=n.maxRank,r.minRank=i.maxRank,r.temp=[],r.x=[],r.y=[],e=r.minRank+1;e<r.maxRank;e++)t[e].push(r),r.setGeneralPurposeVariable(e,t[e].length-1)},i,!1,null)};mxGraphHierarchyModel.prototype.visit=function(n,t,i,r){var f,u;if(t!=null){for(f=0;f<t.length;f++)u=t[f],u!=null&&(r==null&&(r={}),i?(u.hashCode=[],u.hashCode[0]=this.dfsCount,u.hashCode[1]=f,this.extendedDfs(null,u,null,n,r,u.hashCode,f,0)):this.dfs(null,u,null,n,r,0));this.dfsCount++}};mxGraphHierarchyModel.prototype.dfs=function(n,t,i,r,u,f){var o,s,e,h,c;if(t!=null)if(o=t.id,u[o]==null)for(u[o]=t,r(n,t,i,f,0),s=t.connectsAsSource.slice(),e=0;e<s.length;e++)h=s[e],c=h.target,this.dfs(t,c,h,r,u,f+1);else r(n,t,i,f,1)};mxGraphHierarchyModel.prototype.extendedDfs=function(n,t,i,r,u,f,e,o){var a,h,c,s,l,v;if(t!=null)if(n!=null&&(t.hashCode==null||t.hashCode[0]!=n.hashCode[0])&&(a=n.hashCode.length+1,t.hashCode=n.hashCode.slice(),t.hashCode[a-1]=e),h=t.id,u[h]==null)for(u[h]=t,r(n,t,i,o,0),c=t.connectsAsSource.slice(),s=0;s<c.length;s++)l=c[s],v=l.target,this.extendedDfs(t,v,l,r,u,t.hashCode,s,o+1);else r(n,t,i,o,1)};mxSwimlaneModel.prototype.maxRank=null;mxSwimlaneModel.prototype.vertexMapper=null;mxSwimlaneModel.prototype.edgeMapper=null;mxSwimlaneModel.prototype.ranks=null;mxSwimlaneModel.prototype.roots=null;mxSwimlaneModel.prototype.parent=null;mxSwimlaneModel.prototype.dfsCount=0;mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=1e8;mxSwimlaneModel.prototype.ranksPerGroup=null;mxSwimlaneModel.prototype.createInternalCells=function(n,t,i){for(var p,e,l,h,f,o,c,s,v=n.getGraph(),y=n.swimlanes,r=0;r<t.length;r++){for(i[r]=new mxGraphHierarchyNode(t[r]),p=mxCellPath.create(t[r]),this.vertexMapper[p]=i[r],i[r].swimlaneIndex=-1,e=0;e<y.length;e++)if(v.model.getParent(t[r])==y[e]){i[r].swimlaneIndex=e;break}for(l=n.getEdges(t[r]),i[r].connectsAsSource=[],h=0;h<l.length;h++)if(f=n.getVisibleTerminal(l[h],!1),f!=t[r]&&n.graph.model.isVertex(f)&&!n.isVertexIgnored(f)){var u=n.getEdgesBetween(t[r],f,!1),w=n.getEdgesBetween(t[r],f,!0),a=mxCellPath.create(u[0]);if(u!=null&&u.length>0&&this.edgeMapper[a]==null&&w.length*2>=u.length){for(o=new mxGraphHierarchyEdge(u),c=0;c<u.length;c++)s=u[c],a=mxCellPath.create(s),this.edgeMapper[a]=o,v.resetEdge(s),n.disableEdgeStyle&&(n.setEdgeStyleEnabled(s,!1),n.setOrthogonalEdge(s,!0));o.source=i[r];mxUtils.indexOf(i[r].connectsAsSource,o)<0&&i[r].connectsAsSource.push(o)}}i[r].temp[0]=0}};mxSwimlaneModel.prototype.initialRank=function(){var i,l,a,s,r,v,p,t,h,o,c,u,n,f,e,y;if(this.ranksPerGroup=[],i=[],l={},this.roots!=null)for(n=0;n<this.roots.length;n++)a=mxCellPath.create(this.roots[n]),t=this.vertexMapper[a],this.maxChainDfs(null,t,null,l,0),t!=null&&i.push(t);for(s=[],r=[],n=this.ranksPerGroup.length-1;n>=0;n--)s[n]=n==this.ranksPerGroup.length-1?0:r[n+1]+1,r[n]=s[n]+this.ranksPerGroup[n];this.maxRank=r[0];for(v in this.vertexMapper)t=this.vertexMapper[v],t.temp[0]=-1;for(p=i.slice();i.length>0;){for(t=i[0],h=t.connectsAsTarget,o=t.connectsAsSource,c=!0,u=r[0],n=0;n<h.length;n++)if(f=h[n],f.temp[0]==5270620)e=f.source,u=Math.min(u,e.temp[0]-1);else{c=!1;break}if(c){if(u>r[t.swimlaneIndex]&&(u=r[t.swimlaneIndex]),t.temp[0]=u,o!=null)for(n=0;n<o.length;n++)f=o[n],f.temp[0]=5270620,e=f.target,e.temp[0]==-1&&(i.push(e),e.temp[0]=-2);i.shift()}else if(y=i.shift(),i.push(t),y==t&&i.length==1)break}};mxSwimlaneModel.prototype.maxChainDfs=function(n,t,i,r,u){var h,e,c,o,s,f;if(t!=null&&(h=mxCellPath.create(t.cell),r[h]==null))for(r[h]=t,e=t.swimlaneIndex,(this.ranksPerGroup[e]==null||this.ranksPerGroup[e]<u)&&(this.ranksPerGroup[e]=u),c=t.connectsAsSource.slice(),o=0;o<c.length;o++)s=c[o],f=s.target,t.swimlaneIndex<f.swimlaneIndex?this.maxChainDfs(t,f,s,mxUtils.clone(r,null,!0),0):t.swimlaneIndex==f.swimlaneIndex&&this.maxChainDfs(t,f,s,mxUtils.clone(r,null,!0),u+1)};mxSwimlaneModel.prototype.fixRanks=function(){var t=[],i,r,n;for(this.ranks=[],n=0;n<this.maxRank+1;n++)t[n]=[],this.ranks[n]=t[n];if(i=null,this.roots!=null)for(r=this.roots,i=[],n=0;n<r.length;n++){var u=r[n],f=mxCellPath.create(u),e=this.vertexMapper[f];i[n]=e}this.visit(function(n,i,r,u,f){var o,e;if(f==0&&i.maxRank<0&&i.minRank<0&&(t[i.temp[0]]==null&&mxLog.show(),t[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=t[i.maxRank].length-1),n!=null&&r!=null&&(o=n.maxRank-i.maxRank,o>1))for(r.maxRank=n.maxRank,r.minRank=i.maxRank,r.temp=[],r.x=[],r.y=[],e=r.minRank+1;e<r.maxRank;e++)t[e].push(r),r.setGeneralPurposeVariable(e,t[e].length-1)},i,!1,null)};mxSwimlaneModel.prototype.visit=function(n,t,i,r){var f,u;if(t!=null){for(f=0;f<t.length;f++)u=t[f],u!=null&&(r==null&&(r={}),i?(u.hashCode=[],u.hashCode[0]=this.dfsCount,u.hashCode[1]=f,this.extendedDfs(null,u,null,n,r,u.hashCode,f,0)):this.dfs(null,u,null,n,r,0));this.dfsCount++}};mxSwimlaneModel.prototype.dfs=function(n,t,i,r,u,f){var o,s,e,h,c;if(t!=null)if(o=mxCellPath.create(t.cell),u[o]==null)for(u[o]=t,r(n,t,i,f,0),s=t.connectsAsSource.slice(),e=0;e<s.length;e++)h=s[e],c=h.target,this.dfs(t,c,h,r,u,f+1);else r(n,t,i,f,1)};mxSwimlaneModel.prototype.extendedDfs=function(n,t,i,r,u,f,e,o){var y,l,a,v,s,c,h;if(t!=null)if(n!=null&&(t.hashCode==null||t.hashCode[0]!=n.hashCode[0])&&(y=n.hashCode.length+1,t.hashCode=n.hashCode.slice(),t.hashCode[y-1]=e),l=mxCellPath.create(t.cell),u[l]==null){for(u[l]=t,r(n,t,i,o,0),a=t.connectsAsSource.slice(),v=t.connectsAsTarget.slice(),s=0;s<a.length;s++)c=a[s],h=c.target,h==null&&mxLog.show(),t.swimlaneIndex<=h.swimlaneIndex&&this.extendedDfs(t,h,c,r,u,t.hashCode,s,o+1);for(s=0;s<v.length;s++)c=v[s],h=c.source,t.swimlaneIndex<h.swimlaneIndex&&this.extendedDfs(t,h,c,r,u,t.hashCode,s,o+1)}else r(n,t,i,o,1)};mxHierarchicalLayoutStage.prototype.execute=function(){};mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage;mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction;mxMedianHybridCrossingReduction.prototype.layout=null;mxMedianHybridCrossingReduction.prototype.maxIterations=24;mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null;mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0;mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0;mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2;mxMedianHybridCrossingReduction.prototype.execute=function(){var i=this.layout.getModel(),e,o,h,u,r,f,c,s,n,t;for(this.nestedBestRanks=[],n=0;n<i.ranks.length;n++)this.nestedBestRanks[n]=i.ranks[n].slice();for(e=0,o=this.calculateCrossings(i),n=0;n<this.maxIterations&&e<this.maxNoImprovementIterations;n++){if(this.weightedMedian(n,i),this.transpose(n,i),h=this.calculateCrossings(i),h<o)for(o=h,e=0,t=0;t<this.nestedBestRanks.length;t++)for(u=i.ranks[t],r=0;r<u.length;r++)f=u[r],this.nestedBestRanks[t][f.getGeneralPurposeVariable(t)]=f;else for(e++,t=0;t<this.nestedBestRanks.length;t++)for(u=i.ranks[t],r=0;r<u.length;r++)f=u[r],f.setGeneralPurposeVariable(t,r);if(o==0)break}for(c=[],s=[],n=0;n<i.maxRank+1;n++)s[n]=[],c[n]=s[n];for(n=0;n<this.nestedBestRanks.length;n++)for(t=0;t<this.nestedBestRanks[n].length;t++)s[n].push(this.nestedBestRanks[n][t]);i.ranks=c};mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(n){for(var r=n.ranks.length,i=0,t=1;t<r;t++)i+=this.calculateRankCrossing(t,n);return i};mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(n,t){for(var o,y,p,f,u,w,e,b,r,c=0,l=t.ranks[n],k=t.ranks[n-1],s=[],i=0;i<l.length;i++){var a=l[i],d=a.getGeneralPurposeVariable(n),v=a.getPreviousLayerConnectedCells(n),h=[];for(o=0;o<v.length;o++)y=v[o],p=y.getGeneralPurposeVariable(n-1),h.push(p);h.sort(function(n,t){return n-t});s[d]=h}for(f=[],i=0;i<s.length;i++)f=f.concat(s[i]);for(u=1;u<k.length;)u<<=1;for(w=2*u-1,u-=1,e=[],i=0;i<w;++i)e[i]=0;for(i=0;i<f.length;i++)for(b=f[i],r=b+u,++e[r];r>0;)r%2&&(c+=e[r+1]),r=r-1>>1,++e[r];return c};mxMedianHybridCrossingReduction.prototype.transpose=function(n,t){for(var nt=!0,rt=0,tt,r,k,d,it,g,u,w,b,i,f,ut;nt&&rt++<10;)for(tt=n%2==1&&rt%2==1,nt=!1,r=0;r<t.ranks.length;r++){for(k=t.ranks[r],d=[],u=0;u<k.length;u++)it=k[u],g=it.getGeneralPurposeVariable(r),g<0&&(g=u),d[g]=it;var a=null,v=null,y=null,p=null,e=null,o=null,s=null,h=null,c=null,l=null;for(u=0;u<k.length-1;u++){if(u==0){for(c=d[u],a=c.getNextLayerConnectedCells(r),v=c.getPreviousLayerConnectedCells(r),e=[],o=[],i=0;i<a.length;i++)e[i]=a[i].getGeneralPurposeVariable(r+1);for(i=0;i<v.length;i++)o[i]=v[i].getGeneralPurposeVariable(r-1)}else a=y,v=p,e=s,o=h,c=l;for(l=d[u+1],y=l.getNextLayerConnectedCells(r),p=l.getPreviousLayerConnectedCells(r),s=[],h=[],i=0;i<y.length;i++)s[i]=y[i].getGeneralPurposeVariable(r+1);for(i=0;i<p.length;i++)h[i]=p[i].getGeneralPurposeVariable(r-1);for(w=0,b=0,i=0;i<e.length;i++)for(f=0;f<s.length;f++)e[i]>s[f]&&w++,e[i]<s[f]&&b++;for(i=0;i<o.length;i++)for(f=0;f<h.length;f++)o[i]>h[f]&&w++,o[i]<h[f]&&b++;(b<w||b==w&&tt)&&(ut=c.getGeneralPurposeVariable(r),c.setGeneralPurposeVariable(r,l.getGeneralPurposeVariable(r)),l.setGeneralPurposeVariable(r,ut),y=a,p=v,s=e,h=o,l=c,tt||(nt=!0))}}};mxMedianHybridCrossingReduction.prototype.weightedMedian=function(n,t){var r=n%2==0,i;if(r)for(i=t.maxRank-1;i>=0;i--)this.medianRank(i,r);else for(i=1;i<t.maxRank;i++)this.medianRank(i,r)};mxMedianHybridCrossingReduction.prototype.medianRank=function(n,t){for(var u,f,h,r,o=this.nestedBestRanks[n].length,e=[],s=[],i=0;i<o;i++)r=this.nestedBestRanks[n][i],u=new MedianCellSorter,u.cell=r,f=t?r.getNextLayerConnectedCells(n):r.getPreviousLayerConnectedCells(n),h=t?n+1:n-1,f!=null&&f.length!=0?(u.medianValue=this.medianValue(f,h),e.push(u)):s[r.getGeneralPurposeVariable(n)]=!0;for(e.sort(MedianCellSorter.prototype.compare),i=0;i<o;i++)s[i]==null&&(r=e.shift().cell,r.setGeneralPurposeVariable(n,i))};mxMedianHybridCrossingReduction.prototype.medianValue=function(n,t){for(var e,i=[],r=0,f=0;f<n.length;f++)e=n[f],i[r++]=e.getGeneralPurposeVariable(t);if(i.sort(function(n,t){return n-t}),r%2==1)return i[Math.floor(r/2)];if(r==2)return(i[0]+i[1])/2;var u=r/2,o=i[u-1]-i[0],s=i[r-1]-i[u];return(i[u-1]*s+i[u]*o)/(o+s)};MedianCellSorter.prototype.medianValue=0;MedianCellSorter.prototype.cell=!1;MedianCellSorter.prototype.compare=function(n,t){return n!=null&&t!=null?t.medianValue>n.medianValue?-1:t.medianValue<n.medianValue?1:0:0};mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage;mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover;mxMinimumCycleRemover.prototype.layout=null;mxMinimumCycleRemover.prototype.execute=function(){for(var r,e,o,t=this.layout.getModel(),u={},f=t.vertexMapper.getValues(),i={},n=0;n<f.length;n++)i[f[n].id]=f[n];if(r=null,t.roots!=null)for(e=t.roots,r=[],n=0;n<e.length;n++)r[n]=t.vertexMapper.get(e[n]);t.visit(function(n,t,r){t.isAncestor(n)&&(r.invert(),mxUtils.remove(r,n.connectsAsSource),n.connectsAsTarget.push(r),mxUtils.remove(r,t.connectsAsTarget),t.connectsAsSource.push(r));u[t.id]=t;delete i[t.id]},r,!0,null);o=mxUtils.clone(u,null,!0);t.visit(function(n,t,r){t.isAncestor(n)&&(r.invert(),mxUtils.remove(r,n.connectsAsSource),t.connectsAsSource.push(r),n.connectsAsTarget.push(r),mxUtils.remove(r,t.connectsAsTarget));u[t.id]=t;delete i[t.id]},i,!0,o)};mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage;mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment;mxCoordinateAssignment.prototype.layout=null;mxCoordinateAssignment.prototype.intraCellSpacing=30;mxCoordinateAssignment.prototype.interRankCellSpacing=100;mxCoordinateAssignment.prototype.parallelEdgeSpacing=10;mxCoordinateAssignment.prototype.maxIterations=8;mxCoordinateAssignment.prototype.prefHozEdgeSep=5;mxCoordinateAssignment.prototype.prefVertEdgeOff=2;mxCoordinateAssignment.prototype.minEdgeJetty=12;mxCoordinateAssignment.prototype.channelBuffer=4;mxCoordinateAssignment.prototype.jettyPositions=null;mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH;mxCoordinateAssignment.prototype.initialX=null;mxCoordinateAssignment.prototype.limitX=null;mxCoordinateAssignment.prototype.currentXDelta=null;mxCoordinateAssignment.prototype.widestRank=null;mxCoordinateAssignment.prototype.rankTopY=null;mxCoordinateAssignment.prototype.rankBottomY=null;mxCoordinateAssignment.prototype.widestRankValue=null;mxCoordinateAssignment.prototype.rankWidths=null;mxCoordinateAssignment.prototype.rankY=null;mxCoordinateAssignment.prototype.fineTuning=!0;mxCoordinateAssignment.prototype.nextLayerConnectedCache=null;mxCoordinateAssignment.prototype.previousLayerConnectedCache=null;mxCoordinateAssignment.prototype.groupPadding=10;mxCoordinateAssignment.prototype.printStatus=function(){var r=this.layout.getModel(),n,i,t,u;for(mxLog.show(),mxLog.writeln("======Coord assignment debug======="),n=0;n<r.ranks.length;n++){for(mxLog.write("Rank ",n," : "),i=r.ranks[n],t=0;t<i.length;t++)u=i[t],mxLog.write(u.getGeneralPurposeVariable(n),"  ");mxLog.writeln()}mxLog.writeln("====================================")};mxCoordinateAssignment.prototype.execute=function(){var t,e,f,n,r,i,u;if(this.jettyPositions=Object(),t=this.layout.getModel(),this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),t),this.fineTuning&&this.minNode(t),e=1e8,this.fineTuning)for(f=0;f<this.maxIterations;f++){if(f!=0&&(this.medianPos(f,t),this.minNode(t)),this.currentXDelta<e){for(n=0;n<t.ranks.length;n++)for(r=t.ranks[n],i=0;i<r.length;i++)u=r[i],u.setX(n,u.getGeneralPurposeVariable(n));e=this.currentXDelta}else for(n=0;n<t.ranks.length;n++)for(r=t.ranks[n],i=0;i<r.length;i++)u=r[i],u.setGeneralPurposeVariable(n,u.getX(n));this.minPath(this.layout.getGraph(),t);this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),t)};mxCoordinateAssignment.prototype.minNode=function(n){for(var l,g,a,e,tt,h,ot,it,c,k,u,o=[],d=new mxDictionary,s=[],i=0;i<=n.maxRank;i++)for(s[i]=n.ranks[i],l=0;l<s[i].length;l++)g=s[i][l],a=new WeightedCellSorter(g,i),a.rankIndex=l,a.visited=!0,o.push(a),d.put(g,a);for(var st=o.length*10,rt=0,v=1;o.length>0&&rt<=st;){var y=o.shift(),r=y.cell,t=y.weightedValue,p=parseInt(y.rankIndex),w=r.getNextLayerConnectedCells(t),b=r.getPreviousLayerConnectedCells(t),ut=w.length,ft=b.length,ht=this.medianXValue(w,t+1),ct=this.medianXValue(b,t-1),et=ut+ft,nt=r.getGeneralPurposeVariable(t),f=nt;if(et>0&&(f=(ht*ut+ct*ft)/et),e=!1,f<nt-v?p==0?(r.setGeneralPurposeVariable(t,f),e=!0):(tt=s[t][p-1],h=tt.getGeneralPurposeVariable(t),h=h+tt.width/2+this.intraCellSpacing+r.width/2,h<f?(r.setGeneralPurposeVariable(t,f),e=!0):h<r.getGeneralPurposeVariable(t)-v&&(r.setGeneralPurposeVariable(t,h),e=!0)):f>nt+v&&(ot=s[t].length,p==ot-1?(r.setGeneralPurposeVariable(t,f),e=!0):(it=s[t][p+1],c=it.getGeneralPurposeVariable(t),c=c-it.width/2-this.intraCellSpacing-r.width/2,c>f?(r.setGeneralPurposeVariable(t,f),e=!0):c>r.getGeneralPurposeVariable(t)+v&&(r.setGeneralPurposeVariable(t,c),e=!0))),e){for(i=0;i<w.length;i++)k=w[i],u=d.get(k),u!=null&&u.visited==!1&&(u.visited=!0,o.push(u));for(i=0;i<b.length;i++)k=b[i],u=d.get(k),u!=null&&u.visited==!1&&(u.visited=!0,o.push(u))}y.visited=!1;rt++}};mxCoordinateAssignment.prototype.medianPos=function(n,t){var r=n%2==0,i;if(r)for(i=t.maxRank;i>0;i--)this.rankMedianPosition(i-1,t,i);else for(i=0;i<t.maxRank-1;i++)this.rankMedianPosition(i+1,t,i)};mxCoordinateAssignment.prototype.rankMedianPosition=function(n,t,i){for(var c,h,b,l,y,k,a,f,s,p,v=t.ranks[n],u=[],w={},r=0;r<v.length;r++)c=v[r],u[r]=new WeightedCellSorter,u[r].cell=c,u[r].rankIndex=r,w[c.id]=u[r],h=null,h=i<n?c.getPreviousLayerConnectedCells(n):c.getNextLayerConnectedCells(n),u[r].weightedValue=this.calculatedWeightedValue(c,h);for(u.sort(WeightedCellSorter.prototype.compare),r=0;r<u.length;r++){var d=0,e=u[r].cell,h=null,o=0;for(h=i<n?e.getPreviousLayerConnectedCells(n).slice():e.getNextLayerConnectedCells(n).slice(),h!=null&&(d=h.length,o=d>0?this.medianXValue(h,i):e.getGeneralPurposeVariable(n)),b=0,l=-1e8,f=u[r].rankIndex-1;f>=0;)s=w[v[f].id],s!=null&&(y=s.cell,s.visited?(l=y.getGeneralPurposeVariable(n)+y.width/2+this.intraCellSpacing+b+e.width/2,f=-1):(b+=y.width+this.intraCellSpacing,f--));for(k=0,a=1e8,f=u[r].rankIndex+1;f<u.length;)s=w[v[f].id],s!=null&&(p=s.cell,s.visited?(a=p.getGeneralPurposeVariable(n)-p.width/2-this.intraCellSpacing-k-e.width/2,f=u.length):(k+=p.width+this.intraCellSpacing,f++));o>=l&&o<=a?e.setGeneralPurposeVariable(n,o):o<l?(e.setGeneralPurposeVariable(n,l),this.currentXDelta+=l-o):o>a&&(e.setGeneralPurposeVariable(n,a),this.currentXDelta+=o-a);u[r].visited=!0}};mxCoordinateAssignment.prototype.calculatedWeightedValue=function(n,t){for(var u,i=0,r=0;r<t.length;r++)u=t[r],n.isVertex()&&u.isVertex()?i++:i+=n.isEdge()&&u.isEdge()?8:2;return i};mxCoordinateAssignment.prototype.medianXValue=function(n,t){var i,r;if(n.length==0)return 0;for(i=[],r=0;r<n.length;r++)i[r]=n[r].getGeneralPurposeVariable(t);if(i.sort(function(n,t){return n-t}),n.length%2==1)return i[Math.floor(n.length/2)];var u=n.length/2,f=i[u-1],e=i[u];return(f+e)/2};mxCoordinateAssignment.prototype.initialCoords=function(n,t){var i;for(this.calculateWidestRank(n,t),i=this.widestRank;i>=0;i--)i<t.maxRank&&this.rankCoordinates(i,n,t);for(i=this.widestRank+1;i<=t.maxRank;i++)i>0&&this.rankCoordinates(i,n,t)};mxCoordinateAssignment.prototype.rankCoordinates=function(n,t,i){for(var r,u,o,s=i.ranks[n],h=0,f=this.initialX+(this.widestRankValue-this.rankWidths[n])/2,c=!1,e=0;e<s.length;e++)r=s[e],r.isVertex()?(u=this.layout.getVertexBounds(r.cell),u!=null?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(r.width=u.width,r.height=u.height):(r.width=u.height,r.height=u.width):c=!0,h=Math.max(h,r.height)):r.isEdge()&&(o=1,r.edges!=null?o=r.edges.length:mxLog.warn("edge.edges is null"),r.width=(o-1)*this.parallelEdgeSpacing),f+=r.width/2,r.setX(n,f),r.setGeneralPurposeVariable(n,f),f+=r.width/2,f+=this.intraCellSpacing;c==!0&&mxLog.warn("At least one cell has no bounds")};mxCoordinateAssignment.prototype.calculateWidestRank=function(n,t){var o=-this.interRankCellSpacing,a=0,r,i,e,c,l,f,y;for(this.rankWidths=[],this.rankY=[],r=t.maxRank;r>=0;r--){var s=0,h=t.ranks[r],u=this.initialX,v=!1;for(f=0;f<h.length;f++)i=h[f],i.isVertex()?(e=this.layout.getVertexBounds(i.cell),e!=null?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(i.width=e.width,i.height=e.height):(i.width=e.height,i.height=e.width):v=!0,s=Math.max(s,i.height)):i.isEdge()&&(c=1,i.edges!=null?c=i.edges.length:mxLog.warn("edge.edges is null"),i.width=(c-1)*this.parallelEdgeSpacing),u+=i.width/2,i.setX(r,u),i.setGeneralPurposeVariable(r,u),u+=i.width/2,u+=this.intraCellSpacing,u>this.widestRankValue&&(this.widestRankValue=u,this.widestRank=r),this.rankWidths[r]=u;for(v==!0&&mxLog.warn("At least one cell has no bounds"),this.rankY[r]=o,l=s/2+a/2+this.interRankCellSpacing,a=s,this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?o+=l:o-=l,f=0;f<h.length;f++)y=h[f],y.setY(r,o)}};mxCoordinateAssignment.prototype.minPath=function(n,t){for(var i,a,f,r,v=t.edgeMapper.getValues(),c=0;c<v.length;c++)if(i=v[c],!(i.maxRank-i.minRank-1<1)){var y=i.getGeneralPurposeVariable(i.minRank+1),p=!0,l=0;for(r=i.minRank+2;r<i.maxRank;r++)a=i.getGeneralPurposeVariable(r),y!=a?(p=!1,y=a):l++;if(!p){var e=0,o=0,s=[],h=[],u=i.getGeneralPurposeVariable(i.minRank+1);for(r=i.minRank+1;r<i.maxRank-1;r++)f=i.getX(r+1),u==f?(s[r-i.minRank-1]=u,e++):this.repositionValid(t,i,r+1,u)?(s[r-i.minRank-1]=u,e++):(s[r-i.minRank-1]=f,u=f);for(u=i.getX(r),r=i.maxRank-1;r>i.minRank+1;r--)f=i.getX(r-1),u==f?(h[r-i.minRank-2]=u,o++):this.repositionValid(t,i,r-1,u)?(h[r-i.minRank-2]=u,o++):(h[r-i.minRank-2]=i.getX(r-1),u=f);if(o>l||e>l)if(o>=e)for(r=i.maxRank-2;r>i.minRank;r--)i.setX(r,h[r-i.minRank-1]);else if(e>o)for(r=i.minRank+2;r<i.maxRank;r++)i.setX(r,s[r-i.minRank-2])}}};mxCoordinateAssignment.prototype.repositionValid=function(n,t,i,r){for(var h,c,o,l,s,f=n.ranks[i],u=-1,e=0;e<f.length;e++)if(t==f[e]){u=e;break}return u<0?!1:(h=t.getGeneralPurposeVariable(i),r<h)?u==0?!0:(c=f[u-1],o=c.getGeneralPurposeVariable(i),o=o+c.width/2+this.intraCellSpacing+t.width/2,o<=r?!0:!1):r>h?u==f.length-1?!0:(l=f[u+1],s=l.getGeneralPurposeVariable(i),s=s-l.width/2-this.intraCellSpacing-t.width/2,s>=r?!0:!1):!0};mxCoordinateAssignment.prototype.setCellLocations=function(n,t){var r,u,i;for(this.rankTopY=[],this.rankBottomY=[],i=0;i<t.ranks.length;i++)this.rankTopY[i]=Number.MAX_VALUE,this.rankBottomY[i]=-Number.MAX_VALUE;for(r=t.vertexMapper.getValues(),i=0;i<r.length;i++)this.setVertexLocation(r[i]);for((this.layout.edgeStyle==mxHierarchicalEdgeStyle.ORTHOGONAL||this.layout.edgeStyle==mxHierarchicalEdgeStyle.POLYLINE||this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(t),u=t.edgeMapper.getValues(),i=0;i<u.length;i++)this.setEdgePosition(u[i])};mxCoordinateAssignment.prototype.localEdgeProcessing=function(n){for(var k,p,i,u,a,e,v,d,h,c,f,tt,t,ft,l,y,r=0;r<n.ranks.length;r++)for(k=n.ranks[r],p=0;p<k.length;p++)if(i=k[p],i.isVertex())for(u=i.getPreviousLayerConnectedCells(r),a=r-1,e=0;e<2;e++){if(a>-1&&a<n.ranks.length&&u!=null&&u.length>0){for(v=[],t=0;t<u.length;t++)d=new WeightedCellSorter(u[t],u[t].getX(a)),v.push(d);v.sort(WeightedCellSorter.prototype.compare);var w=i.x[0]-i.width/2,g=w+i.width,o=0,nt=0,s=[];for(t=0;t<v.length;t++)if(h=v[t].cell,h.isVertex())for(c=e==0?i.connectsAsSource:i.connectsAsTarget,f=0;f<c.length;f++)(c[f].source==h||c[f].target==h)&&(o+=c[f].edges.length,nt++,s.push(c[f]));else o+=h.edges.length,nt++,s.push(h);tt=(o+1)*this.prefHozEdgeSep;i.width>tt+2*this.prefHozEdgeSep&&(w+=this.prefHozEdgeSep,g-=this.prefHozEdgeSep);var et=g-w,it=et/o,rt=w+it/2,b=this.minEdgeJetty-this.prefVertEdgeOff,ut=0;for(t=0;t<s.length;t++){for(ft=s[t].edges.length,l=this.jettyPositions[s[t].ids[0]],l==null&&(l=[],this.jettyPositions[s[t].ids[0]]=l),t<o/2?b+=this.prefVertEdgeOff:t>o/2&&(b-=this.prefVertEdgeOff),y=0;y<ft;y++)l[y*4+e*2]=rt,rt+=it,l[y*4+e*2+1]=b;ut=Math.max(ut,b)}}u=i.getNextLayerConnectedCells(r);a=r+1}};mxCoordinateAssignment.prototype.setEdgePosition=function(n){var s=0,e,o,k,i,w,g,ot,v;if(n.temp[0]!=101207){e=n.maxRank;o=n.minRank;e==o&&(e=n.source.maxRank,o=n.target.minRank);var p=0,h=this.jettyPositions[n.ids[0]],ht=n.isReversed?n.target.cell:n.source.cell,c=this.layout.graph,l=this.orientation==mxConstants.DIRECTION_EAST||this.orientation==mxConstants.DIRECTION_SOUTH;for(k=0;k<n.edges.length;k++){var a=n.edges[k],rt=this.layout.getVisibleTerminal(a,!0),t=[],r=n.isReversed;if(rt!=ht&&(r=!r),h!=null){var d=r?2:0,f=r?l?this.rankBottomY[o]:this.rankTopY[o]:l?this.rankTopY[e]:this.rankBottomY[e],u=h[p*4+1+d];r!=l&&(u=-u);f+=u;i=h[p*4+d];w=c.model.getTerminal(a,!0);this.layout.isPort(w)&&c.model.getParent(w)==rt&&(v=c.view.getState(w),i=v!=null?v.x:rt.geometry.x+n.source.width*w.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(t.push(new mxPoint(i,f)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&t.push(new mxPoint(i,f+u))):(t.push(new mxPoint(f,i)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&t.push(new mxPoint(f+u,i)))}var ft=n.x.length-1,et=-1,ut=-1,y=n.maxRank-1;for(r&&(ft=0,et=n.x.length,ut=1,y=n.minRank+1),g=ft;n.maxRank!=n.minRank&&g!=et;g+=ut){var b=n.x[g]+s,nt=(this.rankTopY[y]+this.rankBottomY[y+1])/2,tt=(this.rankTopY[y-1]+this.rankBottomY[y])/2;r&&(ot=nt,nt=tt,tt=ot);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(t.push(new mxPoint(b,nt)),t.push(new mxPoint(b,tt))):(t.push(new mxPoint(nt,b)),t.push(new mxPoint(tt,b)));this.limitX=Math.max(this.limitX,b);y+=ut}if(h!=null){var d=r?2:0,ct=r?l?this.rankTopY[e]:this.rankBottomY[e]:l?this.rankBottomY[o]:this.rankTopY[o],u=h[p*4+3-d];r!=l&&(u=-u);var f=ct-u,i=h[p*4+2-d],it=c.model.getTerminal(a,!1),st=this.layout.getVisibleTerminal(a,!1);this.layout.isPort(it)&&c.model.getParent(it)==st&&(v=c.view.getState(it),i=v!=null?v.x:st.geometry.x+n.target.width*it.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&t.push(new mxPoint(i,f-u)),t.push(new mxPoint(i,f))):(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&t.push(new mxPoint(f-u,i)),t.push(new mxPoint(f,i)))}n.isReversed&&this.processReversedEdge(n,a);this.layout.setEdgePoints(a,t);s=s==0?this.parallelEdgeSpacing:s>0?-s:-s+this.parallelEdgeSpacing;p++}n.temp[0]=101207}};mxCoordinateAssignment.prototype.setVertexLocation=function(n){var r=n.cell,i=n.x[0]-n.width/2,t=n.y[0]-n.height/2;this.rankTopY[n.minRank]=Math.min(this.rankTopY[n.minRank],t);this.rankBottomY[n.minRank]=Math.max(this.rankBottomY[n.minRank],t+n.height);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(r,i,t):this.layout.setVertexLocation(r,t,i);this.limitX=Math.max(this.limitX,i+n.width)};mxCoordinateAssignment.prototype.processReversedEdge=function(){};WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(n,t){return n!=null&&t!=null?t.weightedValue>n.weightedValue?-1:t.weightedValue<n.weightedValue?1:t.nudge?-1:1:0};mxSwimlaneOrdering.prototype=new mxHierarchicalLayoutStage;mxSwimlaneOrdering.prototype.constructor=mxSwimlaneOrdering;mxSwimlaneOrdering.prototype.layout=null;mxSwimlaneOrdering.prototype.execute=function(){var n=this.layout.getModel(),f={},e=mxUtils.clone(n.vertexMapper,null,!0),i=null,r,t,u;if(n.roots!=null)for(r=n.roots,i=[],t=0;t<r.length;t++)u=mxCellPath.create(r[t]),i[t]=n.vertexMapper[u];n.visit(function(n,t,i){var u=n!=null&&n.swimlaneIndex==t.swimlaneIndex&&t.isAncestor(n),o=n!=null&&i!=null&&n.swimlaneIndex<t.swimlaneIndex&&i.source==t,r;u?(i.invert(),mxUtils.remove(i,n.connectsAsSource),t.connectsAsSource.push(i),n.connectsAsTarget.push(i),mxUtils.remove(i,t.connectsAsTarget)):o&&(i.invert(),mxUtils.remove(i,n.connectsAsTarget),t.connectsAsTarget.push(i),n.connectsAsSource.push(i),mxUtils.remove(i,t.connectsAsSource));r=mxCellPath.create(t.cell);f[r]=t;delete e[r]},i,!0,null)};mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxHierarchicalLayout.prototype=new mxGraphLayout;mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=!1;mxCompactTreeLayout.prototype.maintainParentLocation=!1;mxHierarchicalLayout.prototype.moveParent=!1;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxHierarchicalLayout.prototype.fineTuning=!0;mxHierarchicalLayout.prototype.tightenToSource=!0;mxHierarchicalLayout.prototype.disableEdgeStyle=!0;mxHierarchicalLayout.prototype.traverseAncestors=!0;mxHierarchicalLayout.prototype.model=null;mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.edgeSourceTermCache=null;mxHierarchicalLayout.prototype.edgesTargetTermCache=null;mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxHierarchicalLayout.prototype.getModel=function(){return this.model};mxHierarchicalLayout.prototype.execute=function(n,t){var r,f,u,e,i;if(this.parent=n,r=this.graph.model,this.edgesCache=new mxDictionary,this.edgeSourceTermCache=new mxDictionary,this.edgesTargetTermCache=new mxDictionary,t==null||t instanceof Array||(t=[t]),t!=null||n!=null){if(this.parentX=null,this.parentY=null,n!=this.root&&r.isVertex(n)!=null&&this.maintainParentLocation&&(i=this.graph.getCellGeometry(n),i!=null&&(this.parentX=i.x,this.parentY=i.y)),t!=null){for(f=[],u=0;u<t.length;u++)e=n!=null?r.isAncestor(n,t[u]):!0,e&&r.isVertex(t[u])&&f.push(t[u]);this.roots=f}r.beginUpdate();try{this.run(n);this.resizeParent&&!this.graph.isCellCollapsed(n)&&this.graph.updateGroupBounds([n],this.parentBorder,this.moveParent);this.parentX!=null&&this.parentY!=null&&(i=this.graph.getCellGeometry(n),i!=null&&(i=i.clone(),i.x=this.parentX,i.y=this.parentY,r.setGeometry(n,i)))}finally{r.endUpdate()}}};mxHierarchicalLayout.prototype.findRoots=function(n,t){var r=[],c,i,u,a,s;if(n!=null&&t!=null){var v=this.graph.model,f=null,h=-1e5;for(c in t)if(i=t[c],v.isVertex(i)&&this.graph.isCellVisible(i)){var l=this.getEdges(i),e=0,o=0;for(u=0;u<l.length;u++)a=this.getVisibleTerminal(l[u],!0),a==i?e++:o++;o==0&&e>0&&r.push(i);s=e-o;s>h&&(h=s,f=i)}r.length==0&&f!=null&&r.push(f)}return r};mxHierarchicalLayout.prototype.getEdges=function(n){var s=this.edgesCache.get(n),u,o,i,f,e;if(s!=null)return s;var r=this.graph.model,t=[],h=this.graph.isCellCollapsed(n),c=r.getChildCount(n);for(i=0;i<c;i++)u=r.getChildAt(n,i),this.isPort(u)?t=t.concat(r.getEdges(u,!0,!0)):(h||!this.graph.isCellVisible(u))&&(t=t.concat(r.getEdges(u,!0,!0)));for(t=t.concat(r.getEdges(n,!0,!0)),o=[],i=0;i<t.length;i++)f=this.getVisibleTerminal(t[i],!0),e=this.getVisibleTerminal(t[i],!1),(f==e||f!=e&&(e==n&&(this.parent==null||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))||f==n&&(this.parent==null||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))))&&o.push(t[i]);return this.edgesCache.put(n,o),o};mxHierarchicalLayout.prototype.getVisibleTerminal=function(n,t){var u=this.edgesTargetTermCache,f,r,i;return(t&&(u=this.edgeSourceTermCache),f=u.get(n),f!=null)?f:(r=this.graph.view.getState(n),i=r!=null?r.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(n,t),i==null&&(i=r!=null?r.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(n,t)),i!=null&&(this.isPort(i)&&(i=this.graph.model.getParent(i)),u.put(n,i)),i)};mxHierarchicalLayout.prototype.run=function(n){var u=[],c=[],r,e,o,s,t,i,h,f;if(this.roots==null&&n!=null){r=Object();this.filterDescendants(n,r);this.roots=[];e=!0;for(f in r)if(r[f]!=null){e=!1;break}while(!e){for(o=this.findRoots(n,r),t=0;t<o.length;t++)i=Object(),u.push(i),this.traverse(o[t],!0,null,c,i,u,r);for(t=0;t<o.length;t++)this.roots.push(o[t]);e=!0;for(f in r)if(r[f]!=null){e=!1;break}}}else for(t=0;t<this.roots.length;t++)i=Object(),u.push(i),this.traverse(this.roots[t],!0,null,c,i,u,null);for(s=0,t=0;t<u.length;t++){i=u[t];h=[];for(f in i)h.push(i[f]);this.model=new mxGraphHierarchyModel(this,h,this.roots,n,this.tightenToSource);this.cycleStage(n);this.layeringStage();this.crossingStage(n);s=this.placementStage(s,n)}};mxHierarchicalLayout.prototype.filterDescendants=function(n,t){var r=this.graph.model,f,i,u;if(r.isVertex(n)&&n!=this.parent&&this.graph.isCellVisible(n)&&(t[mxObjectIdentity.get(n)]=n),this.traverseAncestors||n==this.parent&&this.graph.isCellVisible(n))for(f=r.getChildCount(n),i=0;i<f;i++)u=r.getChildAt(n,i),this.isPort(u)||this.filterDescendants(u,t)};mxHierarchicalLayout.prototype.isPort=function(n){return n.geometry.relative?!0:!1};mxHierarchicalLayout.prototype.getEdgesBetween=function(n,t,i){var u,f,r,e,o;for(i=i!=null?i:!1,u=this.getEdges(n),f=[],r=0;r<u.length;r++)e=this.getVisibleTerminal(u[r],!0),o=this.getVisibleTerminal(u[r],!1),(e!=n||o!=t)&&(i||e!=t||o!=n)||f.push(u[r]);return f};mxHierarchicalLayout.prototype.traverse=function(n,t,i,r,u,f,e){var s,h,l,y,a,c,p,b,o,v,w;if(n!=null&&r!=null)if(s=mxObjectIdentity.get(n),r[s]==null&&(e==null?!0:e[s]!=null)){for(u[s]==null&&(u[s]=n),r[s]==null&&(r[s]=n),e!==null&&delete e[s],h=this.getEdges(n),l=[],o=0;o<h.length;o++)l[o]=this.getVisibleTerminal(h[o],!0)==n;for(o=0;o<h.length;o++)if(!t||l[o]){for(y=this.getVisibleTerminal(h[o],!l[o]),a=1,c=0;c<h.length;c++)if(c==o)continue;else p=l[c],b=this.getVisibleTerminal(h[c],!p),b==y&&(p?a++:a--);a>=0&&(u=this.traverse(y,t,h[o],r,u,f,e))}}else if(u[s]==null)for(o=0;o<f.length;o++)if(v=f[o],v[s]!=null){for(w in v)u[w]=v[w];return f.splice(o,1),u}return u};mxHierarchicalLayout.prototype.cycleStage=function(n){var t=new mxMinimumCycleRemover(this);t.execute(n)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(n){var t=new mxMedianHybridCrossingReduction(this);t.execute(n)};mxHierarchicalLayout.prototype.placementStage=function(n,t){var i=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,n,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(t),i.limitX+this.interHierarchySpacing};mxSwimlaneLayout.prototype=new mxGraphLayout;mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout;mxSwimlaneLayout.prototype.roots=null;mxSwimlaneLayout.prototype.swimlanes=null;mxSwimlaneLayout.prototype.dummyVertices=null;mxSwimlaneLayout.prototype.dummyVertexWidth=50;mxSwimlaneLayout.prototype.resizeParent=!1;mxSwimlaneLayout.prototype.moveParent=!1;mxSwimlaneLayout.prototype.parentBorder=30;mxSwimlaneLayout.prototype.intraCellSpacing=30;mxSwimlaneLayout.prototype.interRankCellSpacing=100;mxSwimlaneLayout.prototype.interHierarchySpacing=60;mxSwimlaneLayout.prototype.parallelEdgeSpacing=10;mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxSwimlaneLayout.prototype.fineTuning=!0;mxSwimlaneLayout.prototype.tightenToSource=!0;mxSwimlaneLayout.prototype.disableEdgeStyle=!0;mxSwimlaneLayout.prototype.traverseAncestors=!0;mxSwimlaneLayout.prototype.model=null;mxSwimlaneLayout.prototype.edgesCache=null;mxSwimlaneLayout.prototype.getModel=function(){return this.model};mxSwimlaneLayout.prototype.execute=function(n,t){var r,i,u,f;if(this.parent=n,r=this.graph.model,this.edgesCache={},t!=null&&!(t.length<1)){for(n==null&&(n=r.getParent(t[0])),this.swimlanes=t,this.dummyVertices=[],i=0;i<t.length;i++)u=this.graph.getChildCells(t[i]),(u==null||u.length==0)&&(f=this.graph.insertVertex(t[i],null,null,0,0,this.dummyVertexWidth,0),this.dummyVertices.push(f));r.beginUpdate();try{this.run(n);this.resizeParent&&!this.graph.isCellCollapsed(n)&&this.graph.updateGroupBounds([n],this.parentBorder,this.moveParent);this.graph.removeCells(this.dummyVertices)}finally{r.endUpdate()}}};mxSwimlaneLayout.prototype.updateGroupBounds=function(){var a=[],v=this.model,y,h,t,f,s,c,w,n,i,r;for(y in v.edgeMapper)for(h=v.edgeMapper[y],n=0;n<h.edges.length;n++)a.push(h.edges[n]);for(t=this.graph.getBoundingBoxFromGeometry(a,!0),f=[],n=0;n<this.swimlanes.length;n++)if(i=this.swimlanes[n],r=this.graph.getCellGeometry(i),r!=null){var p=this.graph.getChildCells(i),e=this.graph.isSwimlane(i)?this.graph.getStartSize(i):new mxRectangle,o=this.graph.getBoundingBoxFromGeometry(p);f[n]=o;s=o.y+r.y-e.height-this.parentBorder;c=o.y+r.y+o.height;t==null?t=new mxRectangle(0,s,0,c-s):(t.y=Math.min(t.y,s),w=Math.max(t.y+t.height,c),t.height=w-t.y)}for(n=0;n<this.swimlanes.length;n++)if(i=this.swimlanes[n],r=this.graph.getCellGeometry(i),r!=null){var p=this.graph.getChildCells(i),e=this.graph.isSwimlane(i)?this.graph.getStartSize(i):new mxRectangle,u=r.clone(),l=n==0?this.parentBorder:this.interRankCellSpacing/2;u.x+=f[n].x-e.width-l;u.y=u.y+t.y-r.y-this.parentBorder;u.width=f[n].width+e.width+this.interRankCellSpacing/2+l;u.height=t.height+e.height+2*this.parentBorder;this.graph.model.setGeometry(i,u);this.graph.moveCells(p,-f[n].x+e.width+l,r.y-t.y+this.parentBorder)}};mxSwimlaneLayout.prototype.findRoots=function(n,t){var u=[],v,i,r,c,y,l;if(n!=null&&t!=null){var f=this.graph.model,e=null,a=-1e5;for(v in t)if(i=t[v],i!=null&&f.isVertex(i)&&this.graph.isCellVisible(i)&&f.isAncestor(n,i)){var o=this.getEdges(i),s=0,h=0;for(r=0;r<o.length;r++)c=this.getVisibleTerminal(o[r],!0),c==i?(y=this.getVisibleTerminal(o[r],!1),f.isAncestor(n,y)&&s++):f.isAncestor(n,c)&&h++;h==0&&s>0&&u.push(i);l=s-h;l>a&&(a=l,e=i)}u.length==0&&e!=null&&u.push(e)}return u};mxSwimlaneLayout.prototype.getEdges=function(n){var s=mxCellPath.create(n),u,o,i,f,e;if(this.edgesCache[s]!=null)return this.edgesCache[s];var r=this.graph.model,t=[],h=this.graph.isCellCollapsed(n),c=r.getChildCount(n);for(i=0;i<c;i++)u=r.getChildAt(n,i),this.isPort(u)?t=t.concat(r.getEdges(u,!0,!0)):(h||!this.graph.isCellVisible(u))&&(t=t.concat(r.getEdges(u,!0,!0)));for(t=t.concat(r.getEdges(n,!0,!0)),o=[],i=0;i<t.length;i++)f=this.getVisibleTerminal(t[i],!0),e=this.getVisibleTerminal(t[i],!1),(f==e||f!=e&&(e==n&&(this.parent==null||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))||f==n&&(this.parent==null||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))))&&o.push(t[i]);return this.edgesCache[s]=o,o};mxSwimlaneLayout.prototype.getVisibleTerminal=function(n,t){var r=this.graph.view.getState(n),i=r!=null?r.getVisibleTerminal(t):this.graph.view.getVisibleTerminal(n,t);return this.isPort(i)&&(i=this.graph.model.getParent(i)),i};mxSwimlaneLayout.prototype.run=function(n){var s=[],h=[],i,e,o,u,t,f,c,r;if(this.swimlanes!=null&&this.swimlanes.length>0&&n!=null){for(i=Object(),t=0;t<this.swimlanes.length;t++)this.filterDescendants(this.swimlanes[t],i);this.roots=[];e=!0;for(r in i)if(i[r]!=null){e=!1;break}for(o=0;!e&&o<this.swimlanes.length;){if(u=this.findRoots(this.swimlanes[o],i),u.length==0){o++;continue}for(t=0;t<u.length;t++)f=Object(),s.push(f),this.traverse(u[t],!0,null,h,f,s,i,o);for(t=0;t<u.length;t++)this.roots.push(u[t]);e=!0;for(r in i)if(i[r]!=null){e=!1;break}}}else for(t=0;t<this.roots.length;t++)f=Object(),s.push(f),this.traverse(this.roots[t],!0,null,h,f,s,null);c=[];for(r in h)c.push(h[r]);this.model=new mxSwimlaneModel(this,c,this.roots,n,this.tightenToSource);this.cycleStage(n);this.layeringStage();this.crossingStage(n);initialX=this.placementStage(0,n)};mxSwimlaneLayout.prototype.filterDescendants=function(n,t){var i=this.graph.model,f,r,u;if(i.isVertex(n)&&n!=this.parent&&i.getParent(n)!=this.parent&&this.graph.isCellVisible(n)&&(t[mxCellPath.create(n)]=n),this.traverseAncestors||n==this.parent&&this.graph.isCellVisible(n))for(f=i.getChildCount(n),r=0;r<f;r++)u=i.getChildAt(n,r),this.isPort(u)||this.filterDescendants(u,t)};mxSwimlaneLayout.prototype.isPort=function(n){return n.geometry.relative?!0:!1};mxSwimlaneLayout.prototype.getEdgesBetween=function(n,t,i){var u,f,r,e,o;for(i=i!=null?i:!1,u=this.getEdges(n),f=[],r=0;r<u.length;r++)e=this.getVisibleTerminal(u[r],!0),o=this.getVisibleTerminal(u[r],!1),(e!=n||o!=t)&&(i||e!=t||o!=n)||f.push(u[r]);return f};mxSwimlaneLayout.prototype.traverse=function(n,t,i,r,u,f,e,o){var h,l,w,a,y,c,s,v,p;if(n!=null&&r!=null)if(h=mxCellPath.create(n),r[h]==null&&(e==null?!0:e[h]!=null))for(u[h]==null&&(u[h]=n),r[h]==null&&(r[h]=n),e!==null&&delete e[h],l=this.getEdges(n),w=this.graph.model,s=0;s<l.length;s++){for(a=this.getVisibleTerminal(l[s],!0),y=a==n,y&&(a=this.getVisibleTerminal(l[s],!1)),c=0,c=0;c<this.swimlanes.length;c++)if(w.isAncestor(this.swimlanes[c],a))break;c>=this.swimlanes.length||(c>o||(!t||y)&&c==o)&&(u=this.traverse(a,t,l[s],r,u,f,e,c))}else if(u[h]==null)for(s=0;s<f.length;s++)if(v=f[s],v[h]!=null){for(p in v)u[p]=v[p];return f.splice(s,1),u}return u};mxSwimlaneLayout.prototype.cycleStage=function(n){var t=new mxSwimlaneOrdering(this);t.execute(n)};mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxSwimlaneLayout.prototype.crossingStage=function(n){var t=new mxMedianHybridCrossingReduction(this);t.execute(n)};mxSwimlaneLayout.prototype.placementStage=function(n,t){var i=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,n,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(t),i.limitX+this.interHierarchySpacing};mxGraphModel.prototype=new mxEventSource;mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=!0;mxGraphModel.prototype.createIds=!0;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=!1;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};mxGraphModel.prototype.setCreateIds=function(n){this.createIds=n};mxGraphModel.prototype.createRoot=function(){var n=new mxCell;return n.insert(new mxCell),n};mxGraphModel.prototype.getCell=function(n){return this.cells!=null?this.cells[n]:null};mxGraphModel.prototype.filterCells=function(n,t){var r=null,i;if(n!=null)for(r=[],i=0;i<n.length;i++)t(n[i])&&r.push(n[i]);return r};mxGraphModel.prototype.getDescendants=function(n){return this.filterDescendants(null,n)};mxGraphModel.prototype.filterDescendants=function(n,t){var i=[],u,r,f;for(t=t||this.getRoot(),(n==null||n(t))&&i.push(t),u=this.getChildCount(t),r=0;r<u;r++)f=this.getChildAt(t,r),i=i.concat(this.filterDescendants(n,f));return i};mxGraphModel.prototype.getRoot=function(n){var t=n||this.root;if(n!=null)while(n!=null)t=n,n=this.getParent(n);return t};mxGraphModel.prototype.setRoot=function(n){return this.execute(new mxRootChange(this,n)),n};mxGraphModel.prototype.rootChanged=function(n){var t=this.root;return this.root=n,this.nextId=0,this.cells=null,this.cellAdded(n),t};mxGraphModel.prototype.isRoot=function(n){return n!=null&&this.root==n};mxGraphModel.prototype.isLayer=function(n){return this.isRoot(this.getParent(n))};mxGraphModel.prototype.isAncestor=function(n,t){while(t!=null&&t!=n)t=this.getParent(t);return t==n};mxGraphModel.prototype.contains=function(n){return this.isAncestor(this.root,n)};mxGraphModel.prototype.getParent=function(n){return n!=null?n.getParent():null};mxGraphModel.prototype.add=function(n,t,i){if(t!=n&&n!=null&&t!=null){i==null&&(i=this.getChildCount(n));var r=n!=this.getParent(t);this.execute(new mxChildChange(this,n,t,i));this.maintainEdgeParent&&r&&this.updateEdgeParents(t)}return t};mxGraphModel.prototype.cellAdded=function(n){var t,r,i;if(n!=null){if(n.getId()==null&&this.createIds&&n.setId(this.createId(n)),n.getId()!=null&&(t=this.getCell(n.getId()),t!=n)){while(t!=null)n.setId(this.createId(n)),t=this.getCell(n.getId());this.cells==null&&(this.cells={});this.cells[n.getId()]=n}for(mxUtils.isNumeric(n.getId())&&(this.nextId=Math.max(this.nextId,n.getId())),r=this.getChildCount(n),i=0;i<r;i++)this.cellAdded(this.getChildAt(n,i))}};mxGraphModel.prototype.createId=function(){var n=this.nextId;return this.nextId++,this.prefix+n+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(n,t){var f,e,o,r,i,u;for(t=t||this.getRoot(n),f=this.getChildCount(n),i=0;i<f;i++)e=this.getChildAt(n,i),this.updateEdgeParents(e,t);for(o=this.getEdgeCount(n),r=[],i=0;i<o;i++)r.push(this.getEdgeAt(n,i));for(i=0;i<r.length;i++)u=r[i],this.isAncestor(t,u)&&this.updateEdgeParent(u,t)};mxGraphModel.prototype.updateEdgeParent=function(n,t){for(var i=this.getTerminal(n,!0),r=this.getTerminal(n,!1),u=null,f;i!=null&&!this.isEdge(i)&&i.geometry!=null&&i.geometry.relative;)i=this.getParent(i);while(r!=null&&!this.isEdge(r)&&r.geometry!=null&&r.geometry.relative)r=this.getParent(r);if(this.isAncestor(t,i)&&this.isAncestor(t,r)&&(u=i==r?this.getParent(i):this.getNearestCommonAncestor(i,r),u!=null&&(this.getParent(u)!=this.root||this.isAncestor(u,n))&&this.getParent(n)!=u)){if(f=this.getGeometry(n),f!=null){var e=this.getOrigin(this.getParent(n)),o=this.getOrigin(u),s=o.x-e.x,h=o.y-e.y;f=f.clone();f.translate(-s,-h);this.setGeometry(n,f)}this.add(u,n,this.getChildCount(u))}};mxGraphModel.prototype.getOrigin=function(n){var t=null,i;return n!=null?(t=this.getOrigin(this.getParent(n)),this.isEdge(n)||(i=this.getGeometry(n),i!=null&&(t.x+=i.x,t.y+=i.y))):t=new mxPoint,t};mxGraphModel.prototype.getNearestCommonAncestor=function(n,t){var i,r,u,e,f;if(n!=null&&t!=null&&(i=mxCellPath.create(t),i!=null&&i.length>0))for(r=n,u=mxCellPath.create(r),i.length<u.length&&(r=t,e=u,u=i,i=e);r!=null;){if(f=this.getParent(r),i.indexOf(u+mxCellPath.PATH_SEPARATOR)==0&&f!=null)return r;u=mxCellPath.getParentPath(u);r=f}return null};mxGraphModel.prototype.remove=function(n){return n==this.root?this.setRoot(null):this.getParent(n)!=null&&this.execute(new mxChildChange(this,null,n)),n};mxGraphModel.prototype.cellRemoved=function(n){var i,t;if(n!=null&&this.cells!=null){for(i=this.getChildCount(n),t=i-1;t>=0;t--)this.cellRemoved(this.getChildAt(n,t));this.cells!=null&&n.getId()!=null&&delete this.cells[n.getId()]}};mxGraphModel.prototype.parentForCellChanged=function(n,t,i){var r=this.getParent(n),u;return t!=null?(t!=r||r.getIndex(n)!=i)&&t.insert(n,i):r!=null&&(u=r.getIndex(n),r.remove(u)),this.contains(r)||t==null?t==null&&this.cellRemoved(n):this.cellAdded(n),r};mxGraphModel.prototype.getChildCount=function(n){return n!=null?n.getChildCount():0};mxGraphModel.prototype.getChildAt=function(n,t){return n!=null?n.getChildAt(t):null};mxGraphModel.prototype.getChildren=function(n){return n!=null?n.children:null};mxGraphModel.prototype.getChildVertices=function(n){return this.getChildCells(n,!0,!1)};mxGraphModel.prototype.getChildEdges=function(n){return this.getChildCells(n,!1,!0)};mxGraphModel.prototype.getChildCells=function(n,t,i){var e,f,r,u;for(t=t!=null?t:!1,i=i!=null?i:!1,e=this.getChildCount(n),f=[],r=0;r<e;r++)u=this.getChildAt(n,r),(!i&&!t||i&&this.isEdge(u)||t&&this.isVertex(u))&&f.push(u);return f};mxGraphModel.prototype.getTerminal=function(n,t){return n!=null?n.getTerminal(t):null};mxGraphModel.prototype.setTerminal=function(n,t,i){var r=t!=this.getTerminal(n,i);return this.execute(new mxTerminalChange(this,n,t,i)),this.maintainEdgeParent&&r&&this.updateEdgeParent(n,this.getRoot()),t};mxGraphModel.prototype.setTerminals=function(n,t,i){this.beginUpdate();try{this.setTerminal(n,t,!0);this.setTerminal(n,i,!1)}finally{this.endUpdate()}};mxGraphModel.prototype.terminalForCellChanged=function(n,t,i){var r=this.getTerminal(n,i);return t!=null?t.insertEdge(n,i):r!=null&&r.removeEdge(n,i),r};mxGraphModel.prototype.getEdgeCount=function(n){return n!=null?n.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(n,t){return n!=null?n.getEdgeAt(t):null};mxGraphModel.prototype.getDirectedEdgeCount=function(n,t,i){for(var u,f=0,e=this.getEdgeCount(n),r=0;r<e;r++)u=this.getEdgeAt(n,r),u!=i&&this.getTerminal(u,t)==n&&f++;return f};mxGraphModel.prototype.getConnections=function(n){return this.getEdges(n,!0,!0,!1)};mxGraphModel.prototype.getIncomingEdges=function(n){return this.getEdges(n,!0,!1,!1)};mxGraphModel.prototype.getOutgoingEdges=function(n){return this.getEdges(n,!1,!0,!1)};mxGraphModel.prototype.getEdges=function(n,t,i,r){var h,f,u;for(t=t!=null?t:!0,i=i!=null?i:!0,r=r!=null?r:!0,h=this.getEdgeCount(n),f=[],u=0;u<h;u++){var e=this.getEdgeAt(n,u),o=this.getTerminal(e,!0),s=this.getTerminal(e,!1);(r&&o==s||o!=s&&(t&&s==n||i&&o==n))&&f.push(e)}return f};mxGraphModel.prototype.getEdgesBetween=function(n,t,i){var u,r;i=i!=null?i:!1;var e=this.getEdgeCount(n),o=this.getEdgeCount(t),s=n,h=e;for(o<e&&(h=o,s=t),u=[],r=0;r<h;r++){var f=this.getEdgeAt(s,r),c=this.getTerminal(f,!0),l=this.getTerminal(f,!1),a=c==n&&l==t,v=l==n&&c==t;(a||!i&&v)&&u.push(f)}return u};mxGraphModel.prototype.getOpposites=function(n,t,i,r){var o,u,f,e;if(i=i!=null?i:!0,r=r!=null?r:!0,o=[],n!=null)for(u=0;u<n.length;u++)f=this.getTerminal(n[u],!0),e=this.getTerminal(n[u],!1),f==t&&e!=null&&e!=t&&r?o.push(e):e==t&&f!=null&&f!=t&&i&&o.push(f);return o};mxGraphModel.prototype.getTopmostCells=function(n){for(var r=[],i=0;i<n.length;i++){for(var u=n[i],f=!0,t=this.getParent(u);t!=null;){if(mxUtils.indexOf(n,t)>=0){f=!1;break}t=this.getParent(t)}f&&r.push(u)}return r};mxGraphModel.prototype.isVertex=function(n){return n!=null?n.isVertex():!1};mxGraphModel.prototype.isEdge=function(n){return n!=null?n.isEdge():!1};mxGraphModel.prototype.isConnectable=function(n){return n!=null?n.isConnectable():!1};mxGraphModel.prototype.getValue=function(n){return n!=null?n.getValue():null};mxGraphModel.prototype.setValue=function(n,t){return this.execute(new mxValueChange(this,n,t)),t};mxGraphModel.prototype.valueForCellChanged=function(n,t){return n.valueChanged(t)};mxGraphModel.prototype.getGeometry=function(n){return n!=null?n.getGeometry():null};mxGraphModel.prototype.setGeometry=function(n,t){return t!=this.getGeometry(n)&&this.execute(new mxGeometryChange(this,n,t)),t};mxGraphModel.prototype.geometryForCellChanged=function(n,t){var i=this.getGeometry(n);return n.setGeometry(t),i};mxGraphModel.prototype.getStyle=function(n){return n!=null?n.getStyle():null};mxGraphModel.prototype.setStyle=function(n,t){return t!=this.getStyle(n)&&this.execute(new mxStyleChange(this,n,t)),t};mxGraphModel.prototype.styleForCellChanged=function(n,t){var i=this.getStyle(n);return n.setStyle(t),i};mxGraphModel.prototype.isCollapsed=function(n){return n!=null?n.isCollapsed():!1};mxGraphModel.prototype.setCollapsed=function(n,t){return t!=this.isCollapsed(n)&&this.execute(new mxCollapseChange(this,n,t)),t};mxGraphModel.prototype.collapsedStateForCellChanged=function(n,t){var i=this.isCollapsed(n);return n.setCollapsed(t),i};mxGraphModel.prototype.isVisible=function(n){return n!=null?n.isVisible():!1};mxGraphModel.prototype.setVisible=function(n,t){return t!=this.isVisible(n)&&this.execute(new mxVisibleChange(this,n,t)),t};mxGraphModel.prototype.visibleStateForCellChanged=function(n,t){var i=this.isVisible(n);return n.setVisible(t),i};mxGraphModel.prototype.execute=function(n){n.execute();this.beginUpdate();this.currentEdit.add(n);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",n));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",n));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));this.updateLevel==1&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))};mxGraphModel.prototype.endUpdate=function(){if(this.updateLevel--,this.updateLevel==0&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT)),!this.endingUpdate){this.endingUpdate=this.updateLevel==0;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var n=this.currentEdit;this.currentEdit=this.createUndoableEdit();n.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",n))}}finally{this.endingUpdate=!1}}};mxGraphModel.prototype.createUndoableEdit=function(){var n=new mxUndoableEdit(this,!0);return n.notify=function(){n.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",n,"changes",n.changes));n.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",n,"changes",n.changes))},n};mxGraphModel.prototype.mergeChildren=function(n,t,i){var u,e,f,r;i=i!=null?i:!0;this.beginUpdate();try{u={};this.mergeChildrenImpl(n,t,i,u);for(e in u)f=u[e],r=this.getTerminal(f,!0),r!=null&&(r=u[mxCellPath.create(r)],this.setTerminal(f,r,!0)),r=this.getTerminal(f,!1),r!=null&&(r=u[mxCellPath.create(r)],this.setTerminal(f,r,!1))}finally{this.endUpdate()}};mxGraphModel.prototype.mergeChildrenImpl=function(n,t,i,r){var h,o,u,s,f,e;this.beginUpdate();try{for(h=n.getChildCount(),o=0;o<h;o++)u=n.getChildAt(o),typeof u.getId=="function"&&(s=u.getId(),f=s!=null&&(!this.isEdge(u)||!i)?this.getCell(s):null,f==null&&(e=u.clone(),e.setId(s),e.setTerminal(u.getTerminal(!0),!0),e.setTerminal(u.getTerminal(!1),!1),f=t.insert(e),this.cellAdded(f)),r[mxCellPath.create(u)]=f,this.mergeChildrenImpl(u,f,i,r))}finally{this.endUpdate()}};mxGraphModel.prototype.getParents=function(n){var f=[],r,i,t,u;if(n!=null)for(r={},i=0;i<n.length;i++)t=this.getParent(n[i]),t!=null&&(u=mxCellPath.create(t),r[u]==null&&(r[u]=t,f.push(t)));return f};mxGraphModel.prototype.cloneCell=function(n){return n!=null?this.cloneCells([n],!0)[0]:null};mxGraphModel.prototype.cloneCells=function(n,t){for(var u={},r=[],i=0;i<n.length;i++)n[i]!=null?r.push(this.cloneCellImpl(n[i],u,t)):r.push(null);for(i=0;i<r.length;i++)r[i]!=null&&this.restoreClone(r[i],n[i],u);return r};mxGraphModel.prototype.cloneCellImpl=function(n,t,i){var u=this.cellCloned(n),f,r,e;if(t[mxObjectIdentity.get(n)]=u,i)for(f=this.getChildCount(n),r=0;r<f;r++)e=this.cloneCellImpl(this.getChildAt(n,r),t,!0),u.insert(e);return u};mxGraphModel.prototype.cellCloned=function(n){return n.clone()};mxGraphModel.prototype.restoreClone=function(n,t,i){var e=this.getTerminal(t,!0),f,r,o,u;for(e!=null&&(r=i[mxObjectIdentity.get(e)],r!=null&&r.insertEdge(n,!0)),f=this.getTerminal(t,!1),f!=null&&(r=i[mxObjectIdentity.get(f)],r!=null&&r.insertEdge(n,!1)),o=this.getChildCount(n),u=0;u<o;u++)this.restoreClone(this.getChildAt(n,u),this.getChildAt(t,u),i)};mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};mxChildChange.prototype.execute=function(){var n=this.model.getParent(this.child),t=n!=null?n.getIndex(this.child):0;this.previous==null&&this.connect(this.child,!1);n=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);this.previous!=null&&this.connect(this.child,!0);this.parent=this.previous;this.previous=n;this.index=this.previousIndex;this.previousIndex=t};mxChildChange.prototype.connect=function(n,t){var i,r,f,u;for(t=t!=null?t:!0,i=n.getTerminal(!0),r=n.getTerminal(!1),i!=null&&(t?this.model.terminalForCellChanged(n,i,!0):this.model.terminalForCellChanged(n,null,!0)),r!=null&&(t?this.model.terminalForCellChanged(n,r,!1):this.model.terminalForCellChanged(n,null,!1)),n.setTerminal(i,!0),n.setTerminal(r,!1),f=this.model.getChildCount(n),u=0;u<f;u++)this.connect(this.model.getChildAt(n,u),t)};mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};mxCellAttributeChange.prototype.execute=function(){var n=this.cell.getAttribute(this.attribute);this.previous==null?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous);this.previous=n};mxCell.prototype.id=null;mxCell.prototype.value=null;mxCell.prototype.geometry=null;mxCell.prototype.style=null;mxCell.prototype.vertex=!1;mxCell.prototype.edge=!1;mxCell.prototype.connectable=!0;mxCell.prototype.visible=!0;mxCell.prototype.collapsed=!1;mxCell.prototype.parent=null;mxCell.prototype.source=null;mxCell.prototype.target=null;mxCell.prototype.children=null;mxCell.prototype.edges=null;mxCell.prototype.mxTransient=["id","value","parent","source","target","children","edges"];mxCell.prototype.getId=function(){return this.id};mxCell.prototype.setId=function(n){this.id=n};mxCell.prototype.getValue=function(){return this.value};mxCell.prototype.setValue=function(n){this.value=n};mxCell.prototype.valueChanged=function(n){var t=this.getValue();return this.setValue(n),t};mxCell.prototype.getGeometry=function(){return this.geometry};mxCell.prototype.setGeometry=function(n){this.geometry=n};mxCell.prototype.getStyle=function(){return this.style};mxCell.prototype.setStyle=function(n){this.style=n};mxCell.prototype.isVertex=function(){return this.vertex!=0};mxCell.prototype.setVertex=function(n){this.vertex=n};mxCell.prototype.isEdge=function(){return this.edge!=0};mxCell.prototype.setEdge=function(n){this.edge=n};mxCell.prototype.isConnectable=function(){return this.connectable!=0};mxCell.prototype.setConnectable=function(n){this.connectable=n};mxCell.prototype.isVisible=function(){return this.visible!=0};mxCell.prototype.setVisible=function(n){this.visible=n};mxCell.prototype.isCollapsed=function(){return this.collapsed!=0};mxCell.prototype.setCollapsed=function(n){this.collapsed=n};mxCell.prototype.getParent=function(){return this.parent};mxCell.prototype.setParent=function(n){this.parent=n};mxCell.prototype.getTerminal=function(n){return n?this.source:this.target};mxCell.prototype.setTerminal=function(n,t){return t?this.source=n:this.target=n,n};mxCell.prototype.getChildCount=function(){return this.children==null?0:this.children.length};mxCell.prototype.getIndex=function(n){return mxUtils.indexOf(this.children,n)};mxCell.prototype.getChildAt=function(n){return this.children==null?null:this.children[n]};mxCell.prototype.insert=function(n,t){return n!=null&&(t==null&&(t=this.getChildCount(),n.getParent()==this&&t--),n.removeFromParent(),n.setParent(this),this.children==null?(this.children=[],this.children.push(n)):this.children.splice(t,0,n)),n};mxCell.prototype.remove=function(n){var t=null;return this.children!=null&&n>=0&&(t=this.getChildAt(n),t!=null&&(this.children.splice(n,1),t.setParent(null))),t};mxCell.prototype.removeFromParent=function(){if(this.parent!=null){var n=this.parent.getIndex(this);this.parent.remove(n)}};mxCell.prototype.getEdgeCount=function(){return this.edges==null?0:this.edges.length};mxCell.prototype.getEdgeIndex=function(n){return mxUtils.indexOf(this.edges,n)};mxCell.prototype.getEdgeAt=function(n){return this.edges==null?null:this.edges[n]};mxCell.prototype.insertEdge=function(n,t){return n!=null&&(n.removeFromTerminal(t),n.setTerminal(this,t),(this.edges==null||n.getTerminal(!t)!=this||mxUtils.indexOf(this.edges,n)<0)&&(this.edges==null&&(this.edges=[]),this.edges.push(n))),n};mxCell.prototype.removeEdge=function(n,t){if(n!=null){if(n.getTerminal(!t)!=this&&this.edges!=null){var i=this.getEdgeIndex(n);i>=0&&this.edges.splice(i,1)}n.setTerminal(null,t)}return n};mxCell.prototype.removeFromTerminal=function(n){var t=this.getTerminal(n);t!=null&&t.removeEdge(this,n)};mxCell.prototype.getAttribute=function(n,t){var i=this.getValue(),r=i!=null&&i.nodeType==mxConstants.NODETYPE_ELEMENT?i.getAttribute(n):null;return r||t};mxCell.prototype.setAttribute=function(n,t){var i=this.getValue();i!=null&&i.nodeType==mxConstants.NODETYPE_ELEMENT&&i.setAttribute(n,t)};mxCell.prototype.clone=function(){var n=mxUtils.clone(this,this.mxTransient);return n.setValue(this.cloneValue()),n};mxCell.prototype.cloneValue=function(){var n=this.getValue();return n!=null&&(typeof n.clone=="function"?n=n.clone():isNaN(n.nodeType)||(n=n.cloneNode(!0))),n};mxGeometry.prototype=new mxRectangle;mxGeometry.prototype.constructor=mxGeometry;mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0;mxGeometry.prototype.alternateBounds=null;mxGeometry.prototype.sourcePoint=null;mxGeometry.prototype.targetPoint=null;mxGeometry.prototype.points=null;mxGeometry.prototype.offset=null;mxGeometry.prototype.relative=!1;mxGeometry.prototype.swap=function(){if(this.alternateBounds!=null){var n=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x;this.y=this.alternateBounds.y;this.width=this.alternateBounds.width;this.height=this.alternateBounds.height;this.alternateBounds=n}};mxGeometry.prototype.getTerminalPoint=function(n){return n?this.sourcePoint:this.targetPoint};mxGeometry.prototype.setTerminalPoint=function(n,t){return t?this.sourcePoint=n:this.targetPoint=n,n};mxGeometry.prototype.rotate=function(n,t){var e=mxUtils.toRadians(n),u=Math.cos(e),f=Math.sin(e),o,r,i;if(this.relative||(o=new mxPoint(this.getCenterX(),this.getCenterY()),i=mxUtils.getRotatedPoint(o,u,f,t),this.x=Math.round(i.x-this.width/2),this.y=Math.round(i.y-this.height/2)),this.sourcePoint!=null&&(i=mxUtils.getRotatedPoint(this.sourcePoint,u,f,t),this.sourcePoint.x=Math.round(i.x),this.sourcePoint.y=Math.round(i.y)),this.targetPoint!=null&&(i=mxUtils.getRotatedPoint(this.targetPoint,u,f,t),this.targetPoint.x=Math.round(i.x),this.targetPoint.y=Math.round(i.y)),this.points!=null)for(r=0;r<this.points.length;r++)this.points[r]!=null&&(i=mxUtils.getRotatedPoint(this.points[r],u,f,t),this.points[r].x=Math.round(i.x),this.points[r].y=Math.round(i.y))};mxGeometry.prototype.translate=function(n,t){if(n=parseFloat(n),t=parseFloat(t),this.relative||(this.x=parseFloat(this.x)+n,this.y=parseFloat(this.y)+t),this.sourcePoint!=null&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)+n,this.sourcePoint.y=parseFloat(this.sourcePoint.y)+t),this.targetPoint!=null&&(this.targetPoint.x=parseFloat(this.targetPoint.x)+n,this.targetPoint.y=parseFloat(this.targetPoint.y)+t),this.TRANSLATE_CONTROL_POINTS&&this.points!=null)for(var i=0;i<this.points.length;i++)this.points[i]!=null&&(this.points[i].x=parseFloat(this.points[i].x)+n,this.points[i].y=parseFloat(this.points[i].y)+t)};mxGeometry.prototype.scale=function(n,t,i){if(n=parseFloat(n),t=parseFloat(t),this.sourcePoint!=null&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)*n,this.sourcePoint.y=parseFloat(this.sourcePoint.y)*t),this.targetPoint!=null&&(this.targetPoint.x=parseFloat(this.targetPoint.x)*n,this.targetPoint.y=parseFloat(this.targetPoint.y)*t),this.points!=null)for(var r=0;r<this.points.length;r++)this.points[r]!=null&&(this.points[r].x=parseFloat(this.points[r].x)*n,this.points[r].y=parseFloat(this.points[r].y)*t);this.relative||(this.x=parseFloat(this.x)*n,this.y=parseFloat(this.y)*t,i&&(t=n=Math.min(n,t)),this.width=parseFloat(this.width)*n,this.height=parseFloat(this.height)*t)};mxGeometry.prototype.equals=function(n){return mxRectangle.prototype.equals.apply(this,arguments)&&this.relative==n.relative&&(this.sourcePoint==null&&n.sourcePoint==null||this.sourcePoint!=null&&this.sourcePoint.equals(n.sourcePoint))&&(this.targetPoint==null&&n.targetPoint==null||this.targetPoint!=null&&this.targetPoint.equals(n.targetPoint))&&(this.points==null&&n.points==null||this.points!=null&&mxUtils.equalPoints(this.points,n.points))&&(this.alternateBounds==null&&n.alternateBounds==null||this.alternateBounds!=null&&this.alternateBounds.equals(n.alternateBounds))&&(this.offset==null&&n.offset==null||this.offset!=null&&this.offset.equals(n.offset))};mxCellPath={PATH_SEPARATOR:".",create:function(n){var t="",i,u,r;if(n!=null)for(i=n.getParent();i!=null;)u=i.getIndex(n),t=u+mxCellPath.PATH_SEPARATOR+t,n=i,i=n.getParent();return r=t.length,r>1&&(t=t.substring(0,r-1)),t},getParentPath:function(n){if(n!=null){var t=n.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(t>=0)return n.substring(0,t);if(n.length>0)return""}return null},resolve:function(n,t){var r=n,u,i;if(t!=null)for(u=t.split(mxCellPath.PATH_SEPARATOR),i=0;i<u.length;i++)r=r.getChildAt(parseInt(u[i]));return r},compare:function(n,t){for(var r,u,e=Math.min(n.length,t.length),f=0,i=0;i<e;i++)if(n[i]!=t[i]){n[i].length==0||t[i].length==0?f=n[i]==t[i]?0:n[i]>t[i]?1:-1:(r=parseInt(n[i]),u=parseInt(t[i]),f=r==u?0:r>u?1:-1);break}return f==0&&(r=n.length,u=t.length,r!=u&&(f=r>u?1:-1)),f}};mxPerimeter={RectanglePerimeter:function(n,t,i,r){var o=n.getCenterX(),s=n.getCenterY(),l=i.x-o,a=i.y-s,f=Math.atan2(a,l),u=new mxPoint(0,0),h=Math.PI,v=Math.PI/2,c=v-f,e=Math.atan2(n.height,n.width);return f<-h+e||f>h-e?(u.x=n.x,u.y=s-n.width*Math.tan(f)/2):f<-e?(u.y=n.y,u.x=o-n.height*Math.tan(c)/2):f<e?(u.x=n.x+n.width,u.y=s+n.width*Math.tan(f)/2):(u.y=n.y+n.height,u.x=o+n.height*Math.tan(c)/2),r&&(i.x>=n.x&&i.x<=n.x+n.width?u.x=i.x:i.y>=n.y&&i.y<=n.y+n.height&&(u.y=i.y),i.x<n.x?u.x=n.x:i.x>n.x+n.width&&(u.x=n.x+n.width),i.y<n.y?u.y=n.y:i.y>n.y+n.height&&(u.y=n.y+n.height)),u},EllipsePerimeter:function(n,t,i,r){var y=n.x,p=n.y,f=n.width/2,u=n.height/2,e=y+f,a=p+u,o=i.x,s=i.y,k=parseInt(o-e),v=parseInt(s-a),c,h;if(k==0&&v!=0)return new mxPoint(e,a+u*v/Math.abs(v));if(k==0&&v==0)return new mxPoint(o,s);if(r){if(s>=p&&s<=p+n.height)return h=s-a,c=Math.sqrt(f*f*(1-h*h/(u*u)))||0,o<=y&&(c=-c),new mxPoint(e+c,s);if(o>=y&&o<=y+n.width)return c=o-e,h=Math.sqrt(u*u*(1-c*c/(f*f)))||0,s<=p&&(h=-h),new mxPoint(o,a+h)}var l=v/k,it=a-l*e,w=f*f*l*l+u*u,b=-2*e*w,et=f*f*l*l*e*e+u*u*e*e-f*f*u*u,rt=Math.sqrt(b*b-4*w*et),d=(-b+rt)/(2*w),g=(-b-rt)/(2*w),ut=l*d+it,ft=l*g+it,ot=Math.sqrt(Math.pow(d-o,2)+Math.pow(ut-s,2)),st=Math.sqrt(Math.pow(g-o,2)+Math.pow(ft-s,2)),nt=0,tt=0;return ot<st?(nt=d,tt=ut):(nt=g,tt=ft),new mxPoint(nt,tt)},RhombusPerimeter:function(n,t,i,r){var s=n.x,h=n.y,a=n.width,v=n.height,e=s+a/2,u=h+v/2,o=i.x,f=i.y,c,l;return e==o?u>f?new mxPoint(e,h):new mxPoint(e,h+v):u==f?e>o?new mxPoint(s,u):new mxPoint(s+a,u):(c=e,l=u,r&&(o>=s&&o<=s+a?c=o:f>=h&&f<=h+v&&(l=f)),o<e?f<u?mxUtils.intersection(o,f,c,l,e,h,s,u):mxUtils.intersection(o,f,c,l,e,h+v,s,u):f<u?mxUtils.intersection(o,f,c,l,e,h,s+a,u):mxUtils.intersection(o,f,c,l,e,h+v,s+a,u))},TrianglePerimeter:function(n,t,i,r){var s=t!=null?t.style[mxConstants.STYLE_DIRECTION]:null,h=s==mxConstants.DIRECTION_NORTH||s==mxConstants.DIRECTION_SOUTH,u=n.x,f=n.y,e=n.width,o=n.height,c=u+e/2,l=f+o/2,v=new mxPoint(u,f),w=new mxPoint(u+e,l),y=new mxPoint(u,f+o),b,a;s==mxConstants.DIRECTION_NORTH?(v=y,w=new mxPoint(c,f),y=new mxPoint(u+e,f+o)):s==mxConstants.DIRECTION_SOUTH?(w=new mxPoint(c,f+o),y=new mxPoint(u+e,f)):s==mxConstants.DIRECTION_WEST&&(v=new mxPoint(u+e,f),w=new mxPoint(u,l),y=new mxPoint(u+e,f+o));var d=i.x-c,g=i.y-l,p=h?Math.atan2(d,g):Math.atan2(g,d),k=h?Math.atan2(e,o):Math.atan2(o,e),nt=!1;return nt=s==mxConstants.DIRECTION_NORTH||s==mxConstants.DIRECTION_WEST?p>-k&&p<k:p<-Math.PI+k||p>Math.PI-k,b=null,nt?b=r&&(h&&i.x>=v.x&&i.x<=y.x||!h&&i.y>=v.y&&i.y<=y.y)?h?new mxPoint(i.x,v.y):new mxPoint(v.x,i.y):s==mxConstants.DIRECTION_NORTH?new mxPoint(u+e/2+o*Math.tan(p)/2,f+o):s==mxConstants.DIRECTION_SOUTH?new mxPoint(u+e/2-o*Math.tan(p)/2,f):s==mxConstants.DIRECTION_WEST?new mxPoint(u+e,f+o/2+e*Math.tan(p)/2):new mxPoint(u,f+o/2-e*Math.tan(p)/2):(r&&(a=new mxPoint(c,l),i.y>=f&&i.y<=f+o?(a.x=h?c:s==mxConstants.DIRECTION_WEST?u+e:u,a.y=i.y):i.x>=u&&i.x<=u+e&&(a.x=i.x,a.y=h?s==mxConstants.DIRECTION_NORTH?f+o:f:l),d=i.x-a.x,g=i.y-a.y,c=a.x,l=a.y),b=h&&i.x<=u+e/2||!h&&i.y<=f+o/2?mxUtils.intersection(i.x,i.y,c,l,v.x,v.y,w.x,w.y):mxUtils.intersection(i.x,i.y,c,l,w.x,w.y,y.x,y.y)),b==null&&(b=new mxPoint(c,l)),b},HexagonPerimeter:function(n,t,i,r){var f=n.x,u=n.y,o=n.width,e=n.height,p=n.getCenterX(),w=n.getCenterY(),c=i.x,h=i.y,it=c-p,rt=h-w,s=-Math.atan2(rt,it),y=Math.PI,b=Math.PI/2,k=new mxPoint(p,w),nt=t!=null?mxUtils.getValue(t.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST):mxConstants.DIRECTION_EAST,tt=nt==mxConstants.DIRECTION_NORTH||nt==mxConstants.DIRECTION_SOUTH,l=new mxPoint,a=new mxPoint,d,g,v;if((c<f&&h<u||c<f&&h>u+e||c>f+o&&h<u||c>f+o&&h>u+e)&&(r=!1),r){if(tt){if(c==p){if(h<=u)return new mxPoint(p,u);if(h>=u+e)return new mxPoint(p,u+e)}else if(c<f){if(h==u+e/4)return new mxPoint(f,u+e/4);if(h==u+3*e/4)return new mxPoint(f,u+3*e/4)}else if(c>f+o){if(h==u+e/4)return new mxPoint(f+o,u+e/4);if(h==u+3*e/4)return new mxPoint(f+o,u+3*e/4)}else if(c==f){if(h<w)return new mxPoint(f,u+e/4);if(h>w)return new mxPoint(f,u+3*e/4)}else if(c==f+o){if(h<w)return new mxPoint(f+o,u+e/4);if(h>w)return new mxPoint(f+o,u+3*e/4)}if(h==u)return new mxPoint(p,u);if(h==u+e)return new mxPoint(p,u+e);c<p?h>u+e/4&&h<u+3*e/4?(l=new mxPoint(f,u),a=new mxPoint(f,u+e)):h<u+e/4?(l=new mxPoint(f-Math.floor(.5*o),u+Math.floor(.5*e)),a=new mxPoint(f+o,u-Math.floor(.25*e))):h>u+3*e/4&&(l=new mxPoint(f-Math.floor(.5*o),u+Math.floor(.5*e)),a=new mxPoint(f+o,u+Math.floor(1.25*e))):c>p&&(h>u+e/4&&h<u+3*e/4?(l=new mxPoint(f+o,u),a=new mxPoint(f+o,u+e)):h<u+e/4?(l=new mxPoint(f,u-Math.floor(.25*e)),a=new mxPoint(f+Math.floor(1.5*o),u+Math.floor(.5*e))):h>u+3*e/4&&(l=new mxPoint(f+Math.floor(1.5*o),u+Math.floor(.5*e)),a=new mxPoint(f,u+Math.floor(1.25*e))))}else{if(h==w){if(c<=f)return new mxPoint(f,u+e/2);if(c>=f+o)return new mxPoint(f+o,u+e/2)}else if(h<u){if(c==f+o/4)return new mxPoint(f+o/4,u);if(c==f+3*o/4)return new mxPoint(f+3*o/4,u)}else if(h>u+e){if(c==f+o/4)return new mxPoint(f+o/4,u+e);if(c==f+3*o/4)return new mxPoint(f+3*o/4,u+e)}else if(h==u){if(c<p)return new mxPoint(f+o/4,u);if(c>p)return new mxPoint(f+3*o/4,u)}else if(h==u+e){if(c<p)return new mxPoint(f+o/4,u+e);if(h>w)return new mxPoint(f+3*o/4,u+e)}if(c==f)return new mxPoint(f,w);if(c==f+o)return new mxPoint(f+o,w);h<w?c>f+o/4&&c<f+3*o/4?(l=new mxPoint(f,u),a=new mxPoint(f+o,u)):c<f+o/4?(l=new mxPoint(f-Math.floor(.25*o),u+e),a=new mxPoint(f+Math.floor(.5*o),u-Math.floor(.5*e))):c>f+3*o/4&&(l=new mxPoint(f+Math.floor(.5*o),u-Math.floor(.5*e)),a=new mxPoint(f+Math.floor(1.25*o),u+e)):h>w&&(c>f+o/4&&c<f+3*o/4?(l=new mxPoint(f,u+e),a=new mxPoint(f+o,u+e)):c<f+o/4?(l=new mxPoint(f-Math.floor(.25*o),u),a=new mxPoint(f+Math.floor(.5*o),u+Math.floor(1.5*e))):c>f+3*o/4&&(l=new mxPoint(f+Math.floor(.5*o),u+Math.floor(1.5*e)),a=new mxPoint(f+Math.floor(1.25*o),u)))}d=p;g=w;c>=f&&c<=f+o?(d=c,g=h<w?u+e:u):h>=u&&h<=u+e&&(g=h,d=c<p?f+o:f);k=mxUtils.intersection(d,g,i.x,i.y,l.x,l.y,a.x,a.y)}else{if(tt){if(v=Math.atan2(e/4,o/2),s==v)return new mxPoint(f+o,u+Math.floor(.25*e));if(s==b)return new mxPoint(f+Math.floor(.5*o),u);if(s==y-v)return new mxPoint(f,u+Math.floor(.25*e));if(s==-v)return new mxPoint(f+o,u+Math.floor(.75*e));if(s==-b)return new mxPoint(f+Math.floor(.5*o),u+e);if(s==-y+v)return new mxPoint(f,u+Math.floor(.75*e));s<v&&s>-v?(l=new mxPoint(f+o,u),a=new mxPoint(f+o,u+e)):s>v&&s<b?(l=new mxPoint(f,u-Math.floor(.25*e)),a=new mxPoint(f+Math.floor(1.5*o),u+Math.floor(.5*e))):s>b&&s<y-v?(l=new mxPoint(f-Math.floor(.5*o),u+Math.floor(.5*e)),a=new mxPoint(f+o,u-Math.floor(.25*e))):s>y-v&&s<=y||s<-y+v&&s>=-y?(l=new mxPoint(f,u),a=new mxPoint(f,u+e)):s<-v&&s>-b?(l=new mxPoint(f+Math.floor(1.5*o),u+Math.floor(.5*e)),a=new mxPoint(f,u+Math.floor(1.25*e))):s<-b&&s>-y+v&&(l=new mxPoint(f-Math.floor(.5*o),u+Math.floor(.5*e)),a=new mxPoint(f+o,u+Math.floor(1.25*e)))}else{if(v=Math.atan2(e/2,o/4),s==v)return new mxPoint(f+Math.floor(.75*o),u);if(s==y-v)return new mxPoint(f+Math.floor(.25*o),u);if(s==y||s==-y)return new mxPoint(f,u+Math.floor(.5*e));if(s==0)return new mxPoint(f+o,u+Math.floor(.5*e));if(s==-v)return new mxPoint(f+Math.floor(.75*o),u+e);if(s==-y+v)return new mxPoint(f+Math.floor(.25*o),u+e);s>0&&s<v?(l=new mxPoint(f+Math.floor(.5*o),u-Math.floor(.5*e)),a=new mxPoint(f+Math.floor(1.25*o),u+e)):s>v&&s<y-v?(l=new mxPoint(f,u),a=new mxPoint(f+o,u)):s>y-v&&s<y?(l=new mxPoint(f-Math.floor(.25*o),u+e),a=new mxPoint(f+Math.floor(.5*o),u-Math.floor(.5*e))):s<0&&s>-v?(l=new mxPoint(f+Math.floor(.5*o),u+Math.floor(1.5*e)),a=new mxPoint(f+Math.floor(1.25*o),u)):s<-v&&s>-y+v?(l=new mxPoint(f,u+e),a=new mxPoint(f+o,u+e)):s<-y+v&&s>-y&&(l=new mxPoint(f-Math.floor(.25*o),u),a=new mxPoint(f+Math.floor(.5*o),u+Math.floor(1.5*e)))}k=mxUtils.intersection(p,w,i.x,i.y,l.x,l.y,a.x,a.y)}return k==null?new mxPoint(p,w):k}};mxPrintPreview.prototype.graph=null;mxPrintPreview.prototype.pageFormat=null;mxPrintPreview.prototype.scale=null;mxPrintPreview.prototype.border=0;mxPrintPreview.prototype.x0=0;mxPrintPreview.prototype.y0=0;mxPrintPreview.prototype.autoOrigin=!0;mxPrintPreview.prototype.printOverlays=!1;mxPrintPreview.prototype.printControls=!1;mxPrintPreview.prototype.printBackgroundImage=!1;mxPrintPreview.prototype.borderColor=null;mxPrintPreview.prototype.title=null;mxPrintPreview.prototype.pageSelector=null;mxPrintPreview.prototype.wnd=null;mxPrintPreview.prototype.pageCount=0;mxPrintPreview.prototype.getWindow=function(){return this.wnd};mxPrintPreview.prototype.getDoctype=function(){var n="";return document.documentMode==5?n='<meta http-equiv="X-UA-Compatible" content="IE=5">':document.documentMode==8?n='<meta http-equiv="X-UA-Compatible" content="IE=8">':document.documentMode>8&&(n='<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->'),n};mxPrintPreview.prototype.open=function(n){var nt=this.graph.cellRenderer.initializeOverlay,u=null,t,c,d,a,e,v,o,i;try{if(this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(n,t){t.init(n.view.getDrawPane())}),this.printControls&&(this.graph.cellRenderer.initControl=function(n,t){t.dialect=n.view.graph.dialect;t.init(n.view.getDrawPane())}),this.wnd==null){this.wnd=window.open();t=this.wnd.document;c=this.getDoctype();c!=null&&c.length>0&&t.writeln(c);mxClient.IS_VML?t.writeln('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">'):(document.compatMode==="CSS1Compat"&&t.writeln("<!DOCTYPE html>"),t.writeln("<html>"));t.writeln("<head>");this.writeHead(t,n);t.writeln("<\/head>");t.writeln('<body class="mxPage">');var r=this.graph.getGraphBounds().clone(),s=this.graph.getView().getScale(),w=s/this.scale,l=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=l.x*this.scale,this.y0-=l.y*this.scale,r.width+=r.x,r.height+=r.y,r.x=0,r.y=0,this.border=0);r.width/=w;r.height/=w;var b=this.pageFormat.width-this.border*2,k=this.pageFormat.height-this.border*2,f=Math.max(1,Math.ceil((r.width+this.x0)/b)),h=Math.max(1,Math.ceil((r.height+this.y0)/k));this.pageCount=f*h;d=mxUtils.bind(this,function(){var n,i;this.pageSelector&&(h>1||f>1)&&(n=this.createPageSelector(h,f),t.body.appendChild(n),(mxClient.IS_IE&&t.documentMode==null||t.documentMode==5||t.documentMode==8||t.documentMode==7)&&(n.style.position="absolute",i=function(){n.style.top=(t.body.scrollTop||t.documentElement.scrollTop)+10+"px"},mxEvent.addListener(this.wnd,"scroll",function(){i()}),mxEvent.addListener(this.wnd,"resize",function(){i()})))});function y(n,i){if(this.borderColor!=null&&(n.style.borderColor=this.borderColor,n.style.borderStyle="solid",n.style.borderWidth="1px"),n.style.background="white",i&&(n.style.pageBreakAfter="always"),mxClient.IS_IE||document.documentMode>=11?(t.writeln(n.outerHTML),n.parentNode.removeChild(n)):(n.parentNode.removeChild(n),t.body.appendChild(n)),i){var r=t.createElement("hr");r.className="mxPageBreak";t.body.appendChild(r)}}if(a=this.getCoverPages(this.pageFormat.width,this.pageFormat.height),a!=null)for(i=0;i<a.length;i++)y(a[i],!0);for(e=this.getAppendices(this.pageFormat.width,this.pageFormat.height),i=0;i<h;i++)for(v=i*k/this.scale-this.y0/this.scale+(r.y-l.y*s)/s,o=0;o<f;o++){if(this.wnd==null)return null;var p=o*b/this.scale-this.x0/this.scale+(r.x-l.x*s)/s,g=i*f+o+1,tt=new mxRectangle(p,v,this.pageFormat.width,this.pageFormat.height);u=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,mxUtils.bind(this,function(n){this.addGraphFragment(-p,-v,this.scale,g,n,tt);this.printBackgroundImage&&this.insertBackgroundImage(n,-p,-v)}));u.setAttribute("id","mxPage-"+g);y(u,e!=null||i<h-1||o<f-1)}if(e!=null)for(i=0;i<e.length;i++)y(e[i],i<e.length);t.writeln("<\/body>");t.writeln("<\/html>");t.close();d();mxEvent.release(t.body)}this.wnd.focus()}catch(it){u!=null&&u.parentNode!=null&&u.parentNode.removeChild(u)}finally{this.graph.cellRenderer.initializeOverlay=nt}return this.wnd};mxPrintPreview.prototype.writeHead=function(n,t){this.title!=null&&n.writeln("<title>"+this.title+"<\/title>");mxClient.IS_VML&&n.writeln('<style type="text/css">v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}<\/style>');mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",n);n.writeln('<style type="text/css">');n.writeln("@media print {");n.writeln("  table.mxPageSelector { display: none; }");n.writeln("  hr.mxPageBreak { display: none; }");n.writeln("}");n.writeln("@media screen {");n.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }");n.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }");n.writeln("  body.mxPage { background: gray; }");n.writeln("}");t!=null&&n.writeln(t);n.writeln("<\/style>")};mxPrintPreview.prototype.createPageSelector=function(n,t){var i=this.wnd.document,r=i.createElement("table"),o,u,s,f,l;for(r.className="mxPageSelector",r.setAttribute("border","0"),o=i.createElement("tbody"),u=0;u<n;u++){for(s=i.createElement("tr"),f=0;f<t;f++){var h=u*t+f+1,c=i.createElement("td"),e=i.createElement("a");e.setAttribute("href","#mxPage-"+h);!mxClient.IS_NS||mxClient.IS_SF||mxClient.IS_GC||(l="var page = document.getElementById('mxPage-"+h+"');page.scrollIntoView(true);event.preventDefault();",e.setAttribute("onclick",l));mxUtils.write(e,h,i);c.appendChild(e);s.appendChild(c)}o.appendChild(s)}return r.appendChild(o),r};mxPrintPreview.prototype.renderPage=function(n,t,i,r,u){var s=this.wnd.document,e=document.createElement("div"),h=null,o,f;try{i!=0||r!=0?(e.style.position="relative",e.style.width=n+"px",e.style.height=t+"px",e.style.pageBreakInside="avoid",f=document.createElement("div"),f.style.position="relative",f.style.top=this.border+"px",f.style.left=this.border+"px",f.style.width=n-2*this.border+"px",f.style.height=t-2*this.border+"px",f.style.overflow="hidden",o=document.createElement("div"),o.style.position="relative",o.style.marginLeft=i+"px",o.style.marginTop=r+"px",s.documentMode==8&&(f.style.position="absolute",o.style.position="absolute"),s.documentMode==10&&(o.style.width="100%",o.style.height="100%"),f.appendChild(o),e.appendChild(f),document.body.appendChild(e),h=o):(e.style.width=n+"px",e.style.height=t+"px",e.style.overflow="hidden",e.style.pageBreakInside="avoid",s.documentMode==8&&(e.style.position="relative"),f=document.createElement("div"),f.style.width=n-2*this.border+"px",f.style.height=t-2*this.border+"px",f.style.overflow="hidden",mxClient.IS_IE&&(s.documentMode==null||s.documentMode==5||s.documentMode==8||s.documentMode==7)?(f.style.marginTop=this.border+"px",f.style.marginLeft=this.border+"px"):(f.style.top=this.border+"px",f.style.left=this.border+"px"),this.graph.dialect==mxConstants.DIALECT_VML&&(f.style.position="absolute"),e.appendChild(f),document.body.appendChild(e),h=f)}catch(c){e.parentNode.removeChild(e);e=null;throw c;}return u(h),e};mxPrintPreview.prototype.getRoot=function(){var n=this.graph.view.currentRoot;return n==null&&(n=this.graph.getModel().getRoot()),n};mxPrintPreview.prototype.addGraphFragment=function(n,t,i,r,u){var f=this.graph.getView(),p=this.graph.container,c,l,a,o,v,e,y,s,h;this.graph.container=u;var w=f.getCanvas(),b=f.getBackgroundPane(),k=f.getDrawPane(),d=f.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?f.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?f.createVml():f.createHtml();c=f.isEventsEnabled();f.setEventsEnabled(!1);l=this.graph.isEnabled();this.graph.setEnabled(!1);a=f.getTranslate();f.translate=new mxPoint(n,t);o=null;try{v=[this.getRoot()];o=new mxTemporaryCellStates(f,i,v)}finally{if(mxClient.IS_IE)f.overlayPane.innerHTML="";else for(e=u.firstChild;e!=null;)y=e.nextSibling,s=e.nodeName.toLowerCase(),s=="svg"?(e.setAttribute("width",parseInt(u.style.width)),e.setAttribute("height",parseInt(u.style.height))):e.style.cursor!="default"&&s!="div"&&e.parentNode.removeChild(e),e=y;this.printBackgroundImage&&(h=u.getElementsByTagName("svg"),h.length>0&&(h[0].style.position="absolute"));f.overlayPane.parentNode.removeChild(f.overlayPane);this.graph.setEnabled(l);this.graph.container=p;f.canvas=w;f.backgroundPane=b;f.drawPane=k;f.overlayPane=d;f.translate=a;o.destroy();f.setEventsEnabled(c)}};mxPrintPreview.prototype.insertBackgroundImage=function(n,t,i){var u=this.graph.backgroundImage,r;u!=null&&(r=document.createElement("img"),r.style.position="absolute",r.style.marginLeft=Math.round(t*this.scale)+"px",r.style.marginTop=Math.round(i*this.scale)+"px",r.setAttribute("width",Math.round(this.scale*u.width)),r.setAttribute("height",Math.round(this.scale*u.height)),r.src=u.src,n.insertBefore(r,n.firstChild))};mxPrintPreview.prototype.getCoverPages=function(){return null};mxPrintPreview.prototype.getAppendices=function(){return null};mxPrintPreview.prototype.print=function(n){var t=this.open(n);t!=null&&t.print()};mxPrintPreview.prototype.close=function(){this.wnd!=null&&(this.wnd.close(),this.wnd=null)};mxStylesheet.prototype.styles;mxStylesheet.prototype.createDefaultVertexStyle=function(){var n={};return n[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE,n[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter,n[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,n[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,n[mxConstants.STYLE_FILLCOLOR]="#C3D9FF",n[mxConstants.STYLE_STROKECOLOR]="#6482B9",n[mxConstants.STYLE_FONTCOLOR]="#774400",n};mxStylesheet.prototype.createDefaultEdgeStyle=function(){var n={};return n[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR,n[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC,n[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,n[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER,n[mxConstants.STYLE_STROKECOLOR]="#6482B9",n[mxConstants.STYLE_FONTCOLOR]="#446299",n};mxStylesheet.prototype.putDefaultVertexStyle=function(n){this.putCellStyle("defaultVertex",n)};mxStylesheet.prototype.putDefaultEdgeStyle=function(n){this.putCellStyle("defaultEdge",n)};mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex};mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge};mxStylesheet.prototype.putCellStyle=function(n,t){this.styles[n]=t};mxStylesheet.prototype.getCellStyle=function(n,t){var i=t,h,e,u,o,f,s,r;if(n!=null&&n.length>0)for(h=n.split(";"),i=i!=null&&n.charAt(0)!=";"?mxUtils.clone(i):{},e=0;e<h.length;e++)if(u=h[e],o=u.indexOf("="),o>=0)r=u.substring(0,o),f=u.substring(o+1),f==mxConstants.NONE?delete i[r]:i[r]=mxUtils.isNumeric(f)?parseFloat(f):f;else if(s=this.styles[u],s!=null)for(r in s)i[r]=s[r];return i};mxCellState.prototype=new mxRectangle;mxCellState.prototype.constructor=mxCellState;mxCellState.prototype.view=null;mxCellState.prototype.cell=null;mxCellState.prototype.style=null;mxCellState.prototype.invalid=!0;mxCellState.prototype.origin=null;mxCellState.prototype.absolutePoints=null;mxCellState.prototype.absoluteOffset=null;mxCellState.prototype.visibleSourceState=null;mxCellState.prototype.visibleTargetState=null;mxCellState.prototype.terminalDistance=0;mxCellState.prototype.length=0;mxCellState.prototype.segments=null;mxCellState.prototype.shape=null;mxCellState.prototype.text=null;mxCellState.prototype.getPerimeterBounds=function(n,t){if(n=n||0,t=t!=null?t:new mxRectangle(this.x,this.y,this.width,this.height),this.shape!=null&&this.shape.stencil!=null&&this.shape.stencil.aspect=="fixed"){var i=this.shape.stencil.computeAspect(this.style,t.x,t.y,t.width,t.height);t.x=i.x;t.y=i.y;t.width=this.shape.stencil.w0*i.width;t.height=this.shape.stencil.h0*i.height}return n!=0&&t.grow(n),t};mxCellState.prototype.setAbsoluteTerminalPoint=function(n,t){t?(this.absolutePoints==null&&(this.absolutePoints=[]),this.absolutePoints.length==0?this.absolutePoints.push(n):this.absolutePoints[0]=n):this.absolutePoints==null?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(n)):this.absolutePoints.length==1?this.absolutePoints.push(n):this.absolutePoints[this.absolutePoints.length-1]=n};mxCellState.prototype.setCursor=function(n){this.shape!=null&&this.shape.setCursor(n);this.text!=null&&this.text.setCursor(n)};mxCellState.prototype.getVisibleTerminal=function(n){var t=this.getVisibleTerminalState(n);return t!=null?t.cell:null};mxCellState.prototype.getVisibleTerminalState=function(n){return n?this.visibleSourceState:this.visibleTargetState};mxCellState.prototype.setVisibleTerminalState=function(n,t){t?this.visibleSourceState=n:this.visibleTargetState=n};mxCellState.prototype.getCellBounds=function(){return this.cellBounds};mxCellState.prototype.getPaintBounds=function(){return this.paintBounds};mxCellState.prototype.updateCachedBounds=function(){var t=this.view.translate,n=this.view.scale;this.cellBounds=new mxRectangle(this.x/n-t.x,this.y/n-t.y,this.width/n,this.height/n);this.paintBounds=mxRectangle.fromRectangle(this.cellBounds);this.shape!=null&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()};mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)};mxCellState.prototype.clone=function(){var n=new mxCellState(this.view,this.cell,this.style),t;if(this.absolutePoints!=null)for(n.absolutePoints=[],t=0;t<this.absolutePoints.length;t++)n.absolutePoints[t]=this.absolutePoints[t].clone();return this.origin!=null&&(n.origin=this.origin.clone()),this.absoluteOffset!=null&&(n.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox!=null&&(n.boundingBox=this.boundingBox.clone()),n.terminalDistance=this.terminalDistance,n.segments=this.segments,n.length=this.length,n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n};mxGraphSelectionModel.prototype=new mxEventSource;mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel;mxGraphSelectionModel.prototype.doneResource=mxClient.language!="none"?"done":"";mxGraphSelectionModel.prototype.updatingSelectionResource=mxClient.language!="none"?"updatingSelection":"";mxGraphSelectionModel.prototype.graph=null;mxGraphSelectionModel.prototype.singleSelection=!1;mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection};mxGraphSelectionModel.prototype.setSingleSelection=function(n){this.singleSelection=n};mxGraphSelectionModel.prototype.isSelected=function(n){return n!=null?mxUtils.indexOf(this.cells,n)>=0:!1};mxGraphSelectionModel.prototype.isEmpty=function(){return this.cells.length==0};mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)};mxGraphSelectionModel.prototype.setCell=function(n){n!=null&&this.setCells([n])};mxGraphSelectionModel.prototype.setCells=function(n){var i,t;if(n!=null){for(this.singleSelection&&(n=[this.getFirstSelectableCell(n)]),i=[],t=0;t<n.length;t++)this.graph.isCellSelectable(n[t])&&i.push(n[t]);this.changeSelection(i,this.cells)}};mxGraphSelectionModel.prototype.getFirstSelectableCell=function(n){if(n!=null)for(var t=0;t<n.length;t++)if(this.graph.isCellSelectable(n[t]))return n[t];return null};mxGraphSelectionModel.prototype.addCell=function(n){n!=null&&this.addCells([n])};mxGraphSelectionModel.prototype.addCells=function(n){var i,r,t;if(n!=null){for(i=null,this.singleSelection&&(i=this.cells,n=[this.getFirstSelectableCell(n)]),r=[],t=0;t<n.length;t++)!this.isSelected(n[t])&&this.graph.isCellSelectable(n[t])&&r.push(n[t]);this.changeSelection(r,i)}};mxGraphSelectionModel.prototype.removeCell=function(n){n!=null&&this.removeCells([n])};mxGraphSelectionModel.prototype.removeCells=function(n){var i,t;if(n!=null){for(i=[],t=0;t<n.length;t++)this.isSelected(n[t])&&i.push(n[t]);this.changeSelection(null,i)}};mxGraphSelectionModel.prototype.changeSelection=function(n,t){var i,r;(n!=null&&n.length>0&&n[0]!=null||t!=null&&t.length>0&&t[0]!=null)&&(i=new mxSelectionChange(this,n,t),i.execute(),r=new mxUndoableEdit(this,!1),r.add(i),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",r)))};mxGraphSelectionModel.prototype.cellAdded=function(n){n==null||this.isSelected(n)||this.cells.push(n)};mxGraphSelectionModel.prototype.cellRemoved=function(n){if(n!=null){var t=mxUtils.indexOf(this.cells,n);t>=0&&this.cells.splice(t,1)}};mxSelectionChange.prototype.execute=function(){var i=mxLog.enter("mxSelectionChange.execute"),n,t;if(window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource,this.removed!=null)for(n=0;n<this.removed.length;n++)this.selectionModel.cellRemoved(this.removed[n]);if(this.added!=null)for(n=0;n<this.added.length;n++)this.selectionModel.cellAdded(this.added[n]);t=this.added;this.added=this.removed;this.removed=t;window.status=mxResources.get(this.selectionModel.doneResource)||this.selectionModel.doneResource;mxLog.leave("mxSelectionChange.execute",i);this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))};mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=!1;mxCellEditor.prototype.autoSize=!0;mxCellEditor.prototype.selectText=!0;mxCellEditor.prototype.emptyLabelText="";mxCellEditor.prototype.textNode="";mxCellEditor.prototype.zIndex=5;mxCellEditor.prototype.minResize=new mxRectangle(0,20);mxCellEditor.prototype.init=function(){this.textarea=document.createElement("textarea");this.textarea.className="mxCellEditor";this.textarea.style.position="absolute";this.textarea.style.overflow="visible";this.textarea.setAttribute("cols","20");this.textarea.setAttribute("rows","4");mxClient.IS_NS&&(this.textarea.style.resize="none");this.installListeners(this.textarea)};mxCellEditor.prototype.installListeners=function(n){mxEvent.addListener(n,"blur",mxUtils.bind(this,function(n){this.focusLost(n)}));mxEvent.addListener(n,"change",mxUtils.bind(this,function(){this.setModified(!0)}));mxEvent.addListener(n,"keydown",mxUtils.bind(this,function(t){mxEvent.isConsumed(t)||(this.isStopEditingEvent(t)?(this.graph.stopEditing(!1),mxEvent.consume(t)):t.keyCode==27?(this.graph.stopEditing(!0),mxEvent.consume(t)):(this.clearOnChange&&n.value==this.getEmptyLabelText()&&(this.clearOnChange=!1,n.value=""),this.setModified(!0)))}));this.changeHandler=mxUtils.bind(this,function(){this.editingCell!=null&&this.graph.getView().getState(this.editingCell)==null&&this.stopEditing(!0)});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);var t=!mxClient.IS_IE11&&(!mxClient.IS_IE||document.documentMode>=9)?"input":"keypress";mxEvent.addListener(n,t,mxUtils.bind(this,function(n){this.autoSize&&!mxEvent.isConsumed(n)&&setTimeout(mxUtils.bind(this,function(){this.resize()}),0)}))};mxCellEditor.prototype.isStopEditingEvent=function(n){return n.keyCode==113||this.graph.isEnterStopsCellEditing()&&n.keyCode==13&&!mxEvent.isControlDown(n)&&!mxEvent.isShiftDown(n)};mxCellEditor.prototype.isEventSource=function(n){return mxEvent.getSource(n)==this.textarea};mxCellEditor.prototype.resize=function(){var n,o,h,c,l;if(this.textDiv!=null)if(n=this.graph.getView().getState(this.editingCell),n==null)this.stopEditing(!0);else if(o=this.graph.getModel().isEdge(n.cell),o||n.style[mxConstants.STYLE_OVERFLOW]!="fill"){var i=this.graph.getView().scale,f=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_WIDTH,null),r=n.text!=null?n.text.margin:null;if(r==null&&(r=mxUtils.getAlignmentAsPoint(mxUtils.getValue(n.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE))),o)this.bounds.x=n.absoluteOffset.x,this.bounds.y=n.absoluteOffset.y,this.bounds.width=0,this.bounds.height=0,f!=null&&(h=(parseFloat(f)+2)*i,this.bounds.width=h,this.bounds.x+=r.x*h);else if(this.bounds!=null){var t=mxRectangle.fromRectangle(n),a=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),v=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(t=n.shape!=null&&a==mxConstants.ALIGN_CENTER&&v==mxConstants.ALIGN_MIDDLE?n.shape.getLabelBounds(t):t,f!=null&&(t.width=parseFloat(f)*i),!n.view.graph.cellRenderer.legacySpacing||n.style[mxConstants.STYLE_OVERFLOW]!="width"){var s=parseInt(n.style[mxConstants.STYLE_SPACING]||2)*i,y=(parseInt(n.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*i+s,b=(parseInt(n.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*i+s,k=(parseInt(n.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*i+s,p=(parseInt(n.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*i+s,a=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),v=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);t=new mxRectangle(t.x+p,t.y+y,t.width-(a==mxConstants.ALIGN_CENTER&&f==null?p+b:0),t.height-(v==mxConstants.ALIGN_MIDDLE?y+k:0))}this.bounds.x=t.x+n.absoluteOffset.x-1;this.bounds.y=t.y+n.absoluteOffset.y;this.bounds.width=t.width+2;this.bounds.height=t.height}c=this.graph.isWrapping(n.cell)&&(this.bounds.width>=2||this.bounds.height>=2);c&&(this.textDiv.style.whiteSpace="normal",mxClient.IS_QUIRKS?this.textDiv.style.width=Math.ceil(this.bounds.width)+"px":this.textDiv.style.maxWidth=Math.ceil(this.bounds.width)+"px");l=this.getCurrentHtmlValue();this.textDiv.innerHTML=l.length>0?l:"&nbsp;";var w=mxUtils.getValue(n.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*i,u=this.textDiv.offsetWidth+w,e=this.textDiv.offsetHeight+16;this.minResize!=null&&(u=Math.max(u,this.minResize.width),e=Math.max(e,this.minResize.height));c&&(u=Math.min(this.bounds.width,u));this.textarea.style.left=Math.max(0,Math.ceil(this.bounds.x-r.x*(this.bounds.width-u-3)))+"px";this.textarea.style.top=o?Math.max(0,Math.round(this.bounds.y-r.y*this.bounds.height+r.y*e-r.y*4)+6)+"px":Math.max(0,Math.floor(this.bounds.y-r.y*(this.bounds.height-e+w*.1+8)))+"px";this.textarea.style.width=Math.ceil(u+this.textarea.offsetWidth-this.textarea.clientWidth)+"px";this.textarea.style.height=Math.ceil(e)+"px"}};mxCellEditor.prototype.isModified=function(){return this.modified};mxCellEditor.prototype.setModified=function(n){this.modified=n};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};mxCellEditor.prototype.startEditing=function(n,t){var i,r,u,f;if(this.textarea==null&&this.init(),this.stopEditing(!0),i=this.graph.getView().getState(n),i!=null){this.editingCell=n;this.trigger=t;this.textNode=null;i.text!=null&&this.isHideLabel(i)&&(this.textNode=i.text.node,this.textNode.style.visibility="hidden");var o=this.graph.getView().scale,e=mxUtils.getValue(i.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*o,s=mxUtils.getValue(i.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),h=mxUtils.getValue(i.style,mxConstants.STYLE_FONTCOLOR,"black"),c=mxUtils.getValue(i.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),l=(mxUtils.getValue(i.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,a=(mxUtils.getValue(i.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,v=(mxUtils.getValue(i.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(e*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;this.textarea.style.textDecoration=v?"underline":"";this.textarea.style.fontWeight=l?"bold":"normal";this.textarea.style.fontStyle=a?"italic":"";this.textarea.style.fontSize=Math.round(e)+"px";this.textarea.style.fontFamily=s;this.textarea.style.textAlign=c;this.textarea.style.overflow="auto";this.textarea.style.outline="none";this.textarea.style.color=h;this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(e*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;r=this.textDirection=mxUtils.getValue(i.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);r==mxConstants.TEXT_DIRECTION_AUTO&&(i==null||i.text==null||i.text.dialect==mxConstants.DIALECT_STRICTHTML||mxUtils.isNode(i.text.value)||(r=i.text.getAutoDirection()));r==mxConstants.TEXT_DIRECTION_LTR||r==mxConstants.TEXT_DIRECTION_RTL?this.textarea.setAttribute("dir",r):this.textarea.removeAttribute("dir");u=this.getEditorBounds(i);this.bounds=u;this.textarea.style.left=u.x+"px";this.textarea.style.top=u.y+"px";this.textarea.style.width=u.width+"px";this.textarea.style.height=u.height+"px";this.textarea.style.zIndex=this.zIndex;f=this.getInitialValue(i,t);f==null||f.length==0?(f=this.getEmptyLabelText(),this.clearOnChange=f.length>0):this.clearOnChange=!1;this.setModified(!1);this.textarea.value=f;this.graph.container.appendChild(this.textarea);this.textarea.style.display!="none"&&(this.autoSize&&(this.textDiv=this.createTextDiv(),document.body.appendChild(this.textDiv),this.resize()),this.textarea.focus(),this.isSelectText()&&this.textarea.value.length>0&&(mxClient.IS_IOS?document.execCommand("selectAll"):this.textarea.select()))}};mxCellEditor.prototype.isSelectText=function(){return this.selectText};mxCellEditor.prototype.createTextDiv=function(){var t=document.createElement("div"),n=t.style;return n.position="absolute",n.whiteSpace="nowrap",n.visibility="hidden",n.padding="0px",n.margin="0px",n.display=mxClient.IS_QUIRKS?"inline":"inline-block",n.zoom="1",n.verticalAlign="top",n.lineHeight=this.textarea.style.lineHeight,n.fontSize=this.textarea.style.fontSize,n.fontFamily=this.textarea.style.fontFamily,n.fontWeight=this.textarea.style.fontWeight,n.textAlign=this.textarea.style.textAlign,n.fontStyle=this.textarea.style.fontStyle,n.textDecoration=this.textarea.style.textDecoration,t};mxCellEditor.prototype.stopEditing=function(n){n=n||!1;this.editingCell!=null&&(this.textNode!=null&&(this.textNode.style.visibility="visible",this.textNode=null),n||this.applyValue(),this.textDiv!=null&&(document.body.removeChild(this.textDiv),this.textDiv=null),this.editingCell=null,this.trigger=null,this.bounds=null,this.textarea.blur(),this.textarea.parentNode!=null&&this.textarea.parentNode.removeChild(this.textarea))};mxCellEditor.prototype.applyValue=function(){this.isModified()&&this.graph.labelChanged(this.editingCell,this.getCurrentValue(),this.trigger)};mxCellEditor.prototype.getInitialValue=function(n,t){return this.graph.getEditingValue(n.cell,t)};mxCellEditor.prototype.getCurrentValue=function(){return this.textarea.value.replace(/\r/g,"")};mxCellEditor.prototype.getCurrentHtmlValue=function(){var n=this.getCurrentValue();return(n.charAt(n.length-1)=="\n"||n=="")&&(n+="&nbsp;"),mxUtils.htmlEntities(n,!1).replace(/\n/g,"<br/>")};mxCellEditor.prototype.isHideLabel=function(){return!0};mxCellEditor.prototype.getMinimumSize=function(n){var t=this.graph.getView().scale;return new mxRectangle(0,0,n.text==null?30:n.text.size*t+20,this.textarea.style.textAlign=="left"?120:40)};mxCellEditor.prototype.getEditorBounds=function(n){var u=this.graph.getModel().isEdge(n.cell),i=this.graph.getView().scale,o=this.getMinimumSize(n),s=o.width,h=o.height,t=null,a,v,f,e;if(!u&&n.view.graph.cellRenderer.legacySpacing&&n.style[mxConstants.STYLE_OVERFLOW]=="fill")t=n.shape.getLabelBounds(mxRectangle.fromRectangle(n));else{var r=parseInt(n.style[mxConstants.STYLE_SPACING]||0)*i,c=(parseInt(n.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*i+r,y=(parseInt(n.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*i+r,p=(parseInt(n.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*i+r,l=(parseInt(n.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*i+r;t=new mxRectangle(n.x,n.y,Math.max(s,n.width-l-y),Math.max(h,n.height-c-p));a=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);v=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);t=n.shape!=null&&a==mxConstants.ALIGN_CENTER&&v==mxConstants.ALIGN_MIDDLE?n.shape.getLabelBounds(t):t;u?(t.x=n.absoluteOffset.x,t.y=n.absoluteOffset.y,n.text!=null&&n.text.boundingBox!=null&&(n.text.boundingBox.x>0&&(t.x=n.text.boundingBox.x),n.text.boundingBox.y>0&&(t.y=n.text.boundingBox.y))):n.text!=null&&n.text.boundingBox!=null&&(t.x=Math.min(t.x,n.text.boundingBox.x),t.y=Math.min(t.y,n.text.boundingBox.y));t.x+=l;t.y+=c;n.text!=null&&n.text.boundingBox!=null&&(u?(t.width=Math.max(s,n.text.boundingBox.width),t.height=Math.max(h,n.text.boundingBox.height)):(t.width=Math.max(t.width,n.text.boundingBox.width),t.height=Math.max(t.height,n.text.boundingBox.height)));this.graph.getModel().isVertex(n.cell)&&(f=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),f==mxConstants.ALIGN_LEFT?t.x-=n.width:f==mxConstants.ALIGN_RIGHT&&(t.x+=n.width),e=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),e==mxConstants.ALIGN_TOP?t.y-=n.height:e==mxConstants.ALIGN_BOTTOM&&(t.y+=n.height))}return new mxRectangle(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))};mxCellEditor.prototype.getEmptyLabelText=function(){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};mxCellEditor.prototype.destroy=function(){this.textarea!=null&&(mxEvent.release(this.textarea),this.textarea.parentNode!=null&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null,this.changeHandler!=null&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null))};mxCellRenderer.prototype.defaultEdgeShape=mxConnector;mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape;mxCellRenderer.prototype.defaultTextShape=mxText;mxCellRenderer.prototype.legacyControlPosition=!0;mxCellRenderer.prototype.legacySpacing=!0;mxCellRenderer.prototype.defaultShapes={};mxCellRenderer.prototype.antiAlias=!0;mxCellRenderer.registerShape=function(n,t){mxCellRenderer.prototype.defaultShapes[n]=t};mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape);mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus);mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder);mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor);mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle);mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon);mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud);mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine);mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow);mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW_CONNECTOR,mxArrowConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane);mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape);mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel);mxCellRenderer.prototype.initializeShape=function(n){n.shape.dialect=n.view.graph.dialect;this.configureShape(n);n.shape.init(n.view.getDrawPane())};mxCellRenderer.prototype.createShape=function(n){var t=null,i,r;return n.style!=null&&(i=mxStencilRegistry.getStencil(n.style[mxConstants.STYLE_SHAPE]),i!=null?t=new mxShape(i):(r=this.getShapeConstructor(n),t=new r)),t};mxCellRenderer.prototype.createIndicatorShape=function(n){n.shape.indicatorShape=this.getShape(n.view.graph.getIndicatorShape(n))};mxCellRenderer.prototype.getShape=function(n){return n!=null?mxCellRenderer.prototype.defaultShapes[n]:null};mxCellRenderer.prototype.getShapeConstructor=function(n){var t=this.getShape(n.style[mxConstants.STYLE_SHAPE]);return t==null&&(t=n.view.graph.getModel().isEdge(n.cell)?this.defaultEdgeShape:this.defaultVertexShape),t};mxCellRenderer.prototype.configureShape=function(n){n.shape.apply(n);n.shape.image=n.view.graph.getImage(n);n.shape.indicatorColor=n.view.graph.getIndicatorColor(n);n.shape.indicatorStrokeColor=n.style[mxConstants.STYLE_INDICATOR_STROKECOLOR];n.shape.indicatorGradientColor=n.view.graph.getIndicatorGradientColor(n);n.shape.indicatorDirection=n.style[mxConstants.STYLE_INDICATOR_DIRECTION];n.shape.indicatorImage=n.view.graph.getIndicatorImage(n);this.postConfigureShape(n)};mxCellRenderer.prototype.postConfigureShape=function(n){n.shape!=null&&(this.resolveColor(n,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(n,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(n,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(n,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(n,"gradient",mxConstants.STYLE_GRADIENTCOLOR))};mxCellRenderer.prototype.resolveColor=function(n,t,i){var e=n.shape[t],r=n.view.graph,u=null,f;e=="inherit"?u=r.model.getParent(n.cell):e=="swimlane"?(u=r.model.getTerminal(n.cell,!1)!=null?r.model.getTerminal(n.cell,!1):n.cell,u=r.getSwimlane(u),i=r.swimlaneIndicatorColorAttribute):e=="indicated"&&(n.shape[t]=n.shape.indicatorColor);u!=null&&(f=r.getView().getState(u),n.shape[t]=null,f!=null&&(n.shape[t]=f.shape!=null&&t!="indicatorColor"?f.shape[t]:f.style[i]))};mxCellRenderer.prototype.getLabelValue=function(n){return n.view.graph.getLabel(n.cell)};mxCellRenderer.prototype.createLabel=function(n,t){var i=n.view.graph,e=i.getModel().isEdge(n.cell),f,r,u;(n.style[mxConstants.STYLE_FONTSIZE]>0||n.style[mxConstants.STYLE_FONTSIZE]==null)&&(f=i.isHtmlLabel(n.cell)||t!=null&&mxUtils.isNode(t),n.text=new this.defaultTextShape(t,new mxRectangle,n.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,i.getVerticalAlign(n),n.style[mxConstants.STYLE_FONTCOLOR],n.style[mxConstants.STYLE_FONTFAMILY],n.style[mxConstants.STYLE_FONTSIZE],n.style[mxConstants.STYLE_FONTSTYLE],n.style[mxConstants.STYLE_SPACING],n.style[mxConstants.STYLE_SPACING_TOP],n.style[mxConstants.STYLE_SPACING_RIGHT],n.style[mxConstants.STYLE_SPACING_BOTTOM],n.style[mxConstants.STYLE_SPACING_LEFT],n.style[mxConstants.STYLE_HORIZONTAL],n.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],n.style[mxConstants.STYLE_LABEL_BORDERCOLOR],i.isWrapping(n.cell)&&i.isHtmlLabel(n.cell),i.isLabelClipped(n.cell),n.style[mxConstants.STYLE_OVERFLOW],n.style[mxConstants.STYLE_LABEL_PADDING],mxUtils.getValue(n.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION)),n.text.opacity=mxUtils.getValue(n.style,mxConstants.STYLE_TEXT_OPACITY,100),n.text.dialect=f?mxConstants.DIALECT_STRICTHTML:n.view.graph.dialect,n.text.style=n.style,n.text.state=n,this.initializeLabel(n,n.text),r=!1,u=function(t){var u=n;if(mxClient.IS_TOUCH||r){var e=mxEvent.getClientX(t),o=mxEvent.getClientY(t),f=mxUtils.convertPoint(i.container,e,o);u=i.view.getState(i.getCellAt(f.x,f.y))}return u},mxEvent.addGestureListeners(n.text.node,mxUtils.bind(this,function(t){this.isLabelEvent(n,t)&&(i.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(t,n)),r=i.dialect!=mxConstants.DIALECT_SVG&&mxEvent.getSource(t).nodeName=="IMG")}),mxUtils.bind(this,function(t){this.isLabelEvent(n,t)&&i.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(t,u(t)))}),mxUtils.bind(this,function(t){this.isLabelEvent(n,t)&&(i.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(t,u(t))),r=!1)})),i.nativeDblClickEnabled&&mxEvent.addListener(n.text.node,"dblclick",mxUtils.bind(this,function(t){this.isLabelEvent(n,t)&&(i.dblClick(t,n.cell),mxEvent.consume(t))})))};mxCellRenderer.prototype.initializeLabel=function(n,t){mxClient.IS_SVG&&mxClient.NO_FO&&t.dialect!=mxConstants.DIALECT_SVG?t.init(n.view.graph.container):t.init(n.view.getDrawPane())};mxCellRenderer.prototype.createCellOverlays=function(n){var e=n.view.graph,i=e.getCellOverlays(n.cell),u=null,t,f,r;if(i!=null)for(u=new mxDictionary,t=0;t<i.length;t++)f=n.overlays!=null?n.overlays.remove(i[t]):null,f==null?(r=new mxImageShape(new mxRectangle,i[t].image.src),r.dialect=n.view.graph.dialect,r.preserveImageAspect=!1,r.overlay=i[t],this.initializeOverlay(n,r),this.installCellOverlayListeners(n,i[t],r),i[t].cursor!=null&&(r.node.style.cursor=i[t].cursor),u.put(i[t],r)):u.put(i[t],f);n.overlays!=null&&n.overlays.visit(function(n,t){t.destroy()});n.overlays=u};mxCellRenderer.prototype.initializeOverlay=function(n,t){t.init(n.view.getOverlayPane())};mxCellRenderer.prototype.installCellOverlayListeners=function(n,t,i){var r=n.view.graph;mxEvent.addListener(i.node,"click",function(i){r.isEditing()&&r.stopEditing(!r.isInvokesStopCellEditing());t.fireEvent(new mxEventObject(mxEvent.CLICK,"event",i,"cell",n.cell))});mxEvent.addGestureListeners(i.node,function(n){mxEvent.consume(n)},function(t){r.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(t,n))});mxClient.IS_TOUCH&&mxEvent.addListener(i.node,"touchend",function(i){t.fireEvent(new mxEventObject(mxEvent.CLICK,"event",i,"cell",n.cell))})};mxCellRenderer.prototype.createControl=function(n){var i=n.view.graph,t=i.getFoldingImage(n),r;i.foldingEnabled&&t!=null?n.control==null&&(r=new mxRectangle(0,0,t.width,t.height),n.control=new mxImageShape(r,t.src),n.control.preserveImageAspect=!1,n.control.dialect=i.dialect,this.initControl(n,n.control,!0,this.createControlClickHandler(n))):n.control!=null&&(n.control.destroy(),n.control=null)};mxCellRenderer.prototype.createControlClickHandler=function(n){var t=n.view.graph;return function(i){if(t.isEnabled()){var r=!t.isCellCollapsed(n.cell);t.foldCells(r,!1,[n.cell],null,i);mxEvent.consume(i)}}};mxCellRenderer.prototype.initControl=function(n,t,i,r){var u=n.view.graph,e=u.isHtmlLabel(n.cell)&&mxClient.NO_FO&&u.dialect==mxConstants.DIALECT_SVG,f;return e?(t.dialect=mxConstants.DIALECT_PREFERHTML,t.init(u.container),t.node.style.zIndex=1):t.init(n.view.getOverlayPane()),f=t.innerNode||t.node,r&&(u.isEnabled()&&(f.style.cursor="pointer"),mxEvent.addListener(f,"click",r)),i&&mxEvent.addGestureListeners(f,function(t){u.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(t,n));mxEvent.consume(t)},function(t){u.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(t,n))}),f};mxCellRenderer.prototype.isShapeEvent=function(){return!0};mxCellRenderer.prototype.isLabelEvent=function(){return!0};mxCellRenderer.prototype.installListeners=function(n){var t=n.view.graph,i=function(i){var r=n;if(t.dialect!=mxConstants.DIALECT_SVG&&mxEvent.getSource(i).nodeName=="IMG"||mxClient.IS_TOUCH){var f=mxEvent.getClientX(i),e=mxEvent.getClientY(i),u=mxUtils.convertPoint(t.container,f,e);r=t.view.getState(t.getCellAt(u.x,u.y))}return r};mxEvent.addGestureListeners(n.shape.node,mxUtils.bind(this,function(i){this.isShapeEvent(n,i)&&t.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(i,n))}),mxUtils.bind(this,function(r){this.isShapeEvent(n,r)&&t.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(r,i(r)))}),mxUtils.bind(this,function(r){this.isShapeEvent(n,r)&&t.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(r,i(r)))}));t.nativeDblClickEnabled&&mxEvent.addListener(n.shape.node,"dblclick",mxUtils.bind(this,function(i){this.isShapeEvent(n,i)&&(t.dblClick(i,n.cell),mxEvent.consume(i))}))};mxCellRenderer.prototype.redrawLabel=function(n,t){var i=this.getLabelValue(n);if(n.text==null&&i!=null&&(mxUtils.isNode(i)||i.length>0)?this.createLabel(n,i):n.text!=null&&(i==null||i.length==0)&&(n.text.destroy(),n.text=null),n.text!=null){var r=n.view.graph,u=r.isWrapping(n.cell),f=r.isLabelClipped(n.cell),e=this.getLabelBounds(n),s=n.view.graph.isHtmlLabel(n.cell)||i!=null&&mxUtils.isNode(i),o=s?mxConstants.DIALECT_STRICTHTML:n.view.graph.dialect;(t||n.text.value!=i||n.text.isWrapping!=u||n.text.isClipping!=f||n.text.scale!=n.view.scale||n.text.dialect!=o||!n.text.bounds.equals(e))&&(n.text.dialect=o,n.text.value=i,n.text.bounds=e,n.text.scale=this.getTextScale(n),n.text.isWrapping=u,n.text.isClipping=f,n.text.redraw())}};mxCellRenderer.prototype.getTextScale=function(n){return n.view.scale};mxCellRenderer.prototype.getLabelBounds=function(n){var l=n.view.graph,i=n.view.scale,a=l.getModel().isEdge(n.cell),t=new mxRectangle(n.absoluteOffset.x,n.absoluteOffset.y),e,r,o,f,s,h,u,v,y,c;return a?(e=n.text.getSpacing(),t.x+=e.x*i,t.y+=e.y*i,r=l.getCellGeometry(n.cell),r!=null&&(t.width=Math.max(0,r.width*i),t.height=Math.max(0,r.height*i))):(n.text.isPaintBoundsInverted()&&(u=t.x,t.x=t.y,t.y=u),t.x+=n.x,t.y+=n.y,t.width=Math.max(1,n.width),t.height=Math.max(1,n.height),o=mxUtils.getValue(n.style,mxConstants.STYLE_STROKECOLOR,mxConstants.NONE),o!=mxConstants.NONE&&o!=""&&(f=parseFloat(mxUtils.getValue(n.style,mxConstants.STYLE_STROKEWIDTH,1))*i/2,s=2*f+.5,t.x+=f,t.y+=f,t.width-=s,t.height-=s)),n.text.isPaintBoundsInverted()&&(h=(n.width-n.height)/2,t.x+=h,t.y-=h,u=t.width,t.width=t.height,t.height=u),n.shape!=null&&(v=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),y=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),v==mxConstants.ALIGN_CENTER&&y==mxConstants.ALIGN_MIDDLE&&(t=n.shape.getLabelBounds(t))),c=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_WIDTH,null),c!=null&&(t.width=parseFloat(c)*i),a||this.rotateLabelBounds(n,t),t};mxCellRenderer.prototype.rotateLabelBounds=function(n,t){var i,r,u,f,e,o;if(t.x-=n.text.margin.x*t.width,t.y-=n.text.margin.y*t.height,!this.legacySpacing||n.style[mxConstants.STYLE_OVERFLOW]!="fill"&&n.style[mxConstants.STYLE_OVERFLOW]!="width"){i=n.view.scale;r=n.text.getSpacing();t.x+=r.x*i;t.y+=r.y*i;var s=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),h=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),c=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_WIDTH,null);t.width=Math.max(0,t.width-(s==mxConstants.ALIGN_CENTER&&c==null?n.text.spacingLeft*i+n.text.spacingRight*i:0));t.height=Math.max(0,t.height-(h==mxConstants.ALIGN_MIDDLE?n.text.spacingTop*i+n.text.spacingBottom*i:0))}u=n.text.getTextRotation();u!=0&&n!=null&&n.view.graph.model.isVertex(n.cell)&&(f=n.getCenterX(),e=n.getCenterY(),(t.x!=f||t.y!=e)&&(o=u*(Math.PI/180),pt=mxUtils.getRotatedPoint(new mxPoint(t.x,t.y),Math.cos(o),Math.sin(o),new mxPoint(f,e)),t.x=pt.x,t.y=pt.y))};mxCellRenderer.prototype.redrawCellOverlays=function(n,t){if(this.createCellOverlays(n),n.overlays!=null){var i=mxUtils.mod(mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION,0),90),r=mxUtils.toRadians(i),u=Math.cos(r),f=Math.sin(r);n.overlays.visit(function(r,e){var o=e.overlay.getBounds(n);if(!n.view.graph.getModel().isEdge(n.cell)&&n.shape!=null&&i!=0){var s=o.getCenterX(),h=o.getCenterY(),c=mxUtils.getRotatedPoint(new mxPoint(s,h),u,f,new mxPoint(n.getCenterX(),n.getCenterY()));s=c.x;h=c.y;o.x=Math.round(s-o.width/2);o.y=Math.round(h-o.height/2)}(t||e.bounds==null||e.scale!=n.view.scale||!e.bounds.equals(o))&&(e.bounds=o,e.scale=n.view.scale,e.redraw())})}};mxCellRenderer.prototype.redrawControl=function(n,t){var i=n.view.graph.getFoldingImage(n);if(n.control!=null&&i!=null){var r=this.getControlBounds(n,i.width,i.height),u=this.legacyControlPosition?mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION,0):n.shape.getTextRotation(),f=n.view.scale;(t||n.control.scale!=f||!n.control.bounds.equals(r)||n.control.rotation!=u)&&(n.control.rotation=u,n.control.bounds=r,n.control.scale=f,n.control.redraw())}};mxCellRenderer.prototype.getControlBounds=function(n,t,i){var e,o;if(n.control!=null){var r=n.view.scale,u=n.getCenterX(),f=n.getCenterY();if(!n.view.graph.getModel().isEdge(n.cell)&&(u=n.x+t*r,f=n.y+i*r,n.shape!=null&&(e=n.shape.getShapeRotation(),this.legacyControlPosition?e=mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION,0):n.shape.isPaintBoundsInverted()&&(o=(n.width-n.height)/2,u+=o,f-=o),e!=0))){var s=mxUtils.toRadians(e),c=Math.cos(s),l=Math.sin(s),h=mxUtils.getRotatedPoint(new mxPoint(u,f),c,l,new mxPoint(n.getCenterX(),n.getCenterY()));u=h.x;f=h.y}return n.view.graph.getModel().isEdge(n.cell)?new mxRectangle(Math.round(u-t/2*r),Math.round(f-i/2*r),Math.round(t*r),Math.round(i*r)):new mxRectangle(Math.round(u-t/2*r),Math.round(f-i/2*r),Math.round(t*r),Math.round(i*r))}return null};mxCellRenderer.prototype.insertStateAfter=function(n,t,i){for(var o,e,f,u=this.getShapesForState(n),r=0;r<u.length;r++)if(u[r]!=null){if(o=u[r].node.parentNode!=n.view.getDrawPane(),e=o?i:t,e!=null&&e.nextSibling!=u[r].node)e.nextSibling==null?e.parentNode.appendChild(u[r].node):e.parentNode.insertBefore(u[r].node,e.nextSibling);else if(e==null)if(u[r].node.parentNode==n.view.graph.container){for(f=n.view.canvas;f!=null&&f.parentNode!=n.view.graph.container;)f=f.parentNode;f!=null&&f.nextSibling!=null&&f.nextSibling!=u[r].node?u[r].node.parentNode.insertBefore(u[r].node,f.nextSibling):u[r].node.parentNode.appendChild(u[r].node)}else u[r].node.parentNode.firstChild!=null&&u[r].node.parentNode.firstChild!=u[r].node&&u[r].node.parentNode.insertBefore(u[r].node,u[r].node.parentNode.firstChild);o?i=u[r].node:t=u[r].node}return[t,i]};mxCellRenderer.prototype.getShapesForState=function(n){return[n.shape,n.text]};mxCellRenderer.prototype.redraw=function(n,t,i){var r=this.redrawShape(n,t,i);n.shape!=null&&(i==null||i)&&(this.redrawLabel(n,r),this.redrawCellOverlays(n,r),this.redrawControl(n,r))};mxCellRenderer.prototype.redrawShape=function(n,t,i){var r=!1;return n.shape!=null&&(n.shape.node==null&&(this.createIndicatorShape(n),this.initializeShape(n),this.createCellOverlays(n),this.installListeners(n)),this.createControl(n),mxUtils.equalEntries(n.shape.style,n.style)||(this.configureShape(n),t=!0),!t&&n.shape.bounds!=null&&n.shape.scale==n.view.scale&&(n.absolutePoints!=null||n.shape.bounds.equals(n))&&(n.absolutePoints==null||mxUtils.equalPoints(n.shape.points,n.absolutePoints))||(n.absolutePoints!=null?(n.shape.points=n.absolutePoints.slice(),n.shape.bounds=null):(n.shape.points=null,n.shape.bounds=new mxRectangle(n.x,n.y,n.width,n.height)),n.shape.scale=n.view.scale,i==null||i?n.shape.redraw():n.shape.updateBoundingBox(),r=!0)),r};mxCellRenderer.prototype.destroy=function(n){n.shape!=null&&(n.text!=null&&(n.text.destroy(),n.text=null),n.overlays!=null&&(n.overlays.visit(function(n,t){t.destroy()}),n.overlays=null),n.control!=null&&(n.control.destroy(),n.control=null),n.shape.destroy(),n.shape=null)};mxEdgeStyle={EntityRelation:function(n,t,i,r,u){var h=n.view,ut=h.graph,v=mxUtils.getValue(n.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*h.scale,y=n.absolutePoints,p=y[0],w=y[y.length-1],f=!1,b,e,o,k,s,it,rt;if(p!=null)t=new mxCellState,t.x=p.x,t.y=p.y;else if(t!=null)o=mxUtils.getPortConstraints(t,n,!0,mxConstants.DIRECTION_MASK_NONE),o!=mxConstants.DIRECTION_MASK_NONE?f=o==mxConstants.DIRECTION_MASK_WEST:(b=ut.getCellGeometry(t.cell),b.relative?f=b.x<=.5:i!=null&&(f=i.x+i.width<t.x));else return;if(e=!0,w!=null?(i=new mxCellState,i.x=w.x,i.y=w.y):i!=null&&(o=mxUtils.getPortConstraints(i,n,!1,mxConstants.DIRECTION_MASK_NONE),o!=mxConstants.DIRECTION_MASK_NONE?e=o==mxConstants.DIRECTION_MASK_WEST:(k=ut.getCellGeometry(i.cell),k.relative?e=k.x<=.5:t!=null&&(e=t.x+t.width<i.x))),t!=null&&i!=null){var d=f?t.x:t.x+t.width,c=h.getRoutingCenterY(t),g=e?i.x:i.x+i.width,nt=h.getRoutingCenterY(i),l=v,tt=f?-l:l,a=new mxPoint(d+tt,c);tt=e?-l:l;s=new mxPoint(g+tt,nt);f==e?(it=f?Math.min(d,g)-v:Math.max(d,g)+v,u.push(new mxPoint(it,c)),u.push(new mxPoint(it,nt))):a.x<s.x==f?(rt=c+(nt-c)/2,u.push(a),u.push(new mxPoint(a.x,rt)),u.push(new mxPoint(s.x,rt)),u.push(s)):(u.push(a),u.push(s))}},Loop:function(n,t,i,r,u){var v=n.absolutePoints,p=v[0],w=v[v.length-1],a,f;if(p!=null&&w!=null){if(r!=null&&r.length>0)for(a=0;a<r.length;a++)f=r[a],f=n.view.transformControlPoint(n,f),u.push(new mxPoint(f.x,f.y));return}if(t!=null){var h=n.view,b=h.graph,f=r!=null&&r.length>0?r[0]:null;f!=null&&(f=h.transformControlPoint(n,f),mxUtils.contains(t,f.x,f.y)&&(f=null));var o=0,c=0,s=0,e=0,y=mxUtils.getValue(n.style,mxConstants.STYLE_SEGMENT,b.gridSize)*h.scale,l=mxUtils.getValue(n.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);l==mxConstants.DIRECTION_NORTH||l==mxConstants.DIRECTION_SOUTH?(o=h.getRoutingCenterX(t),c=y):(s=h.getRoutingCenterY(t),e=y);f==null||f.x<t.x||f.x>t.x+t.width?f!=null?(o=f.x,e=Math.max(Math.abs(s-f.y),e)):l==mxConstants.DIRECTION_NORTH?s=t.y-2*c:l==mxConstants.DIRECTION_SOUTH?s=t.y+t.height+2*c:o=l==mxConstants.DIRECTION_EAST?t.x-2*e:t.x+t.width+2*e:f!=null&&(o=h.getRoutingCenterX(t),c=Math.max(Math.abs(o-f.x),e),s=f.y,e=0);u.push(new mxPoint(o-c,s-e));u.push(new mxPoint(o+c,s+e))}},ElbowConnector:function(n,t,i,r,u){var f=r!=null&&r.length>0?r[0]:null,e=!1,o=!1,s,h,c,l;if(t!=null&&i!=null)if(f!=null){var s=Math.min(t.x,i.x),h=Math.max(t.x+t.width,i.x+i.width),c=Math.min(t.y,i.y),l=Math.max(t.y+t.height,i.y+i.height);f=n.view.transformControlPoint(n,f);e=f.y<c||f.y>l;o=f.x<s||f.x>h}else s=Math.max(t.x,i.x),h=Math.min(t.x+t.width,i.x+i.width),e=s==h,e||(c=Math.max(t.y,i.y),l=Math.min(t.y+t.height,i.y+i.height),o=c==l);!o&&(e||n.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL)?mxEdgeStyle.TopToBottom(n,t,i,r,u):mxEdgeStyle.SideToSide(n,t,i,r,u)},SideToSide:function(n,t,i,r,u){var h=n.view,f=r!=null&&r.length>0?r[0]:null,c=n.absolutePoints,l=c[0],a=c[c.length-1],v,p;if(f!=null&&(f=h.transformControlPoint(n,f)),l!=null&&(t=new mxCellState,t.x=l.x,t.y=l.y),a!=null&&(i=new mxCellState,i.x=a.x,i.y=a.y),t!=null&&i!=null){var w=Math.max(t.x,i.x),y=Math.min(t.x+t.width,i.x+i.width),e=f!=null?f.x:y+(w-y)/2,o=h.getRoutingCenterY(t),s=h.getRoutingCenterY(i);f!=null&&(f.y>=t.y&&f.y<=t.y+t.height&&(o=f.y),f.y>=i.y&&f.y<=i.y+i.height&&(s=f.y));mxUtils.contains(i,e,o)||mxUtils.contains(t,e,o)||u.push(new mxPoint(e,o));mxUtils.contains(i,e,s)||mxUtils.contains(t,e,s)||u.push(new mxPoint(e,s));u.length==1&&(f!=null?mxUtils.contains(i,e,f.y)||mxUtils.contains(t,e,f.y)||u.push(new mxPoint(e,f.y)):(v=Math.max(t.y,i.y),p=Math.min(t.y+t.height,i.y+i.height),u.push(new mxPoint(e,v+(p-v)/2))))}},TopToBottom:function(n,t,i,r,u){var s=n.view,f=r!=null&&r.length>0?r[0]:null,h=n.absolutePoints,c=h[0],l=h[h.length-1],e,a,y;if(f!=null&&(f=s.transformControlPoint(n,f)),c!=null&&(t=new mxCellState,t.x=c.x,t.y=c.y),l!=null&&(i=new mxCellState,i.x=l.x,i.y=l.y),t!=null&&i!=null){var p=Math.max(t.y,i.y),v=Math.min(t.y+t.height,i.y+i.height),o=s.getRoutingCenterX(t);f!=null&&f.x>=t.x&&f.x<=t.x+t.width&&(o=f.x);e=f!=null?f.y:v+(p-v)/2;mxUtils.contains(i,o,e)||mxUtils.contains(t,o,e)||u.push(new mxPoint(o,e));o=f!=null&&f.x>=i.x&&f.x<=i.x+i.width?f.x:s.getRoutingCenterX(i);mxUtils.contains(i,o,e)||mxUtils.contains(t,o,e)||u.push(new mxPoint(o,e));u.length==1&&(f!=null&&u.length==1?mxUtils.contains(i,f.x,e)||mxUtils.contains(t,f.x,e)||u.push(new mxPoint(f.x,e)):(a=Math.max(t.x,i.x),y=Math.min(t.x+t.width,i.x+i.width),u.push(new mxPoint(a+(y-a)/2,e))))}},SegmentConnector:function(n,t,i,r,u){function k(n){return(b==null||Math.abs(b.x-n.x)>y||Math.abs(b.y-n.y)>y)&&(u.push(n),b=n),b}var o=n.absolutePoints,y=Math.max(1,2*n.view.scale),b=u.length>0?u[0]:null,l=!0,e=null,f=o[0],a,p,c,s;if(f==null&&t!=null?f=new mxPoint(n.view.getRoutingCenterX(t),n.view.getRoutingCenterY(t)):f!=null&&(f=f.clone()),f.x=Math.round(f.x),f.y=Math.round(f.y),a=o.length-1,r!=null&&r.length>0){for(p=[],s=0;s<r.length;s++)p[s]=n.view.transformControlPoint(n,r[s]),p[s].x=Math.round(p[s].x),p[s].y=Math.round(p[s].y);r=p;f!=null&&r[0]!=null&&(Math.abs(r[0].x-f.x)<=y&&(r[0].x=f.x),Math.abs(r[0].y-f.y)<=y&&(r[0].y=f.y));c=o[a];c!=null&&r[r.length-1]!=null&&(Math.abs(r[r.length-1].x-c.x)<=y&&(r[r.length-1].x=c.x),Math.abs(r[r.length-1].y-c.y)<=y&&(r[r.length-1].y=c.y));e=r[0];var v=t,h=o[0],d=!1,g=!1,w=e;for(h!=null&&(h.x=Math.round(h.x),h.y=Math.round(h.y),v=null),s=0;s<2;s++){var nt=h!=null&&h.x==w.x,tt=h!=null&&h.y==w.y,it=v!=null&&w.y>=v.y&&w.y<=v.y+v.height,rt=v!=null&&w.x>=v.x&&w.x<=v.x+v.width;if(d=tt||h==null&&it,g=nt||h==null&&rt,s!=0||!(d&&g||nt&&tt)){if(h!=null&&!tt&&!nt&&(it||rt)){l=it?!1:!0;break}if(g||d){l=d;s==1&&(l=r.length%2==0?d:g);break}}v=i;h=o[a];h!=null&&(h.x=Math.round(h.x),h.y=Math.round(h.y),v=null);w=r[r.length-1];nt&&tt&&(r=r.slice(1))}for(l&&(o[0]!=null&&o[0].y!=e.y||o[0]==null&&t!=null&&(e.y<t.y||e.y>t.y+t.height))?k(new mxPoint(f.x,e.y)):!l&&(o[0]!=null&&o[0].x!=e.x||o[0]==null&&t!=null&&(e.x<t.x||e.x>t.x+t.width))&&k(new mxPoint(e.x,f.y)),l?f.y=e.y:f.x=e.x,s=0;s<r.length;s++)l=!l,e=r[s],l?f.y=e.y:f.x=e.x,k(f.clone())}else e=f,l=!0;if(f=o[a],f==null&&i!=null&&(f=new mxPoint(n.view.getRoutingCenterX(i),n.view.getRoutingCenterY(i))),f!=null&&(f.x=Math.round(f.x),f.y=Math.round(f.y),e!=null&&(l&&(o[a]!=null&&o[a].y!=e.y||o[a]==null&&i!=null&&(e.y<i.y||e.y>i.y+i.height))?k(new mxPoint(f.x,e.y)):!l&&(o[a]!=null&&o[a].x!=e.x||o[a]==null&&i!=null&&(e.x<i.x||e.x>i.x+i.width))&&k(new mxPoint(e.x,f.y)))),o[0]==null&&t!=null)while(u.length>1&&u[1]!=null&&mxUtils.contains(t,u[1].x,u[1].y))u.splice(1,1);if(o[a]==null&&i!=null)while(u.length>1&&u[u.length-1]!=null&&mxUtils.contains(i,u[u.length-1].x,u[u.length-1].y))u.splice(u.length-1,1);c!=null&&u[u.length-1]!=null&&Math.abs(c.x-u[u.length-1].x)<=y&&Math.abs(c.y-u[u.length-1].y)<=y&&(u.splice(u.length-1,1),u[u.length-1]!=null&&(Math.abs(u[u.length-1].x-c.x)<=y&&(u[u.length-1].x=c.x),Math.abs(u[u.length-1].y-c.y)<=y&&(u[u.length-1].y=c.y)))},orthBuffer:10,orthPointsFallback:!0,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,OrthConnector:function(n,t,i,r,u){var si=n.view.graph,ki=t==null?!1:si.getModel().isEdge(t.cell),di=i==null?!1:si.getModel().isEdge(i.cell),w,v,e,g,p,et,ot,nt,fi,b,it,at,vt,k,yi,ei,pi,oi,f,wi,bi;if(mxEdgeStyle.orthPointsFallback&&r!=null&&r.length>0||ki||di){mxEdgeStyle.SegmentConnector(n,t,i,r,u);return}var yt=n.absolutePoints,pt=yt[0],wt=yt[yt.length-1],bt=t!=null?t.x:pt.x,kt=t!=null?t.y:pt.y,dt=t!=null?t.width:0,gt=t!=null?t.height:0,ni=i!=null?i.x:wt.x,ti=i!=null?i.y:wt.y,ii=i!=null?i.width:0,ri=i!=null?i.height:0,a=n.view.scale*mxEdgeStyle.orthBuffer,s=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL],ut=0;for(t!=null&&(s[0]=mxUtils.getPortConstraints(t,n,!0,mxConstants.DIRECTION_MASK_ALL),ut=mxUtils.getValue(t.style,mxConstants.STYLE_ROTATION,0),ut!=0&&(w=mxUtils.getBoundingBox(new mxRectangle(bt,kt,dt,gt),ut),bt=w.x,kt=w.y,dt=w.width,gt=w.height)),i!=null&&(s[1]=mxUtils.getPortConstraints(i,n,!1,mxConstants.DIRECTION_MASK_ALL),ut=mxUtils.getValue(i.style,mxConstants.STYLE_ROTATION,0),ut!=0&&(w=mxUtils.getBoundingBox(new mxRectangle(ni,ti,ii,ri),ut),ni=w.x,ti=w.y,ii=w.width,ri=w.height)),v=[0,0],e=[[bt,kt,dt,gt],[ni,ti,ii,ri]],f=0;f<2;f++)mxEdgeStyle.limits[f][1]=e[f][0]-a,mxEdgeStyle.limits[f][2]=e[f][1]-a,mxEdgeStyle.limits[f][4]=e[f][0]+e[f][2]+a,mxEdgeStyle.limits[f][8]=e[f][1]+e[f][3]+a;var gi=e[0][0]+e[0][2]/2,nr=e[0][1]+e[0][3]/2,tr=e[1][0]+e[1][2]/2,ir=e[1][1]+e[1][3]/2,hi=gi-tr,ci=nr-ir,d=0;for(hi<0?d=ci<0?2:1:ci<=0&&(d=3,hi==0&&(d=2)),g=null,t!=null&&(g=pt),p=[[.5,.5],[.5,.5]],f=0;f<2;f++)g!=null&&(p[f][0]=(g.x-e[f][0])/e[f][2],p[f][0]<.01?v[f]=mxConstants.DIRECTION_MASK_WEST:p[f][0]>.99&&(v[f]=mxConstants.DIRECTION_MASK_EAST),p[f][1]=(g.y-e[f][1])/e[f][3],p[f][1]<.01?v[f]=mxConstants.DIRECTION_MASK_NORTH:p[f][1]>.99&&(v[f]=mxConstants.DIRECTION_MASK_SOUTH)),g=null,i!=null&&(g=wt);var st=e[0][1]-(e[1][1]+e[1][3]),ht=e[0][0]-(e[1][0]+e[1][2]),ct=e[1][1]-(e[0][1]+e[0][3]),lt=e[1][0]-(e[0][0]+e[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(ht-2*a,0);mxEdgeStyle.vertexSeperations[2]=Math.max(st-2*a,0);mxEdgeStyle.vertexSeperations[4]=Math.max(ct-2*a,0);mxEdgeStyle.vertexSeperations[3]=Math.max(lt-2*a,0);var y=[],c=[],l=[];c[0]=ht>=lt?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST;l[0]=st>=ct?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH;c[1]=mxUtils.reversePortConstraints(c[0]);l[1]=mxUtils.reversePortConstraints(l[0]);var li=ht>=lt?ht:lt,ai=st>=ct?st:ct,o=[[0,0],[0,0]],ft=!1;for(f=0;f<2;f++)v[f]==0&&((c[f]&s[f])==0&&(c[f]=mxUtils.reversePortConstraints(c[f])),(l[f]&s[f])==0&&(l[f]=mxUtils.reversePortConstraints(l[f])),o[f][0]=l[f],o[f][1]=c[f]);for(ai>a*2&&li>a*2&&((c[0]&s[0])>0&&(l[1]&s[1])>0?(o[0][0]=c[0],o[0][1]=l[0],o[1][0]=l[1],o[1][1]=c[1],ft=!0):(l[0]&s[0])>0&&(c[1]&s[1])>0&&(o[0][0]=l[0],o[0][1]=c[0],o[1][0]=c[1],o[1][1]=l[1],ft=!0)),ai>a*2&&!ft&&(o[0][0]=l[0],o[0][1]=c[0],o[1][0]=l[1],o[1][1]=c[1],ft=!0),li>a*2&&!ft&&(o[0][0]=c[0],o[0][1]=l[0],o[1][0]=c[1],o[1][1]=l[1],ft=!0),f=0;f<2;f++)v[f]==0&&((o[f][0]&s[f])==0&&(o[f][0]=o[f][1]),y[f]=o[f][0]&s[f],y[f]|=(o[f][1]&s[f])<<8,y[f]|=(o[1-f][f]&s[f])<<16,y[f]|=(o[1-f][1-f]&s[f])<<24,(y[f]&15)==0&&(y[f]=y[f]<<8),(y[f]&3840)==0&&(y[f]=y[f]&15|y[f]>>8),(y[f]&983040)==0&&(y[f]=y[f]&65535|(y[f]&251658240)>>8),v[f]=y[f]&15,(s[f]==mxConstants.DIRECTION_MASK_WEST||s[f]==mxConstants.DIRECTION_MASK_NORTH||s[f]==mxConstants.DIRECTION_MASK_EAST||s[f]==mxConstants.DIRECTION_MASK_SOUTH)&&(v[f]=s[f]));et=v[0]==mxConstants.DIRECTION_MASK_EAST?3:v[0];ot=v[1]==mxConstants.DIRECTION_MASK_EAST?3:v[1];et-=d;ot-=d;et<1&&(et+=4);ot<1&&(ot+=4);nt=mxEdgeStyle.routePatterns[et-1][ot-1];mxEdgeStyle.wayPoints1[0][0]=e[0][0];mxEdgeStyle.wayPoints1[0][1]=e[0][1];switch(v[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=a;mxEdgeStyle.wayPoints1[0][1]+=p[0][1]*e[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=p[0][0]*e[0][2];mxEdgeStyle.wayPoints1[0][1]+=e[0][3]+a;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=e[0][2]+a;mxEdgeStyle.wayPoints1[0][1]+=p[0][1]*e[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=p[0][0]*e[0][2];mxEdgeStyle.wayPoints1[0][1]-=a}var h=0,ui=(v[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1,rr=ui,tt=0;for(f=0;f<nt.length;f++){fi=nt[f]&15;b=fi==mxConstants.DIRECTION_MASK_EAST?3:fi;b+=d;b>4&&(b-=4);it=mxEdgeStyle.dirVectors[b-1];tt=b%2>0?0:1;tt!=ui&&(h++,mxEdgeStyle.wayPoints1[h][0]=mxEdgeStyle.wayPoints1[h-1][0],mxEdgeStyle.wayPoints1[h][1]=mxEdgeStyle.wayPoints1[h-1][1]);var ur=(nt[f]&mxEdgeStyle.TARGET_MASK)>0,vi=(nt[f]&mxEdgeStyle.SOURCE_MASK)>0,rt=(nt[f]&mxEdgeStyle.SIDE_MASK)>>5;rt=rt<<d;rt>15&&(rt=rt>>4);at=(nt[f]&mxEdgeStyle.CENTER_MASK)>0;(vi||ur)&&rt<9?(vt=0,k=vi?0:1,vt=at&&tt==0?e[k][0]+p[k][0]*e[k][2]:at?e[k][1]+p[k][1]*e[k][3]:mxEdgeStyle.limits[k][rt],tt==0?(yi=mxEdgeStyle.wayPoints1[h][0],ei=(vt-yi)*it[0],ei>0&&(mxEdgeStyle.wayPoints1[h][0]+=it[0]*ei)):(pi=mxEdgeStyle.wayPoints1[h][1],oi=(vt-pi)*it[1],oi>0&&(mxEdgeStyle.wayPoints1[h][1]+=it[1]*oi))):at&&(mxEdgeStyle.wayPoints1[h][0]+=it[0]*Math.abs(mxEdgeStyle.vertexSeperations[b]/2),mxEdgeStyle.wayPoints1[h][1]+=it[1]*Math.abs(mxEdgeStyle.vertexSeperations[b]/2));h>0&&mxEdgeStyle.wayPoints1[h][tt]==mxEdgeStyle.wayPoints1[h-1][tt]?h--:ui=tt}for(f=0;f<=h;f++){if(f==h&&(wi=(v[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))>0?0:1,bi=wi==rr?0:1,bi!=(h+1)%2))break;u.push(new mxPoint(Math.round(mxEdgeStyle.wayPoints1[f][0]),Math.round(mxEdgeStyle.wayPoints1[f][1])))}},getRoutePattern:function(n,t,i,r){var u=n[0]==mxConstants.DIRECTION_MASK_EAST?3:n[0],f=n[1]==mxConstants.DIRECTION_MASK_EAST?3:n[1],e;return u-=t,f-=t,u<1&&(u+=4),f<1&&(f+=4),e=routePatterns[u-1][f-1],(i==0||r==0)&&inlineRoutePatterns[u-1][f-1]!=null&&(e=inlineRoutePatterns[u-1][f-1]),e}};mxStyleRegistry={values:[],putValue:function(n,t){mxStyleRegistry.values[n]=t},getValue:function(n){return mxStyleRegistry.values[n]},getName:function(n){for(var t in mxStyleRegistry.values)if(mxStyleRegistry.values[t]==n)return t;return null}};mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector);mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_HEXAGON,mxPerimeter.HexagonPerimeter);mxGraphView.prototype=new mxEventSource;mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint;mxGraphView.prototype.doneResource=mxClient.language!="none"?"done":"";mxGraphView.prototype.updatingDocumentResource=mxClient.language!="none"?"updatingDocument":"";mxGraphView.prototype.allowEval=!1;mxGraphView.prototype.captureDocumentGesture=!0;mxGraphView.prototype.optimizeVmlReflows=!0;mxGraphView.prototype.rendering=!0;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.updateStyle=!1;mxGraphView.prototype.lastNode=null;mxGraphView.prototype.lastHtmlNode=null;mxGraphView.prototype.lastForegroundNode=null;mxGraphView.prototype.lastForegroundHtmlNode=null;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(n){this.graphBounds=n};mxGraphView.prototype.getBounds=function(n){var i=null,u,t,r;if(n!=null&&n.length>0)for(u=this.graph.getModel(),t=0;t<n.length;t++)(u.isVertex(n[t])||u.isEdge(n[t]))&&(r=this.getState(n[t]),r!=null&&(i==null?i=mxRectangle.fromRectangle(r):i.add(r)));return i};mxGraphView.prototype.setCurrentRoot=function(n){var t,i;return this.currentRoot!=n&&(t=new mxCurrentRootChange(this,n),t.execute(),i=new mxUndoableEdit(this,!1),i.add(t),this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",i)),this.graph.sizeDidChange()),n};mxGraphView.prototype.scaleAndTranslate=function(n,t,i){var r=this.scale,u=new mxPoint(this.translate.x,this.translate.y);(this.scale!=n||this.translate.x!=t||this.translate.y!=i)&&(this.scale=n,this.translate.x=t,this.translate.y=i,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",n,"previousScale",r,"translate",this.translate,"previousTranslate",u))};mxGraphView.prototype.getScale=function(){return this.scale};mxGraphView.prototype.setScale=function(n){var t=this.scale;this.scale!=n&&(this.scale=n,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",n,"previousScale",t))};mxGraphView.prototype.getTranslate=function(){return this.translate};mxGraphView.prototype.setTranslate=function(n,t){var i=new mxPoint(this.translate.x,this.translate.y);(this.translate.x!=n||this.translate.y!=t)&&(this.translate.x=n,this.translate.y=t,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",i))};mxGraphView.prototype.refresh=function(){this.currentRoot!=null&&this.clear();this.revalidate()};mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(n,t,i){var u=this.graph.getModel(),f,r;if(n=n||u.getRoot(),t=t!=null?t:!1,i=i!=null?i:!0,this.removeState(n),i&&(t||n!=this.currentRoot))for(f=u.getChildCount(n),r=0;r<f;r++)this.clear(u.getChildAt(n,r),t);else this.invalidate(n)};mxGraphView.prototype.invalidate=function(n,t,i){var u=this.graph.getModel(),f,e,o,s,r;if(n=n||u.getRoot(),t=t!=null?t:!0,i=i!=null?i:!0,f=this.getState(n),f!=null&&(f.invalid=!0),!n.invalidating){if(n.invalidating=!0,t)for(e=u.getChildCount(n),r=0;r<e;r++)o=u.getChildAt(n,r),this.invalidate(o,t,i);if(i)for(s=u.getEdgeCount(n),r=0;r<s;r++)this.invalidate(u.getEdgeAt(n,r),t,i);delete n.invalidating}};mxGraphView.prototype.validate=function(n){var r=mxLog.enter("mxGraphView.validate"),t,i;window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;this.resetValidationState();t=null;this.optimizeVmlReflows&&this.canvas!=null&&this.textDiv==null&&(document.documentMode==8&&!mxClient.IS_EM||mxClient.IS_QUIRKS)&&(this.placeholder=document.createElement("div"),this.placeholder.style.position="absolute",this.placeholder.style.width=this.canvas.clientWidth+"px",this.placeholder.style.height=this.canvas.clientHeight+"px",this.canvas.parentNode.appendChild(this.placeholder),t=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv));i=this.getBoundingBox(this.validateCellState(this.validateCell(n||(this.currentRoot!=null?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds(i!=null?i:this.getEmptyBounds());this.validateBackground();t!=null&&(this.canvas.style.display=t,this.textDiv.parentNode.removeChild(this.textDiv),this.placeholder!=null&&this.placeholder.parentNode.removeChild(this.placeholder),this.textDiv=null);this.resetValidationState();window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",r)};mxGraphView.prototype.getEmptyBounds=function(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)};mxGraphView.prototype.getBoundingBox=function(n,t){var i,f,e,r,u;if(t=t!=null?t:!0,i=null,n!=null&&(n.shape!=null&&n.shape.boundingBox!=null&&(i=n.shape.boundingBox.clone()),n.text!=null&&n.text.boundingBox!=null&&(i!=null?i.add(n.text.boundingBox):i=n.text.boundingBox.clone()),t))for(f=this.graph.getModel(),e=f.getChildCount(n.cell),r=0;r<e;r++)u=this.getBoundingBox(this.getState(f.getChildAt(n.cell,r))),u!=null&&(i==null?i=u:i.add(u));return i};mxGraphView.prototype.createBackgroundPageShape=function(n){return new mxRectangleShape(n,"white","black")};mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage();this.validateBackgroundPage()};mxGraphView.prototype.validateBackgroundImage=function(){var n=this.graph.getBackgroundImage(),t;n!=null?((this.backgroundImage==null||this.backgroundImage.image!=n.src)&&(this.backgroundImage!=null&&this.backgroundImage.destroy(),t=new mxRectangle(0,0,1,1),this.backgroundImage=new mxImageShape(t,n.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw(),document.documentMode!=8||mxClient.IS_EM||mxEvent.addGestureListeners(this.backgroundImage.node,mxUtils.bind(this,function(n){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n))}),mxUtils.bind(this,function(n){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n))}),mxUtils.bind(this,function(n){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n))}))),this.redrawBackgroundImage(this.backgroundImage,n)):this.backgroundImage!=null&&(this.backgroundImage.destroy(),this.backgroundImage=null)};mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var n=this.getBackgroundPageBounds();this.backgroundPageShape==null?(this.backgroundPageShape=this.createBackgroundPageShape(n),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,function(n){this.graph.dblClick(n)})),mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(n){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n))}),mxUtils.bind(this,function(n){this.graph.tooltipHandler!=null&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide();this.graph.isMouseDown&&!mxEvent.isConsumed(n)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n))}),mxUtils.bind(this,function(n){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=n,this.backgroundPageShape.redraw())}else this.backgroundPageShape!=null&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)};mxGraphView.prototype.getBackgroundPageBounds=function(){var n=this.graph.pageFormat,t=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,n.width*t,n.height*t)};mxGraphView.prototype.redrawBackgroundImage=function(n,t){n.scale=this.scale;n.bounds.x=this.scale*this.translate.x;n.bounds.y=this.scale*this.translate.y;n.bounds.width=this.scale*t.width;n.bounds.height=this.scale*t.height;n.redraw()};mxGraphView.prototype.validateCell=function(n,t){var u,r,f,i;if(t=t!=null?t:!0,n!=null)if(t=t&&this.graph.isCellVisible(n),u=this.getState(n,t),u==null||t)for(r=this.graph.getModel(),f=r.getChildCount(n),i=0;i<f;i++)this.validateCell(r.getChildAt(n,i),t&&(!this.isCellCollapsed(n)||n==this.currentRoot));else this.removeState(n);return n};mxGraphView.prototype.validateCellState=function(n,t){var i,r,f,u;if(t=t!=null?t:!0,i=null,n!=null&&(i=this.getState(n),i!=null&&(r=this.graph.getModel(),i.invalid&&(i.invalid=!1,n!=this.currentRoot&&this.validateCellState(r.getParent(n),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(n,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(n,!1),!1),!1),this.updateCellState(i),n!=this.currentRoot&&this.graph.cellRenderer.redraw(i,!1,this.isRendering())),t)))for(i.updateCachedBounds(),i.shape!=null&&this.stateValidated(i),f=r.getChildCount(n),u=0;u<f;u++)this.validateCellState(r.getChildAt(n,u));return i};mxGraphView.prototype.updateCellState=function(n){var u,i,r,t,f;n.absoluteOffset.x=0;n.absoluteOffset.y=0;n.origin.x=0;n.origin.y=0;n.length=0;n.cell!=this.currentRoot&&(u=this.graph.getModel(),i=this.getState(u.getParent(n.cell)),i!=null&&i.cell!=this.currentRoot&&(n.origin.x+=i.origin.x,n.origin.y+=i.origin.y),r=this.graph.getChildOffsetForCell(n.cell),r!=null&&(n.origin.x+=r.x,n.origin.y+=r.y),t=this.graph.getCellGeometry(n.cell),t!=null&&(u.isEdge(n.cell)||(r=t.offset||this.EMPTY_POINT,t.relative&&i!=null?u.isEdge(i.cell)?(f=this.getPoint(i,t),f!=null&&(n.origin.x+=f.x/this.scale-i.origin.x-this.translate.x,n.origin.y+=f.y/this.scale-i.origin.y-this.translate.y)):(n.origin.x+=t.x*i.width/this.scale+r.x,n.origin.y+=t.y*i.height/this.scale+r.y):(n.absoluteOffset.x=this.scale*r.x,n.absoluteOffset.y=this.scale*r.y,n.origin.x+=t.x,n.origin.y+=t.y)),n.x=this.scale*(this.translate.x+n.origin.x),n.y=this.scale*(this.translate.y+n.origin.y),n.width=this.scale*t.width,n.height=this.scale*t.height,u.isVertex(n.cell)&&this.updateVertexState(n,t),u.isEdge(n.cell)&&this.updateEdgeState(n,t)))};mxGraphView.prototype.isCellCollapsed=function(n){return this.graph.isCellCollapsed(n)};mxGraphView.prototype.updateVertexState=function(n,t){var u=this.graph.getModel(),i=this.getState(u.getParent(n.cell)),r;if(t.relative&&i!=null&&!u.isEdge(i.cell)&&(r=mxUtils.toRadians(i.style[mxConstants.STYLE_ROTATION]||"0"),r!=0)){var e=Math.cos(r),o=Math.sin(r),s=new mxPoint(n.getCenterX(),n.getCenterY()),h=new mxPoint(i.getCenterX(),i.getCenterY()),f=mxUtils.getRotatedPoint(s,e,o,h);n.x=f.x-n.width/2;n.y=f.y-n.height/2}this.updateVertexLabelOffset(n)};mxGraphView.prototype.updateEdgeState=function(n,t){var r=n.getVisibleTerminalState(!0),u=n.getVisibleTerminalState(!1),i;this.graph.model.getTerminal(n.cell,!0)!=null&&r==null||r==null&&t.getTerminalPoint(!0)==null||this.graph.model.getTerminal(n.cell,!1)!=null&&u==null||u==null&&t.getTerminalPoint(!1)==null?this.clear(n.cell,!0):(this.updateFixedTerminalPoints(n,r,u),this.updatePoints(n,t.points,r,u),this.updateFloatingTerminalPoints(n,r,u),i=n.absolutePoints,n.cell!=this.currentRoot&&(i==null||i.length<2||i[0]==null||i[i.length-1]==null)?this.clear(n.cell,!0):(this.updateEdgeBounds(n),this.updateEdgeLabelOffset(n)))};mxGraphView.prototype.updateVertexLabelOffset=function(n){var r=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),t,u,i,f;r==mxConstants.ALIGN_LEFT?(t=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_WIDTH,null),t!=null?t*=this.scale:t=n.width,n.absoluteOffset.x-=t):r==mxConstants.ALIGN_RIGHT?n.absoluteOffset.x+=n.width:r==mxConstants.ALIGN_CENTER&&(t=mxUtils.getValue(n.style,mxConstants.STYLE_LABEL_WIDTH,null),t!=null&&(u=mxUtils.getValue(n.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),i=0,u==mxConstants.ALIGN_CENTER?i=.5:u==mxConstants.ALIGN_RIGHT&&(i=1),i!=0&&(n.absoluteOffset.x-=(t*this.scale-n.width)*i)));f=mxUtils.getValue(n.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);f==mxConstants.ALIGN_TOP?n.absoluteOffset.y-=n.height:f==mxConstants.ALIGN_BOTTOM&&(n.absoluteOffset.y+=n.height)};mxGraphView.prototype.resetValidationState=function(){this.lastNode=null;this.lastHtmlNode=null;this.lastForegroundNode=null;this.lastForegroundHtmlNode=null};mxGraphView.prototype.stateValidated=function(n){var i=this.graph.getModel().isEdge(n.cell)&&this.graph.keepEdgesInForeground||this.graph.getModel().isVertex(n.cell)&&this.graph.keepEdgesInBackground,r=i?this.lastForegroundHtmlNode||this.lastHtmlNode:this.lastHtmlNode,u=i?this.lastForegroundNode||this.lastNode:this.lastNode,t=this.graph.cellRenderer.insertStateAfter(n,u,r);i?(this.lastForegroundHtmlNode=t[1],this.lastForegroundNode=t[0]):(this.lastHtmlNode=t[1],this.lastNode=t[0])};mxGraphView.prototype.updateFixedTerminalPoints=function(n,t,i){this.updateFixedTerminalPoint(n,t,!0,this.graph.getConnectionConstraint(n,t,!0));this.updateFixedTerminalPoint(n,i,!1,this.graph.getConnectionConstraint(n,i,!1))};mxGraphView.prototype.updateFixedTerminalPoint=function(n,t,i,r){n.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(n,t,i,r),i)};mxGraphView.prototype.getFixedTerminalPoint=function(n,t,i,r){var u=null;if(r!=null&&(u=this.graph.getConnectionPoint(t,r)),u==null&&t==null){var f=this.scale,e=this.translate,o=n.origin,s=this.graph.getCellGeometry(n.cell);u=s.getTerminalPoint(i);u!=null&&(u=new mxPoint(f*(e.x+u.x+o.x),f*(e.y+u.y+o.y)))}return u};mxGraphView.prototype.updateBoundsFromStencil=function(n){var i=null,t;return n!=null&&n.shape!=null&&n.shape.stencil!=null&&n.shape.stencil.aspect=="fixed"&&(i=mxRectangle.fromRectangle(n),t=n.shape.stencil.computeAspect(n.style,n.x,n.y,n.width,n.height),n.setRect(t.x,t.y,n.shape.stencil.w0*t.width,n.shape.stencil.h0*t.height)),i};mxGraphView.prototype.updatePoints=function(n,t,i,r){var u,s,o,a,l;if(n!=null){if(u=[],u.push(n.absolutePoints[0]),s=this.getEdgeStyle(n,t,i,r),s!=null){var h=this.getTerminalPort(n,i,!0),c=this.getTerminalPort(n,r,!1),f=this.updateBoundsFromStencil(h),e=this.updateBoundsFromStencil(c);s(n,h,c,t,u);f!=null&&h.setRect(f.x,f.y,f.width,f.height);e!=null&&c.setRect(e.x,e.y,e.width,e.height)}else if(t!=null)for(o=0;o<t.length;o++)t[o]!=null&&(a=mxUtils.clone(t[o]),u.push(this.transformControlPoint(n,a)));l=n.absolutePoints;u.push(l[l.length-1]);n.absolutePoints=u}};mxGraphView.prototype.transformControlPoint=function(n,t){if(n!=null&&t!=null){var i=n.origin;return new mxPoint(this.scale*(t.x+this.translate.x+i.x),this.scale*(t.y+this.translate.y+i.y))}return null};mxGraphView.prototype.getEdgeStyle=function(n,t,i,r){var u=i!=null&&i==r?mxUtils.getValue(n.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):mxUtils.getValue(n.style,mxConstants.STYLE_NOEDGESTYLE,!1)?null:n.style[mxConstants.STYLE_EDGE],f;return(typeof u=="string"&&(f=mxStyleRegistry.getValue(u),f==null&&this.isAllowEval()&&(f=mxUtils.eval(u)),u=f),typeof u=="function")?u:null};mxGraphView.prototype.updateFloatingTerminalPoints=function(n,t,i){var r=n.absolutePoints,u=r[0],f=r[r.length-1];f==null&&i!=null&&this.updateFloatingTerminalPoint(n,i,t,!1);u==null&&t!=null&&this.updateFloatingTerminalPoint(n,t,i,!0)};mxGraphView.prototype.updateFloatingTerminalPoint=function(n,t,i,r){n.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(n,t,i,r),r)};mxGraphView.prototype.getFloatingTerminalPoint=function(n,t,i,r){var h,o,f,e;t=this.getTerminalPort(n,t,r);var s=this.getNextPoint(n,i,r),l=this.graph.isOrthogonal(n),u=mxUtils.toRadians(Number(t.style[mxConstants.STYLE_ROTATION]||"0")),c=new mxPoint(t.getCenterX(),t.getCenterY());return u!=0&&(f=Math.cos(-u),e=Math.sin(-u),s=mxUtils.getRotatedPoint(s,f,e,c)),h=parseFloat(n.style[mxConstants.STYLE_PERIMETER_SPACING]||0),h+=parseFloat(n.style[r?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0),o=this.getPerimeterPoint(t,s,u==0&&l,h),u!=0&&(f=Math.cos(u),e=Math.sin(u),o=mxUtils.getRotatedPoint(o,f,e,c)),o};mxGraphView.prototype.getTerminalPort=function(n,t,i){var f=i?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,u=mxUtils.getValue(n.style,f),r;return u!=null&&(r=this.getState(this.graph.getModel().getCell(u)),r!=null&&(t=r)),t};mxGraphView.prototype.getPerimeterPoint=function(n,t,i,r){var u=null,e,f;return n!=null&&(e=this.getPerimeterFunction(n),e!=null&&t!=null&&(f=this.getPerimeterBounds(n,r),(f.width>0||f.height>0)&&(u=e(f,n,t,i),u!=null&&(u.x=Math.round(u.x),u.y=Math.round(u.y)))),u==null&&(u=this.getPoint(n))),u};mxGraphView.prototype.getRoutingCenterX=function(n){var t=n.style!=null?parseFloat(n.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return n.getCenterX()+t*n.width};mxGraphView.prototype.getRoutingCenterY=function(n){var t=n.style!=null?parseFloat(n.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return n.getCenterY()+t*n.height};mxGraphView.prototype.getPerimeterBounds=function(n,t){return t=t!=null?t:0,n!=null&&(t+=parseFloat(n.style[mxConstants.STYLE_PERIMETER_SPACING]||0)),n.getPerimeterBounds(t*this.scale)};mxGraphView.prototype.getPerimeterFunction=function(n){var t=n.style[mxConstants.STYLE_PERIMETER],i;return(typeof t=="string"&&(i=mxStyleRegistry.getValue(t),i==null&&this.isAllowEval()&&(i=mxUtils.eval(t)),t=i),typeof t=="function")?t:null};mxGraphView.prototype.getNextPoint=function(n,t,i){var r=n.absolutePoints,u=null,f;return r!=null&&r.length>=2&&(f=r.length,u=r[i?Math.min(1,f-1):Math.max(0,f-2)]),u==null&&t!=null&&(u=new mxPoint(t.getCenterX(),t.getCenterY())),u};mxGraphView.prototype.getVisibleTerminal=function(n,t){for(var u=this.graph.getModel(),i=u.getTerminal(n,t),r=i;i!=null&&i!=this.currentRoot;)(!this.graph.isCellVisible(r)||this.isCellCollapsed(i))&&(r=i),i=u.getParent(i);return u.getParent(r)==u.getRoot()&&(r=null),r};mxGraphView.prototype.updateEdgeBounds=function(n){var i=n.absolutePoints,r=i[0],h=i[i.length-1],u,f,c,s,v;r.x!=h.x||r.y!=h.y?(u=h.x-r.x,f=h.y-r.y,n.terminalDistance=Math.sqrt(u*u+f*f)):n.terminalDistance=0;var y=0,p=[],t=r;if(t!=null){var e=t.x,o=t.y,l=e,a=o;for(c=1;c<i.length;c++)if(s=i[c],s!=null){var u=t.x-s.x,f=t.y-s.y,w=Math.sqrt(u*u+f*f);p.push(w);y+=w;t=s;e=Math.min(t.x,e);o=Math.min(t.y,o);l=Math.max(t.x,l);a=Math.max(t.y,a)}n.length=y;n.segments=p;v=1;n.x=e;n.y=o;n.width=Math.max(v,l-e);n.height=Math.max(v,a-o)}};mxGraphView.prototype.getPoint=function(n,t){var e=n.getCenterX(),o=n.getCenterY(),r;if(n.segments!=null&&(t==null||t.relative)){for(var b=t!=null?t.x/2:0,k=n.absolutePoints.length,l=(b+.5)*n.length,i=n.segments[0],s=0,f=1;l>s+i&&f<k-1;)s+=i,i=n.segments[f++];var a=i==0?0:(l-s)/i,u=n.absolutePoints[f-1],h=n.absolutePoints[f];if(u!=null&&h!=null){var c=0,v=0,y=0;t!=null&&(c=t.y,r=t.offset,r!=null&&(v=r.x,y=r.y));var p=h.x-u.x,w=h.y-u.y,d=i==0?0:w/i,g=i==0?0:p/i;e=u.x+p*a+(d*c+v)*this.scale;o=u.y+w*a-(g*c-y)*this.scale}}else t!=null&&(r=t.offset,r!=null&&(e+=r.x,o+=r.y));return new mxPoint(e,o)};mxGraphView.prototype.getRelativePoint=function(n,t,i){var et=this.graph.getModel(),k=et.getGeometry(n.cell),y,f,p,w,b,l,a,v,ft;if(k!=null&&(y=n.absolutePoints.length,k.relative&&y>1)){var d=n.length,g=n.segments,u=n.absolutePoints[0],r=n.absolutePoints[1],nt=mxUtils.ptSegDistSq(u.x,u.y,r.x,r.y,t,i),e=0,tt=0,it=0;for(f=2;f<y;f++)tt+=g[f-2],r=n.absolutePoints[f],p=mxUtils.ptSegDistSq(u.x,u.y,r.x,r.y,t,i),p<=nt&&(nt=p,e=f-1,it=tt),u=r;w=g[e];u=n.absolutePoints[e];r=n.absolutePoints[e+1];var ot=u.x,st=u.y,rt=r.x,ut=r.y,o=t,s=i,h=ot-rt,c=st-ut;return o-=rt,s-=ut,b=0,o=h-o,s=c-s,l=o*h+s*c,b=l<=0?0:l*l/(h*h+c*c),a=Math.sqrt(b),a>w&&(a=w),v=Math.sqrt(mxUtils.ptSegDistSq(u.x,u.y,r.x,r.y,t,i)),ft=mxUtils.relativeCcw(u.x,u.y,r.x,r.y,t,i),ft==-1&&(v=-v),new mxPoint((d/2-it-a)/d*-2,v/this.scale)}return new mxPoint};mxGraphView.prototype.updateEdgeLabelOffset=function(n){var i=n.absolutePoints,r,f,t,u,h,c;if(n.absoluteOffset.x=n.getCenterX(),n.absoluteOffset.y=n.getCenterY(),i!=null&&i.length>0&&n.segments!=null)if(r=this.graph.getCellGeometry(n.cell),r.relative)f=this.getPoint(n,r),f!=null&&(n.absoluteOffset=f);else if(t=i[0],u=i[i.length-1],t!=null&&u!=null){var l=u.x-t.x,a=u.y-t.y,o=0,s=0,e=r.offset;e!=null&&(o=e.x,s=e.y);h=t.x+l/2+o*this.scale;c=t.y+a/2+s*this.scale;n.absoluteOffset.x=h;n.absoluteOffset.y=c}};mxGraphView.prototype.getState=function(n,t){t=t||!1;var i=null;return n!=null&&(i=this.states.get(n),t&&(i==null||this.updateStyle)&&this.graph.isCellVisible(n)&&(i==null?(i=this.createState(n),this.states.put(n,i)):i.style=this.graph.getCellStyle(n))),i};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(n){this.rendering=n};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};mxGraphView.prototype.setAllowEval=function(n){this.allowEval=n};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(n){this.states=n};mxGraphView.prototype.getCellStates=function(n){var i,t,r;if(n==null)return this.states;for(i=[],t=0;t<n.length;t++)r=this.getState(n[t]),r!=null&&i.push(r);return i};mxGraphView.prototype.removeState=function(n){var t=null;return n!=null&&(t=this.states.remove(n),t!=null&&(this.graph.cellRenderer.destroy(t),t.destroy())),t};mxGraphView.prototype.createState=function(n){var t=new mxCellState(this,n,this.graph.getCellStyle(n)),i=this.graph.getModel();return t.view.graph.container!=null&&t.cell!=t.view.currentRoot&&(i.isVertex(t.cell)||i.isEdge(t.cell))&&(t.shape=this.graph.cellRenderer.createShape(t),t.shape.antiAlias=this.graph.cellRenderer.antiAlias),t};mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.getDecoratorPane=function(){return this.decoratorPane};mxGraphView.prototype.isContainerEvent=function(n){var t=mxEvent.getSource(n);return t==this.graph.container||t.parentNode==this.backgroundPane||t.parentNode!=null&&t.parentNode.parentNode==this.backgroundPane||t==this.canvas.parentNode||t==this.canvas||t==this.backgroundPane||t==this.drawPane||t==this.overlayPane||t==this.decoratorPane};mxGraphView.prototype.isScrollEvent=function(n){var u=mxUtils.getOffset(this.graph.container),t=new mxPoint(n.clientX-u.x,n.clientY-u.y),f=this.graph.container.offsetWidth,e=this.graph.container.clientWidth,i,r;return f>e&&t.x>e+2&&t.x<=f?!0:(i=this.graph.container.offsetHeight,r=this.graph.container.clientHeight,i>r&&t.y>r+2&&t.y<=i)?!0:!1};mxGraphView.prototype.init=function(){this.installListeners();var n=this.graph;n.dialect==mxConstants.DIALECT_SVG?this.createSvg():n.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()};mxGraphView.prototype.installListeners=function(){var n=this.graph,t=n.container,i;t!=null&&(mxClient.IS_TOUCH&&(mxEvent.addListener(t,"gesturestart",mxUtils.bind(this,function(t){n.fireGestureEvent(t);mxEvent.consume(t)})),mxEvent.addListener(t,"gesturechange",mxUtils.bind(this,function(t){n.fireGestureEvent(t);mxEvent.consume(t)})),mxEvent.addListener(t,"gestureend",mxUtils.bind(this,function(t){n.fireGestureEvent(t);mxEvent.consume(t)}))),mxEvent.addGestureListeners(t,mxUtils.bind(this,function(t){!this.isContainerEvent(t)||(mxClient.IS_IE||mxClient.IS_IE11||mxClient.IS_GC||mxClient.IS_OP||mxClient.IS_SF)&&this.isScrollEvent(t)||n.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(t))}),mxUtils.bind(this,function(t){this.isContainerEvent(t)&&n.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(t))}),mxUtils.bind(this,function(t){this.isContainerEvent(t)&&n.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(t))})),mxEvent.addListener(t,"dblclick",mxUtils.bind(this,function(t){this.isContainerEvent(t)&&n.dblClick(t)})),i=function(i){var r=null;if(mxClient.IS_TOUCH){var f=mxEvent.getClientX(i),e=mxEvent.getClientY(i),u=mxUtils.convertPoint(t,f,e);r=n.view.getState(n.getCellAt(u.x,u.y))}return r},n.addMouseListener({mouseDown:function(){n.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}}),this.moveHandler=mxUtils.bind(this,function(t){n.tooltipHandler!=null&&n.tooltipHandler.isHideOnHover()&&n.tooltipHandler.hide();this.captureDocumentGesture&&n.isMouseDown&&n.container!=null&&!this.isContainerEvent(t)&&n.container.style.display!="none"&&n.container.style.visibility!="hidden"&&!mxEvent.isConsumed(t)&&n.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(t,i(t)))}),this.endHandler=mxUtils.bind(this,function(t){this.captureDocumentGesture&&n.isMouseDown&&n.container!=null&&!this.isContainerEvent(t)&&n.container.style.display!="none"&&n.container.style.visibility!="hidden"&&n.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(t))}),mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler))};mxGraphView.prototype.createHtml=function(){var n=this.graph.container,t;n!=null&&(this.canvas=this.createHtmlPane("100%","100%"),this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),n.appendChild(this.canvas),mxClient.IS_QUIRKS&&(t=mxUtils.bind(this,function(){var n=this.getGraphBounds(),t=n.x+n.width+this.graph.border,i=n.y+n.height+this.graph.border;this.updateHtmlCanvasSize(t,i)}),mxEvent.addListener(window,"resize",t)))};mxGraphView.prototype.updateHtmlCanvasSize=function(n,t){if(this.graph.container!=null){var i=this.graph.container.offsetWidth,r=this.graph.container.offsetHeight;this.canvas.style.width=i<n?n+"px":"100%";this.canvas.style.height=r<t?t+"px":"100%"}};mxGraphView.prototype.createHtmlPane=function(n,t){var i=document.createElement("DIV");return n!=null&&t!=null?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=n,i.style.height=t):i.style.position="relative",i};mxGraphView.prototype.createVml=function(){var i=this.graph.container,n,t;i!=null&&(n=i.offsetWidth,t=i.offsetHeight,this.canvas=this.createVmlPane(n,t),this.backgroundPane=this.createVmlPane(n,t),this.drawPane=this.createVmlPane(n,t),this.overlayPane=this.createVmlPane(n,t),this.decoratorPane=this.createVmlPane(n,t),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),i.appendChild(this.canvas))};mxGraphView.prototype.createVmlPane=function(n,t){var i=document.createElement(mxClient.VML_PREFIX+":group");return i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=n+"px",i.style.height=t+"px",i.setAttribute("coordsize",n+","+t),i.setAttribute("coordorigin","0,0"),i};mxGraphView.prototype.createSvg=function(){var t=this.graph.container,n;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.decoratorPane);n=document.createElementNS(mxConstants.NS_SVG,"svg");n.style.width="100%";n.style.height="100%";n.style.display="block";n.appendChild(this.canvas);t!=null&&(t.appendChild(n),this.updateContainerStyle(t))};mxGraphView.prototype.updateContainerStyle=function(n){var t=mxUtils.getCurrentStyle(n);t!=null&&t.position=="static"&&(n.style.position="relative");mxClient.IS_POINTER&&(n.style.msTouchAction="none")};mxGraphView.prototype.destroy=function(){var n=this.canvas!=null?this.canvas.ownerSVGElement:null;n==null&&(n=this.canvas);n!=null&&n.parentNode!=null&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),n.parentNode.removeChild(n),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)};mxCurrentRootChange.prototype.execute=function(){var i=this.view.currentRoot,n,t;this.view.currentRoot=this.previous;this.previous=i;n=this.view.graph.getTranslateForRoot(this.view.currentRoot);n!=null&&(this.view.translate=new mxPoint(-n.x,-n.y));this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();t=this.isUp?mxEvent.UP:mxEvent.DOWN;this.view.fireEvent(new mxEventObject(t,"root",this.view.currentRoot,"previous",this.previous));this.isUp=!this.isUp};mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph");mxGraph.prototype=new mxEventSource;mxGraph.prototype.constructor=mxGraph;mxGraph.prototype.EMPTY_ARRAY=[];mxGraph.prototype.mouseListeners=null;mxGraph.prototype.isMouseDown=!1;mxGraph.prototype.model=null;mxGraph.prototype.view=null;mxGraph.prototype.stylesheet=null;mxGraph.prototype.selectionModel=null;mxGraph.prototype.cellEditor=null;mxGraph.prototype.cellRenderer=null;mxGraph.prototype.multiplicities=null;mxGraph.prototype.renderHint=null;mxGraph.prototype.dialect=null;mxGraph.prototype.gridSize=10;mxGraph.prototype.gridEnabled=!0;mxGraph.prototype.portsEnabled=!0;mxGraph.prototype.nativeDblClickEnabled=!0;mxGraph.prototype.doubleTapEnabled=!0;mxGraph.prototype.doubleTapTimeout=500;mxGraph.prototype.doubleTapTolerance=25;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchTime=0;mxGraph.prototype.tapAndHoldEnabled=!0;mxGraph.prototype.tapAndHoldDelay=500;mxGraph.prototype.tapAndHoldInProgress=!1;mxGraph.prototype.tapAndHoldValid=!1;mxGraph.prototype.initialTouchX=0;mxGraph.prototype.initialTouchY=0;mxGraph.prototype.tolerance=4;mxGraph.prototype.defaultOverlap=.5;mxGraph.prototype.defaultParent=null;mxGraph.prototype.alternateEdgeStyle=null;mxGraph.prototype.backgroundImage=null;mxGraph.prototype.pageVisible=!1;mxGraph.prototype.pageBreaksVisible=!1;mxGraph.prototype.pageBreakColor="gray";mxGraph.prototype.pageBreakDashed=!0;mxGraph.prototype.minPageBreakDist=20;mxGraph.prototype.preferPageSize=!1;mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;mxGraph.prototype.pageScale=1.5;mxGraph.prototype.enabled=!0;mxGraph.prototype.escapeEnabled=!0;mxGraph.prototype.invokesStopCellEditing=!0;mxGraph.prototype.enterStopsCellEditing=!1;mxGraph.prototype.useScrollbarsForPanning=!0;mxGraph.prototype.exportEnabled=!0;mxGraph.prototype.importEnabled=!0;mxGraph.prototype.cellsLocked=!1;mxGraph.prototype.cellsCloneable=!0;mxGraph.prototype.foldingEnabled=!0;mxGraph.prototype.cellsEditable=!0;mxGraph.prototype.cellsDeletable=!0;mxGraph.prototype.cellsMovable=!0;mxGraph.prototype.edgeLabelsMovable=!0;mxGraph.prototype.vertexLabelsMovable=!1;mxGraph.prototype.dropEnabled=!1;mxGraph.prototype.splitEnabled=!0;mxGraph.prototype.cellsResizable=!0;mxGraph.prototype.cellsBendable=!0;mxGraph.prototype.cellsSelectable=!0;mxGraph.prototype.cellsDisconnectable=!0;mxGraph.prototype.autoSizeCells=!1;mxGraph.prototype.autoSizeCellsOnAdd=!1;mxGraph.prototype.autoScroll=!0;mxGraph.prototype.timerAutoScroll=!1;mxGraph.prototype.allowAutoPanning=!1;mxGraph.prototype.ignoreScrollbars=!1;mxGraph.prototype.autoExtend=!0;mxGraph.prototype.maximumGraphBounds=null;mxGraph.prototype.minimumGraphSize=null;mxGraph.prototype.minimumContainerSize=null;mxGraph.prototype.maximumContainerSize=null;mxGraph.prototype.resizeContainer=!1;mxGraph.prototype.border=0;mxGraph.prototype.keepEdgesInForeground=!1;mxGraph.prototype.keepEdgesInBackground=!1;mxGraph.prototype.allowNegativeCoordinates=!0;mxGraph.prototype.constrainChildren=!0;mxGraph.prototype.constrainChildrenOnResize=!1;mxGraph.prototype.extendParents=!0;mxGraph.prototype.extendParentsOnAdd=!0;mxGraph.prototype.extendParentsOnMove=!1;mxGraph.prototype.recursiveResize=!1;mxGraph.prototype.collapseToPreferredSize=!0;mxGraph.prototype.zoomFactor=1.2;mxGraph.prototype.keepSelectionVisibleOnZoom=!1;mxGraph.prototype.centerZoom=!0;mxGraph.prototype.resetViewOnRootChange=!0;mxGraph.prototype.resetEdgesOnResize=!1;mxGraph.prototype.resetEdgesOnMove=!1;mxGraph.prototype.resetEdgesOnConnect=!0;mxGraph.prototype.allowLoops=!1;mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop;mxGraph.prototype.multigraph=!0;mxGraph.prototype.connectableEdges=!1;mxGraph.prototype.allowDanglingEdges=!0;mxGraph.prototype.cloneInvalidEdges=!1;mxGraph.prototype.disconnectOnMove=!0;mxGraph.prototype.labelsVisible=!0;mxGraph.prototype.htmlLabels=!1;mxGraph.prototype.swimlaneSelectionEnabled=!0;mxGraph.prototype.swimlaneNesting=!0;mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR;mxGraph.prototype.imageBundles=null;mxGraph.prototype.minFitScale=.1;mxGraph.prototype.maxFitScale=8;mxGraph.prototype.panDx=0;mxGraph.prototype.panDy=0;mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9);mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16);mxGraph.prototype.alreadyConnectedResource=mxClient.language!="none"?"alreadyConnected":"";mxGraph.prototype.containsValidationErrorsResource=mxClient.language!="none"?"containsValidationErrors":"";mxGraph.prototype.collapseExpandResource=mxClient.language!="none"?"collapse-expand":"";mxGraph.prototype.init=function(n){this.container=n;this.cellEditor=this.createCellEditor();this.view.init();this.sizeDidChange();mxEvent.addListener(n,"mouseleave",mxUtils.bind(this,function(){this.tooltipHandler!=null&&this.tooltipHandler.hide()}));mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(n,"selectstart",mxUtils.bind(this,function(n){return this.isEditing()||!this.isMouseDown&&!mxEvent.isShiftDown(n)})));document.documentMode==8&&n.insertAdjacentHTML("beforeend",'<v:group style="DISPLAY: none;"><\/v:group>')};mxGraph.prototype.createHandlers=function(){this.tooltipHandler=this.createTooltipHandler();this.tooltipHandler.setEnabled(!1);this.selectionCellsHandler=this.createSelectionCellsHandler();this.connectionHandler=this.createConnectionHandler();this.connectionHandler.setEnabled(!1);this.graphHandler=this.createGraphHandler();this.panningHandler=this.createPanningHandler();this.panningHandler.panningEnabled=!1;this.popupMenuHandler=this.createPopupMenuHandler()};mxGraph.prototype.createTooltipHandler=function(){return new mxTooltipHandler(this)};mxGraph.prototype.createSelectionCellsHandler=function(){return new mxSelectionCellsHandler(this)};mxGraph.prototype.createConnectionHandler=function(){return new mxConnectionHandler(this)};mxGraph.prototype.createGraphHandler=function(){return new mxGraphHandler(this)};mxGraph.prototype.createPanningHandler=function(){return new mxPanningHandler(this)};mxGraph.prototype.createPopupMenuHandler=function(){return new mxPopupMenuHandler(this)};mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)};mxGraph.prototype.createStylesheet=function(){return new mxStylesheet};mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)};mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer};mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)};mxGraph.prototype.getModel=function(){return this.model};mxGraph.prototype.getView=function(){return this.view};mxGraph.prototype.getStylesheet=function(){return this.stylesheet};mxGraph.prototype.setStylesheet=function(n){this.stylesheet=n};mxGraph.prototype.getSelectionModel=function(){return this.selectionModel};mxGraph.prototype.setSelectionModel=function(n){this.selectionModel=n};mxGraph.prototype.getSelectionCellsForChanges=function(n){for(var t,i,r=[],u=0;u<n.length;u++)t=n[u],t.constructor!=mxRootChange&&(i=null,t instanceof mxChildChange&&t.previous==null?i=t.child:t.cell!=null&&t.cell instanceof mxCell&&(i=t.cell),i!=null&&mxUtils.indexOf(r,i)<0&&r.push(i));return this.getModel().getTopmostCells(r)};mxGraph.prototype.graphModelChanged=function(n){for(var t=0;t<n.length;t++)this.processChange(n[t]);this.removeSelectionCells(this.getRemovedCellsForChanges(n));this.view.validate();this.sizeDidChange()};mxGraph.prototype.getRemovedCellsForChanges=function(n){for(var t,i=[],r=0;r<n.length;r++)if(t=n[r],t instanceof mxRootChange)break;else t instanceof mxChildChange?t.previous!=null&&t.parent==null&&(i=i.concat(this.model.getDescendants(t.child))):t instanceof mxVisibleChange&&(i=i.concat(this.model.getDescendants(t.cell)));return i};mxGraph.prototype.processChange=function(n){if(n instanceof mxRootChange)this.clearSelection(),this.removeStateForCell(n.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(n instanceof mxChildChange){var t=this.model.getParent(n.child);this.view.invalidate(n.child,!0,!0);(t==null||this.isCellCollapsed(t))&&(this.view.invalidate(n.child,!0,!0),this.removeStateForCell(n.child),this.view.currentRoot==n.child&&this.home());t!=n.previous&&(t!=null&&this.view.invalidate(t,!1,!1),n.previous!=null&&this.view.invalidate(n.previous,!1,!1))}else n instanceof mxTerminalChange||n instanceof mxGeometryChange?(n instanceof mxTerminalChange||n.previous==null&&n.geometry!=null||n.previous!=null&&!n.previous.equals(n.geometry))&&this.view.invalidate(n.cell):n instanceof mxValueChange?this.view.invalidate(n.cell,!1,!1):n instanceof mxStyleChange?(this.view.invalidate(n.cell,!0,!0),this.view.removeState(n.cell)):n.cell!=null&&n.cell instanceof mxCell&&this.removeStateForCell(n.cell)};mxGraph.prototype.removeStateForCell=function(n){for(var i=this.model.getChildCount(n),t=0;t<i;t++)this.removeStateForCell(this.model.getChildAt(n,t));this.view.invalidate(n,!1,!0);this.view.removeState(n)};mxGraph.prototype.addCellOverlay=function(n,t){n.overlays==null&&(n.overlays=[]);n.overlays.push(t);var i=this.view.getState(n);return i!=null&&this.cellRenderer.redraw(i),this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",n,"overlay",t)),t};mxGraph.prototype.getCellOverlays=function(n){return n.overlays};mxGraph.prototype.removeCellOverlay=function(n,t){var i,r;return t==null?this.removeCellOverlays(n):(i=mxUtils.indexOf(n.overlays,t),i>=0?(n.overlays.splice(i,1),n.overlays.length==0&&(n.overlays=null),r=this.view.getState(n),r!=null&&this.cellRenderer.redraw(r),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",n,"overlay",t))):t=null),t};mxGraph.prototype.removeCellOverlays=function(n){var t=n.overlays,r,i;if(t!=null)for(n.overlays=null,r=this.view.getState(n),r!=null&&this.cellRenderer.redraw(r),i=0;i<t.length;i++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",n,"overlay",t[i]));return t};mxGraph.prototype.clearCellOverlays=function(n){var i,t,r;for(n=n!=null?n:this.model.getRoot(),this.removeCellOverlays(n),i=this.model.getChildCount(n),t=0;t<i;t++)r=this.model.getChildAt(n,t),this.clearCellOverlays(r)};mxGraph.prototype.setCellWarning=function(n,t,i,r){if(t!=null&&t.length>0){i=i!=null?i:this.warningImage;var u=new mxCellOverlay(i,"<font color=red>"+t+"<\/font>");return r&&u.addListener(mxEvent.CLICK,mxUtils.bind(this,function(){this.isEnabled()&&this.setSelectionCell(n)})),this.addCellOverlay(n,u)}return this.removeCellOverlays(n),null};mxGraph.prototype.startEditing=function(n){this.startEditingAtCell(null,n)};mxGraph.prototype.startEditingAtCell=function(n,t){t!=null&&mxEvent.isMultiTouchEvent(t)||(n==null&&(n=this.getSelectionCell(),n==null||this.isCellEditable(n)||(n=null)),n!=null&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",n,"event",t)),this.cellEditor.startEditing(n,t),this.fireEvent(new mxEventObject(mxEvent.EDITING_STARTED,"cell",n,"event",t))))};mxGraph.prototype.getEditingValue=function(n){return this.convertValueToString(n)};mxGraph.prototype.stopEditing=function(n){this.cellEditor.stopEditing(n);this.fireEvent(new mxEventObject(mxEvent.EDITING_STOPPED,"cancel",n))};mxGraph.prototype.labelChanged=function(n,t,i){this.model.beginUpdate();try{var r=n.value;this.cellLabelChanged(n,t,this.isAutoSizeCell(n));this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",n,"value",t,"old",r,"event",i))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellLabelChanged=function(n,t,i){this.model.beginUpdate();try{this.model.setValue(n,t);i&&this.cellSizeUpdated(n,!1)}finally{this.model.endUpdate()}};mxGraph.prototype.escape=function(n){this.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",n))};mxGraph.prototype.click=function(n){var t=n.getEvent(),r=n.getCell(),u=new mxEventObject(mxEvent.CLICK,"event",t,"cell",r),i;n.isConsumed()&&u.consume();this.fireEvent(u);!this.isEnabled()||mxEvent.isConsumed(t)||u.isConsumed()||(r!=null?this.selectCellForEvent(r,t):(i=null,this.isSwimlaneSelectionEnabled()&&(i=this.getSwimlaneAt(n.getGraphX(),n.getGraphY())),i!=null?this.selectCellForEvent(i,t):this.isToggleEvent(t)||this.clearSelection()))};mxGraph.prototype.dblClick=function(n,t){var i=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",n,"cell",t);this.fireEvent(i);!this.isEnabled()||mxEvent.isConsumed(n)||i.isConsumed()||t==null||!this.isCellEditable(t)||this.isEditing(t)||(this.startEditingAtCell(t,n),mxEvent.consume(n))};mxGraph.prototype.tapAndHold=function(n){var r=n.getEvent(),i=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",r,"cell",n.getCell()),t;this.fireEvent(i);i.isConsumed()&&(this.panningHandler.panningTrigger=!1);this.isEnabled()&&!mxEvent.isConsumed(r)&&!i.isConsumed()&&this.connectionHandler.isEnabled()&&(t=this.view.getState(this.connectionHandler.marker.getCell(n)),t!=null&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=t,this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(n.getGraphX(),n.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(n),this.connectionHandler.previous=t,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous))))};mxGraph.prototype.scrollPointToVisible=function(n,t,i,r){var u,f,h,e,o,s,l,c;!this.timerAutoScroll&&(this.ignoreScrollbars||mxUtils.hasScrollbars(this.container))?(u=this.container,r=r!=null?r:20,n>=u.scrollLeft&&t>=u.scrollTop&&n<=u.scrollLeft+u.clientWidth&&t<=u.scrollTop+u.clientHeight&&(f=u.scrollLeft+u.clientWidth-n,f<r?(o=u.scrollLeft,u.scrollLeft+=r-f,i&&o==u.scrollLeft&&(this.dialect==mxConstants.DIALECT_SVG?(s=this.view.getDrawPane().ownerSVGElement,h=this.container.scrollWidth+r-f,s.style.width=h+"px"):(h=Math.max(u.clientWidth,u.scrollWidth)+r-f,c=this.view.getCanvas(),c.style.width=h+"px"),u.scrollLeft+=r-f)):(f=n-u.scrollLeft,f<r&&(u.scrollLeft-=r-f)),e=u.scrollTop+u.clientHeight-t,e<r?(o=u.scrollTop,u.scrollTop+=r-e,o==u.scrollTop&&i&&(this.dialect==mxConstants.DIALECT_SVG?(s=this.view.getDrawPane().ownerSVGElement,l=this.container.scrollHeight+r-e,s.style.height=l+"px"):(l=Math.max(u.clientHeight,u.scrollHeight)+r-e,c=this.view.getCanvas(),c.style.height=l+"px"),u.scrollTop+=r-e)):(e=t-u.scrollTop,e<r&&(u.scrollTop-=r-e)))):this.allowAutoPanning&&!this.panningHandler.isActive()&&(this.panningManager==null&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(n+this.panDx,t+this.panDy))};mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)};mxGraph.prototype.getBorderSizes=function(){function i(n){var t=0;return t=n=="thin"?2:n=="medium"?4:n=="thick"?6:parseInt(n),isNaN(t)&&(t=0),t}var n=mxUtils.getCurrentStyle(this.container),t=new mxRectangle;return t.x=i(n.borderLeftWidth)+parseInt(n.paddingLeft||0),t.y=i(n.borderTopWidth)+parseInt(n.paddingTop||0),t.width=i(n.borderRightWidth)+parseInt(n.paddingRight||0),t.height=i(n.borderBottomWidth)+parseInt(n.paddingBottom||0),t};mxGraph.prototype.getPreferredPageSize=function(n,t,i){var u=this.view.scale,f=this.view.translate,e=this.pageFormat,o=u*this.pageScale,r=new mxRectangle(0,0,e.width*o,e.height*o),s=this.pageBreaksVisible?Math.ceil(t/r.width):1,h=this.pageBreaksVisible?Math.ceil(i/r.height):1;return new mxRectangle(0,0,s*r.width+2+f.x/u,h*r.height+2+f.y/u)};mxGraph.prototype.sizeDidChange=function(){var i=this.getGraphBounds(),u,r;if(this.container!=null){var f=this.getBorder(),n=Math.max(0,i.x+i.width+1+f),t=Math.max(0,i.y+i.height+1+f);this.minimumContainerSize!=null&&(n=Math.max(n,this.minimumContainerSize.width),t=Math.max(t,this.minimumContainerSize.height));this.resizeContainer&&this.doResizeContainer(n,t);(this.preferPageSize||!mxClient.IS_IE&&this.pageVisible)&&(u=this.getPreferredPageSize(i,n,t),u!=null&&(n=u.width,t=u.height));this.minimumGraphSize!=null&&(n=Math.max(n,this.minimumGraphSize.width*this.view.scale),t=Math.max(t,this.minimumGraphSize.height*this.view.scale));n=Math.ceil(n-1);t=Math.ceil(t-1);this.dialect==mxConstants.DIALECT_SVG?(r=this.view.getDrawPane().ownerSVGElement,r.style.minWidth=Math.max(1,n)+"px",r.style.minHeight=Math.max(1,t)+"px",r.style.width="100%",r.style.height="100%"):mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,n),Math.max(1,t)):(this.view.canvas.style.minWidth=Math.max(1,n)+"px",this.view.canvas.style.minHeight=Math.max(1,t)+"px");this.updatePageBreaks(this.pageBreaksVisible,n-1,t-1)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",i))};mxGraph.prototype.doResizeContainer=function(n,t){if(document.documentMode>=9)n+=3,t+=5;else if(mxClient.IS_IE)if(mxClient.IS_QUIRKS){var i=this.getBorderSizes();n+=Math.max(2,i.x+i.width+1);t+=Math.max(2,i.y+i.height+1)}else n+=1,t+=1;else t+=1;this.maximumContainerSize!=null&&(n=Math.min(this.maximumContainerSize.width,n),t=Math.min(this.maximumContainerSize.height,t));this.container.style.width=Math.ceil(n)+"px";this.container.style.height=Math.ceil(t)+"px"};mxGraph.prototype.updatePageBreaks=function(n,t,i){var h=this.view.scale,c=this.view.translate,l=this.pageFormat,a=h*this.pageScale,u=new mxRectangle(h*c.x,h*c.y,l.width*a,l.height*a),e,f,r;n=n&&Math.min(u.width,u.height)>this.minPageBreakDist;u.x=mxUtils.mod(u.x,u.width);u.y=mxUtils.mod(u.y,u.height);var o=n?Math.ceil((t-u.x)/u.width):0,s=n?Math.ceil((i-u.y)/u.height):0,v=t,y=i;if(this.horizontalPageBreaks==null&&o>0&&(this.horizontalPageBreaks=[]),this.horizontalPageBreaks!=null){for(r=0;r<=o;r++)e=[new mxPoint(u.x+r*u.width,1),new mxPoint(u.x+r*u.width,y)],this.horizontalPageBreaks[r]!=null?(this.horizontalPageBreaks[r].points=e,this.horizontalPageBreaks[r].redraw()):(f=new mxPolyline(e,this.pageBreakColor),f.dialect=this.dialect,f.pointerEvents=!1,f.isDashed=this.pageBreakDashed,f.init(this.view.backgroundPane),f.redraw(),this.horizontalPageBreaks[r]=f);for(r=o;r<this.horizontalPageBreaks.length;r++)this.horizontalPageBreaks[r].destroy();this.horizontalPageBreaks.splice(o,this.horizontalPageBreaks.length-o)}if(this.verticalPageBreaks==null&&s>0&&(this.verticalPageBreaks=[]),this.verticalPageBreaks!=null){for(r=0;r<=s;r++)e=[new mxPoint(1,u.y+r*u.height),new mxPoint(v,u.y+r*u.height)],this.verticalPageBreaks[r]!=null?(this.verticalPageBreaks[r].points=e,this.verticalPageBreaks[r].redraw()):(f=new mxPolyline(e,this.pageBreakColor),f.dialect=this.dialect,f.pointerEvents=!1,f.isDashed=this.pageBreakDashed,f.init(this.view.backgroundPane),f.redraw(),this.verticalPageBreaks[r]=f);for(r=s;r<this.verticalPageBreaks.length;r++)this.verticalPageBreaks[r].destroy();this.verticalPageBreaks.splice(s,this.verticalPageBreaks.length-s)}};mxGraph.prototype.getCellStyle=function(n){var i=this.model.getStyle(n),t=null;return t=this.model.isEdge(n)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle(),i!=null&&(t=this.postProcessCellStyle(this.stylesheet.getCellStyle(i,t))),t==null&&(t=mxGraph.prototype.EMPTY_ARRAY),t};mxGraph.prototype.postProcessCellStyle=function(n){var r,t,i;return n!=null&&(r=n[mxConstants.STYLE_IMAGE],t=this.getImageFromBundles(r),t!=null?n[mxConstants.STYLE_IMAGE]=t:t=r,t!=null&&t.substring(0,11)=="data:image/"&&(t.substring(0,20)=="data:image/svg+xml,<"?t=t.substring(0,19)+encodeURIComponent(t.substring(19)):t.substring(0,22)!="data:image/svg+xml,%3C"&&(i=t.indexOf(","),i>0&&(t=t.substring(0,i)+";base64,"+t.substring(i+1))),n[mxConstants.STYLE_IMAGE]=t)),n};mxGraph.prototype.setCellStyle=function(n,t){if(t=t||this.getSelectionCells(),t!=null){this.model.beginUpdate();try{for(var i=0;i<t.length;i++)this.model.setStyle(t[i],n)}finally{this.model.endUpdate()}}};mxGraph.prototype.toggleCellStyle=function(n,t,i){return i=i||this.getSelectionCell(),this.toggleCellStyles(n,t,[i])};mxGraph.prototype.toggleCellStyles=function(n,t,i){var r,u,f;return t=t!=null?t:!1,i=i||this.getSelectionCells(),r=null,i!=null&&i.length>0&&(u=this.view.getState(i[0]),f=u!=null?u.style:this.getCellStyle(i[0]),f!=null&&(r=mxUtils.getValue(f,n,t)?0:1,this.setCellStyles(n,r,i))),r};mxGraph.prototype.setCellStyles=function(n,t,i){i=i||this.getSelectionCells();mxUtils.setCellStyles(this.model,i,n,t)};mxGraph.prototype.toggleCellStyleFlags=function(n,t,i){this.setCellStyleFlags(n,t,null,i)};mxGraph.prototype.setCellStyleFlags=function(n,t,i,r){var u,f,e;r=r||this.getSelectionCells();r!=null&&r.length>0&&(i==null&&(u=this.view.getState(r[0]),f=u!=null?u.style:this.getCellStyle(r[0]),f!=null&&(e=parseInt(f[n]||0),i=!((e&t)==t))),mxUtils.setCellStyleFlags(this.model,r,n,t,i))};mxGraph.prototype.alignCells=function(n,t,i){var e,u,r,f;if(t==null&&(t=this.getSelectionCells()),t!=null&&t.length>1){if(i==null)for(u=0;u<t.length;u++)if(r=this.view.getState(t[u]),r!=null&&!this.model.isEdge(t[u]))if(i==null)if(n==mxConstants.ALIGN_CENTER){i=r.x+r.width/2;break}else if(n==mxConstants.ALIGN_RIGHT)i=r.x+r.width;else if(n==mxConstants.ALIGN_TOP)i=r.y;else if(n==mxConstants.ALIGN_MIDDLE){i=r.y+r.height/2;break}else i=n==mxConstants.ALIGN_BOTTOM?r.y+r.height:r.x;else i=n==mxConstants.ALIGN_RIGHT?Math.max(i,r.x+r.width):n==mxConstants.ALIGN_TOP?Math.min(i,r.y):n==mxConstants.ALIGN_BOTTOM?Math.max(i,r.y+r.height):Math.min(i,r.x);if(i!=null){e=this.view.scale;this.model.beginUpdate();try{for(u=0;u<t.length;u++)r=this.view.getState(t[u]),r!=null&&(f=this.getCellGeometry(t[u]),f==null||this.model.isEdge(t[u])||(f=f.clone(),n==mxConstants.ALIGN_CENTER?f.x+=(i-r.x-r.width/2)/e:n==mxConstants.ALIGN_RIGHT?f.x+=(i-r.x-r.width)/e:n==mxConstants.ALIGN_TOP?f.y+=(i-r.y)/e:n==mxConstants.ALIGN_MIDDLE?f.y+=(i-r.y-r.height/2)/e:n==mxConstants.ALIGN_BOTTOM?f.y+=(i-r.y-r.height)/e:f.x+=(i-r.x)/e,this.resizeCell(t[u],f)));this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",n,"cells",t))}finally{this.model.endUpdate()}}}return t};mxGraph.prototype.flipEdge=function(n){if(n!=null&&this.alternateEdgeStyle!=null){this.model.beginUpdate();try{var t=this.model.getStyle(n);t==null||t.length==0?this.model.setStyle(n,this.alternateEdgeStyle):this.model.setStyle(n,null);this.resetEdge(n);this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",n))}finally{this.model.endUpdate()}}return n};mxGraph.prototype.addImageBundle=function(n){this.imageBundles.push(n)};mxGraph.prototype.removeImageBundle=function(n){for(var i=[],t=0;t<this.imageBundles.length;t++)this.imageBundles[t]!=n&&i.push(this.imageBundles[t]);this.imageBundles=i};mxGraph.prototype.getImageFromBundles=function(n){var t,i;if(n!=null)for(t=0;t<this.imageBundles.length;t++)if(i=this.imageBundles[t].getImage(n),i!=null)return i;return null};mxGraph.prototype.orderCells=function(n,t){t==null&&(t=mxUtils.sortCells(this.getSelectionCells(),!0));this.model.beginUpdate();try{this.cellsOrdered(t,n);this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",n,"cells",t))}finally{this.model.endUpdate()}return t};mxGraph.prototype.cellsOrdered=function(n,t){var i,r;if(n!=null){this.model.beginUpdate();try{for(i=0;i<n.length;i++)r=this.model.getParent(n[i]),t?this.model.add(r,n[i],i):this.model.add(r,n[i],this.model.getChildCount(r)-1);this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",t,"cells",n))}finally{this.model.endUpdate()}}};mxGraph.prototype.groupCells=function(n,t,i){var r,u,f;if(i==null&&(i=mxUtils.sortCells(this.getSelectionCells(),!0)),i=this.getCellsForGroup(i),n==null&&(n=this.createGroupCell(i)),r=this.getBoundsForGroup(n,i,t),i.length>0&&r!=null){u=this.model.getParent(n);u==null&&(u=this.model.getParent(i[0]));this.model.beginUpdate();try{this.getCellGeometry(n)==null&&this.model.setGeometry(n,new mxGeometry);f=this.model.getChildCount(u);this.cellsAdded([n],u,f,null,null,!1);f=this.model.getChildCount(n);this.cellsAdded(i,n,f,null,null,!1,!1);this.cellsMoved(i,-r.x,-r.y,!1,!0);this.cellsResized([n],[r],!1);this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",n,"border",t,"cells",i))}finally{this.model.endUpdate()}}return n};mxGraph.prototype.getCellsForGroup=function(n){var i=[],r,t;if(n!=null&&n.length>0)for(r=this.model.getParent(n[0]),i.push(n[0]),t=1;t<n.length;t++)this.model.getParent(n[t])==r&&i.push(n[t]);return i};mxGraph.prototype.getBoundsForGroup=function(n,t,i){var r=this.getBoundingBoxFromGeometry(t,!0),u;return r!=null&&(this.isSwimlane(n)&&(u=this.getStartSize(n),r.x-=u.width,r.y-=u.height,r.width+=u.width,r.height+=u.height),i!=null&&(r.x-=i,r.y-=i,r.width+=2*i,r.height+=2*i)),r};mxGraph.prototype.createGroupCell=function(){var n=new mxCell("");return n.setVertex(!0),n.setConnectable(!1),n};mxGraph.prototype.ungroupCells=function(n){var r=[],u,t,i,f,e;if(n==null){for(n=this.getSelectionCells(),u=[],t=0;t<n.length;t++)this.model.getChildCount(n[t])>0&&u.push(n[t]);n=u}if(n!=null&&n.length>0){this.model.beginUpdate();try{for(t=0;t<n.length;t++)i=this.model.getChildren(n[t]),i!=null&&i.length>0&&(i=i.slice(),f=this.model.getParent(n[t]),e=this.model.getChildCount(f),this.cellsAdded(i,f,e,null,null,!0),r=r.concat(i));this.cellsRemoved(this.addAllEdges(n));this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,"cells",n))}finally{this.model.endUpdate()}}return r};mxGraph.prototype.removeCellsFromParent=function(n){n==null&&(n=this.getSelectionCells());this.model.beginUpdate();try{var t=this.getDefaultParent(),i=this.model.getChildCount(t);this.cellsAdded(n,t,i,null,null,!0);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",n))}finally{this.model.endUpdate()}return n};mxGraph.prototype.updateGroupBounds=function(n,t,i,r,u,f,e){var h,o,c,s,l,a,v;n==null&&(n=this.getSelectionCells());t=t!=null?t:0;i=i!=null?i:!1;r=r!=null?r:0;u=u!=null?u:0;f=f!=null?f:0;e=e!=null?e:0;this.model.beginUpdate();try{for(h=n.length-1;h>=0;h--)o=this.getCellGeometry(n[h]),o!=null&&(c=this.getChildCells(n[h]),c!=null&&c.length>0&&(s=this.getBoundingBoxFromGeometry(c,!0),s!=null&&s.width>0&&s.height>0&&(l=0,a=0,this.isSwimlane(n[h])&&(v=this.getStartSize(n[h]),l=v.width,a=v.height),o=o.clone(),i&&(o.x=o.x+s.x-t-l-e,o.y=o.y+s.y-t-a-r),o.width=s.width+2*t+l+e+u,o.height=s.height+2*t+a+r+f,this.model.setGeometry(n[h],o),this.moveCells(c,t+l-s.x+e,t+a-s.y+r))))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cloneCells=function(n,t){var r,a,y,g,o,s,i,f,p,v,w,b,u,k,d,c,l;if(t=t!=null?t:!0,r=null,n!=null){for(a={},y=[],i=0;i<n.length;i++)g=mxCellPath.create(n[i]),a[g]=n[i],y.push(n[i]);if(y.length>0){for(o=this.view.scale,s=this.view.translate,r=this.model.cloneCells(n,!0),i=0;i<n.length;i++)if(!t&&this.model.isEdge(r[i])&&this.getEdgeValidationError(r[i],this.model.getTerminal(r[i],!0),this.model.getTerminal(r[i],!1))!=null)r[i]=null;else if(f=this.model.getGeometry(r[i]),f!=null&&(p=this.view.getState(n[i]),v=this.view.getState(this.model.getParent(n[i])),p!=null&&v!=null))if(w=v.origin.x,b=v.origin.y,this.model.isEdge(r[i])){for(var h=p.absolutePoints,e=this.model.getTerminal(n[i],!0),nt=mxCellPath.create(e);e!=null&&a[nt]==null;)e=this.model.getParent(e),nt=mxCellPath.create(e);for(e==null&&f.setTerminalPoint(new mxPoint(h[0].x/o-s.x,h[0].y/o-s.y),!0),u=this.model.getTerminal(n[i],!1),k=mxCellPath.create(u);u!=null&&a[k]==null;)u=this.model.getParent(u),k=mxCellPath.create(u);if(u==null&&(d=h.length-1,f.setTerminalPoint(new mxPoint(h[d].x/o-s.x,h[d].y/o-s.y),!1)),c=f.points,c!=null)for(l=0;l<c.length;l++)c[l].x+=w,c[l].y+=b}else f.translate(w,b)}else r=[]}return r};mxGraph.prototype.insertVertex=function(n,t,i,r,u,f,e,o,s){var h=this.createVertex(n,t,i,r,u,f,e,o,s);return this.addCell(h,n)};mxGraph.prototype.createVertex=function(n,t,i,r,u,f,e,o,s){var c=new mxGeometry(r,u,f,e),h;return c.relative=s!=null?s:!1,h=new mxCell(i,c,o),h.setId(t),h.setVertex(!0),h.setConnectable(!0),h};mxGraph.prototype.insertEdge=function(n,t,i,r,u,f){var e=this.createEdge(n,t,i,r,u,f);return this.addEdge(e,n,r,u)};mxGraph.prototype.createEdge=function(n,t,i,r,u,f){var e=new mxCell(i,new mxGeometry,f);return e.setId(t),e.setEdge(!0),e.geometry.relative=!0,e};mxGraph.prototype.addEdge=function(n,t,i,r,u){return this.addCell(n,t,u,i,r)};mxGraph.prototype.addCell=function(n,t,i,r,u){return this.addCells([n],t,i,r,u)[0]};mxGraph.prototype.addCells=function(n,t,i,r,u){t==null&&(t=this.getDefaultParent());i==null&&(i=this.model.getChildCount(t));this.model.beginUpdate();try{this.cellsAdded(n,t,i,r,u,!1,!0);this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",n,"parent",t,"index",i,"source",r,"target",u))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellsAdded=function(n,t,i,r,u,f,e){var o,h,y,p;if(n!=null&&t!=null&&i!=null){this.model.beginUpdate();try{var l=f?this.view.getState(t):null,c=l!=null?l.origin:null,w=new mxPoint(0,0);for(o=0;o<n.length;o++)if(n[o]==null)i--;else{if(h=this.model.getParent(n[o]),c!=null&&n[o]!=t&&t!=h){var a=this.view.getState(h),v=a!=null?a.origin:w,s=this.model.getGeometry(n[o]);s!=null&&(y=v.x-c.x,p=v.y-c.y,s=s.clone(),s.translate(y,p),s.relative||!this.model.isVertex(n[o])||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.model.setGeometry(n[o],s))}t==h&&i+o>this.model.getChildCount(t)&&i--;this.model.add(t,n[o],i+o);this.autoSizeCellsOnAdd&&this.autoSizeCell(n[o],!0);this.isExtendParentsOnAdd(n[o])&&this.isExtendParent(n[o])&&this.extendParent(n[o]);(e==null||e)&&this.constrainChild(n[o]);r!=null&&this.cellConnected(n[o],r,!0);u!=null&&this.cellConnected(n[o],u,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",n,"parent",t,"index",i,"source",r,"target",u,"absolute",f))}finally{this.model.endUpdate()}}};mxGraph.prototype.autoSizeCell=function(n,t){var r,i;if(t=t!=null?t:!0,t)for(r=this.model.getChildCount(n),i=0;i<r;i++)this.autoSizeCell(this.model.getChildAt(n,i));this.getModel().isVertex(n)&&this.isAutoSizeCell(n)&&this.updateCellSize(n)};mxGraph.prototype.removeCells=function(n,t){t=t!=null?t:!0;n==null&&(n=this.getDeletableCells(this.getSelectionCells()));t&&(n=this.getDeletableCells(this.addAllEdges(n)));this.model.beginUpdate();try{this.cellsRemoved(n);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",n,"includeEdges",t))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellsRemoved=function(n){var o,s,h,t,r,i,f,u,e;if(n!=null&&n.length>0){o=this.view.scale;s=this.view.translate;this.model.beginUpdate();try{for(h={},t=0;t<n.length;t++)f=mxCellPath.create(n[t]),h[f]=n[t];for(t=0;t<n.length;t++){for(r=this.getConnections(n[t]),i=0;i<r.length;i++)if(f=mxCellPath.create(r[i]),h[f]==null&&(u=this.model.getGeometry(r[i]),u!=null&&(e=this.view.getState(r[i]),e!=null))){u=u.clone();var c=e.getVisibleTerminal(!0)==n[t],l=e.absolutePoints,a=c?0:l.length-1;u.setTerminalPoint(new mxPoint(l[a].x/o-s.x,l[a].y/o-s.y),c);this.model.setTerminal(r[i],null,c);this.model.setGeometry(r[i],u)}this.model.remove(n[t])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",n))}finally{this.model.endUpdate()}}};mxGraph.prototype.splitEdge=function(n,t,i,r,u){r=r||0;u=u||0;i==null&&(i=this.cloneCells([n])[0]);var f=this.model.getParent(n),e=this.model.getTerminal(n,!0);this.model.beginUpdate();try{this.cellsMoved(t,r,u,!1,!1);this.cellsAdded(t,f,this.model.getChildCount(f),null,null,!0);this.cellsAdded([i],f,this.model.getChildCount(f),e,t[0],!1);this.cellConnected(n,t[0],!0);this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",n,"cells",t,"newEdge",i,"dx",r,"dy",u))}finally{this.model.endUpdate()}return i};mxGraph.prototype.toggleCells=function(n,t,i){t==null&&(t=this.getSelectionCells());i&&(t=this.addAllEdges(t));this.model.beginUpdate();try{this.cellsToggled(t,n);this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",n,"cells",t,"includeEdges",i))}finally{this.model.endUpdate()}return t};mxGraph.prototype.cellsToggled=function(n,t){if(n!=null&&n.length>0){this.model.beginUpdate();try{for(var i=0;i<n.length;i++)this.model.setVisible(n[i],t)}finally{this.model.endUpdate()}}};mxGraph.prototype.foldCells=function(n,t,i,r){t=t!=null?t:!1;i==null&&(i=this.getFoldableCells(this.getSelectionCells(),n));this.stopEditing(!1);this.model.beginUpdate();try{this.cellsFolded(i,n,t,r);this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",n,"recurse",t,"cells",i))}finally{this.model.endUpdate()}return i};mxGraph.prototype.cellsFolded=function(n,t,i,r){var u,f;if(n!=null&&n.length>0){this.model.beginUpdate();try{for(u=0;u<n.length;u++)(!r||this.isCellFoldable(n[u],t))&&t!=this.isCellCollapsed(n[u])&&(this.model.setCollapsed(n[u],t),this.swapBounds(n[u],t),this.isExtendParent(n[u])&&this.extendParent(n[u]),i&&(f=this.model.getChildren(n[u]),this.foldCells(f,t,i)),this.isConstrainChildrenOnResize()&&this.constrainChild(n[u]));this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",n,"collapse",t,"recurse",i))}finally{this.model.endUpdate()}}};mxGraph.prototype.swapBounds=function(n,t){if(n!=null){var i=this.model.getGeometry(n);i!=null&&(i=i.clone(),this.updateAlternateBounds(n,i,t),i.swap(),this.model.setGeometry(n,i))}};mxGraph.prototype.updateAlternateBounds=function(n,t){var u,f,i,e,o,r;if(n!=null&&t!=null&&(u=this.view.getState(n),f=u!=null?u.style:this.getCellStyle(n),t.alternateBounds==null&&(i=t,this.collapseToPreferredSize&&(e=this.getPreferredSizeForCell(n),e!=null&&(i=e,o=mxUtils.getValue(f,mxConstants.STYLE_STARTSIZE),o>0&&(i.height=Math.max(i.height,o)))),t.alternateBounds=new mxRectangle(0,0,i.width,i.height)),t.alternateBounds!=null&&(t.alternateBounds.x=t.x,t.alternateBounds.y=t.y,r=mxUtils.toRadians(f[mxConstants.STYLE_ROTATION]||0),r!=0))){var s=t.alternateBounds.getCenterX()-t.getCenterX(),h=t.alternateBounds.getCenterY()-t.getCenterY(),c=Math.cos(r),l=Math.sin(r),a=c*s-l*h,v=l*s+c*h;t.alternateBounds.x+=a-s;t.alternateBounds.y+=v-h}};mxGraph.prototype.addAllEdges=function(n){var t=n.slice();return t.concat(this.getAllEdges(n))};mxGraph.prototype.getAllEdges=function(n){var i=[],t,u,r,f;if(n!=null)for(t=0;t<n.length;t++){for(u=this.model.getEdgeCount(n[t]),r=0;r<u;r++)i.push(this.model.getEdgeAt(n[t],r));f=this.model.getChildren(n[t]);i=i.concat(this.getAllEdges(f))}return i};mxGraph.prototype.updateCellSize=function(n,t){t=t!=null?t:!1;this.model.beginUpdate();try{this.cellSizeUpdated(n,t);this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",n,"ignoreChildren",t))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellSizeUpdated=function(n,t){var r,i,e,f;if(n!=null){this.model.beginUpdate();try{if(r=this.getPreferredSizeForCell(n),i=this.model.getGeometry(n),r!=null&&i!=null){if(e=this.isCellCollapsed(n),i=i.clone(),this.isSwimlane(n)){var o=this.view.getState(n),c=o!=null?o.style:this.getCellStyle(n),u=this.model.getStyle(n);u==null&&(u="");mxUtils.getValue(c,mxConstants.STYLE_HORIZONTAL,!0)?(u=mxUtils.setStyle(u,mxConstants.STYLE_STARTSIZE,r.height+8),e&&(i.height=r.height+8),i.width=r.width):(u=mxUtils.setStyle(u,mxConstants.STYLE_STARTSIZE,r.width+8),e&&(i.width=r.width+8),i.height=r.height);this.model.setStyle(n,u)}else i.width=r.width,i.height=r.height;if(!t&&!e&&(f=this.view.getBounds(this.model.getChildren(n)),f!=null)){var s=this.view.translate,h=this.view.scale,l=(f.x+f.width)/h-i.x-s.x,a=(f.y+f.height)/h-i.y-s.y;i.width=Math.max(i.width,l);i.height=Math.max(i.height,a)}this.cellsResized([n],[i],!1)}}finally{this.model.endUpdate()}}};mxGraph.prototype.getPreferredSizeForCell=function(n){var s=null,r,t,h,i,a,c;if(n!=null&&(r=this.view.getState(n)||this.view.createState(n),t=r.style,!this.model.isEdge(n))){var v=t[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,u=0,f=0;if((this.getImage(r)!=null||t[mxConstants.STYLE_IMAGE]!=null)&&t[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL&&(t[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(u+=parseFloat(t[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),t[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(f+=parseFloat(t[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize)),u+=2*(t[mxConstants.STYLE_SPACING]||0),u+=t[mxConstants.STYLE_SPACING_LEFT]||0,u+=t[mxConstants.STYLE_SPACING_RIGHT]||0,f+=2*(t[mxConstants.STYLE_SPACING]||0),f+=t[mxConstants.STYLE_SPACING_TOP]||0,f+=t[mxConstants.STYLE_SPACING_BOTTOM]||0,h=this.getFoldingImage(r),h!=null&&(u+=h.width+8),i=this.cellRenderer.getLabelValue(r),i!=null&&i.length>0){this.isHtmlLabel(r.cell)||(i=mxUtils.htmlEntities(i));i=i.replace(/\n/g,"<br>");var l=mxUtils.getSizeForString(i,v,t[mxConstants.STYLE_FONTFAMILY]),e=l.width+u,o=l.height+f;mxUtils.getValue(t,mxConstants.STYLE_HORIZONTAL,!0)||(a=o,o=e,e=a);this.gridEnabled&&(e=this.snap(e+this.gridSize/2),o=this.snap(o+this.gridSize/2));s=new mxRectangle(0,0,e,o)}else c=4*this.gridSize,s=new mxRectangle(0,0,c,c)}return s};mxGraph.prototype.resizeCell=function(n,t,i){return this.resizeCells([n],[t],i)[0]};mxGraph.prototype.resizeCells=function(n,t,i){i=i!=null?i:this.isRecursiveResize();this.model.beginUpdate();try{this.cellsResized(n,t,i);this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",n,"bounds",t))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellsResized=function(n,t,i){if(i=i!=null?i:!1,n!=null&&t!=null&&n.length==t.length){this.model.beginUpdate();try{for(var r=0;r<n.length;r++)this.cellResized(n[r],t[r],!1,i),this.isExtendParent(n[r])&&this.extendParent(n[r]),this.isConstrainChildrenOnResize()&&this.constrainChild(n[r]);this.resetEdgesOnResize&&this.resetEdges(n);this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",n,"bounds",t))}finally{this.model.endUpdate()}}};mxGraph.prototype.cellResized=function(n,t,i,r){var u=this.model.getGeometry(n),f;if(u!=null&&(u.x!=t.x||u.y!=t.y||u.width!=t.width||u.height!=t.height)){u=u.clone();!i&&u.relative?(f=u.offset,f!=null&&(f.x+=t.x-u.x,f.y+=t.y-u.y)):(u.x=t.x,u.y=t.y);u.width=t.width;u.height=t.height;u.relative||!this.model.isVertex(n)||this.isAllowNegativeCoordinates()||(u.x=Math.max(0,u.x),u.y=Math.max(0,u.y));this.model.beginUpdate();try{r&&this.resizeChildCells(n,u);this.model.setGeometry(n,u);this.isConstrainChildrenOnResize()&&this.constrainChildCells(n)}finally{this.model.endUpdate()}}};mxGraph.prototype.resizeChildCells=function(n,t){for(var r=this.model.getGeometry(n),u=t.width/r.width,f=t.height/r.height,e=this.model.getChildCount(n),i=0;i<e;i++)this.scaleCell(this.model.getChildAt(n,i),u,f,!0)};mxGraph.prototype.constrainChildCells=function(n){for(var i=this.model.getChildCount(n),t=0;t<i;t++)this.constrainChild(this.model.getChildAt(n,t))};mxGraph.prototype.scaleCell=function(n,t,i,r){var u=this.model.getGeometry(n),f,e;u!=null&&this.isCellMovable(n)&&this.isCellResizable(n)&&(f=this.view.getState(n),e=f!=null?f.style:this.getCellStyle(n),u=u.clone(),u.scale(t,i,f.style[mxConstants.STYLE_ASPECT]=="fixed"),this.model.isVertex(n)?this.cellResized(n,u,!0,r):this.model.setGeometry(n,u))};mxGraph.prototype.extendParent=function(n){var r,t,i;n!=null&&(r=this.model.getParent(n),t=this.getCellGeometry(r),r==null||t==null||this.isCellCollapsed(r)||(i=this.getCellGeometry(n),i!=null&&!i.relative&&(t.width<i.x+i.width||t.height<i.y+i.height)&&(t=t.clone(),t.width=Math.max(t.width,i.x+i.width),t.height=Math.max(t.height,i.y+i.height),this.cellsResized([r],[t],!1))))};mxGraph.prototype.importCells=function(n,t,i,r,u){return this.moveCells(n,t,i,!0,r,u)};mxGraph.prototype.moveCells=function(n,t,i,r,u,f){var e,o;if(t=t!=null?t:0,i=i!=null?i:0,r=r!=null?r:!1,n!=null&&(t!=0||i!=0||r||u!=null)){this.model.beginUpdate();try{r&&(n=this.cloneCells(n,this.isCloneInvalidEdges()),u==null&&(u=this.getDefaultParent()));e=this.isAllowNegativeCoordinates();u!=null&&this.setAllowNegativeCoordinates(!0);this.cellsMoved(n,t,i,!r&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),u==null,this.isExtendParentsOnMove()&&u==null);this.setAllowNegativeCoordinates(e);u!=null&&(o=this.model.getChildCount(u),this.cellsAdded(n,u,o,null,null,!0));this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",n,"dx",t,"dy",i,"clone",r,"target",u,"event",f))}finally{this.model.endUpdate()}}return n};mxGraph.prototype.cellsMoved=function(n,t,i,r,u,f){if(n!=null&&(t!=0||i!=0)){f=f!=null?f:!1;n=this.model.getTopmostCells(n);this.model.beginUpdate();try{r&&this.disconnectGraph(n);for(var e=0;e<n.length;e++)this.translateCell(n[e],t,i),f&&this.isExtendParent(n[e])?this.extendParent(n[e]):u&&this.constrainChild(n[e]);this.resetEdgesOnMove&&this.resetEdges(n);this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",n,"dx",t,"dy",i,"disconnect",r))}finally{this.model.endUpdate()}}};mxGraph.prototype.translateCell=function(n,t,i){var r=this.model.getGeometry(n),u,f,e,o;if(r!=null){if(t=parseFloat(t),i=parseFloat(i),r=r.clone(),r.translate(t,i),r.relative||!this.model.isVertex(n)||this.isAllowNegativeCoordinates()||(r.x=Math.max(0,parseFloat(r.x)),r.y=Math.max(0,parseFloat(r.y))),r.relative&&!this.model.isEdge(n)){if(u=this.model.getParent(n),f=0,this.model.isVertex(u)&&(e=this.view.getState(u),o=e!=null?e.style:this.getCellStyle(u),f=mxUtils.getValue(o,mxConstants.STYLE_ROTATION,0)),f!=0){var s=mxUtils.toRadians(-f),c=Math.cos(s),l=Math.sin(s),h=mxUtils.getRotatedPoint(new mxPoint(t,i),c,l,new mxPoint(0,0));t=h.x;i=h.y}r.offset==null?r.offset=new mxPoint(t,i):(r.offset.x=parseFloat(r.offset.x)+t,r.offset.y=parseFloat(r.offset.y)+i)}this.model.setGeometry(n,r)}};mxGraph.prototype.getCellContainmentArea=function(n){var t,u,v;if(n!=null&&!this.model.isEdge(n)){if(t=this.model.getParent(n),t==this.getDefaultParent()||t==this.getCurrentRoot())return this.getMaximumGraphBounds();if(t!=null&&t!=this.getDefaultParent()&&(u=this.model.getGeometry(t),u!=null)){var e=0,o=0,s=u.width,h=u.height;if(this.isSwimlane(t)){var i=this.getStartSize(t),c=this.view.getState(t),f=c!=null?c.style:this.getCellStyle(t),r=mxUtils.getValue(f,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),l=mxUtils.getValue(f,mxConstants.STYLE_FLIPH,0)==1,a=mxUtils.getValue(f,mxConstants.STYLE_FLIPV,0)==1;(r==mxConstants.DIRECTION_SOUTH||r==mxConstants.DIRECTION_NORTH)&&(v=i.width,i.width=i.height,i.height=v);(r==mxConstants.DIRECTION_EAST&&!a||r==mxConstants.DIRECTION_NORTH&&!l||r==mxConstants.DIRECTION_WEST&&a||r==mxConstants.DIRECTION_SOUTH&&l)&&(e=i.width,o=i.height);s-=i.width;h-=i.height}return new mxRectangle(e,o,s,h)}}return null};mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds};mxGraph.prototype.constrainChild=function(n){var y,c,f,t,e,b,o,l,a,v;if(n!=null){var i=this.getCellGeometry(n),u=this.getMaximumGraphBounds(),r=this.isConstrainChild(n)?this.getCellContainmentArea(n):u;if(i!=null&&!i.relative&&r!=null){if(y=[n],!this.isCellCollapsed(n))for(c=this.model.getDescendants(n),f=0;f<c.length;f++)this.isCellVisible(c[f])&&y.push(c[f]);if(t=this.getBoundingBoxFromGeometry(y,!1),t!=null){if(e=r==u?0:this.getOverlap(n),b=r==u,u!=null){for(u=mxRectangle.fromRectangle(u),o=this.model.getParent(n);this.model.isVertex(o);)l=this.getCellGeometry(o),l!=null&&(u.x-=l.x,u.y-=l.y),o=this.model.getParent(o);b&&(r=u)}var s=r.x-t.width*e,h=r.y-t.height*e,p=r.x+r.width+t.width*e,w=r.y+r.height+t.height*e;r!=u&&u!=null&&(s=Math.max(s,u.x),h=Math.max(h,u.y));(t.x<s||t.x+t.width>p||t.y<h||t.y+t.height>w)&&(i=i.clone(),t.x<s?(a=s-t.x,i.x+=a):r.width>0&&t.x+t.width>p&&(a=t.x+t.width-p,i.x-=a),t.y<h?(v=h-t.y,i.y+=v):r.height>0&&t.y+t.height>w&&(v=t.y+t.height-w,i.y-=v),i.width=Math.min(i.width,r.width+i.width-t.width),i.height=Math.min(i.height,r.height+i.height-t.height),this.model.setGeometry(n,i))}}}};mxGraph.prototype.resetEdges=function(n){var u,e,t,i,r;if(n!=null){for(u={},t=0;t<n.length;t++)e=mxCellPath.create(n[t]),u[e]=n[t];this.model.beginUpdate();try{for(t=0;t<n.length;t++){if(i=this.model.getEdges(n[t]),i!=null)for(r=0;r<i.length;r++){var f=this.view.getState(i[r]),o=f!=null?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(i[r],!0),s=f!=null?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(i[r],!1),h=mxCellPath.create(o),c=mxCellPath.create(s);(u[h]==null||u[c]==null)&&this.resetEdge(i[r])}this.resetEdges(this.model.getChildren(n[t]))}}finally{this.model.endUpdate()}}};mxGraph.prototype.resetEdge=function(n){var t=this.model.getGeometry(n);return t!=null&&t.points!=null&&t.points.length>0&&(t=t.clone(),t.points=[],this.model.setGeometry(n,t)),n};mxGraph.prototype.getOutlineConstraint=function(n,t){var i,f,o,r,u,e,a,v;if(t.shape!=null){if(i=this.view.getPerimeterBounds(t),f=t.style[mxConstants.STYLE_DIRECTION],(f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH)&&(i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2,e=i.width,i.width=i.height,i.height=e),o=mxUtils.toRadians(t.shape.getShapeRotation()),o!=0){var y=Math.cos(-o),p=Math.sin(-o),w=new mxPoint(i.getCenterX(),i.getCenterY());n=mxUtils.getRotatedPoint(n,y,p,w)}var s=1,h=1,c=0,l=0;return this.getModel().isVertex(t.cell)&&(r=t.style[mxConstants.STYLE_FLIPH],u=t.style[mxConstants.STYLE_FLIPV],t.shape!=null&&t.shape.stencil!=null&&(r=mxUtils.getValue(t.style,"stencilFlipH",0)==1||r,u=mxUtils.getValue(t.style,"stencilFlipV",0)==1||u),(f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH)&&(e=r,r=u,u=e),r&&(s=-1,c=-i.width),u&&(h=-1,l=-i.height)),n=new mxPoint((n.x-i.x)*s-c+i.x,(n.y-i.y)*h-l+i.y),a=Math.round((n.x-i.x)*1e3/i.width)/1e3,v=Math.round((n.y-i.y)*1e3/i.height)/1e3,new mxConnectionConstraint(new mxPoint(a,v),!1)}return null};mxGraph.prototype.getAllConnectionConstraints=function(n){return n!=null&&n.shape!=null&&n.shape.stencil!=null?n.shape.stencil.constraints:null};mxGraph.prototype.getConnectionConstraint=function(n,t,i){var r=null,e=n.style[i?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X],u,f;return e!=null&&(u=n.style[i?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y],u!=null&&(r=new mxPoint(parseFloat(e),parseFloat(u)))),f=!1,r!=null&&(f=mxUtils.getValue(n.style,i?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0)),new mxConnectionConstraint(r,f)};mxGraph.prototype.setConnectionConstraint=function(n,t,i,r){if(r!=null){this.model.beginUpdate();try{r==null||r.point==null?(this.setCellStyles(i?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[n]),this.setCellStyles(i?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[n]),this.setCellStyles(i?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[n])):r.point!=null&&(this.setCellStyles(i?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,r.point.x,[n]),this.setCellStyles(i?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,r.point.y,[n]),r.perimeter?this.setCellStyles(i?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[n]):this.setCellStyles(i?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[n]))}finally{this.model.endUpdate()}}};mxGraph.prototype.getConnectionPoint=function(n,t){var i=null,e,o,w,h,c,s;if(n!=null&&t.point!=null){var r=this.view.getPerimeterBounds(n),l=new mxPoint(r.getCenterX(),r.getCenterY()),u=n.style[mxConstants.STYLE_DIRECTION],f=0;if(u!=null&&(u==mxConstants.DIRECTION_NORTH?f+=270:u==mxConstants.DIRECTION_WEST?f+=180:u==mxConstants.DIRECTION_SOUTH&&(f+=90),(u==mxConstants.DIRECTION_NORTH||u==mxConstants.DIRECTION_SOUTH)&&r.rotate90()),t.point!=null){var a=1,v=1,y=0,p=0;this.getModel().isVertex(n.cell)&&(e=n.style[mxConstants.STYLE_FLIPH],o=n.style[mxConstants.STYLE_FLIPV],n.shape!=null&&n.shape.stencil!=null&&(e=mxUtils.getValue(n.style,"stencilFlipH",0)==1||e,o=mxUtils.getValue(n.style,"stencilFlipV",0)==1||o),(u==mxConstants.DIRECTION_NORTH||u==mxConstants.DIRECTION_SOUTH)&&(w=e,e=o,o=w),e&&(a=-1,y=-r.width),o&&(v=-1,p=-r.height));i=new mxPoint(r.x+t.point.x*r.width*a-y,r.y+t.point.y*r.height*v-p)}if(h=n.style[mxConstants.STYLE_ROTATION]||0,t.perimeter?(f!=0&&i!=null&&(c=0,s=0,f==90?s=1:f==180?c=-1:f==270&&(s=-1),i=mxUtils.getRotatedPoint(i,c,s,l)),i!=null&&t.perimeter&&(i=this.view.getPerimeterPoint(n,i,!1))):h+=f,h!=0&&i!=null){var b=mxUtils.toRadians(h),c=Math.cos(b),s=Math.sin(b);i=mxUtils.getRotatedPoint(i,c,s,l)}}return i!=null&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),i};mxGraph.prototype.connectCell=function(n,t,i,r){this.model.beginUpdate();try{var u=this.model.getTerminal(n,i);this.cellConnected(n,t,i,r);this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",n,"terminal",t,"source",i,"previous",u))}finally{this.model.endUpdate()}return n};mxGraph.prototype.cellConnected=function(n,t,i,r){var f,u,e;if(n!=null){this.model.beginUpdate();try{f=this.model.getTerminal(n,i);this.setConnectionConstraint(n,t,i,r);this.isPortsEnabled()&&(u=null,this.isPort(t)&&(u=t.getId(),t=this.getTerminalForPort(t,i)),e=i?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,this.setCellStyles(e,u,[n]));this.model.setTerminal(n,t,i);this.resetEdgesOnConnect&&this.resetEdge(n);this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",n,"terminal",t,"source",i,"previous",f))}finally{this.model.endUpdate()}}};mxGraph.prototype.disconnectGraph=function(n){var y,t,u,c,s,l,i,a,v;if(n!=null){this.model.beginUpdate();try{var e=this.view.scale,o=this.view.translate,h={};for(t=0;t<n.length;t++)y=mxCellPath.create(n[t]),h[y]=n[t];for(t=0;t<n.length;t++)if(this.model.isEdge(n[t])&&(u=this.model.getGeometry(n[t]),u!=null&&(c=this.view.getState(n[t]),s=this.view.getState(this.model.getParent(n[t])),c!=null&&s!=null))){u=u.clone();var p=-s.origin.x,w=-s.origin.y,f=c.absolutePoints,r=this.model.getTerminal(n[t],!0);if(r!=null&&this.isCellDisconnectable(n[t],r,!0)){for(l=mxCellPath.create(r);r!=null&&h[l]==null;)r=this.model.getParent(r),l=mxCellPath.create(r);r==null&&(u.setTerminalPoint(new mxPoint(f[0].x/e-o.x+p,f[0].y/e-o.y+w),!0),this.model.setTerminal(n[t],null,!0))}if(i=this.model.getTerminal(n[t],!1),i!=null&&this.isCellDisconnectable(n[t],i,!1)){for(a=mxCellPath.create(i);i!=null&&h[a]==null;)i=this.model.getParent(i),a=mxCellPath.create(i);i==null&&(v=f.length-1,u.setTerminalPoint(new mxPoint(f[v].x/e-o.x+p,f[v].y/e-o.y+w),!1),this.model.setTerminal(n[t],null,!1))}this.model.setGeometry(n[t],u)}}finally{this.model.endUpdate()}}};mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot};mxGraph.prototype.getTranslateForRoot=function(){return null};mxGraph.prototype.isPort=function(){return!1};mxGraph.prototype.getTerminalForPort=function(n){return this.model.getParent(n)};mxGraph.prototype.getChildOffsetForCell=function(){return null};mxGraph.prototype.enterGroup=function(n){n=n||this.getSelectionCell();n!=null&&this.isValidRoot(n)&&(this.view.setCurrentRoot(n),this.clearSelection())};mxGraph.prototype.exitGroup=function(){var t=this.model.getRoot(),i=this.getCurrentRoot(),n,r;if(i!=null){for(n=this.model.getParent(i);n!=t&&!this.isValidRoot(n)&&this.model.getParent(n)!=t;)n=this.model.getParent(n);n==t||this.model.getParent(n)==t?this.view.setCurrentRoot(null):this.view.setCurrentRoot(n);r=this.view.getState(i);r!=null&&this.setSelectionCell(i)}};mxGraph.prototype.home=function(){var n=this.getCurrentRoot(),t;n!=null&&(this.view.setCurrentRoot(null),t=this.view.getState(n),t!=null&&this.setSelectionCell(n))};mxGraph.prototype.isValidRoot=function(n){return n!=null};mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()};mxGraph.prototype.getCellBounds=function(n,t,i){var f=[n],r,o,u,e;if(t&&(f=f.concat(this.model.getEdges(n))),r=this.view.getBounds(f),i)for(o=this.model.getChildCount(n),u=0;u<o;u++)e=this.getCellBounds(this.model.getChildAt(n,u),t,!0),r!=null?r.add(e):r=e;return r};mxGraph.prototype.getBoundingBoxFromGeometry=function(n,t){var s,f,i,u,e,h,c,o,r;if(t=t!=null?t:!1,s=null,n!=null)for(f=0;f<n.length;f++)if((t||this.model.isVertex(n[f]))&&(i=this.getCellGeometry(n[f]),i!=null)){if(u=null,this.model.isEdge(n[f])){if(e=i.points,e!=null&&e.length>0){for(r=new mxRectangle(e[0].x,e[0].y,0,0),h=function(n){n!=null&&r.add(new mxRectangle(n.x,n.y,0,0))},c=1;c<e.length;c++)h(e[c]);h(i.getTerminalPoint(!0));h(i.getTerminalPoint(!1));u=r}}else o=this.model.getParent(n[f]),i.relative?this.model.isVertex(o)&&o!=this.view.currentRoot&&(r=this.getBoundingBoxFromGeometry([o],!1),r!=null&&(u=new mxRectangle(r.x+i.x*r.width,r.y+i.y*r.height,i.width,i.height))):(u=mxRectangle.fromRectangle(i),this.model.isVertex(o)&&mxUtils.indexOf(n,o)>=0&&(r=this.getBoundingBoxFromGeometry([o],!1),r!=null&&(u.x+=r.x,u.y+=r.y))),u!=null&&i.offset!=null&&(u.x+=i.offset.x,u.y+=i.offset.y);u!=null&&(s==null?s=mxRectangle.fromRectangle(u):s.add(u))}return s};mxGraph.prototype.refresh=function(n){this.view.clear(n,n==null);this.view.validate();this.sizeDidChange();this.fireEvent(new mxEventObject(mxEvent.REFRESH))};mxGraph.prototype.snap=function(n){return this.gridEnabled&&(n=Math.round(n/this.gridSize)*this.gridSize),n};mxGraph.prototype.panGraph=function(n,t){var r,f,i,u;if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-n,this.container.scrollTop=-t;else{if(r=this.view.getCanvas(),this.dialect==mxConstants.DIALECT_SVG)if(n==0&&t==0){if(mxClient.IS_IE?r.setAttribute("transform","translate("+n+","+t+")"):r.removeAttribute("transform"),this.shiftPreview1!=null){for(i=this.shiftPreview1.firstChild;i!=null;)u=i.nextSibling,this.container.appendChild(i),i=u;for(this.shiftPreview1.parentNode!=null&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,this.container.appendChild(r.parentNode),i=this.shiftPreview2.firstChild;i!=null;)u=i.nextSibling,this.container.appendChild(i),i=u;this.shiftPreview2.parentNode!=null&&this.shiftPreview2.parentNode.removeChild(this.shiftPreview2);this.shiftPreview2=null}}else{if(r.setAttribute("transform","translate("+n+","+t+")"),this.shiftPreview1==null){for(this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible",f=this.shiftPreview1,i=this.container.firstChild;i!=null;)u=i.nextSibling,i!=r.parentNode?f.appendChild(i):f=this.shiftPreview2,i=u;this.shiftPreview1.firstChild!=null&&this.container.insertBefore(this.shiftPreview1,r.parentNode);this.shiftPreview2.firstChild!=null&&this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=n+"px";this.shiftPreview1.style.top=t+"px";this.shiftPreview2.style.left=n+"px";this.shiftPreview2.style.top=t+"px"}else r.style.left=n+"px",r.style.top=t+"px";this.panDx=n;this.panDy=t;this.fireEvent(new mxEventObject(mxEvent.PAN))}};mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)};mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)};mxGraph.prototype.zoomActual=function(){this.view.scale==1?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))};mxGraph.prototype.zoomTo=function(n,t){this.zoom(n/this.view.scale,t)};mxGraph.prototype.center=function(n,t){var h,c;n=n!=null?n:!0;t=t!=null?t:!0;var l=mxUtils.hasScrollbars(this.container),f=this.container.clientWidth,e=this.container.clientHeight,i=this.getGraphBounds(),r=this.view.translate,u=this.view.scale,o=n?f-i.width:0,s=t?e-i.height:0;l?(i.x-=r.x,i.y-=r.y,h=this.container.scrollWidth,c=this.container.scrollHeight,h>f&&(o=0),c>e&&(s=0),this.view.setTranslate(Math.floor(o/2-i.x),Math.floor(s/2-i.y)),this.container.scrollLeft=(h-f)/2,this.container.scrollTop=(c-e)/2):this.view.setTranslate(n?Math.floor(r.x-i.x/u+o/(2*u)):r.x,t?Math.floor(r.y-i.y/u+s/(2*u)):r.y)};mxGraph.prototype.zoom=function(n,t){var i,f,s,o,e,r,u;if(t=t!=null?t:this.centerZoom,i=Math.round(this.view.scale*n*100)/100,f=this.view.getState(this.getSelectionCell()),n=i/this.view.scale,this.keepSelectionVisibleOnZoom&&f!=null)s=new mxRectangle(f.x*n,f.y*n,f.width*n,f.height*n),this.view.scale=i,this.scrollRectToVisible(s)||(this.view.revalidate(),this.view.setScale(i));else if(o=mxUtils.hasScrollbars(this.container),t&&!o)r=this.container.offsetWidth,u=this.container.offsetHeight,n>1?(e=(n-1)/(i*2),r*=-e,u*=-e):(e=(1/n-1)/(this.view.scale*2),r*=e,u*=e),this.view.scaleAndTranslate(i,this.view.translate.x+r,this.view.translate.y+u);else{var h=this.view.translate.x,c=this.view.translate.y,l=this.container.scrollLeft,a=this.container.scrollTop;this.view.setScale(i);o&&(r=0,u=0,t&&(r=this.container.offsetWidth*(n-1)/2,u=this.container.offsetHeight*(n-1)/2),this.container.scrollLeft=(this.view.translate.x-h)*this.view.scale+Math.round(l*n+r),this.container.scrollTop=(this.view.translate.y-c)*this.view.scale+Math.round(a*n+u))}};mxGraph.prototype.zoomToRect=function(n){var a=this.container.clientWidth/n.width,v=this.container.clientHeight/n.height,u=a/v,t,i,f,s,h,e,c,l,r,o;n.x=Math.max(0,n.x);n.y=Math.max(0,n.y);t=Math.min(this.container.scrollWidth,n.x+n.width);i=Math.min(this.container.scrollHeight,n.y+n.height);n.width=t-n.x;n.height=i-n.y;u<1?(f=n.height/u,s=(f-n.height)/2,n.height=f,h=Math.min(n.y,s),n.y=n.y-h,i=Math.min(this.container.scrollHeight,n.y+n.height),n.height=i-n.y):(e=n.width*u,c=(e-n.width)/2,n.width=e,l=Math.min(n.x,c),n.x=n.x-l,t=Math.min(this.container.scrollWidth,n.x+n.width),n.width=t-n.x);r=this.container.clientWidth/n.width;o=this.view.scale*r;mxUtils.hasScrollbars(this.container)?(this.view.setScale(o),this.container.scrollLeft=Math.round(n.x*r),this.container.scrollTop=Math.round(n.y*r)):this.view.scaleAndTranslate(o,this.view.translate.x-n.x/this.view.scale,this.view.translate.y-n.y/this.view.scale)};mxGraph.prototype.fit=function(n,t){var s,r,c,l,f;if(this.container!=null){n=n!=null?n:0;t=t!=null?t:!1;var h=document.documentMode>=9?4:0,a=this.container.clientWidth-h,v=this.container.clientHeight-h,i=this.view.getGraphBounds();t&&i.x!=null&&i.y!=null&&(i.width+=i.x,i.height+=i.y,i.x=0,i.y=0);var u=this.view.scale,e=i.width/u,o=i.height/u;this.backgroundImage!=null&&(e=Math.max(e,this.backgroundImage.width-i.x/u),o=Math.max(o,this.backgroundImage.height-i.y/u));s=t?n:2*n;r=Math.floor(Math.min(a/(e+s),v/(o+s))*100)/100;this.minFitScale!=null&&(r=Math.max(r,this.minFitScale));this.maxFitScale!=null&&(r=Math.min(r,this.maxFitScale));t?this.view.scale!=r&&this.view.setScale(r):mxUtils.hasScrollbars(this.container)?(this.view.setScale(r),f=this.getGraphBounds(),f.x!=null&&(this.container.scrollLeft=f.x),f.y!=null&&(this.container.scrollTop=f.y)):(c=i.x!=null?Math.floor(this.view.translate.x-i.x/u+n+1):n,l=i.y!=null?Math.floor(this.view.translate.y-i.y/u+n+1):n,this.view.scaleAndTranslate(r,c,l))}return this.view.scale};mxGraph.prototype.scrollCellToVisible=function(n,t){var e=-this.view.translate.x,o=-this.view.translate.y,r=this.view.getState(n),i,u,f;r!=null&&(i=new mxRectangle(e+r.x,o+r.y,r.width,r.height),t&&this.container!=null&&(u=this.container.clientWidth,f=this.container.clientHeight,i.x=i.getCenterX()-u/2,i.width=u,i.y=i.getCenterY()-f/2,i.height=f),this.scrollRectToVisible(i)&&this.view.setTranslate(this.view.translate.x,this.view.translate.y))};mxGraph.prototype.scrollRectToVisible=function(n){var u=!1,t,i,a,r,v;if(n!=null){var s=this.container.offsetWidth,h=this.container.offsetHeight,c=Math.min(s,n.width),l=Math.min(h,n.height);if(mxUtils.hasScrollbars(this.container))t=this.container,n.x+=this.view.translate.x,n.y+=this.view.translate.y,i=t.scrollLeft-n.x,a=Math.max(i-t.scrollLeft,0),i>0?t.scrollLeft-=i+2:(i=n.x+c-t.scrollLeft-t.clientWidth,i>0&&(t.scrollLeft+=i+2)),r=t.scrollTop-n.y,v=Math.max(0,r-t.scrollTop),r>0?t.scrollTop-=r+2:(r=n.y+l-t.scrollTop-t.clientHeight,r>0&&(t.scrollTop+=r+2)),this.useScrollbarsForPanning||a==0&&v==0||this.view.setTranslate(a,v);else{var f=-this.view.translate.x,e=-this.view.translate.y,o=this.view.scale;n.x+c>f+s&&(this.view.translate.x-=(n.x+c-s-f)/o,u=!0);n.y+l>e+h&&(this.view.translate.y-=(n.y+l-h-e)/o,u=!0);n.x<f&&(this.view.translate.x+=(f-n.x)/o,u=!0);n.y<e&&(this.view.translate.y+=(e-n.y)/o,u=!0);u&&(this.view.refresh(),this.selectionCellsHandler!=null&&this.selectionCellsHandler.refresh())}}return u};mxGraph.prototype.getCellGeometry=function(n){return this.model.getGeometry(n)};mxGraph.prototype.isCellVisible=function(n){return this.model.isVisible(n)};mxGraph.prototype.isCellCollapsed=function(n){return this.model.isCollapsed(n)};mxGraph.prototype.isCellConnectable=function(n){return this.model.isConnectable(n)};mxGraph.prototype.isOrthogonal=function(n){var i=n.style[mxConstants.STYLE_ORTHOGONAL],t;return i!=null?i:(t=this.view.getEdgeStyle(n),t==mxEdgeStyle.SegmentConnector||t==mxEdgeStyle.ElbowConnector||t==mxEdgeStyle.SideToSide||t==mxEdgeStyle.TopToBottom||t==mxEdgeStyle.EntityRelation||t==mxEdgeStyle.OrthConnector)};mxGraph.prototype.isLoop=function(n){var t=n.getVisibleTerminalState(!0),i=n.getVisibleTerminalState(!1);return t!=null&&t==i};mxGraph.prototype.isCloneEvent=function(n){return mxEvent.isControlDown(n)};mxGraph.prototype.isToggleEvent=function(n){return mxClient.IS_MAC?mxEvent.isMetaDown(n):mxEvent.isControlDown(n)};mxGraph.prototype.isGridEnabledEvent=function(n){return n!=null&&!mxEvent.isAltDown(n)};mxGraph.prototype.isConstrainedEvent=function(n){return mxEvent.isShiftDown(n)};mxGraph.prototype.validationAlert=function(n){mxUtils.alert(n)};mxGraph.prototype.isEdgeValid=function(n,t,i){return this.getEdgeValidationError(n,t,i)==null};mxGraph.prototype.getEdgeValidationError=function(n,t,i){var r,f,o,s,e,u;if(n!=null&&!this.isAllowDanglingEdges()&&(t==null||i==null))return"";if(n!=null&&this.model.getTerminal(n,!0)==null&&this.model.getTerminal(n,!1)==null)return null;if(!this.allowLoops&&t==i&&t!=null||!this.isValidConnection(t,i))return"";if(t!=null&&i!=null){if(r="",this.multigraph||(f=this.model.getEdgesBetween(t,i,!0),(f.length>1||f.length==1&&f[0]!=n)&&(r+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+"\n")),o=this.model.getDirectedEdgeCount(t,!0,n),s=this.model.getDirectedEdgeCount(i,!1,n),this.multiplicities!=null)for(e=0;e<this.multiplicities.length;e++)u=this.multiplicities[e].check(this,n,t,i,o,s),u!=null&&(r+=u);return u=this.validateEdge(n,t,i),u!=null&&(r+=u),r.length>0?r:null}return this.allowDanglingEdges?null:""};mxGraph.prototype.validateEdge=function(){return null};mxGraph.prototype.validateGraph=function(n,t){var r,h,f,u,o,e,i,s;for(n=n!=null?n:this.model.getRoot(),t=t!=null?t:{},r=!0,h=this.model.getChildCount(n),f=0;f<h;f++)u=this.model.getChildAt(n,f),o=t,this.isValidRoot(u)&&(o={}),e=this.validateGraph(u,o),e!=null?this.setCellWarning(u,e.replace(/\n/g,"<br>")):this.setCellWarning(u,null),r=r&&e==null;return i="",this.isCellCollapsed(n)&&!r&&(i+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n"),i+=this.model.isEdge(n)?this.getEdgeValidationError(n,this.model.getTerminal(n,!0),this.model.getTerminal(n,!1))||"":this.getCellValidationError(n)||"",s=this.validateCell(n,t),s!=null&&(i+=s),this.model.getParent(n)==null&&this.view.validate(),i.length>0||!r?i:null};mxGraph.prototype.getCellValidationError=function(n){var u=this.model.getDirectedEdgeCount(n,!0),f=this.model.getDirectedEdgeCount(n,!1),e=this.model.getValue(n),i="",r,t;if(this.multiplicities!=null)for(r=0;r<this.multiplicities.length;r++)t=this.multiplicities[r],t.source&&mxUtils.isNode(e,t.type,t.attr,t.value)&&(t.max==0&&u>0||t.min==1&&u==0||t.max==1&&u>1)?i+=t.countError+"\n":!t.source&&mxUtils.isNode(e,t.type,t.attr,t.value)&&(t.max==0&&f>0||t.min==1&&f==0||t.max==1&&f>1)&&(i+=t.countError+"\n");return i.length>0?i:null};mxGraph.prototype.validateCell=function(){return null};mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage};mxGraph.prototype.setBackgroundImage=function(n){this.backgroundImage=n};mxGraph.prototype.getFoldingImage=function(n){if(n!=null&&this.foldingEnabled&&!this.getModel().isEdge(n.cell)){var t=this.isCellCollapsed(n.cell);if(this.isCellFoldable(n.cell,!t))return t?this.collapsedImage:this.expandedImage}return null};mxGraph.prototype.convertValueToString=function(n){var t=this.model.getValue(n);if(t!=null){if(mxUtils.isNode(t))return t.nodeName;if(typeof t.toString=="function")return t.toString()}return""};mxGraph.prototype.getLabel=function(n){var i="",t,r;return this.labelsVisible&&n!=null&&(t=this.view.getState(n),r=t!=null?t.style:this.getCellStyle(n),mxUtils.getValue(r,mxConstants.STYLE_NOLABEL,!1)||(i=this.convertValueToString(n))),i};mxGraph.prototype.isHtmlLabel=function(){return this.isHtmlLabels()};mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels};mxGraph.prototype.setHtmlLabels=function(n){this.htmlLabels=n};mxGraph.prototype.isWrapping=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return i!=null?i[mxConstants.STYLE_WHITE_SPACE]=="wrap":!1};mxGraph.prototype.isLabelClipped=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return i!=null?i[mxConstants.STYLE_OVERFLOW]=="hidden":!1};mxGraph.prototype.getTooltip=function(n,t){var i=null,r;return n!=null&&(n.control!=null&&(t==n.control.node||t.parentNode==n.control.node)&&(i=this.collapseExpandResource,i=mxResources.get(i)||i),i==null&&n.overlays!=null&&n.overlays.visit(function(n,r){i==null&&(t==r.node||t.parentNode==r.node)&&(i=r.overlay.toString())}),i==null&&(r=this.selectionCellsHandler.getHandler(n.cell),r!=null&&typeof r.getTooltipForNode=="function"&&(i=r.getTooltipForNode(t))),i==null&&(i=this.getTooltipForCell(n.cell))),i};mxGraph.prototype.getTooltipForCell=function(n){return n!=null&&n.getTooltip!=null?n.getTooltip():this.convertValueToString(n)};mxGraph.prototype.getCursorForMouseEvent=function(n){return this.getCursorForCell(n.getCell())};mxGraph.prototype.getCursorForCell=function(){return null};mxGraph.prototype.getStartSize=function(n){var t=new mxRectangle,u=this.view.getState(n),i=u!=null?u.style:this.getCellStyle(n),r;return i!=null&&(r=parseInt(mxUtils.getValue(i,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),mxUtils.getValue(i,mxConstants.STYLE_HORIZONTAL,!0)?t.height=r:t.width=r),t};mxGraph.prototype.getImage=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_IMAGE]:null};mxGraph.prototype.getVerticalAlign=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null};mxGraph.prototype.getIndicatorColor=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_INDICATOR_COLOR]:null};mxGraph.prototype.getIndicatorGradientColor=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null};mxGraph.prototype.getIndicatorShape=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_INDICATOR_SHAPE]:null};mxGraph.prototype.getIndicatorImage=function(n){return n!=null&&n.style!=null?n.style[mxConstants.STYLE_INDICATOR_IMAGE]:null};mxGraph.prototype.getBorder=function(){return this.border};mxGraph.prototype.setBorder=function(n){this.border=n};mxGraph.prototype.isSwimlane=function(n){if(n!=null&&this.model.getParent(n)!=this.model.getRoot()){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);if(i!=null&&!this.model.isEdge(n))return i[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}return!1};mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer};mxGraph.prototype.setResizeContainer=function(n){this.resizeContainer=n};mxGraph.prototype.isEnabled=function(){return this.enabled};mxGraph.prototype.setEnabled=function(n){this.enabled=n};mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled};mxGraph.prototype.setEscapeEnabled=function(n){this.escapeEnabled=n};mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing};mxGraph.prototype.setInvokesStopCellEditing=function(n){this.invokesStopCellEditing=n};mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing};mxGraph.prototype.setEnterStopsCellEditing=function(n){this.enterStopsCellEditing=n};mxGraph.prototype.isCellLocked=function(n){var t=this.model.getGeometry(n);return this.isCellsLocked()||t!=null&&this.model.isVertex(n)&&t.relative};mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked};mxGraph.prototype.setCellsLocked=function(n){this.cellsLocked=n};mxGraph.prototype.getCloneableCells=function(n){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.isCellCloneable(n)}))};mxGraph.prototype.isCellCloneable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsCloneable()&&i[mxConstants.STYLE_CLONEABLE]!=0};mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable};mxGraph.prototype.setCellsCloneable=function(n){this.cellsCloneable=n};mxGraph.prototype.getExportableCells=function(n){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.canExportCell(n)}))};mxGraph.prototype.canExportCell=function(){return this.exportEnabled};mxGraph.prototype.getImportableCells=function(n){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.canImportCell(n)}))};mxGraph.prototype.canImportCell=function(){return this.importEnabled};mxGraph.prototype.isCellSelectable=function(){return this.isCellsSelectable()};mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable};mxGraph.prototype.setCellsSelectable=function(n){this.cellsSelectable=n};mxGraph.prototype.getDeletableCells=function(n){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.isCellDeletable(n)}))};mxGraph.prototype.isCellDeletable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsDeletable()&&i[mxConstants.STYLE_DELETABLE]!=0};mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable};mxGraph.prototype.setCellsDeletable=function(n){this.cellsDeletable=n};mxGraph.prototype.isLabelMovable=function(n){return!this.isCellLocked(n)&&(this.model.isEdge(n)&&this.edgeLabelsMovable||this.model.isVertex(n)&&this.vertexLabelsMovable)};mxGraph.prototype.isCellRotatable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return i[mxConstants.STYLE_ROTATABLE]!=0};mxGraph.prototype.getMovableCells=function(n){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.isCellMovable(n)}))};mxGraph.prototype.isCellMovable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsMovable()&&!this.isCellLocked(n)&&i[mxConstants.STYLE_MOVABLE]!=0};mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable};mxGraph.prototype.setCellsMovable=function(n){this.cellsMovable=n};mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled};mxGraph.prototype.setGridEnabled=function(n){this.gridEnabled=n};mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled};mxGraph.prototype.setPortsEnabled=function(n){this.portsEnabled=n};mxGraph.prototype.getGridSize=function(){return this.gridSize};mxGraph.prototype.setGridSize=function(n){this.gridSize=n};mxGraph.prototype.getTolerance=function(){return this.tolerance};mxGraph.prototype.setTolerance=function(n){this.tolerance=n};mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable};mxGraph.prototype.setVertexLabelsMovable=function(n){this.vertexLabelsMovable=n};mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable};mxGraph.prototype.setEdgeLabelsMovable=function(n){this.edgeLabelsMovable=n};mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting};mxGraph.prototype.setSwimlaneNesting=function(n){this.swimlaneNesting=n};mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled};mxGraph.prototype.setSwimlaneSelectionEnabled=function(n){this.swimlaneSelectionEnabled=n};mxGraph.prototype.isMultigraph=function(){return this.multigraph};mxGraph.prototype.setMultigraph=function(n){this.multigraph=n};mxGraph.prototype.isAllowLoops=function(){return this.allowLoops};mxGraph.prototype.setAllowDanglingEdges=function(n){this.allowDanglingEdges=n};mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges};mxGraph.prototype.setConnectableEdges=function(n){this.connectableEdges=n};mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges};mxGraph.prototype.setCloneInvalidEdges=function(n){this.cloneInvalidEdges=n};mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges};mxGraph.prototype.setAllowLoops=function(n){this.allowLoops=n};mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove};mxGraph.prototype.setDisconnectOnMove=function(n){this.disconnectOnMove=n};mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled};mxGraph.prototype.setDropEnabled=function(n){this.dropEnabled=n};mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled};mxGraph.prototype.setSplitEnabled=function(n){this.splitEnabled=n};mxGraph.prototype.isCellResizable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsResizable()&&!this.isCellLocked(n)&&mxUtils.getValue(i,mxConstants.STYLE_RESIZABLE,"1")!="0"};mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable};mxGraph.prototype.setCellsResizable=function(n){this.cellsResizable=n};mxGraph.prototype.isTerminalPointMovable=function(){return!0};mxGraph.prototype.isCellBendable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsBendable()&&!this.isCellLocked(n)&&i[mxConstants.STYLE_BENDABLE]!=0};mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable};mxGraph.prototype.setCellsBendable=function(n){this.cellsBendable=n};mxGraph.prototype.isCellEditable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isCellsEditable()&&!this.isCellLocked(n)&&i[mxConstants.STYLE_EDITABLE]!=0};mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable};mxGraph.prototype.setCellsEditable=function(n){this.cellsEditable=n};mxGraph.prototype.isCellDisconnectable=function(n){return this.isCellsDisconnectable()&&!this.isCellLocked(n)};mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable};mxGraph.prototype.setCellsDisconnectable=function(n){this.cellsDisconnectable=n};mxGraph.prototype.isValidSource=function(n){return n==null&&this.allowDanglingEdges||n!=null&&(!this.model.isEdge(n)||this.connectableEdges)&&this.isCellConnectable(n)};mxGraph.prototype.isValidTarget=function(n){return this.isValidSource(n)};mxGraph.prototype.isValidConnection=function(n,t){return this.isValidSource(n)&&this.isValidTarget(t)};mxGraph.prototype.setConnectable=function(n){this.connectionHandler.setEnabled(n)};mxGraph.prototype.isConnectable=function(){return this.connectionHandler.isEnabled()};mxGraph.prototype.setTooltips=function(n){this.tooltipHandler.setEnabled(n)};mxGraph.prototype.setPanning=function(n){this.panningHandler.panningEnabled=n};mxGraph.prototype.isEditing=function(n){if(this.cellEditor!=null){var t=this.cellEditor.getEditingCell();return n==null?t!=null:n==t}return!1};mxGraph.prototype.isAutoSizeCell=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.isAutoSizeCells()||i[mxConstants.STYLE_AUTOSIZE]==1};mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells};mxGraph.prototype.setAutoSizeCells=function(n){this.autoSizeCells=n};mxGraph.prototype.isExtendParent=function(n){return!this.getModel().isEdge(n)&&this.isExtendParents()};mxGraph.prototype.isExtendParents=function(){return this.extendParents};mxGraph.prototype.setExtendParents=function(n){this.extendParents=n};mxGraph.prototype.isExtendParentsOnAdd=function(){return this.extendParentsOnAdd};mxGraph.prototype.setExtendParentsOnAdd=function(n){this.extendParentsOnAdd=n};mxGraph.prototype.isExtendParentsOnMove=function(){return this.extendParentsOnMove};mxGraph.prototype.setExtendParentsOnMove=function(n){this.extendParentsOnMove=n};mxGraph.prototype.isRecursiveResize=function(){return this.recursiveResize};mxGraph.prototype.setRecursiveResize=function(n){this.recursiveResize=n};mxGraph.prototype.isConstrainChild=function(n){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(n))};mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren};mxGraph.prototype.setConstrainChildren=function(n){this.constrainChildren=n};mxGraph.prototype.setConstrainChildrenOnResize=function(n){this.constrainChildrenOnResize=n};mxGraph.prototype.isConstrainChildrenOnResize=function(){return this.constrainChildrenOnResize};mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates};mxGraph.prototype.setAllowNegativeCoordinates=function(n){this.allowNegativeCoordinates=n};mxGraph.prototype.getOverlap=function(n){return this.isAllowOverlapParent(n)?this.defaultOverlap:0};mxGraph.prototype.isAllowOverlapParent=function(){return!1};mxGraph.prototype.getFoldableCells=function(n,t){return this.model.filterCells(n,mxUtils.bind(this,function(n){return this.isCellFoldable(n,t)}))};mxGraph.prototype.isCellFoldable=function(n){var t=this.view.getState(n),i=t!=null?t.style:this.getCellStyle(n);return this.model.getChildCount(n)>0&&i[mxConstants.STYLE_FOLDABLE]!=0};mxGraph.prototype.isValidDropTarget=function(n,t,i){return n!=null&&(this.isSplitEnabled()&&this.isSplitTarget(n,t,i)||!this.model.isEdge(n)&&(this.isSwimlane(n)||this.model.getChildCount(n)>0&&!this.isCellCollapsed(n)))};mxGraph.prototype.isSplitTarget=function(n,t){if(this.model.isEdge(n)&&t!=null&&t.length==1&&this.isCellConnectable(t[0])&&this.getEdgeValidationError(n,this.model.getTerminal(n,!0),t[0])==null){var i=this.model.getTerminal(n,!0),r=this.model.getTerminal(n,!1);return!this.model.isAncestor(t[0],i)&&!this.model.isAncestor(t[0],r)}return!1};mxGraph.prototype.getDropTarget=function(n,t,i,r){var s,e,o,u,f;if(!this.isSwimlaneNesting())for(s=0;s<n.length;s++)if(this.isSwimlane(n[s]))return null;if(e=mxUtils.convertPoint(this.container,mxEvent.getClientX(t),mxEvent.getClientY(t)),e.x-=this.panDx,e.y-=this.panDy,o=this.getSwimlaneAt(e.x,e.y),i==null)i=o;else if(o!=null){for(u=this.model.getParent(o);u!=null&&this.isSwimlane(u)&&u!=i;)u=this.model.getParent(u);u==i&&(i=o)}while(i!=null&&!this.isValidDropTarget(i,n,t)&&!this.model.isLayer(i))i=this.model.getParent(i);if(r==null||!r)for(f=i;f!=null&&mxUtils.indexOf(n,f)<0;)f=this.model.getParent(f);return!this.model.isLayer(i)&&f==null?i:null};mxGraph.prototype.getDefaultParent=function(){var n=this.getCurrentRoot(),t;return n==null&&(n=this.defaultParent,n==null&&(t=this.model.getRoot(),n=this.model.getChildAt(t,0))),n};mxGraph.prototype.setDefaultParent=function(n){this.defaultParent=n};mxGraph.prototype.getSwimlane=function(n){while(n!=null&&!this.isSwimlane(n))n=this.model.getParent(n);return n};mxGraph.prototype.getSwimlaneAt=function(n,t,i){var e,u,r,f,o;if(i=i||this.getDefaultParent(),i!=null)for(e=this.model.getChildCount(i),u=0;u<e;u++){if(r=this.model.getChildAt(i,u),f=this.getSwimlaneAt(n,t,r),f!=null)return f;if(this.isSwimlane(r)&&(o=this.view.getState(r),this.intersects(o,n,t)))return r}return null};mxGraph.prototype.getCellAt=function(n,t,i,r,u,f){var c,o,e,h,s;if(r=r!=null?r:!0,u=u!=null?u:!0,i==null&&(i=this.getCurrentRoot(),i==null&&(i=this.getModel().getRoot())),i!=null)for(c=this.model.getChildCount(i),o=c-1;o>=0;o--){if(e=this.model.getChildAt(i,o),h=this.getCellAt(n,t,e,r,u,f),h!=null)return h;if(this.isCellVisible(e)&&(u&&this.model.isEdge(e)||r&&this.model.isVertex(e))&&(s=this.view.getState(e),s!=null&&(f==null||!f(s,n,t))&&this.intersects(s,n,t)))return e}return null};mxGraph.prototype.intersects=function(n,t,i){var u,s,r,f,e,h,o;if(n!=null)if(u=n.absolutePoints,u!=null)for(s=this.tolerance*this.tolerance,r=u[0],f=1;f<u.length;f++){if(e=u[f],h=mxUtils.ptSegDistSq(r.x,r.y,e.x,e.y,t,i),h<=s)return!0;r=e}else{if(o=mxUtils.toRadians(mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION)||0),o!=0){var c=Math.cos(-o),l=Math.sin(-o),a=new mxPoint(n.getCenterX(),n.getCenterY()),r=mxUtils.getRotatedPoint(new mxPoint(t,i),c,l,a);t=r.x;i=r.y}if(mxUtils.contains(n,t,i))return!0}return!1};mxGraph.prototype.hitsSwimlaneContent=function(n,t,i){var u=this.getView().getState(n),r=this.getStartSize(n),f;return u!=null&&((f=this.getView().getScale(),t-=u.x,i-=u.y,r.width>0&&t>0&&t>r.width*f)||r.height>0&&i>0&&i>r.height*f)?!0:!1};mxGraph.prototype.getChildVertices=function(n){return this.getChildCells(n,!0,!1)};mxGraph.prototype.getChildEdges=function(n){return this.getChildCells(n,!1,!0)};mxGraph.prototype.getChildCells=function(n,t,i){var u,f,r;for(n=n!=null?n:this.getDefaultParent(),t=t!=null?t:!1,i=i!=null?i:!1,u=this.model.getChildCells(n,t,i),f=[],r=0;r<u.length;r++)this.isCellVisible(u[r])&&f.push(u[r]);return f};mxGraph.prototype.getConnections=function(n,t){return this.getEdges(n,t,!0,!0,!1)};mxGraph.prototype.getIncomingEdges=function(n,t){return this.getEdges(n,t,!0,!1,!1)};mxGraph.prototype.getOutgoingEdges=function(n,t){return this.getEdges(n,t,!1,!0,!1)};mxGraph.prototype.getEdges=function(n,t,i,r,u,f){var l,a,e;i=i!=null?i:!0;r=r!=null?r:!0;u=u!=null?u:!0;f=f!=null?f:!1;var o=[],v=this.isCellCollapsed(n),y=this.model.getChildCount(n);for(e=0;e<y;e++)l=this.model.getChildAt(n,e),(v||!this.isCellVisible(l))&&(o=o.concat(this.model.getEdges(l,i,r)));for(o=o.concat(this.model.getEdges(n,i,r)),a=[],e=0;e<o.length;e++){var s=this.view.getState(o[e]),h=s!=null?s.getVisibleTerminal(!0):this.view.getVisibleTerminal(o[e],!0),c=s!=null?s.getVisibleTerminal(!1):this.view.getVisibleTerminal(o[e],!1);(u&&h==c||h!=c&&(i&&c==n&&(t==null||this.isValidAncestor(h,t,f))||r&&h==n&&(t==null||this.isValidAncestor(c,t,f))))&&a.push(o[e])}return a};mxGraph.prototype.isValidAncestor=function(n,t,i){return i?this.model.isAncestor(t,n):this.model.getParent(n)==t};mxGraph.prototype.getOpposites=function(n,t,i,r){var h,s,u,o;if(i=i!=null?i:!0,r=r!=null?r:!0,h=[],s={},n!=null)for(u=0;u<n.length;u++){var c=this.view.getState(n[u]),f=c!=null?c.getVisibleTerminal(!0):this.view.getVisibleTerminal(n[u],!0),e=c!=null?c.getVisibleTerminal(!1):this.view.getVisibleTerminal(n[u],!1);f==t&&e!=null&&e!=t&&r?(o=mxCellPath.create(e),s[o]==null&&(s[o]=e,h.push(e))):e==t&&f!=null&&f!=t&&i&&(o=mxCellPath.create(f),s[o]==null&&(s[o]=f,h.push(f)))}return h};mxGraph.prototype.getEdgesBetween=function(n,t,i){var u,e,r;for(i=i!=null?i:!1,u=this.getEdges(n),e=[],r=0;r<u.length;r++){var f=this.view.getState(u[r]),o=f!=null?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(u[r],!0),s=f!=null?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(u[r],!1);(o!=n||s!=t)&&(i||o!=t||s!=n)||e.push(u[r])}return e};mxGraph.prototype.getPointForEvent=function(n,t){var i=mxUtils.convertPoint(this.container,mxEvent.getClientX(n),mxEvent.getClientY(n)),r=this.view.scale,u=this.view.translate,f=t!=!1?this.gridSize/2:0;return i.x=this.snap(i.x/r-u.x-f),i.y=this.snap(i.y/r-u.y-f),i};mxGraph.prototype.getCells=function(n,t,i,r,u,f){var a,h,o,c,l,e;if(f=f!=null?f:[],i>0||r>0){var s=this.getModel(),v=n+i,y=t+r;if(u==null&&(u=this.getCurrentRoot(),u==null&&(u=s.getRoot())),u!=null)for(a=s.getChildCount(u),h=0;h<a;h++)o=s.getChildAt(u,h),c=this.view.getState(o),c!=null&&this.isCellVisible(o)&&(l=mxUtils.getValue(c.style,mxConstants.STYLE_ROTATION)||0,e=c,l!=0&&(e=mxUtils.getBoundingBox(e,l)),(s.isEdge(o)||s.isVertex(o))&&e.x>=n&&e.y+e.height<=y&&e.y>=t&&e.x+e.width<=v?f.push(o):this.getCells(n,t,i,r,o,f))}return f};mxGraph.prototype.getCellsBeyond=function(n,t,i,r,u){var s=[],h,f,e,o;if((r||u)&&(i==null&&(i=this.getDefaultParent()),i!=null))for(h=this.model.getChildCount(i),f=0;f<h;f++)e=this.model.getChildAt(i,f),o=this.view.getState(e),this.isCellVisible(e)&&o!=null&&(!r||o.x>=n)&&(!u||o.y>=t)&&s.push(e);return s};mxGraph.prototype.findTreeRoots=function(n,t,i){var u,o,r,s,y,c;if(t=t!=null?t:!1,i=i!=null?i:!1,u=[],n!=null){var l=this.getModel(),p=l.getChildCount(n),h=null,a=0;for(o=0;o<p;o++)if(r=l.getChildAt(n,o),this.model.isVertex(r)&&this.isCellVisible(r)){var v=this.getConnections(r,t?n:null),f=0,e=0;for(s=0;s<v.length;s++)y=this.view.getVisibleTerminal(v[s],!0),y==r?f++:e++;(i&&f==0&&e>0||!i&&e==0&&f>0)&&u.push(r);c=i?e-f:f-e;c>a&&(a=c,h=r)}u.length==0&&h!=null&&u.push(h)}return u};mxGraph.prototype.traverse=function(n,t,i,r,u){var o,s,h,f,e,c,l;if(i!=null&&n!=null&&(t=t!=null?t:!0,u=u||[],o=mxCellPath.create(n),u[o]==null&&(u[o]=n,s=i(n,r),(s==null||s)&&(h=this.model.getEdgeCount(n),h>0))))for(f=0;f<h;f++)e=this.model.getEdgeAt(n,f),c=this.model.getTerminal(e,!0)==n,(!t||c)&&(l=this.model.getTerminal(e,!c),this.traverse(l,t,i,e,u))};mxGraph.prototype.isCellSelected=function(n){return this.getSelectionModel().isSelected(n)};mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()};mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()};mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length};mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]};mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()};mxGraph.prototype.setSelectionCell=function(n){this.getSelectionModel().setCell(n)};mxGraph.prototype.setSelectionCells=function(n){this.getSelectionModel().setCells(n)};mxGraph.prototype.addSelectionCell=function(n){this.getSelectionModel().addCell(n)};mxGraph.prototype.addSelectionCells=function(n){this.getSelectionModel().addCells(n)};mxGraph.prototype.removeSelectionCell=function(n){this.getSelectionModel().removeCell(n)};mxGraph.prototype.removeSelectionCells=function(n){this.getSelectionModel().removeCells(n)};mxGraph.prototype.selectRegion=function(n,t){var i=this.getCells(n.x,n.y,n.width,n.height);return this.selectCellsForEvent(i,t),i};mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)};mxGraph.prototype.selectPreviousCell=function(){this.selectCell()};mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)};mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)};mxGraph.prototype.selectCell=function(n,t,i){var s=this.selectionModel,u=s.cells.length>0?s.cells[0]:null,r,o,h,e,c,f;s.cells.length>1&&s.clear();r=u!=null?this.model.getParent(u):this.getDefaultParent();o=this.model.getChildCount(r);u==null&&o>0?(f=this.model.getChildAt(r,0),this.setSelectionCell(f)):(u==null||t)&&this.view.getState(r)!=null&&this.model.getGeometry(r)!=null?this.getCurrentRoot()!=r&&this.setSelectionCell(r):u!=null&&i?(h=this.model.getChildCount(u),h>0&&(f=this.model.getChildAt(u,0),this.setSelectionCell(f))):o>0&&(e=r.getIndex(u),n?(e++,f=this.model.getChildAt(r,e%o),this.setSelectionCell(f)):(e--,c=e<0?o-1:e,f=this.model.getChildAt(r,c),this.setSelectionCell(f)))};mxGraph.prototype.selectAll=function(n){n=n||this.getDefaultParent();var t=this.model.getChildren(n);t!=null&&this.setSelectionCells(t)};mxGraph.prototype.selectVertices=function(n){this.selectCells(!0,!1,n)};mxGraph.prototype.selectEdges=function(n){this.selectCells(!1,!0,n)};mxGraph.prototype.selectCells=function(n,t,i){i=i||this.getDefaultParent();var r=mxUtils.bind(this,function(i){return this.view.getState(i)!=null&&(this.model.getChildCount(i)==0&&this.model.isVertex(i)&&n||this.model.isEdge(i)&&t)}),u=this.model.filterDescendants(r,i);this.setSelectionCells(u)};mxGraph.prototype.selectCellForEvent=function(n,t){var i=this.isCellSelected(n);this.isToggleEvent(t)?i?this.removeSelectionCell(n):this.addSelectionCell(n):i&&this.getSelectionCount()==1||this.setSelectionCell(n)};mxGraph.prototype.selectCellsForEvent=function(n,t){this.isToggleEvent(t)?this.addSelectionCells(n):this.setSelectionCells(n)};mxGraph.prototype.createHandler=function(n){var i=null,t;return n!=null&&(this.model.isEdge(n.cell)?(t=this.view.getEdgeStyle(n),i=this.isLoop(n)||t==mxEdgeStyle.ElbowConnector||t==mxEdgeStyle.SideToSide||t==mxEdgeStyle.TopToBottom?this.createElbowEdgeHandler(n):t==mxEdgeStyle.SegmentConnector||t==mxEdgeStyle.OrthConnector?this.createEdgeSegmentHandler(n):this.createEdgeHandler(n)):i=this.createVertexHandler(n)),i};mxGraph.prototype.createVertexHandler=function(n){return new mxVertexHandler(n)};mxGraph.prototype.createEdgeHandler=function(n){return new mxEdgeHandler(n)};mxGraph.prototype.createEdgeSegmentHandler=function(n){return new mxEdgeSegmentHandler(n)};mxGraph.prototype.createElbowEdgeHandler=function(n){return new mxElbowEdgeHandler(n)};mxGraph.prototype.addMouseListener=function(n){this.mouseListeners==null&&(this.mouseListeners=[]);this.mouseListeners.push(n)};mxGraph.prototype.removeMouseListener=function(n){if(this.mouseListeners!=null)for(var t=0;t<this.mouseListeners.length;t++)if(this.mouseListeners[t]==n){this.mouseListeners.splice(t,1);break}};mxGraph.prototype.updateMouseEvent=function(n,t){if(n.graphX==null||n.graphY==null){var i=mxUtils.convertPoint(this.container,n.getX(),n.getY());n.graphX=i.x-this.panDx;n.graphY=i.y-this.panDy;n.getCell()==null&&this.isMouseDown&&t==mxEvent.MOUSE_MOVE&&(n.state=this.view.getState(this.getCellAt(i.x,i.y,null,null,null,function(n){return n.shape==null||n.shape.paintBackground!=mxRectangleShape.prototype.paintBackground||mxUtils.getValue(n.style,mxConstants.STYLE_POINTER_EVENTS,"1")=="1"||n.shape.fill!=null&&n.shape.fill!=mxConstants.NONE})))}return n};mxGraph.prototype.getStateForTouchEvent=function(n){var i=mxEvent.getClientX(n),r=mxEvent.getClientY(n),t=mxUtils.convertPoint(this.container,i,r);return this.view.getState(this.getCellAt(t.x,t.y))};mxGraph.prototype.isEventIgnored=function(n,t,i){var u=mxEvent.isMouseEvent(t.getEvent()),r=this.isEditing();return(t.getEvent()==this.lastEvent?r=!0:this.lastEvent=t.getEvent(),this.eventSource!=null&&n!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.eventSource=null):this.eventSource!=null&&t.getSource()!=this.eventSource?r=!0:mxClient.IS_TOUCH&&n==mxEvent.MOUSE_DOWN&&!u&&(this.eventSource=t.getSource(),this.mouseMoveRedirect=mxUtils.bind(this,function(n){this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n,this.getStateForTouchEvent(n)))}),this.mouseUpRedirect=mxUtils.bind(this,function(n){this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n,this.getStateForTouchEvent(n)))}),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(n,t,i)&&(r=!0),!mxEvent.isPopupTrigger(this.lastEvent)&&n!=mxEvent.MOUSE_MOVE&&this.lastEvent.detail==2)?!0:(n==mxEvent.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:n!=mxEvent.MOUSE_DOWN||this.isMouseDown?r||(mxClient.IS_FF&&n==mxEvent.MOUSE_MOVE||!this.isMouseDown||this.isMouseTrigger==u)&&(n!=mxEvent.MOUSE_DOWN||!this.isMouseDown)&&(n!=mxEvent.MOUSE_UP||this.isMouseDown)||(r=!0):(this.isMouseDown=!0,this.isMouseTrigger=u),r||n!=mxEvent.MOUSE_DOWN||(this.lastMouseX=t.getX(),this.lastMouseY=t.getY()),r)};mxGraph.prototype.isSyntheticEventIgnored=function(n,t){var i=!1,r=mxEvent.isMouseEvent(t.getEvent());return this.ignoreMouseEvents&&r&&n!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=n!=mxEvent.MOUSE_UP,i=!0):mxClient.IS_FF&&!r&&n==mxEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0),i};mxGraph.prototype.isEventSourceIgnored=function(n,t){var i=t.getSource(),r=i.nodeName!=null?i.nodeName.toLowerCase():"",u=!mxEvent.isMouseEvent(t.getEvent())||mxEvent.isLeftMouseButton(t.getEvent());return n==mxEvent.MOUSE_DOWN&&u&&(r=="select"||r=="option"||r=="input"&&i.type!="checkbox"&&i.type!="radio"&&i.type!="button"&&i.type!="submit"&&i.type!="file")};mxGraph.prototype.getEventState=function(n){return n};mxGraph.prototype.fireMouseEvent=function(n,t,i){var o,s,u,h,f,e,r,c;if(this.isEventSourceIgnored(n,t)){this.tooltipHandler!=null&&this.tooltipHandler.hide();return}if(i==null&&(i=this),t=this.updateMouseEvent(t,n),n==mxEvent.MOUSE_DOWN&&this.isEditing()&&!this.cellEditor.isEventSource(t.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(t.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&mxEvent.isTouchEvent(t.getEvent()))if(o=(new Date).getTime(),(mxClient.IS_QUIRKS||n!=mxEvent.MOUSE_DOWN)&&(!mxClient.IS_QUIRKS||n!=mxEvent.MOUSE_UP||this.fireDoubleClick)){if((this.isMouseDown||n==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;u=this.lastTouchCell;this.lastTouchCell=null;this.isMouseDown=!1;h=u!=null||mxEvent.isTouchEvent(t.getEvent())&&(mxClient.IS_GC||mxClient.IS_SF);h&&Math.abs(this.lastTouchX-t.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-t.getY())<this.doubleTapTolerance?this.dblClick(t.getEvent(),u):mxEvent.consume(t.getEvent());return}}else if(this.lastTouchEvent!=null&&this.lastTouchEvent!=t.getEvent()&&o-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-t.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-t.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){if(this.doubleClickCounter++,s=!1,n==mxEvent.MOUSE_UP?t.getCell()==this.lastTouchCell&&this.lastTouchCell!=null&&(this.lastTouchTime=0,u=this.lastTouchCell,this.lastTouchCell=null,mxClient.IS_QUIRKS&&t.getSource().fireEvent("ondblclick"),this.dblClick(t.getEvent(),u),s=!0):(this.fireDoubleClick=!0,this.lastTouchTime=0),!mxClient.IS_QUIRKS||s){mxEvent.consume(t.getEvent());return}}else(this.lastTouchEvent==null||this.lastTouchEvent!=t.getEvent())&&(this.lastTouchCell=t.getCell(),this.lastTouchX=t.getX(),this.lastTouchY=t.getY(),this.lastTouchTime=o,this.lastTouchEvent=t.getEvent(),this.doubleClickCounter=0);if(!this.isEventIgnored(n,t,i)){if(t.state=this.getEventState(t.getState()),this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,"eventName",n,"event",t)),mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE&&mxClient.IS_SVG||t.getEvent().target!=this.container){if(n==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&!mxEvent.isMultiTouchEvent(t.getEvent)&&this.scrollPointToVisible(t.getGraphX(),t.getGraphY(),this.autoExtend),this.mouseListeners!=null)for(f=[i,t],t.getEvent().preventDefault||(t.getEvent().returnValue=!0),e=0;e<this.mouseListeners.length;e++)r=this.mouseListeners[e],n==mxEvent.MOUSE_DOWN?r.mouseDown.apply(r,f):n==mxEvent.MOUSE_MOVE?r.mouseMove.apply(r,f):n==mxEvent.MOUSE_UP&&r.mouseUp.apply(r,f);n==mxEvent.MOUSE_UP&&this.click(t)}mxEvent.isTouchEvent(t.getEvent())&&n==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress?(this.tapAndHoldInProgress=!0,this.initialTouchX=t.getGraphX(),this.initialTouchY=t.getGraphY(),c=function(){this.tapAndHoldValid&&this.tapAndHold(t);this.tapAndHoldInProgress=!1;this.tapAndHoldValid=!1},this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,c),this.tapAndHoldDelay),this.tapAndHoldValid=!0):n==mxEvent.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-t.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-t.getGraphY())<this.tolerance);this.consumeMouseEvent(n,t,i)}};mxGraph.prototype.consumeMouseEvent=function(n,t){n==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(t.getEvent())&&t.consume(!1)};mxGraph.prototype.fireGestureEvent=function(n,t){this.lastTouchTime=0;this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",n,"cell",t))};mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.tooltipHandler!=null&&this.tooltipHandler.destroy(),this.selectionCellsHandler!=null&&this.selectionCellsHandler.destroy(),this.panningHandler!=null&&this.panningHandler.destroy(),this.popupMenuHandler!=null&&this.popupMenuHandler.destroy(),this.connectionHandler!=null&&this.connectionHandler.destroy(),this.graphHandler!=null&&this.graphHandler.destroy(),this.cellEditor!=null&&this.cellEditor.destroy(),this.view!=null&&this.view.destroy(),this.model!=null&&this.graphModelChangeListener!=null&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)};mxCellOverlay.prototype=new mxEventSource;mxCellOverlay.prototype.constructor=mxCellOverlay;mxCellOverlay.prototype.image=null;mxCellOverlay.prototype.tooltip=null;mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT;mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM;mxCellOverlay.prototype.offset=null;mxCellOverlay.prototype.cursor=null;mxCellOverlay.prototype.defaultOverlap=.5;mxCellOverlay.prototype.getBounds=function(n){var h=n.view.graph.getModel().isEdge(n.cell),r=n.view.scale,t=null,f=this.image.width,e=this.image.height,i;if(h)if(i=n.absolutePoints,i.length%2==1)t=i[Math.floor(i.length/2)];else{var o=i.length/2,u=i[o-1],s=i[o];t=new mxPoint(u.x+(s.x-u.x)/2,u.y+(s.y-u.y)/2)}else t=new mxPoint,t.x=this.align==mxConstants.ALIGN_LEFT?n.x:this.align==mxConstants.ALIGN_CENTER?n.x+n.width/2:n.x+n.width,t.y=this.verticalAlign==mxConstants.ALIGN_TOP?n.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?n.y+n.height/2:n.y+n.height;return new mxRectangle(Math.round(t.x-(f*this.defaultOverlap-this.offset.x)*r),Math.round(t.y-(e*this.defaultOverlap-this.offset.y)*r),f*r,e*r)};mxCellOverlay.prototype.toString=function(){return this.tooltip};mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=!0;mxOutline.prototype.showViewport=!0;mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.labelsVisible=!1;mxOutline.prototype.updateOnPan=!1;mxOutline.prototype.sizerImage=null;mxOutline.prototype.suspended=!1;mxOutline.prototype.forceVmlHandles=document.documentMode==8;mxOutline.prototype.createGraph=function(n){var t=new mxGraph(n,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());return t.foldingEnabled=!1,t.autoScroll=!1,t};mxOutline.prototype.init=function(n){var u,i,t,r;this.outline=this.createGraph(n);u=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(){this.suspended||this.outline==null||u.apply(this.outline,arguments)});mxClient.IS_SVG&&(i=this.outline.getView().getCanvas().parentNode,i.setAttribute("shape-rendering","optimizeSpeed"),i.setAttribute("image-rendering","optimizeSpeed"));this.outline.labelsVisible=this.labelsVisible;this.outline.setEnabled(!1);this.updateHandler=mxUtils.bind(this,function(){this.suspended||this.active||this.update()});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);t=this.source.getView();t.addListener(mxEvent.SCALE,this.updateHandler);t.addListener(mxEvent.TRANSLATE,this.updateHandler);t.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);t.addListener(mxEvent.DOWN,this.updateHandler);t.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.panHandler=mxUtils.bind(this,function(){this.updateOnPan&&this.updateHandler.apply(this,arguments)});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,0,0,0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);this.selectionBorder.dialect=this.outline.dialect;this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return!1});this.selectionBorder.init(this.outline.getView().getOverlayPane());r=mxUtils.bind(this,function(n){var t=mxEvent.getSource(n),i=mxUtils.bind(this,function(n){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(n))}),r=mxUtils.bind(this,function(n){mxEvent.removeGestureListeners(t,null,i,r);this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(n))});mxEvent.addGestureListeners(t,null,i,r);this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n))});mxEvent.addGestureListeners(this.selectionBorder.node,r);this.sizer=this.createSizer();this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return!1});this.sizer.init(this.outline.getView().getOverlayPane());this.enabled&&(this.sizer.node.style.cursor="nwse-resize");mxEvent.addGestureListeners(this.sizer.node,r);this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(!1)};mxOutline.prototype.isEnabled=function(){return this.enabled};mxOutline.prototype.setEnabled=function(n){this.enabled=n};mxOutline.prototype.setZoomEnabled=function(n){this.sizer.node.style.visibility=n?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(!0)};mxOutline.prototype.createSizer=function(){var n;return this.sizerImage!=null?(n=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src),n.dialect=this.outline.dialect,n):(n=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR),n.dialect=this.outline.dialect,n)};mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};mxOutline.prototype.getOutlineOffset=function(){return null};mxOutline.prototype.getSourceGraphBounds=function(){return this.source.getGraphBounds()};mxOutline.prototype.update=function(n){var i,v,t,f;if(this.source!=null&&this.outline!=null){var r=this.source.view.scale,h=this.getSourceGraphBounds(),e=new mxRectangle(h.x/r+this.source.panDx,h.y/r+this.source.panDy,h.width/r,h.height/r),k=new mxRectangle(0,0,this.source.container.clientWidth/r,this.source.container.clientHeight/r),l=e.clone();l.add(k);var y=this.getSourceContainerSize(),d=Math.max(y.width/r,l.width),g=Math.max(y.height/r,l.height),nt=Math.max(0,this.outline.container.clientWidth-this.border),tt=Math.max(0,this.outline.container.clientHeight-this.border),it=Math.min(nt/d,tt/g),u=Math.floor(it*100)/100;if(u>0){this.outline.getView().scale!=u&&(this.outline.getView().scale=u,n=!0);i=this.outline.getView();i.currentRoot!=this.source.getView().currentRoot&&i.setCurrentRoot(this.source.getView().currentRoot);var c=this.source.view.translate,o=c.x+this.source.panDx,s=c.y+this.source.panDy,a=this.getOutlineOffset(u);a!=null&&(o+=a.x,s+=a.y);e.x<0&&(o=o-e.x);e.y<0&&(s=s-e.y);(i.translate.x!=o||i.translate.y!=s)&&(i.translate.x=o,i.translate.y=s,n=!0);v=i.translate;u=this.source.getView().scale;var p=u/i.scale,w=1/i.scale,b=this.source.container;this.bounds=new mxRectangle((v.x-c.x-this.source.panDx)/w,(v.y-c.y-this.source.panDy)/w,b.clientWidth/p,b.clientHeight/p);this.bounds.x+=this.source.container.scrollLeft*i.scale/u;this.bounds.y+=this.source.container.scrollTop*i.scale/u;t=this.selectionBorder.bounds;(t.x!=this.bounds.x||t.y!=this.bounds.y||t.width!=this.bounds.width||t.height!=this.bounds.height)&&(this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw());t=this.sizer.bounds;f=new mxRectangle(this.bounds.x+this.bounds.width-t.width/2,this.bounds.y+this.bounds.height-t.height/2,t.width,t.height);(t.x!=f.x||t.y!=f.y||t.width!=f.width||t.height!=f.height)&&(this.sizer.bounds=f,this.sizer.node.style.visibility!="hidden"&&this.sizer.redraw());n&&this.outline.view.revalidate()}}};mxOutline.prototype.mouseDown=function(n,t){if(this.enabled&&this.showViewport){var i=mxEvent.isMouseEvent(t.getEvent())?0:this.source.tolerance,r=this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||i>0)?new mxRectangle(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;this.zoom=t.isSource(this.sizer)||r!=null&&mxUtils.intersects(shape.bounds,r);this.startX=t.getX();this.startY=t.getY();this.active=!0;this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,this.dy0=this.source.container.scrollTop):(this.dx0=0,this.dy0=0)}t.consume()};mxOutline.prototype.mouseMove=function(n,t){var e,o,h,f;if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var s=this.getTranslateForEvent(t),r=s.x,u=s.y,i=null;this.zoom?(o=this.source.container,h=o.clientWidth/o.clientHeight,u=r/h,i=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+r),Math.max(1,this.bounds.height+u)),this.selectionBorder.bounds=i,this.selectionBorder.redraw()):(e=this.outline.getView().scale,i=new mxRectangle(this.bounds.x+r,this.bounds.y+u,this.bounds.width,this.bounds.height),this.selectionBorder.bounds=i,this.selectionBorder.redraw(),r/=e,r*=this.source.getView().scale,u/=e,u*=this.source.getView().scale,this.source.panGraph(-r-this.dx0,-u-this.dy0));f=this.sizer.bounds;this.sizer.bounds=new mxRectangle(i.x+i.width-f.width/2,i.y+i.height-f.height/2,f.width,f.height);this.sizer.node.style.visibility!="hidden"&&this.sizer.redraw();t.consume()}};mxOutline.prototype.getTranslateForEvent=function(n){return new mxPoint(n.getX()-this.startX,n.getY()-this.startY)};mxOutline.prototype.mouseUp=function(n,t){var u,o,f;if(this.active){var e=this.getTranslateForEvent(t),i=e.x,r=e.y;(Math.abs(i)>0||Math.abs(r)>0)&&(this.zoom?(o=this.selectionBorder.bounds.width,f=this.source.getView().scale,this.source.zoomTo(f-i*f/o,!1)):this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)||(this.source.panGraph(0,0),i/=this.outline.getView().scale,r/=this.outline.getView().scale,u=this.source.getView().translate,this.source.getView().setTranslate(u.x-i,u.y-r)),this.update(),t.consume());this.index=null;this.active=!1}};mxOutline.prototype.destroy=function(){this.source!=null&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null);this.outline!=null&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null);this.selectionBorder!=null&&(this.selectionBorder.destroy(),this.selectionBorder=null);this.sizer!=null&&(this.sizer.destroy(),this.sizer=null)};mxMultiplicity.prototype.type=null;mxMultiplicity.prototype.attr=null;mxMultiplicity.prototype.value=null;mxMultiplicity.prototype.source=null;mxMultiplicity.prototype.min=null;mxMultiplicity.prototype.max=null;mxMultiplicity.prototype.validNeighbors=null;mxMultiplicity.prototype.validNeighborsAllowed=!0;mxMultiplicity.prototype.countError=null;mxMultiplicity.prototype.typeError=null;mxMultiplicity.prototype.check=function(n,t,i,r,u,f){var e="",o;return(this.source&&this.checkTerminal(n,i,t)||!this.source&&this.checkTerminal(n,r,t))&&(this.countError!=null&&(this.source&&(this.max==0||u>=this.max)||!this.source&&(this.max==0||f>=this.max))&&(e+=this.countError+"\n"),this.validNeighbors!=null&&this.typeError!=null&&this.validNeighbors.length>0&&(o=this.checkNeighbors(n,t,i,r),o||(e+=this.typeError+"\n"))),e.length>0?e:null};mxMultiplicity.prototype.checkNeighbors=function(n,t,i,r){for(var o=n.model.getValue(i),s=n.model.getValue(r),f=!this.validNeighborsAllowed,e=this.validNeighbors,u=0;u<e.length;u++)if(this.source&&this.checkType(n,s,e[u])){f=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(n,o,e[u])){f=this.validNeighborsAllowed;break}return f};mxMultiplicity.prototype.checkTerminal=function(n,t){var i=n.model.getValue(t);return this.checkType(n,i,this.type,this.attr,this.value)};mxMultiplicity.prototype.checkType=function(n,t,i,r,u){return t!=null?isNaN(t.nodeType)?t==i:mxUtils.isNode(t,i,r,u):!1};mxLayoutManager.prototype=new mxEventSource;mxLayoutManager.prototype.constructor=mxLayoutManager;mxLayoutManager.prototype.graph=null;mxLayoutManager.prototype.bubbling=!0;mxLayoutManager.prototype.enabled=!0;mxLayoutManager.prototype.updateHandler=null;mxLayoutManager.prototype.moveHandler=null;mxLayoutManager.prototype.isEnabled=function(){return this.enabled};mxLayoutManager.prototype.setEnabled=function(n){this.enabled=n};mxLayoutManager.prototype.isBubbling=function(){return this.bubbling};mxLayoutManager.prototype.setBubbling=function(n){this.bubbling=n};mxLayoutManager.prototype.getGraph=function(){return this.graph};mxLayoutManager.prototype.setGraph=function(n){var t;this.graph!=null&&(t=this.graph.getModel(),t.removeListener(this.undoHandler),this.graph.removeListener(this.moveHandler));this.graph=n;this.graph!=null&&(t=this.graph.getModel(),t.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))};mxLayoutManager.prototype.getLayout=function(){return null};mxLayoutManager.prototype.beforeUndo=function(n){for(var i=this.getCellsForChanges(n.changes),r=this.getGraph().getModel(),t=[],u=0;u<i.length;u++)t=t.concat(r.getDescendants(i[u]));if(i=t,this.isBubbling())for(t=r.getParents(i);t.length>0;)i=i.concat(t),t=r.getParents(t);this.executeLayoutForCells(i)};mxLayoutManager.prototype.executeLayoutForCells=function(n){var t=mxUtils.sortCells(n,!0);t=t.concat(t.slice().reverse());this.layoutCells(t)};mxLayoutManager.prototype.cellsMoved=function(n,t){var r,f,i,u;if(n!=null&&t!=null)for(r=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(t),mxEvent.getClientY(t)),f=this.getGraph().getModel(),i=0;i<n.length;i++)u=this.getLayout(f.getParent(n[i])),u!=null&&u.moveCell(n[i],r.x,r.y)};mxLayoutManager.prototype.getCellsForChanges=function(n){for(var u,i,t,f,e=[],o={},r=0;r<n.length;r++){if(u=n[r],u instanceof mxRootChange)return[];for(i=this.getCellsForChange(u),t=0;t<i.length;t++)i[t]!=null&&(f=mxCellPath.create(i[t]),o[f]==null&&(o[f]=i[t],e.push(i[t])))}return e};mxLayoutManager.prototype.getCellsForChange=function(n){var t=this.getGraph().getModel();return n instanceof mxChildChange?[n.child,n.previous,t.getParent(n.child)]:n instanceof mxTerminalChange||n instanceof mxGeometryChange?[n.cell,t.getParent(n.cell)]:n instanceof mxVisibleChange||n instanceof mxStyleChange?[n.cell]:[]};mxLayoutManager.prototype.layoutCells=function(n){var i,r,t;if(n.length>0){i=this.getGraph().getModel();i.beginUpdate();try{for(r=null,t=0;t<n.length;t++)n[t]!=i.getRoot()&&n[t]!=r&&this.executeLayout(this.getLayout(n[t]),n[t])&&(r=n[t]);this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",n))}finally{i.endUpdate()}}};mxLayoutManager.prototype.executeLayout=function(n,t){var i=!1;return n!=null&&t!=null&&(n.execute(t),i=!0),i};mxLayoutManager.prototype.destroy=function(){this.setGraph(null)};mxSwimlaneManager.prototype=new mxEventSource;mxSwimlaneManager.prototype.constructor=mxSwimlaneManager;mxSwimlaneManager.prototype.graph=null;mxSwimlaneManager.prototype.enabled=!0;mxSwimlaneManager.prototype.horizontal=!0;mxSwimlaneManager.prototype.addEnabled=!0;mxSwimlaneManager.prototype.resizeEnabled=!0;mxSwimlaneManager.prototype.addHandler=null;mxSwimlaneManager.prototype.resizeHandler=null;mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled};mxSwimlaneManager.prototype.setEnabled=function(n){this.enabled=n};mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal};mxSwimlaneManager.prototype.setHorizontal=function(n){this.horizontal=n};mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled};mxSwimlaneManager.prototype.setAddEnabled=function(n){this.addEnabled=n};mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled};mxSwimlaneManager.prototype.setResizeEnabled=function(n){this.resizeEnabled=n};mxSwimlaneManager.prototype.getGraph=function(){return this.graph};mxSwimlaneManager.prototype.setGraph=function(n){this.graph!=null&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler));this.graph=n;this.graph!=null&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))};mxSwimlaneManager.prototype.isSwimlaneIgnored=function(n){return!this.getGraph().isSwimlane(n)};mxSwimlaneManager.prototype.isCellHorizontal=function(n){if(this.graph.isSwimlane(n)){var t=this.graph.getCellStyle(n);return mxUtils.getValue(t,mxConstants.STYLE_HORIZONTAL,1)==1}return!this.isHorizontal()};mxSwimlaneManager.prototype.cellsAdded=function(n){var i,t;if(n!=null){i=this.getGraph().getModel();i.beginUpdate();try{for(t=0;t<n.length;t++)this.isSwimlaneIgnored(n[t])||this.swimlaneAdded(n[t])}finally{i.endUpdate()}}};mxSwimlaneManager.prototype.swimlaneAdded=function(n){for(var u,e,i=this.getGraph().getModel(),r=i.getParent(n),o=i.getChildCount(r),t=null,f=0;f<o;f++)if(u=i.getChildAt(r,f),u!=n&&!this.isSwimlaneIgnored(u)&&(t=i.getGeometry(u),t!=null))break;t!=null&&(e=r!=null?this.isCellHorizontal(r):this.horizontal,this.resizeSwimlane(n,t.width,t.height,e))};mxSwimlaneManager.prototype.cellsResized=function(n){var r,i,u,o,s;if(n!=null){r=this.getGraph().getModel();r.beginUpdate();try{for(i=0;i<n.length;i++)if(!this.isSwimlaneIgnored(n[i])&&(u=r.getGeometry(n[i]),u!=null)){for(var f=new mxRectangle(0,0,u.width,u.height),e=n[i],t=e;t!=null;)e=t,t=r.getParent(t),o=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new mxRectangle,f.width+=o.width,f.height+=o.height;s=t!=null?this.isCellHorizontal(t):this.horizontal;this.resizeSwimlane(e,f.width,f.height,s)}}finally{r.endUpdate()}}};mxSwimlaneManager.prototype.resizeSwimlane=function(n,t,i,r){var f=this.getGraph().getModel(),s,u,o,h,e,c;f.beginUpdate();try{for(s=this.isCellHorizontal(n),this.isSwimlaneIgnored(n)||(u=f.getGeometry(n),u!=null&&(r&&u.height!=i||!r&&u.width!=t)&&(u=u.clone(),r?u.height=i:u.width=t,f.setGeometry(n,u))),o=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new mxRectangle,t-=o.width,i-=o.height,h=f.getChildCount(n),e=0;e<h;e++)c=f.getChildAt(n,e),this.resizeSwimlane(c,t,i,s)}finally{f.endUpdate()}};mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)};mxTemporaryCellStates.prototype.view=null;mxTemporaryCellStates.prototype.oldStates=null;mxTemporaryCellStates.prototype.oldBounds=null;mxTemporaryCellStates.prototype.oldScale=null;mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale);this.view.setStates(this.oldStates);this.view.setGraphBounds(this.oldBounds);this.view.validateCellState=this.oldValidateCellState};mxCellStatePreview.prototype.graph=null;mxCellStatePreview.prototype.deltas=null;mxCellStatePreview.prototype.count=0;mxCellStatePreview.prototype.isEmpty=function(){return this.count==0};mxCellStatePreview.prototype.moveState=function(n,t,i,r,u){r=r!=null?r:!0;u=u!=null?u:!0;var f=this.deltas.get(n.cell);return f==null?(f={point:new mxPoint(t,i),state:n},this.deltas.put(n.cell,f),this.count++):r?(f.point.x+=t,f.point.y+=i):(f.point.x=t,f.point.y=i),u&&this.addEdges(n),f.point};mxCellStatePreview.prototype.show=function(n){this.deltas.visit(mxUtils.bind(this,function(n,t){this.translateState(t.state,t.point.x,t.point.y)}));this.deltas.visit(mxUtils.bind(this,function(t,i){this.revalidateState(i.state,i.point.x,i.point.y,n)}))};mxCellStatePreview.prototype.translateState=function(n,t,i){var r,f,e,u;if(n!=null)for(r=this.graph.getModel(),r.isVertex(n.cell)&&(n.view.updateCellState(n),f=r.getGeometry(n.cell),t==0&&i==0||f==null||f.relative&&this.deltas.get(n.cell)==null||(n.x+=t,n.y+=i)),e=r.getChildCount(n.cell),u=0;u<e;u++)this.translateState(n.view.getState(r.getChildAt(n.cell,u)),t,i)};mxCellStatePreview.prototype.revalidateState=function(n,t,i,r){var u,e,o,s,f;if(n!=null)for(u=this.graph.getModel(),u.isEdge(n.cell)&&n.view.updateCellState(n),e=this.graph.getCellGeometry(n.cell),o=n.view.getState(u.getParent(n.cell)),(t!=0||i!=0)&&e!=null&&e.relative&&u.isVertex(n.cell)&&(o==null||u.isVertex(o.cell)||this.deltas.get(n.cell)!=null)&&(n.x+=t,n.y+=i),this.graph.cellRenderer.redraw(n),r!=null&&r(n),s=u.getChildCount(n.cell),f=0;f<s;f++)this.revalidateState(this.graph.view.getState(u.getChildAt(n.cell,f)),t,i,r)};mxCellStatePreview.prototype.addEdges=function(n){for(var i,r=this.graph.getModel(),u=r.getEdgeCount(n.cell),t=0;t<u;t++)i=n.view.getState(r.getEdgeAt(n.cell,t)),i!=null&&this.moveState(i,0,0)};mxConnectionConstraint.prototype.point=null;mxConnectionConstraint.prototype.perimeter=null;mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50;mxGraphHandler.prototype.enabled=!0;mxGraphHandler.prototype.highlightEnabled=!0;mxGraphHandler.prototype.cloneEnabled=!0;mxGraphHandler.prototype.moveEnabled=!0;mxGraphHandler.prototype.guidesEnabled=!1;mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=!0;mxGraphHandler.prototype.selectEnabled=!0;mxGraphHandler.prototype.removeCellsFromParent=!0;mxGraphHandler.prototype.connectOnDrop=!1;mxGraphHandler.prototype.scrollOnMove=!0;mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=!1;mxGraphHandler.prototype.shape=null;mxGraphHandler.prototype.scaleGrid=!1;mxGraphHandler.prototype.rotationEnabled=!0;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(n){this.enabled=n};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};mxGraphHandler.prototype.setCloneEnabled=function(n){this.cloneEnabled=n};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};mxGraphHandler.prototype.setMoveEnabled=function(n){this.moveEnabled=n};mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(n){this.selectEnabled=n};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};mxGraphHandler.prototype.setRemoveCellsFromParent=function(n){this.removeCellsFromParent=n};mxGraphHandler.prototype.getInitialCellForEvent=function(n){return n.getCell()};mxGraphHandler.prototype.isDelayedSelection=function(n){return this.graph.isCellSelected(n)};mxGraphHandler.prototype.mouseDown=function(n,t){var i,r,u;!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&t.getState()!=null&&!mxEvent.isMultiTouchEvent(t.getEvent())&&(i=this.getInitialCellForEvent(t),this.delayedSelection=this.isDelayedSelection(i,t),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(i,t.getEvent()),this.isMoveEnabled()&&(r=this.graph.model,u=r.getGeometry(i),this.graph.isCellMovable(i)&&(!r.isEdge(i)||this.graph.getSelectionCount()>1||u.points!=null&&u.points.length>0||r.getTerminal(i,!0)==null||r.getTerminal(i,!1)==null||this.graph.allowDanglingEdges||this.graph.isCloneEvent(t.getEvent())&&this.graph.isCellsCloneable())&&this.start(i,t.getX(),t.getY()),this.cellWasClicked=!0,t.consume()))};mxGraphHandler.prototype.getGuideStates=function(){var t=this.graph.getDefaultParent(),n=this.graph.getModel(),i=mxUtils.bind(this,function(t){return this.graph.view.getState(t)!=null&&n.isVertex(t)&&n.getGeometry(t)!=null&&!n.getGeometry(t).relative});return this.graph.view.getCellStates(n.filterDescendants(i,t))};mxGraphHandler.prototype.getCells=function(n){return!this.delayedSelection&&this.graph.isCellMovable(n)?[n]:this.graph.getMovableCells(this.graph.getSelectionCells())};mxGraphHandler.prototype.getPreviewBounds=function(n){var t=this.getBoundingBox(n),i,r;return t!=null&&(t.width=Math.max(0,t.width-1),t.height=Math.max(0,t.height-1),t.width<this.minimumSize?(i=this.minimumSize-t.width,t.x-=i/2,t.width=this.minimumSize):(t.x=Math.floor(t.x),t.width=Math.ceil(t.width)),t.height<this.minimumSize?(r=this.minimumSize-t.height,t.y-=r/2,t.height=this.minimumSize):(t.y=Math.floor(t.y),t.height=Math.ceil(t.height))),t};mxGraphHandler.prototype.getBoundingBox=function(n){var r=null,u,t,i,f;if(n!=null&&n.length>0)for(u=this.graph.getModel(),t=0;t<n.length;t++)(u.isVertex(n[t])||u.isEdge(n[t]))&&(i=this.graph.view.getState(n[t]),i!=null&&(f=i,u.isVertex(n[t])&&i.shape!=null&&i.shape.boundingBox!=null&&(f=i.shape.boundingBox),r==null?r=mxRectangle.fromRectangle(f):r.add(f)));return r};mxGraphHandler.prototype.createPreviewShape=function(n){var t=new mxRectangleShape(n,null,this.previewColor);return t.isDashed=!0,this.htmlPreview?(t.dialect=mxConstants.DIALECT_STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,t.init(this.graph.getView().getOverlayPane()),t.pointerEvents=!1,mxClient.IS_IOS&&(t.getSvgScreenOffset=function(){return 0})),t};mxGraphHandler.prototype.start=function(n,t,i){this.cell=n;this.first=mxUtils.convertPoint(this.graph.container,t,i);this.cells=this.getCells(this.cell);this.bounds=this.graph.getView().getBounds(this.cells);this.pBounds=this.getPreviewBounds(this.cells);this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))};mxGraphHandler.prototype.useGuidesForEvent=function(n){return this.guide!=null?this.guide.isEnabledForEvent(n.getEvent()):!0};mxGraphHandler.prototype.snap=function(n){var t=this.scaleGrid?this.graph.view.scale:1;return n.x=this.graph.snap(n.x/t)*t,n.y=this.graph.snap(n.y/t)*t,n};mxGraphHandler.prototype.getDelta=function(n){var i=mxUtils.convertPoint(this.graph.container,n.getX(),n.getY()),t=this.graph.view.scale;return new mxPoint(this.roundLength((i.x-this.first.x)/t)*t,this.roundLength((i.y-this.first.y)/t)*t)};mxGraphHandler.prototype.updateHint=function(){};mxGraphHandler.prototype.removeHint=function(){};mxGraphHandler.prototype.roundLength=function(n){return Math.round(n)};mxGraphHandler.prototype.mouseMove=function(n,t){var i=this.graph,v,y,e,l,k,d,a;if(!t.isConsumed()&&i.isMouseDown&&this.cell!=null&&this.first!=null&&this.bounds!=null){if(mxEvent.isMultiTouchEvent(t.getEvent())){this.reset();return}var o=this.getDelta(t),r=o.x,u=o.y,p=i.tolerance;if(this.shape!=null||Math.abs(r)>p||Math.abs(u)>p){if(this.highlight==null&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3)),this.shape==null&&(this.shape=this.createPreviewShape(this.bounds)),v=i.isGridEnabledEvent(t.getEvent()),y=!0,this.guide!=null&&this.useGuidesForEvent(t))o=this.guide.move(this.bounds,new mxPoint(r,u),v),y=!1,r=o.x,u=o.y;else if(v){var h=i.getView().translate,c=i.getView().scale,g=this.bounds.x-(i.snap(this.bounds.x/c-h.x)+h.x)*c,nt=this.bounds.y-(i.snap(this.bounds.y/c-h.y)+h.y)*c,w=this.snap(new mxPoint(r,u));r=w.x-g;u=w.y-nt}this.guide!=null&&y&&this.guide.hide();i.isConstrainedEvent(t.getEvent())&&(Math.abs(r)>Math.abs(u)?u=0:r=0);this.currentDx=r;this.currentDy=u;this.updatePreviewShape();var s=null,f=t.getCell(),b=i.isCloneEvent(t.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled();i.isDropEnabled()&&this.highlightEnabled&&(s=i.getDropTarget(this.cells,t.getEvent(),f,b));e=i.getView().getState(s);l=!1;e!=null&&(i.model.getParent(this.cell)!=s||b)?(this.target!=s&&(this.target=s,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),l=!0):(this.target=null,this.connectOnDrop&&f!=null&&this.cells.length==1&&i.getModel().isVertex(f)&&i.isCellConnectable(f)&&(e=i.getView().getState(f),e!=null&&(k=i.getEdgeValidationError(null,this.cell,f),d=k==null?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR,this.setHighlightColor(d),l=!0)));e!=null&&l?this.highlight.highlight(e):this.highlight.hide()}this.updateHint(t);t.consume();mxEvent.consume(t.getEvent())}else(this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!t.isConsumed()&&t.getState()!=null&&!i.isMouseDown&&(a=i.getCursorForMouseEvent(t),a==null&&i.isEnabled()&&i.isCellMovable(t.getCell())&&(a=i.getModel().isEdge(t.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:mxConstants.CURSOR_MOVABLE_VERTEX),t.sourceState!=null&&t.sourceState.setCursor(a))};mxGraphHandler.prototype.updatePreviewShape=function(){this.shape!=null&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())};mxGraphHandler.prototype.setHighlightColor=function(n){this.highlight!=null&&this.highlight.setHighlightColor(n)};mxGraphHandler.prototype.mouseUp=function(n,t){var i,r;if(!t.isConsumed())if(i=this.graph,this.cell!=null&&this.first!=null&&this.shape!=null&&this.currentDx!=null&&this.currentDy!=null)if(r=t.getCell(),this.connectOnDrop&&this.target==null&&r!=null&&i.getModel().isVertex(r)&&i.isCellConnectable(r)&&i.isEdgeValid(null,this.cell,r))i.connectionHandler.connect(this.cell,r,t.getEvent());else{var s=i.isCloneEvent(t.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),u=i.getView().scale,f=this.roundLength(this.currentDx/u),e=this.roundLength(this.currentDy/u),o=this.target;i.isSplitEnabled()&&i.isSplitTarget(o,this.cells,t.getEvent())?i.splitEdge(o,this.cells,null,f,e):this.moveCells(this.cells,f,e,s,this.target,t.getEvent())}else this.isSelectEnabled()&&this.delayedSelection&&this.cell!=null&&this.selectDelayed(t);this.cellWasClicked&&t.consume();this.reset()};mxGraphHandler.prototype.selectDelayed=function(n){this.graph.isCellSelected(this.cell)&&this.graph.popupMenuHandler.isPopupTrigger(n)||this.graph.selectCellForEvent(this.cell,n.getEvent())};mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.removeHint();this.cellWasClicked=!1;this.delayedSelection=!1;this.currentDx=null;this.currentDy=null;this.guides=null;this.first=null;this.cell=null;this.target=null};mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(n,t,i){if(this.graph.getModel().isVertex(n)){var r=this.graph.getView().getState(n),u=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(i),mxEvent.getClientY(i)),f=mxUtils.toRadians(mxUtils.getValue(r.style,mxConstants.STYLE_ROTATION)||0);if(f!=0){var e=Math.cos(-f),o=Math.sin(-f),s=new mxPoint(r.getCenterX(),r.getCenterY());u=mxUtils.getRotatedPoint(u,e,o,s)}return r!=null&&!mxUtils.contains(r,u.x,u.y)}return!1};mxGraphHandler.prototype.moveCells=function(n,t,i,r,u,f){r&&(n=this.graph.getCloneableCells(n));u==null&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),n,f)&&(u=this.graph.getDefaultParent());n=this.graph.moveCells(n,t-this.graph.panDx/this.graph.view.scale,i-this.graph.panDy/this.graph.view.scale,r,u,f);this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(n[0]);r&&this.graph.setSelectionCells(n)};mxGraphHandler.prototype.destroyShapes=function(){this.shape!=null&&(this.shape.destroy(),this.shape=null);this.guide!=null&&(this.guide.destroy(),this.guide=null);this.highlight!=null&&(this.highlight.destroy(),this.highlight=null)};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);this.escapeHandler!=null&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null);this.destroyShapes();this.removeHint()};mxPanningHandler.prototype=new mxEventSource;mxPanningHandler.prototype.constructor=mxPanningHandler;mxPanningHandler.prototype.graph=null;mxPanningHandler.prototype.useLeftButtonForPanning=!1;mxPanningHandler.prototype.usePopupTrigger=!0;mxPanningHandler.prototype.ignoreCell=!1;mxPanningHandler.prototype.previewEnabled=!0;mxPanningHandler.prototype.useGrid=!1;mxPanningHandler.prototype.panningEnabled=!0;mxPanningHandler.prototype.pinchEnabled=!0;mxPanningHandler.prototype.maxScale=8;mxPanningHandler.prototype.minScale=.01;mxPanningHandler.prototype.dx=null;mxPanningHandler.prototype.dy=null;mxPanningHandler.prototype.startX=0;mxPanningHandler.prototype.startY=0;mxPanningHandler.prototype.isActive=function(){return this.active||this.initialScale!=null};mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled};mxPanningHandler.prototype.setPanningEnabled=function(n){this.panningEnabled=n};mxPanningHandler.prototype.isPinchEnabled=function(){return this.pinchEnabled};mxPanningHandler.prototype.setPinchEnabled=function(n){this.pinchEnabled=n};mxPanningHandler.prototype.isPanningTrigger=function(n){var t=n.getEvent();return this.useLeftButtonForPanning&&n.getState()==null&&mxEvent.isLeftMouseButton(t)||mxEvent.isControlDown(t)&&mxEvent.isShiftDown(t)||this.usePopupTrigger&&mxEvent.isPopupTrigger(t)};mxPanningHandler.prototype.isForcePanningEvent=function(n){return this.ignoreCell||mxEvent.isMultiTouchEvent(n.getEvent())};mxPanningHandler.prototype.mouseDown=function(n,t){this.mouseDownEvent=t;!t.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(t)&&(this.start(t),this.consumePanningTrigger(t))};mxPanningHandler.prototype.start=function(n){this.dx0=-this.graph.container.scrollLeft;this.dy0=-this.graph.container.scrollTop;this.startX=n.getX();this.startY=n.getY();this.dx=null;this.dy=null;this.panningTrigger=!0};mxPanningHandler.prototype.consumePanningTrigger=function(n){n.consume()};mxPanningHandler.prototype.mouseMove=function(n,t){if(this.dx=t.getX()-this.startX,this.dy=t.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new mxEventObject(mxEvent.PAN,"event",t));else if(this.panningTrigger){var i=this.active;this.active=Math.abs(this.dx)>this.graph.tolerance||Math.abs(this.dy)>this.graph.tolerance;!i&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",t))}(this.active||this.panningTrigger)&&t.consume()};mxPanningHandler.prototype.mouseUp=function(n,t){if(this.active){if(this.dx!=null&&this.dy!=null){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){var i=this.graph.getView().scale,r=this.graph.getView().translate;this.graph.panGraph(0,0);this.panGraph(r.x+this.dx/i,r.y+this.dy/i)}t.consume()}this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",t))}this.panningTrigger=!1;this.mouseDownEvent=null;this.active=!1;this.dx=null;this.dy=null};mxPanningHandler.prototype.panGraph=function(n,t){this.graph.getView().setTranslate(n,t)};mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.forcePanningHandler);this.graph.removeListener(this.gestureHandler)};mxPopupMenuHandler.prototype=new mxPopupMenu;mxPopupMenuHandler.prototype.constructor=mxPopupMenuHandler;mxPopupMenuHandler.prototype.graph=null;mxPopupMenuHandler.prototype.selectOnPopup=!0;mxPopupMenuHandler.prototype.clearSelectionOnBackground=!0;mxPopupMenuHandler.prototype.triggerX=null;mxPopupMenuHandler.prototype.triggerY=null;mxPopupMenuHandler.prototype.screenX=null;mxPopupMenuHandler.prototype.screenY=null;mxPopupMenuHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this);mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(){this.graph.tooltipHandler.hide()}))};mxPopupMenuHandler.prototype.isSelectOnPopup=function(){return this.selectOnPopup};mxPopupMenuHandler.prototype.mouseDown=function(n,t){this.isEnabled()&&!mxEvent.isMultiTouchEvent(t.getEvent())&&(this.hideMenu(),this.triggerX=t.getGraphX(),this.triggerY=t.getGraphY(),this.screenX=mxEvent.getMainEvent(t.getEvent()).screenX,this.screenY=mxEvent.getMainEvent(t.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(t),this.inTolerance=!0)};mxPopupMenuHandler.prototype.mouseMove=function(n,t){this.inTolerance&&this.screenX!=null&&this.screenY!=null&&(Math.abs(mxEvent.getMainEvent(t.getEvent()).screenX-this.screenX)>this.graph.tolerance||Math.abs(mxEvent.getMainEvent(t.getEvent()).screenY-this.screenY)>this.graph.tolerance)&&(this.inTolerance=!1)};mxPopupMenuHandler.prototype.mouseUp=function(n,t){var i,r;this.popupTrigger&&this.inTolerance&&this.triggerX!=null&&this.triggerY!=null&&(i=this.getCellForPopupEvent(t),this.graph.isEnabled()&&this.isSelectOnPopup(t)&&i!=null&&!this.graph.isCellSelected(i)?this.graph.setSelectionCell(i):this.clearSelectionOnBackground&&i==null&&this.graph.clearSelection(),this.graph.tooltipHandler.hide(),r=mxUtils.getScrollOrigin(),this.popup(t.getX()+r.x+1,t.getY()+r.y+1,i,t.getEvent()),t.consume());this.popupTrigger=!1;this.inTolerance=!1};mxPopupMenuHandler.prototype.getCellForPopupEvent=function(n){return n.getCell()};mxPopupMenuHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.gestureHandler);mxPopupMenu.prototype.destroy.apply(this)};mxUtils.extend(mxCellMarker,mxEventSource);mxCellMarker.prototype.graph=null;mxCellMarker.prototype.enabled=!0;mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT;mxCellMarker.prototype.hotspotEnabled=!1;mxCellMarker.prototype.validColor=null;mxCellMarker.prototype.invalidColor=null;mxCellMarker.prototype.currentColor=null;mxCellMarker.prototype.validState=null;mxCellMarker.prototype.markedState=null;mxCellMarker.prototype.setEnabled=function(n){this.enabled=n};mxCellMarker.prototype.isEnabled=function(){return this.enabled};mxCellMarker.prototype.setHotspot=function(n){this.hotspot=n};mxCellMarker.prototype.getHotspot=function(){return this.hotspot};mxCellMarker.prototype.setHotspotEnabled=function(n){this.hotspotEnabled=n};mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled};mxCellMarker.prototype.hasValidState=function(){return this.validState!=null};mxCellMarker.prototype.getValidState=function(){return this.validState};mxCellMarker.prototype.getMarkedState=function(){return this.markedState};mxCellMarker.prototype.reset=function(){this.validState=null;this.markedState!=null&&(this.markedState=null,this.unmark())};mxCellMarker.prototype.process=function(n){var t=null;return this.isEnabled()&&(t=this.getState(n),this.setCurrentState(t,n)),t};mxCellMarker.prototype.setCurrentState=function(n,t,i){var r=n!=null?this.isValidState(n):!1;i=i!=null?i:this.getMarkerColor(t.getEvent(),n,r);this.validState=r?n:null;(n!=this.markedState||i!=this.currentColor)&&(this.currentColor=i,n!=null&&this.currentColor!=null?(this.markedState=n,this.mark()):this.markedState!=null&&(this.markedState=null,this.unmark()))};mxCellMarker.prototype.markCell=function(n,t){var i=this.graph.getView().getState(n);i!=null&&(this.currentColor=t!=null?t:this.validColor,this.markedState=i,this.mark())};mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor);this.highlight.highlight(this.markedState);this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))};mxCellMarker.prototype.unmark=function(){this.mark()};mxCellMarker.prototype.isValidState=function(){return!0};mxCellMarker.prototype.getMarkerColor=function(n,t,i){return i?this.validColor:this.invalidColor};mxCellMarker.prototype.getState=function(n){var i=this.graph.getView(),t;return cell=this.getCell(n),t=this.getStateToMark(i.getState(cell)),t!=null&&this.intersects(t,n)?t:null};mxCellMarker.prototype.getCell=function(n){return n.getCell()};mxCellMarker.prototype.getStateToMark=function(n){return n};mxCellMarker.prototype.intersects=function(n,t){return this.hotspotEnabled?mxUtils.intersectsHotspot(n,t.getGraphX(),t.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0};mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);this.highlight.destroy()};mxUtils.extend(mxSelectionCellsHandler,mxEventSource);mxSelectionCellsHandler.prototype.graph=null;mxSelectionCellsHandler.prototype.enabled=!0;mxSelectionCellsHandler.prototype.refreshHandler=null;mxSelectionCellsHandler.prototype.maxHandlers=100;mxSelectionCellsHandler.prototype.handlers=null;mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled};mxSelectionCellsHandler.prototype.setEnabled=function(n){this.enabled=n};mxSelectionCellsHandler.prototype.getHandler=function(n){return this.handlers.get(n)};mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(n,t){t.reset.apply(t)})};mxSelectionCellsHandler.prototype.refresh=function(){var u=this.handlers,i,t,r,n;for(this.handlers=new mxDictionary,i=this.graph.getSelectionCells(),t=0;t<i.length;t++)r=this.graph.view.getState(i[t]),r!=null&&(n=u.remove(i[t]),n!=null&&(n.state!=r?(n.destroy(),n=null):(n.refresh!=null&&n.refresh(),n.redraw())),n==null&&(n=this.graph.createHandler(r),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",r))),n!=null&&this.handlers.put(i[t],n));u.visit(mxUtils.bind(this,function(n,t){this.fireEvent(new mxEventObject(mxEvent.REMOVE,"state",t.state));t.destroy()}))};mxSelectionCellsHandler.prototype.mouseDown=function(n,t){if(this.graph.isEnabled()&&this.isEnabled()){var i=[n,t];this.handlers.visit(function(n,t){t.mouseDown.apply(t,i)})}};mxSelectionCellsHandler.prototype.mouseMove=function(n,t){if(this.graph.isEnabled()&&this.isEnabled()){var i=[n,t];this.handlers.visit(function(n,t){t.mouseMove.apply(t,i)})}};mxSelectionCellsHandler.prototype.mouseUp=function(n,t){if(this.graph.isEnabled()&&this.isEnabled()){var i=[n,t];this.handlers.visit(function(n,t){t.mouseUp.apply(t,i)})}};mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.refreshHandler!=null&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)};mxUtils.extend(mxConnectionHandler,mxEventSource);mxConnectionHandler.prototype.graph=null;mxConnectionHandler.prototype.factoryMethod=!0;mxConnectionHandler.prototype.moveIconFront=!1;mxConnectionHandler.prototype.moveIconBack=!1;mxConnectionHandler.prototype.connectImage=null;mxConnectionHandler.prototype.targetConnectImage=!1;mxConnectionHandler.prototype.enabled=!0;mxConnectionHandler.prototype.select=!0;mxConnectionHandler.prototype.createTarget=!1;mxConnectionHandler.prototype.marker=null;mxConnectionHandler.prototype.constraintHandler=null;mxConnectionHandler.prototype.error=null;mxConnectionHandler.prototype.waypointsEnabled=!1;mxConnectionHandler.prototype.ignoreMouseDown=!1;mxConnectionHandler.prototype.first=null;mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET);mxConnectionHandler.prototype.edgeState=null;mxConnectionHandler.prototype.changeHandler=null;mxConnectionHandler.prototype.drillHandler=null;mxConnectionHandler.prototype.mouseDownCounter=0;mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML;mxConnectionHandler.prototype.outlineConnect=!1;mxConnectionHandler.prototype.isEnabled=function(){return this.enabled};mxConnectionHandler.prototype.setEnabled=function(n){this.enabled=n};mxConnectionHandler.prototype.isCreateTarget=function(){return this.createTarget};mxConnectionHandler.prototype.setCreateTarget=function(n){this.createTarget=n};mxConnectionHandler.prototype.createShape=function(){var n=new mxPolyline([],mxConstants.INVALID_COLOR);return n.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,n.pointerEvents=!1,n.isDashed=!0,n.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(n.node,this.graph,null),n};mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this);this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.changeHandler=mxUtils.bind(this,function(){this.iconState!=null&&(this.iconState=this.graph.getView().getState(this.iconState.cell));this.iconState!=null?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.reset()});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE,this.changeHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler);this.drillHandler=mxUtils.bind(this,function(){this.reset()});this.graph.addListener(mxEvent.START_EDITING,this.drillHandler);this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler);this.graph.getView().addListener(mxEvent.UP,this.drillHandler)};mxConnectionHandler.prototype.isConnectableCell=function(){return!0};mxConnectionHandler.prototype.createMarker=function(){var n=new mxCellMarker(this.graph);return n.hotspotEnabled=!0,n.getCell=mxUtils.bind(this,function(t,i){var i=mxCellMarker.prototype.getCell.apply(n,arguments),r=this.graph.view.scale,u=new mxPoint(this.graph.snap(t.getGraphX()/r)*r,this.graph.snap(t.getGraphY()/r)*r);return this.error=null,i==null&&(i=this.getCellAt(u.x,u.y)),(this.graph.isSwimlane(i)&&this.graph.hitsSwimlaneContent(i,u.x,u.y)||!this.isConnectableCell(i))&&(i=null),i!=null?this.isConnecting()?this.previous!=null&&(this.error=this.validateConnection(this.previous.cell,i),this.error!=null&&this.error.length==0&&(i=null,this.isCreateTarget()&&(this.error=null))):this.isValidSource(i,t)||(i=null):!this.isConnecting()||this.isCreateTarget()||this.graph.allowDanglingEdges||(this.error=""),i}),n.isValidState=mxUtils.bind(this,function(){return this.isConnecting()?this.error==null:mxCellMarker.prototype.isValidState.apply(n,arguments)}),n.getMarkerColor=mxUtils.bind(this,function(){return this.connectImage==null||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(n,arguments):null}),n.intersects=mxUtils.bind(this,function(){return this.connectImage!=null||this.isConnecting()?!0:mxCellMarker.prototype.intersects.apply(n,arguments)}),n};mxConnectionHandler.prototype.start=function(n,t,i,r){this.previous=n;this.first=new mxPoint(t,i);this.edgeState=r!=null?r:this.createEdgeState(null);this.marker.currentColor=this.marker.validColor;this.marker.markedState=n;this.marker.mark();this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))};mxConnectionHandler.prototype.getCellAt=function(n,t){return this.outlineConnect?null:this.graph.getCellAt(n,t)};mxConnectionHandler.prototype.isConnecting=function(){return this.first!=null&&this.shape!=null};mxConnectionHandler.prototype.isValidSource=function(n){return this.graph.isValidSource(n)};mxConnectionHandler.prototype.isValidTarget=function(){return!0};mxConnectionHandler.prototype.validateConnection=function(n,t){return this.isValidTarget(t)?this.graph.getEdgeValidationError(null,n,t):""};mxConnectionHandler.prototype.getConnectImage=function(){return this.connectImage};mxConnectionHandler.prototype.isMoveIconToFrontForState=function(n){return n.text!=null&&n.text.node.parentNode==this.graph.container?!0:this.moveIconFront};mxConnectionHandler.prototype.createIcons=function(n){var i=this.getConnectImage(n),u,f;if(i!=null&&n!=null){this.iconState=n;var r=[],e=new mxRectangle(0,0,i.width,i.height),t=new mxImageShape(e,i.src,null,null,0);return t.preserveImageAspect=!1,this.isMoveIconToFrontForState(n)?(t.dialect=mxConstants.DIALECT_STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,t.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&t.node.previousSibling!=null&&t.node.parentNode.insertBefore(t.node,t.node.parentNode.firstChild)),t.node.style.cursor=mxConstants.CURSOR_CONNECT,u=mxUtils.bind(this,function(){return this.currentState!=null?this.currentState:n}),f=mxUtils.bind(this,function(n){mxEvent.isConsumed(n)||(this.icon=t,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(n,u())))}),mxEvent.redirectMouseEvents(t.node,this.graph,u,f),r.push(t),this.redrawIcons(r,this.iconState),r}return null};mxConnectionHandler.prototype.redrawIcons=function(n,t){if(n!=null&&n[0]!=null&&t!=null){var i=this.getIconPosition(n[0],t);n[0].bounds.x=i.x;n[0].bounds.y=i.y;n[0].redraw()}};mxConnectionHandler.prototype.getIconPosition=function(n,t){var e=this.graph.getView().scale,i=t.getCenterX(),r=t.getCenterY(),u,f;if(this.graph.isSwimlane(t.cell)&&(u=this.graph.getStartSize(t.cell),i=u.width!=0?t.x+u.width*e/2:i,r=u.height!=0?t.y+u.height*e/2:r,f=mxUtils.toRadians(mxUtils.getValue(t.style,mxConstants.STYLE_ROTATION)||0),f!=0)){var s=Math.cos(f),h=Math.sin(f),c=new mxPoint(t.getCenterX(),t.getCenterY()),o=mxUtils.getRotatedPoint(new mxPoint(i,r),s,h,c);i=o.x;r=o.y}return new mxPoint(i-n.bounds.width/2,r-n.bounds.height/2)};mxConnectionHandler.prototype.destroyIcons=function(){if(this.icons!=null){for(var n=0;n<this.icons.length;n++)this.icons[n].destroy();this.icons=null;this.icon=null;this.selectedIcon=null;this.iconState=null}};mxConnectionHandler.prototype.isStartEvent=function(){return this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null||this.previous!=null&&this.error==null&&(this.icons==null||this.icons!=null&&this.icon!=null)};mxConnectionHandler.prototype.mouseDown=function(n,t){if(this.mouseDownCounter++,this.isEnabled()&&this.graph.isEnabled()&&!t.isConsumed()&&!this.isConnecting()&&this.isStartEvent(t)){if(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentPoint!=null?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(t.getGraphX(),t.getGraphY()),this.edgeState=this.createEdgeState(t),this.mouseDownCounter=1,this.waypointsEnabled&&this.shape==null&&(this.waypoints=null,this.shape=this.createShape(),this.edgeState!=null&&this.shape.apply(this.edgeState)),this.previous==null&&this.edgeState!=null){var i=this.graph.getPointForEvent(t.getEvent());this.edgeState.cell.geometry.setTerminalPoint(i,!0)}this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous));t.consume()}this.selectedIcon=this.icon;this.icon=null};mxConnectionHandler.prototype.isImmediateConnectSource=function(n){return!this.graph.isCellMovable(n.cell)};mxConnectionHandler.prototype.createEdgeState=function(){return null};mxConnectionHandler.prototype.isOutlineConnectEvent=function(n){return this.outlineConnect&&!mxEvent.isShiftDown(n.getEvent())&&(n.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(n.getEvent()))};mxConnectionHandler.prototype.updateCurrentState=function(n,t){if(this.constraintHandler.update(n,this.first==null),this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null)this.marker.reset(),this.previous!=null&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error==null?this.currentState=this.constraintHandler.currentFocus:this.constraintHandler.reset());else if(this.marker.process(n),this.currentState=this.marker.getValidState(),this.currentState!=null&&this.isOutlineConnectEvent(n)){var i=this.graph.getOutlineConstraint(t,this.currentState,n);this.constraintHandler.currentConstraint=i;this.constraintHandler.currentFocus=this.currentState;this.constraintHandler.currentPoint=t}this.outlineConnect&&this.marker.highlight!=null&&this.marker.highlight.shape!=null&&(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/this.graph.view.scale/this.graph.view.scale,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/this.graph.view.scale/this.graph.view.scale,this.marker.highlight.repaint()))};mxConnectionHandler.prototype.convertWaypoint=function(n){var t=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();n.x=n.x/t-i.x;n.y=n.y/t-i.y};mxConnectionHandler.prototype.snapToPreview=function(n,t){if(!mxEvent.isAltDown(n.getEvent())&&this.shape!=null&&this.shape.points!=null&&this.shape.points.length>0){var r=this.graph.gridSize*this.graph.view.scale/2,i=this.shape.points[0];Math.abs(i.x-n.getGraphX())<r&&(t.x=i.x);Math.abs(i.y-n.getGraphY())<r&&(t.y=i.y)}};mxConnectionHandler.prototype.mouseMove=function(n,t){var e,r,o,nt,tt,p,it,v,w,rt,f,b,s,h,c,y,d,u;if(t.isConsumed()||!this.ignoreMouseDown&&this.first==null&&this.graph.isMouseDown)this.constraintHandler.reset();else{this.isEnabled()||this.currentState==null||(this.destroyIcons(),this.currentState=null);var g=this.graph.getView(),l=g.scale,a=g.translate,i=new mxPoint(t.getGraphX(),t.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(t.getEvent())&&(i=new mxPoint((this.graph.snap(i.x/l-a.x)+a.x)*l,(this.graph.snap(i.y/l-a.y)+a.y)*l)),this.snapToPreview(t,i),this.currentPoint=i,(this.first!=null||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(t,i),this.first!=null){if(e=null,r=i,this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentPoint!=null?(e=this.constraintHandler.currentConstraint,r=this.constraintHandler.currentPoint.clone()):this.previous!=null&&mxEvent.isShiftDown(t.getEvent())&&(Math.abs(this.previous.getCenterX()-i.x)<Math.abs(this.previous.getCenterY()-i.y)?i.x=this.previous.getCenterX():i.y=this.previous.getCenterY()),o=this.first,this.selectedIcon!=null&&(nt=this.selectedIcon.bounds.width,tt=this.selectedIcon.bounds.height,this.currentState!=null&&this.targetConnectImage?(p=this.getIconPosition(this.selectedIcon,this.currentState),this.selectedIcon.bounds.x=p.x,this.selectedIcon.bounds.y=p.y):(it=new mxRectangle(t.getGraphX()+this.connectIconOffset.x,t.getGraphY()+this.connectIconOffset.y,nt,tt),this.selectedIcon.bounds=it),this.selectedIcon.redraw()),this.edgeState!=null){if(this.edgeState.absolutePoints=[null,this.currentState!=null?null:r],this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),this.currentState!=null&&(e==null&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e)),v=null,this.waypoints!=null)for(v=[],u=0;u<this.waypoints.length;u++)w=this.waypoints[u].clone(),this.convertWaypoint(w),v[u]=w;this.graph.view.updatePoints(this.edgeState,v,this.previous,this.currentState);this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState);r=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1];o=this.edgeState.absolutePoints[0]}else this.currentState!=null&&this.constraintHandler.currentConstraint==null&&(f=this.getTargetPerimeterPoint(this.currentState,t),f!=null&&(r=f)),this.sourceConstraint==null&&this.previous!=null&&(rt=this.waypoints!=null&&this.waypoints.length>0?this.waypoints[0]:r,f=this.getSourcePerimeterPoint(this.previous,rt,t),f!=null&&(o=f));if(this.currentState==null&&this.movePreviewAway){f=o;this.edgeState!=null&&this.edgeState.absolutePoints.length>2&&(b=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2],b!=null&&(f=b));var s=r.x-f.x,h=r.y-f.y,k=Math.sqrt(s*s+h*h);if(k==0)return;r.x-=s*4/k;r.y-=h*4/k}this.shape==null&&(s=Math.abs(i.x-this.first.x),h=Math.abs(i.y-this.first.y),(s>this.graph.tolerance||h>this.graph.tolerance)&&(this.shape=this.createShape(),this.edgeState!=null&&this.shape.apply(this.edgeState),this.updateCurrentState(t,i)));this.shape!=null&&(this.edgeState!=null?this.shape.points=this.edgeState.absolutePoints:(c=[o],this.waypoints!=null&&(c=c.concat(this.waypoints)),c.push(r),this.shape.points=c),this.drawPreview());mxEvent.consume(t.getEvent());t.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous!=this.currentState&&this.edgeState==null?(this.destroyIcons(),this.currentState!=null&&this.error==null&&this.constraintHandler.currentConstraint==null&&(this.icons=this.createIcons(this.currentState),this.icons==null&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),t.consume())),this.previous=this.currentState):this.previous!=this.currentState||this.currentState==null||this.icons!=null||this.graph.isMouseDown||t.consume():this.constraintHandler.reset();if(!this.graph.isMouseDown&&this.currentState!=null&&this.icons!=null){for(y=!1,d=t.getSource(),u=0;u<this.icons.length&&!y;u++)y=d==this.icons[u].node||d.parentNode==this.icons[u].node;y||this.updateIcons(this.currentState,this.icons,t)}}};mxConnectionHandler.prototype.getTargetPerimeterPoint=function(n){var t=null,r=n.view,u=r.getPerimeterFunction(n),f,i;return u!=null?(f=this.waypoints!=null&&this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),i=u(r.getPerimeterBounds(n),this.edgeState,f,!1),i!=null&&(t=i)):t=new mxPoint(n.getCenterX(),n.getCenterY()),t};mxConnectionHandler.prototype.getSourcePerimeterPoint=function(n,t){var f=null,o=n.view,s=o.getPerimeterFunction(n),e=new mxPoint(n.getCenterX(),n.getCenterY()),u,r,i;return s!=null?(u=mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION,0),r=-u*(Math.PI/180),u!=0&&(t=mxUtils.getRotatedPoint(new mxPoint(t.x,t.y),Math.cos(r),Math.sin(r),e)),i=s(o.getPerimeterBounds(n),n,t,!1),i!=null&&(u!=0&&(i=mxUtils.getRotatedPoint(new mxPoint(i.x,i.y),Math.cos(-r),Math.sin(-r),e)),f=i)):f=e,f};mxConnectionHandler.prototype.updateIcons=function(){};mxConnectionHandler.prototype.isStopEvent=function(n){return n.getState()!=null};mxConnectionHandler.prototype.addWaypointForEvent=function(n){var i=mxUtils.convertPoint(this.graph.container,n.getX(),n.getY()),r=Math.abs(i.x-this.first.x),u=Math.abs(i.y-this.first.y),f=this.waypoints!=null||this.mouseDownCounter>1&&(r>this.graph.tolerance||u>this.graph.tolerance),t;f&&(this.waypoints==null&&(this.waypoints=[]),t=this.graph.view.scale,i=new mxPoint(this.graph.snap(n.getGraphX()/t)*t,this.graph.snap(n.getGraphY()/t)*t),this.waypoints.push(i))};mxConnectionHandler.prototype.mouseUp=function(n,t){if(!t.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(t)){this.addWaypointForEvent(t);t.consume();return}if(this.error==null){var r=this.previous!=null?this.previous.cell:null,i=null;this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&(i=this.constraintHandler.currentFocus.cell);i==null&&this.marker.hasValidState()&&(i=this.marker.validState.cell);this.connect(r,i,t.getEvent(),t.getCell())}else this.previous!=null&&this.marker.validState!=null&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,evt),this.error.length>0&&this.graph.validationAlert(this.error);this.destroyIcons();t.consume()}this.first!=null&&this.reset()};mxConnectionHandler.prototype.reset=function(){this.shape!=null&&(this.shape.destroy(),this.shape=null);this.destroyIcons();this.marker.reset();this.constraintHandler.reset();this.edgeState=null;this.previous=null;this.error=null;this.sourceConstraint=null;this.mouseDownCounter=0;this.first=null;this.fireEvent(new mxEventObject(mxEvent.RESET))};mxConnectionHandler.prototype.drawPreview=function(){var n=this.error==null,t;this.shape.strokewidth=this.getEdgeWidth(n);t=this.getEdgeColor(n);this.shape.stroke=t;this.shape.redraw()};mxConnectionHandler.prototype.getEdgeColor=function(n){return n?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR};mxConnectionHandler.prototype.getEdgeWidth=function(n){return n?3:1};mxConnectionHandler.prototype.connect=function(n,t,i,r){var c,v,s,y,p,e,h,w,l,o;if(t!=null||this.isCreateTarget()||this.graph.allowDanglingEdges){var u=this.graph.getModel(),a=!1,f=null;u.beginUpdate();try{if(n!=null&&t==null&&this.isCreateTarget()&&(t=this.createTargetVertex(i,n),t!=null&&(r=this.graph.getDropTarget([t],i,r),a=!0,r!=null&&this.graph.getModel().isEdge(r)?r=this.graph.getDefaultParent():(c=this.graph.getView().getState(r),c!=null&&(v=u.getGeometry(t),v.x-=c.origin.x,v.y-=c.origin.y)),this.graph.addCell(t,r))),s=this.graph.getDefaultParent(),n!=null&&t!=null&&u.getParent(n)==u.getParent(t)&&u.getParent(u.getParent(n))!=u.getRoot()&&(s=u.getParent(n),n.geometry!=null&&n.geometry.relative&&t.geometry!=null&&t.geometry.relative&&(s=u.getParent(s))),y=null,p=null,this.edgeState!=null&&(y=this.edgeState.cell.value,p=this.edgeState.cell.style),f=this.insertEdge(s,null,y,n,t,p),f!=null){if(this.graph.setConnectionConstraint(f,n,!0,this.sourceConstraint),this.graph.setConnectionConstraint(f,t,!1,this.constraintHandler.currentConstraint),this.edgeState!=null&&u.setGeometry(f,this.edgeState.cell.geometry),e=u.getGeometry(f),e==null&&(e=new mxGeometry,e.relative=!0,u.setGeometry(f,e)),this.waypoints!=null&&this.waypoints.length>0)for(h=this.graph.view.scale,w=this.graph.view.translate,e.points=[],l=0;l<this.waypoints.length;l++)o=this.waypoints[l],e.points.push(new mxPoint(o.x/h-w.x,o.y/h-w.y));if(t==null){var b=this.graph.view.translate,h=this.graph.view.scale,o=new mxPoint(this.currentPoint.x/h-b.x,this.currentPoint.y/h-b.y);o.x-=this.graph.panDx/this.graph.view.scale;o.y-=this.graph.panDy/this.graph.view.scale;e.setTerminalPoint(o,!1)}this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",f,"terminal",t,"event",i,"target",r,"terminalInserted",a))}}catch(k){mxLog.show();mxLog.debug(k.message)}finally{u.endUpdate()}this.select&&this.selectCells(f,a?t:null)}};mxConnectionHandler.prototype.selectCells=function(n){this.graph.setSelectionCell(n)};mxConnectionHandler.prototype.insertEdge=function(n,t,i,r,u,f){if(this.factoryMethod==null)return this.graph.insertEdge(n,t,i,r,u,f);var e=this.createEdge(i,r,u,f);return this.graph.addEdge(e,n,r,u)};mxConnectionHandler.prototype.createTargetVertex=function(n,t){for(var i=this.graph.getCellGeometry(t),o,f,e,s,h;i!=null&&i.relative;)t=this.graph.getModel().getParent(t),i=this.graph.getCellGeometry(t);if(o=this.graph.cloneCells([t])[0],i=this.graph.getModel().getGeometry(o),i!=null){var u=this.graph.view.translate,r=this.graph.view.scale,c=new mxPoint(this.currentPoint.x/r-u.x,this.currentPoint.y/r-u.y);i.x=Math.round(c.x-i.width/2-this.graph.panDx/r);i.y=Math.round(c.y-i.height/2-this.graph.panDy/r);f=this.getAlignmentTolerance();f>0&&(e=this.graph.view.getState(t),e!=null&&(s=e.x/r-u.x,h=e.y/r-u.y,Math.abs(s-i.x)<=f&&(i.x=Math.round(s)),Math.abs(h-i.y)<=f&&(i.y=Math.round(h))))}return o};mxConnectionHandler.prototype.getAlignmentTolerance=function(){return this.graph.isGridEnabled()?this.graph.gridSize/2:this.graph.tolerance};mxConnectionHandler.prototype.createEdge=function(n,t,i,r){var u=null,f;return this.factoryMethod!=null&&(u=this.factoryMethod(t,i,r)),u==null&&(u=new mxCell(n||""),u.setEdge(!0),u.setStyle(r),f=new mxGeometry,f.relative=!0,u.setGeometry(f)),u};mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.shape!=null&&(this.shape.destroy(),this.shape=null);this.marker!=null&&(this.marker.destroy(),this.marker=null);this.constraintHandler!=null&&(this.constraintHandler.destroy(),this.constraintHandler=null);this.changeHandler!=null&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null);this.drillHandler!=null&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null);this.escapeHandler!=null&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null)};mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5);mxConstraintHandler.prototype.graph=null;mxConstraintHandler.prototype.enabled=!0;mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR;mxConstraintHandler.prototype.isEnabled=function(){return this.enabled};mxConstraintHandler.prototype.setEnabled=function(n){this.enabled=n};mxConstraintHandler.prototype.reset=function(){if(this.focusIcons!=null){for(var n=0;n<this.focusIcons.length;n++)this.focusIcons[n].destroy();this.focusIcons=null}this.focusHighlight!=null&&(this.focusHighlight.destroy(),this.focusHighlight=null);this.currentConstraint=null;this.currentFocusArea=null;this.currentPoint=null;this.currentFocus=null;this.focusPoints=null};mxConstraintHandler.prototype.getTolerance=function(){return this.graph.getTolerance()};mxConstraintHandler.prototype.getImageForConstraint=function(){return this.pointImage};mxConstraintHandler.prototype.isEventIgnored=function(){return!1};mxConstraintHandler.prototype.isStateIgnored=function(){return!1};mxConstraintHandler.prototype.destroyIcons=function(){if(this.focusIcons!=null){for(var n=0;n<this.focusIcons.length;n++)this.focusIcons[n].destroy();this.focusIcons=null;this.focusPoints=null}};mxConstraintHandler.prototype.destroyFocusHighlight=function(){this.focusHighlight!=null&&(this.focusHighlight.destroy(),this.focusHighlight=null)};mxConstraintHandler.prototype.isKeepFocusEvent=function(n){return mxEvent.isShiftDown(n.getEvent())};mxConstraintHandler.prototype.update=function(n,t){var c,i,u,f,h;if(this.isEnabled()&&!this.isEventIgnored(n)){var e=this.getTolerance(n),l=new mxRectangle(n.getGraphX()-e,n.getGraphY()-e,2*e,2*e),a=n.getState()!=null&&!this.isStateIgnored(n.getState(),t)&&this.graph.isCellConnectable(n.getCell())?this.graph.getAllConnectionConstraints(n.getState(),t):null;if(!this.isKeepFocusEvent(n)&&(this.currentFocusArea==null||this.currentFocus==null||n.getState()!=null&&a!=null||!this.graph.getModel().isVertex(this.currentFocus.cell)||!mxUtils.intersects(this.currentFocusArea,l))&&n.getState()!=this.currentFocus)if(this.currentFocusArea=null,this.currentFocus=null,this.constraints=a,this.constraints!=null){if(this.currentFocus=n.getState(),this.currentFocusArea=new mxRectangle(n.getState().x,n.getState().y,n.getState().width,n.getState().height),this.focusIcons!=null){for(i=0;i<this.focusIcons.length;i++)this.focusIcons[i].destroy();this.focusIcons=null;this.focusPoints=null}for(this.focusIcons=[],this.focusPoints=[],i=0;i<this.constraints.length;i++){var s=this.graph.getConnectionPoint(n.getState(),this.constraints[i]),o=this.getImageForConstraint(n.getState(),this.constraints[i],s),p=o.src,w=new mxRectangle(s.x-o.width/2,s.y-o.height/2,o.width,o.height),r=new mxImageShape(w,p);r.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;r.preserveImageAspect=!1;r.init(this.graph.getView().getDecoratorPane());(mxClient.IS_QUIRKS||document.documentMode==8)&&mxEvent.addListener(r.node,"dragstart",function(n){return mxEvent.consume(n),!1});r.node.previousSibling!=null&&r.node.parentNode.insertBefore(r.node,r.node.parentNode.firstChild);h=mxUtils.bind(this,function(){return this.currentFocus!=null?this.currentFocus:n.getState()});r.redraw();mxEvent.redirectMouseEvents(r.node,this.graph,h);this.currentFocusArea.add(r.bounds);this.focusIcons.push(r);this.focusPoints.push(s)}this.currentFocusArea.grow(e)}else this.destroyIcons(),this.destroyFocusHighlight();if(this.currentConstraint=null,this.currentPoint=null,c=null,this.focusIcons!=null&&this.constraints!=null&&(n.getState()==null||this.currentFocus==n.getState()))for(i=0;i<this.focusIcons.length;i++){var v=n.getGraphX()-this.focusIcons[i].bounds.getCenterX(),y=n.getGraphY()-this.focusIcons[i].bounds.getCenterY(),u=v*v+y*y;mxUtils.intersects(this.focusIcons[i].bounds,l)&&(c==null||u<c)&&(this.currentConstraint=this.constraints[i],this.currentPoint=this.focusPoints[i],c=u,u=this.focusIcons[i].bounds.clone(),u.grow(mxClient.IS_IE?3:2),mxClient.IS_IE&&(u.width-=1,u.height-=1),this.focusHighlight==null?(f=new mxRectangleShape(u,null,this.highlightColor,3),f.pointerEvents=!1,f.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,f.init(this.graph.getView().getOverlayPane()),this.focusHighlight=f,h=mxUtils.bind(this,function(){return this.currentFocus!=null?this.currentFocus:n.getState()}),mxEvent.redirectMouseEvents(f.node,this.graph,h)):(this.focusHighlight.bounds=u,this.focusHighlight.redraw()))}this.currentConstraint==null&&this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null};mxConstraintHandler.prototype.destroy=function(){this.reset()};mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=!0;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;mxRubberband.prototype.currentX=0;mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};mxRubberband.prototype.setEnabled=function(n){this.enabled=n};mxRubberband.prototype.isForceRubberbandEvent=function(n){return mxEvent.isAltDown(n.getEvent())};mxRubberband.prototype.mouseDown=function(n,t){if(!t.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&t.getState()==null&&!mxEvent.isMultiTouchEvent(t.getEvent())){var r=mxUtils.getOffset(this.graph.container),i=mxUtils.getScrollOrigin(this.graph.container);i.x-=r.x;i.y-=r.y;this.start(t.getX()+i.x,t.getY()+i.y);t.consume(!1)}};mxRubberband.prototype.start=function(n,t){function i(n){var t=new mxMouseEvent(n),i=mxUtils.convertPoint(r,t.getX(),t.getY());return t.graphX=i.x,t.graphY=i.y,t}this.first=new mxPoint(n,t);var r=this.graph.container;this.dragHandler=mxUtils.bind(this,function(n){this.mouseMove(this.graph,i(n))});this.dropHandler=mxUtils.bind(this,function(n){this.mouseUp(this.graph,i(n))});mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)};mxRubberband.prototype.mouseMove=function(n,t){var i,r;if(!t.isConsumed()&&this.first!=null){i=mxUtils.getScrollOrigin(this.graph.container);r=mxUtils.getOffset(this.graph.container);i.x-=r.x;i.y-=r.y;var u=t.getX()+i.x,f=t.getY()+i.y,o=this.first.x-u,s=this.first.y-f,e=this.graph.tolerance;(this.div!=null||Math.abs(o)>e||Math.abs(s)>e)&&(this.div==null&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(u,f),t.consume())}};mxRubberband.prototype.createShape=function(){return this.sharedDiv==null&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv),this.sharedDiv};mxRubberband.prototype.mouseUp=function(n,t){var r=this.div!=null&&this.div.style.display!="none",i;this.reset();r&&(i=new mxRectangle(this.x,this.y,this.width,this.height),this.graph.selectRegion(i,t.getEvent()),t.consume())};mxRubberband.prototype.reset=function(){this.div!=null&&this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler);this.dragHandler=null;this.dropHandler=null;this.currentX=0;this.currentY=0;this.first=null;this.div=null};mxRubberband.prototype.update=function(n,t){this.currentX=n;this.currentY=t;this.repaint()};mxRubberband.prototype.repaint=function(){var n,t,i,r;this.div!=null&&(n=this.currentX-this.graph.panDx,t=this.currentY-this.graph.panDy,this.x=Math.min(this.first.x,n),this.y=Math.min(this.first.y,t),this.width=Math.max(this.first.x,n)-this.x,this.height=Math.max(this.first.y,t)-this.y,i=mxClient.IS_VML?this.graph.panDx:0,r=mxClient.IS_VML?this.graph.panDy:0,this.div.style.left=this.x+i+"px",this.div.style.top=this.y+r+"px",this.div.style.width=Math.max(1,this.width)+"px",this.div.style.height=Math.max(1,this.height)+"px")};mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv!=null&&(this.sharedDiv=null))};mxHandle.prototype.cursor="default";mxHandle.prototype.image=null;mxHandle.prototype.ignoreGrid=!1;mxHandle.prototype.getPosition=function(){};mxHandle.prototype.setPosition=function(){};mxHandle.prototype.execute=function(){};mxHandle.prototype.copyStyle=function(n){this.graph.setCellStyles(n,this.state.style[n],[this.state.cell])};mxHandle.prototype.processEvent=function(n){var i=this.graph.view.scale,u=this.graph.view.translate,t=new mxPoint(n.getGraphX()/i-u.x,n.getGraphY()/i-u.y),r,f;this.shape!=null&&this.shape.bounds!=null&&(t.x-=this.shape.bounds.width/i/4,t.y-=this.shape.bounds.height/i/4);r=-mxUtils.toRadians(this.getRotation());f=-mxUtils.toRadians(this.getTotalRotation())-r;t=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(t,r),this.ignoreGrid||!this.graph.isGridEnabledEvent(n.getEvent())),f));this.setPosition(this.state.getPaintBounds(),t,n);this.positionChanged();this.redraw()};mxHandle.prototype.positionChanged=function(){this.state.text!=null&&this.state.text.apply(this.state);this.state.shape!=null&&this.state.shape.apply(this.state);this.graph.cellRenderer.redraw(this.state,!0)};mxHandle.prototype.getRotation=function(){return this.state.shape!=null?this.state.shape.getRotation():0};mxHandle.prototype.getTotalRotation=function(){return this.state.shape!=null?this.state.shape.getShapeRotation():0};mxHandle.prototype.init=function(){var n=this.isHtmlRequired();this.image!=null?(this.shape=new mxImageShape(new mxRectangle(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape=this.createShape(n);this.initShape(n)};mxHandle.prototype.createShape=function(){var n=new mxRectangle(0,0,mxConstants.HANDLE_SIZE,mxConstants.HANDLE_SIZE);return new mxRectangleShape(n,mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};mxHandle.prototype.initShape=function(n){n&&this.shape.isHtmlAllowed()?(this.shape.dialect=mxConstants.DIALECT_STRICTHTML,this.shape.init(this.graph.container)):(this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,this.cursor!=null&&this.shape.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.shape.node.style.cursor=this.cursor};mxHandle.prototype.redraw=function(){var n,r,t,i;this.shape!=null&&this.state.shape!=null&&(n=this.getPosition(this.state.getPaintBounds()),n!=null&&(r=mxUtils.toRadians(this.getTotalRotation()),n=this.rotatePoint(this.flipPoint(n),r),t=this.graph.view.scale,i=this.graph.view.translate,this.shape.bounds.x=Math.floor((n.x+i.x)*t-this.shape.bounds.width/2),this.shape.bounds.y=Math.floor((n.y+i.y)*t-this.shape.bounds.height/2),this.shape.redraw()))};mxHandle.prototype.isHtmlRequired=function(){return this.state.text!=null&&this.state.text.node.parentNode==this.graph.container};mxHandle.prototype.rotatePoint=function(n,t){var i=this.state.getCellBounds(),r=new mxPoint(i.getCenterX(),i.getCenterY()),u=Math.cos(t),f=Math.sin(t);return mxUtils.getRotatedPoint(n,u,f,r)};mxHandle.prototype.flipPoint=function(n){if(this.state.shape!=null){var t=this.state.getCellBounds();this.state.shape.flipH&&(n.x=2*t.x+t.width-n.x);this.state.shape.flipV&&(n.y=2*t.y+t.height-n.y)}return n};mxHandle.prototype.snapPoint=function(n,t){return t||(n.x=this.graph.snap(n.x),n.y=this.graph.snap(n.y)),n};mxHandle.prototype.setVisible=function(n){this.shape!=null&&this.shape.node!=null&&(this.shape.node.style.display=n?"":"none")};mxHandle.prototype.reset=function(){this.setVisible(!0);this.state.style=this.graph.getCellStyle(this.state.cell);this.positionChanged()};mxHandle.prototype.destroy=function(){this.shape!=null&&(this.shape.destroy(),this.shape=null)};mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=!1;mxVertexHandler.prototype.index=null;mxVertexHandler.prototype.allowHandleBoundsCheck=!0;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;mxVertexHandler.prototype.rotationEnabled=!1;mxVertexHandler.prototype.parentHighlightEnabled=!1;mxVertexHandler.prototype.rotationRaster=!0;mxVertexHandler.prototype.rotationCursor="crosshair";mxVertexHandler.prototype.livePreview=!1;mxVertexHandler.prototype.manageSizers=!1;mxVertexHandler.prototype.constrainGroupByChildren=!1;mxVertexHandler.prototype.rotationHandleVSpacing=-16;mxVertexHandler.prototype.horizontalOffset=0;mxVertexHandler.prototype.verticalOffset=0;mxVertexHandler.prototype.init=function(){var t,n,i;this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.pointerEvents=!1;this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");this.selectionBorder.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX);(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&(t=this.graph.isCellResizable(this.state.cell),this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2?(n=0,t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",n++)),this.sizers.push(this.createSizer("n-resize",n++)),this.sizers.push(this.createSizer("ne-resize",n++)),this.sizers.push(this.createSizer("w-resize",n++)),this.sizers.push(this.createSizer("e-resize",n++)),this.sizers.push(this.createSizer("sw-resize",n++)),this.sizers.push(this.createSizer("s-resize",n++))),this.sizers.push(this.createSizer("se-resize",n++))),i=this.graph.model.getGeometry(this.state.cell),i==null||i.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))):this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape)));this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape));this.customHandles=this.createCustomHandles();this.redraw();this.constrainGroupByChildren&&this.updateMinBounds()};mxVertexHandler.prototype.isRotationHandleVisible=function(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&this.state.width>=2&&this.state.height>=2};mxVertexHandler.prototype.isConstrainedEvent=function(n){return mxEvent.isShiftDown(n.getEvent())||this.state.style[mxConstants.STYLE_ASPECT]=="fixed"};mxVertexHandler.prototype.createCustomHandles=function(){return null};mxVertexHandler.prototype.updateMinBounds=function(){var i=this.graph.getChildCells(this.state.cell),n,t;i.length>0&&(this.minBounds=this.graph.view.getBounds(i),this.minBounds!=null&&(n=this.state.view.scale,t=this.state.view.translate,this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=n,this.minBounds.y/=n,this.minBounds.width/=n,this.minBounds.height/=n,this.x0=this.state.x/n-t.x,this.y0=this.state.y/n-t.y))};mxVertexHandler.prototype.getSelectionBounds=function(n){return new mxRectangle(Math.round(n.x),Math.round(n.y),Math.round(n.width),Math.round(n.height))};mxVertexHandler.prototype.createParentHighlightShape=function(n){return this.createSelectionShape(n)};mxVertexHandler.prototype.createSelectionShape=function(n){var t=new mxRectangleShape(n,null,this.getSelectionColor());return t.strokewidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t};mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};mxVertexHandler.prototype.createSizer=function(n,t,i,r){i=i||mxConstants.HANDLE_SIZE;var f=new mxRectangle(0,0,i,i),u=this.createSizerShape(f,t,r);return u.isHtmlAllowed()&&this.state.text!=null&&this.state.text.node.parentNode==this.graph.container?(u.bounds.height-=1,u.bounds.width-=1,u.dialect=mxConstants.DIALECT_STRICTHTML,u.init(this.graph.container)):(u.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,u.init(this.graph.getView().getOverlayPane())),mxEvent.redirectMouseEvents(u.node,this.graph,this.state),this.graph.isEnabled()&&u.setCursor(n),this.isSizerVisible(t)||(u.node.style.visibility="hidden"),u};mxVertexHandler.prototype.isSizerVisible=function(){return!0};mxVertexHandler.prototype.createSizerShape=function(n,t,i){if(this.handleImage!=null){n=new mxRectangle(n.x,n.y,this.handleImage.width,this.handleImage.height);var r=new mxImageShape(n,this.handleImage.src);return r.preserveImageAspect=!1,r}return t==mxEvent.ROTATION_HANDLE?new mxEllipse(n,i||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(n,i||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};mxVertexHandler.prototype.moveSizerTo=function(n,t,i){n!=null&&(n.bounds.x=Math.round(t-n.bounds.width/2),n.bounds.y=Math.round(i-n.bounds.height/2),n.node!=null&&n.node.style.display!="none"&&n.redraw())};mxVertexHandler.prototype.getHandleForEvent=function(n){function r(t){return t!=null&&(n.isSource(t)||u!=null&&mxUtils.intersects(t.bounds,u)&&t.node.style.display!="none"&&t.node.style.visibility!="hidden")}var i=mxEvent.isMouseEvent(n.getEvent())?1:this.tolerance,u=this.allowHandleBoundsCheck&&(mxClient.IS_IE||i>0)?new mxRectangle(n.getGraphX()-i,n.getGraphY()-i,2*i,2*i):null,t;if(this.customHandles!=null&&this.isCustomHandleEvent(n))for(t=this.customHandles.length-1;t>=0;t--)if(r(this.customHandles[t].shape))return mxEvent.CUSTOM_HANDLE-t;if(r(this.rotationShape))return mxEvent.ROTATION_HANDLE;if(r(this.labelShape))return mxEvent.LABEL_HANDLE;if(this.sizers!=null)for(t=0;t<this.sizers.length;t++)if(r(this.sizers[t]))return t;return null};mxVertexHandler.prototype.isCustomHandleEvent=function(){return!0};mxVertexHandler.prototype.mouseDown=function(n,t){var r=mxEvent.isMouseEvent(t.getEvent())?0:this.tolerance,i;!t.isConsumed()&&this.graph.isEnabled()&&(r>0||t.getState()==this.state)&&(i=this.getHandleForEvent(t),i!=null&&(this.start(t.getGraphX(),t.getGraphY(),i),t.consume()))};mxVertexHandler.prototype.isLivePreviewBorder=function(){return this.state.shape!=null&&this.state.shape.fill==null&&this.state.shape.stroke==null};mxVertexHandler.prototype.start=function(n,t,i){var u,r,e,f,o;if(this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=n,this.startY=t,u=this.state.view.graph.model,r=u.getParent(this.state.cell),this.state.view.currentRoot!=r&&(u.isVertex(r)||u.isEdge(r))&&(this.parentState=this.state.view.graph.view.getState(r)),this.selectionBorder.node.style.display=i==mxEvent.ROTATION_HANDLE?"inline":"none",(!this.livePreview||this.isLivePreviewBorder())&&(this.preview=this.createSelectionShape(this.bounds),mxClient.IS_SVG&&Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")!=0||this.state.text==null||this.state.text.node.parentNode!=this.graph.container?(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container))),this.livePreview)for(this.hideSizers(),i==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":this.sizers!=null&&this.sizers[i]!=null?this.sizers[i].node.style.display="":i<=mxEvent.CUSTOM_HANDLE&&this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-i].setVisible(!0),e=this.graph.getEdges(this.state.cell),this.edgeHandlers=[],f=0;f<e.length;f++)o=this.graph.selectionCellsHandler.getHandler(e[f]),o!=null&&this.edgeHandlers.push(o)};mxVertexHandler.prototype.setHandlesVisible=function(n){var t;if(this.sizers!=null)for(t=0;t<this.sizers.length;t++)this.sizers[t].node.style.display=n?"":"none";if(this.customHandles!=null)for(t=0;t<this.customHandles.length;t++)this.customHandles[t].setVisible(n)};mxVertexHandler.prototype.hideSizers=function(){this.setHandlesVisible(!1)};mxVertexHandler.prototype.checkTolerance=function(n){this.inTolerance&&this.startX!=null&&this.startY!=null&&(mxEvent.isMouseEvent(n.getEvent())||Math.abs(n.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(n.getGraphY()-this.startY)>this.graph.tolerance)&&(this.inTolerance=!1)};mxVertexHandler.prototype.updateHint=function(){};mxVertexHandler.prototype.removeHint=function(){};mxVertexHandler.prototype.roundAngle=function(n){return Math.round(n*10)/10};mxVertexHandler.prototype.roundLength=function(n){return Math.round(n)};mxVertexHandler.prototype.mouseMove=function(n,t){t.isConsumed()||this.index==null?this.graph.isMouseDown||this.getHandleForEvent(t)==null||t.consume(!1):(this.checkTolerance(t),this.inTolerance||(this.index<=mxEvent.CUSTOM_HANDLE?this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(t):this.index==mxEvent.LABEL_HANDLE?this.moveLabel(t):this.index==mxEvent.ROTATION_HANDLE?this.rotateVertex(t):this.resizeVertex(t),this.updateHint(t)),t.consume())};mxVertexHandler.prototype.moveLabel=function(n){var t=new mxPoint(n.getGraphX(),n.getGraphY()),i=this.graph.view.translate,r=this.graph.view.scale;this.graph.isGridEnabledEvent(n.getEvent())&&(t.x=(this.graph.snap(t.x/r-i.x)+i.x)*r,t.y=(this.graph.snap(t.y/r-i.y)+i.y)*r);this.moveSizerTo(this.sizers[this.sizers.length-1],t.x,t.y)};mxVertexHandler.prototype.rotateVertex=function(n){var i=new mxPoint(n.getGraphX(),n.getGraphY()),t=this.state.x+this.state.width/2-i.x,r=this.state.y+this.state.height/2-i.y;if(this.currentAlpha=t!=0?Math.atan(r/t)*180/Math.PI+90:r<0?180:0,t>0&&(this.currentAlpha-=180),this.rotationRaster&&this.graph.isGridEnabledEvent(n.getEvent())){var t=i.x-this.state.getCenterX(),r=i.y-this.state.getCenterY(),f=Math.abs(Math.sqrt(t*t+r*r)-20)*3,u=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(f)))));this.currentAlpha=Math.round(this.currentAlpha/u)*u}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha;this.selectionBorder.redraw();this.livePreview&&this.redrawHandles()};mxVertexHandler.prototype.resizeVertex=function(n){var c=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),e=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),l=new mxPoint(n.getGraphX(),n.getGraphY()),a=this.graph.view.translate,t=this.graph.view.scale,i=Math.cos(-e),r=Math.sin(-e),u=l.x-this.startX,f=l.y-this.startY,w=i*u-r*f,b=r*u+i*f,o;u=w;f=b;o=this.graph.getCellGeometry(this.state.cell);this.unscaledBounds=this.union(o,u/t,f/t,this.index,this.graph.isGridEnabledEvent(n.getEvent()),1,new mxPoint(0,0),this.isConstrainedEvent(n));this.bounds=new mxRectangle((this.parentState!=null?this.parentState.x:a.x*t)+this.unscaledBounds.x*t,(this.parentState!=null?this.parentState.y:a.y*t)+this.unscaledBounds.y*t,this.unscaledBounds.width*t,this.unscaledBounds.height*t);o.relative&&this.parentState!=null&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y);i=Math.cos(e);r=Math.sin(e);var v=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY()),u=v.x-c.x,f=v.y-c.y,k=i*u-r*f,d=r*u+i*f,s=k-u,h=d-f,y=this.bounds.x-this.state.x,p=this.bounds.y-this.state.y,g=i*y-r*p,nt=r*y+i*p;this.bounds.x+=s;this.bounds.y+=h;this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+s/t);this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+h/t);this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width);this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height);this.graph.isCellCollapsed(this.state.cell)||s==0&&h==0?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+g,this.childOffsetY=this.state.y-this.bounds.y+nt);this.livePreview&&this.updateLivePreview(n);this.preview!=null&&this.drawPreview()};mxVertexHandler.prototype.updateLivePreview=function(){var u=this.graph.view.scale,f=this.graph.view.translate,t=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height),e=this.state.origin,n,i,r;this.state.x=this.bounds.x;this.state.y=this.bounds.y;this.state.origin=new mxPoint(this.state.x/u-f.x,this.state.y/u-f.y);this.state.width=this.bounds.width;this.state.height=this.bounds.height;n=this.state.absoluteOffset;n=new mxPoint(n.x,n.y);this.state.absoluteOffset.x=0;this.state.absoluteOffset.y=0;i=this.graph.getCellGeometry(this.state.cell);i!=null&&(r=i.offset||this.EMPTY_POINT,r==null||i.relative||(this.state.absoluteOffset.x=this.state.view.scale*r.x,this.state.absoluteOffset.y=this.state.view.scale*r.y),this.state.view.updateVertexLabelOffset(this.state));this.state.view.graph.cellRenderer.redraw(this.state,!0);this.state.view.invalidate(this.state.cell);this.state.invalid=!1;this.state.view.validate();this.redrawHandles();this.state.x=t.x;this.state.y=t.y;this.state.width=t.width;this.state.height=t.height;this.state.origin=e;this.state.absoluteOffset=n};mxVertexHandler.prototype.mouseUp=function(n,t){var u,f,e,c;if(this.index!=null&&this.state!=null){u=new mxPoint(t.getGraphX(),t.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index<=mxEvent.CUSTOM_HANDLE)this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute();else if(this.index==mxEvent.ROTATION_HANDLE)this.currentAlpha!=null?(f=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0),f!=0&&this.rotateCell(this.state.cell,f)):this.rotateClick();else{var l=this.graph.isGridEnabledEvent(t.getEvent()),o=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),s=Math.cos(-o),h=Math.sin(-o),i=u.x-this.startX,r=u.y-this.startY,a=s*i-h*r,v=h*i+s*r;i=a;r=v;e=this.graph.view.scale;c=this.isRecursiveResize(this.state,t);this.resizeCell(this.state.cell,this.roundLength(i/e),this.roundLength(r/e),this.index,l,this.isConstrainedEvent(t),c)}}finally{this.graph.getModel().endUpdate()}t.consume();this.reset()}};mxVertexHandler.prototype.isRecursiveResize=function(){return this.graph.isRecursiveResize(this.state)};mxVertexHandler.prototype.rotateClick=function(){};mxVertexHandler.prototype.rotateCell=function(n,t,i){var r,o,s,h,u,f,c,e;if(t!=0&&(r=this.graph.getModel(),(r.isVertex(n)||r.isEdge(n))&&(r.isEdge(n)||(o=this.graph.view.getState(n),s=o!=null?o.style:this.graph.getCellStyle(n),s!=null&&(h=(s[mxConstants.STYLE_ROTATION]||0)+t,this.graph.setCellStyles(mxConstants.STYLE_ROTATION,h,[n]))),u=this.graph.getCellGeometry(n),u!=null&&(f=this.graph.getCellGeometry(i),f==null||r.isEdge(i)||(u=u.clone(),u.rotate(t,new mxPoint(f.width/2,f.height/2)),r.setGeometry(n,u)),r.isVertex(n)&&!u.relative||r.isEdge(n)))))for(c=r.getChildCount(n),e=0;e<c;e++)this.rotateCell(r.getChildAt(n,e),t,n)};mxVertexHandler.prototype.reset=function(){var n;if(this.sizers!=null&&this.index!=null&&this.sizers[this.index]!=null&&this.sizers[this.index].node.style.display=="none"&&(this.sizers[this.index].node.style.display=""),this.currentAlpha=null,this.inTolerance=null,this.index=null,this.preview!=null&&(this.preview.destroy(),this.preview=null),this.livePreview&&this.sizers!=null)for(n=0;n<this.sizers.length;n++)this.sizers[n]!=null&&(this.sizers[n].node.style.display="");if(this.customHandles!=null)for(n=0;n<this.customHandles.length;n++)this.customHandles[n].reset();this.selectionBorder!=null&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview());this.removeHint();this.redrawHandles();this.edgeHandlers=null;this.unscaledBounds=null};mxVertexHandler.prototype.resizeCell=function(n,t,i,r,u,f,e){var o=this.graph.model.getGeometry(n),s;o!=null&&(r==mxEvent.LABEL_HANDLE?(s=this.graph.view.scale,t=Math.round((this.labelShape.bounds.getCenterX()-this.startX)/s),i=Math.round((this.labelShape.bounds.getCenterY()-this.startY)/s),o=o.clone(),o.offset==null?o.offset=new mxPoint(t,i):(o.offset.x+=t,o.offset.y+=i),this.graph.model.setGeometry(n,o)):this.unscaledBounds!=null&&(s=this.graph.view.scale,(this.childOffsetX!=0||this.childOffsetY!=0)&&this.moveChildren(n,Math.round(this.childOffsetX/s),Math.round(this.childOffsetY/s)),this.graph.resizeCell(n,this.unscaledBounds,e)))};mxVertexHandler.prototype.moveChildren=function(n,t,i){for(var e,r,u=this.graph.getModel(),o=u.getChildCount(n),f=0;f<o;f++)e=u.getChildAt(n,f),r=this.graph.getCellGeometry(e),r!=null&&(r=r.clone(),r.translate(t,i),u.setGeometry(e,r))};mxVertexHandler.prototype.union=function(n,t,i,r,u,f,e,o){var p,w,k,h,c,b,d,a;if(this.singleSizer)return p=n.x+n.width+t,w=n.y+n.height+i,u&&(p=this.graph.snap(p/f)*f,w=this.graph.snap(w/f)*f),k=new mxRectangle(n.x,n.y,0,0),k.add(new mxRectangle(p,w,0,0)),k;var l=n.x-e.x*f,y=l+n.width,s=n.y-e.y*f,v=s+n.height;return r>4?(v=v+i,u&&(v=this.graph.snap(v/f)*f)):r<3&&(s=s+i,u&&(s=this.graph.snap(s/f)*f)),r==0||r==3||r==5?(l+=t,u&&(l=this.graph.snap(l/f)*f)):(r==2||r==4||r==7)&&(y+=t,u&&(y=this.graph.snap(y/f)*f)),h=y-l,c=v-s,o&&(b=this.graph.getCellGeometry(this.state.cell),b!=null&&(d=b.width/b.height,r==1||r==2||r==7||r==6?h=c*d:c=h/d,r==0&&(l=y-h,s=v-c))),h<0&&(l+=h,h=Math.abs(h)),c<0&&(s+=c,c=Math.abs(c)),a=new mxRectangle(l+e.x*f,s+e.y*f,h,c),this.minBounds!=null&&(a.width=Math.max(a.width,this.minBounds.x*f+this.minBounds.width*f+Math.max(0,this.x0*f-a.x)),a.height=Math.max(a.height,this.minBounds.y*f+this.minBounds.height*f+Math.max(0,this.y0*f-a.y))),a};mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.redrawHandles();this.drawPreview()};mxVertexHandler.prototype.redrawHandles=function(){var t,e,h,c,l,a,s;if(this.horizontalOffset=0,this.verticalOffset=0,t=this.bounds,this.sizers!=null&&this.sizers.length>0)if(this.index==null&&this.manageSizers&&this.sizers.length>=8&&(e=this.tolerance,(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e)&&(t=new mxRectangle(t.x,t.y,t.width,t.height),e/=2,this.horizontalOffset=this.sizers[0].bounds.width+e,this.verticalOffset=this.sizers[0].bounds.height+e,t.x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))),h=t.x+t.width,c=t.y+t.height,this.singleSizer)this.moveSizerTo(this.sizers[0],h,c);else if(l=t.x+t.width/2,a=t.y+t.height/2,this.sizers.length>=8){var i=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],v=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),r=Math.cos(v),u=Math.sin(v),o=Math.round(v*4/Math.PI),f=new mxPoint(t.getCenterX(),t.getCenterY()),n=mxUtils.getRotatedPoint(new mxPoint(t.x,t.y),r,u,f);this.moveSizerTo(this.sizers[0],n.x,n.y);this.sizers[0].setCursor(i[mxUtils.mod(0+o,i.length)]);n.x=l;n.y=t.y;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[1],n.x,n.y);this.sizers[1].setCursor(i[mxUtils.mod(1+o,i.length)]);n.x=h;n.y=t.y;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[2],n.x,n.y);this.sizers[2].setCursor(i[mxUtils.mod(2+o,i.length)]);n.x=t.x;n.y=a;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[3],n.x,n.y);this.sizers[3].setCursor(i[mxUtils.mod(7+o,i.length)]);n.x=h;n.y=a;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[4],n.x,n.y);this.sizers[4].setCursor(i[mxUtils.mod(3+o,i.length)]);n.x=t.x;n.y=c;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[5],n.x,n.y);this.sizers[5].setCursor(i[mxUtils.mod(6+o,i.length)]);n.x=l;n.y=c;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[6],n.x,n.y);this.sizers[6].setCursor(i[mxUtils.mod(5+o,i.length)]);n.x=h;n.y=c;n=mxUtils.getRotatedPoint(n,r,u,f);this.moveSizerTo(this.sizers[7],n.x,n.y);this.sizers[7].setCursor(i[mxUtils.mod(4+o,i.length)]);this.moveSizerTo(this.sizers[8],l+this.state.absoluteOffset.x,a+this.state.absoluteOffset.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],l+this.state.absoluteOffset.x,a+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y);if(this.rotationShape!=null){var v=mxUtils.toRadians(this.currentAlpha!=null?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),r=Math.cos(v),u=Math.sin(v),f=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),n=mxUtils.getRotatedPoint(new mxPoint(t.x+t.width/2,t.y+this.rotationHandleVSpacing),r,u,f);this.rotationShape.node!=null&&this.moveSizerTo(this.rotationShape,n.x,n.y)}if(this.selectionBorder!=null&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),this.edgeHandlers!=null)for(s=0;s<this.edgeHandlers.length;s++)this.edgeHandlers[s].redraw();if(this.customHandles!=null)for(s=0;s<this.customHandles.length;s++)this.customHandles[s].redraw();this.updateParentHighlight()};mxVertexHandler.prototype.updateParentHighlight=function(){var i,t,n;this.selectionBorder!=null&&(this.parentHighlight!=null?(t=this.graph.model.getParent(this.state.cell),this.graph.model.isVertex(t)?(n=this.graph.view.getState(t),i=this.parentHighlight.bounds,n!=null&&(i.x!=n.x||i.y!=n.y||i.width!=n.width||i.height!=n.height)&&(this.parentHighlight.bounds=n,this.parentHighlight.redraw())):(this.parentHighlight.destroy(),this.parentHighlight=null)):this.parentHighlightEnabled&&(t=this.graph.model.getParent(this.state.cell),this.graph.model.isVertex(t)&&(n=this.graph.view.getState(t),n!=null&&(this.parentHighlight=this.createParentHighlightShape(n),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(n.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane())))))};mxVertexHandler.prototype.drawPreview=function(){this.preview!=null&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw());this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw();this.parentHighlight!=null&&this.parentHighlight.redraw()};mxVertexHandler.prototype.destroy=function(){var n;if(this.escapeHandler!=null&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null),this.preview!=null&&(this.preview.destroy(),this.preview=null),this.parentHighlight!=null&&(this.parentHighlight.destroy(),this.parentHighlight=null),this.selectionBorder.destroy(),this.selectionBorder=null,this.labelShape=null,this.removeHint(),this.sizers!=null){for(n=0;n<this.sizers.length;n++)this.sizers[n].destroy();this.sizers=null}if(this.customHandles!=null){for(n=0;n<this.customHandles.length;n++)this.customHandles[n].destroy();this.customHandles=null}};mxEdgeHandler.prototype.graph=null;mxEdgeHandler.prototype.state=null;mxEdgeHandler.prototype.marker=null;mxEdgeHandler.prototype.constraintHandler=null;mxEdgeHandler.prototype.error=null;mxEdgeHandler.prototype.shape=null;mxEdgeHandler.prototype.bends=null;mxEdgeHandler.prototype.labelShape=null;mxEdgeHandler.prototype.cloneEnabled=!0;mxEdgeHandler.prototype.addEnabled=!1;mxEdgeHandler.prototype.removeEnabled=!1;mxEdgeHandler.prototype.dblClickRemoveEnabled=!1;mxEdgeHandler.prototype.mergeRemoveEnabled=!1;mxEdgeHandler.prototype.straightRemoveEnabled=!1;mxEdgeHandler.prototype.virtualBendsEnabled=!1;mxEdgeHandler.prototype.virtualBendOpacity=20;mxEdgeHandler.prototype.parentHighlightEnabled=!1;mxEdgeHandler.prototype.preferHtml=!1;mxEdgeHandler.prototype.allowHandleBoundsCheck=!0;mxEdgeHandler.prototype.snapToTerminals=!1;mxEdgeHandler.prototype.handleImage=null;mxEdgeHandler.prototype.tolerance=0;mxEdgeHandler.prototype.outlineConnect=!1;mxEdgeHandler.prototype.manageLabelHandle=!1;mxEdgeHandler.prototype.init=function(){var n,t,r,i;this.graph=this.state.view.graph;this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.points=[];this.abspoints=this.getSelectionPoints(this.state);this.shape=this.createSelectionShape(this.abspoints);this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;this.shape.init(this.graph.getView().getOverlayPane());this.shape.pointerEvents=!1;this.shape.setCursor(mxConstants.CURSOR_MOVABLE_EDGE);mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.preferHtml=this.state.text!=null&&this.state.text.node.parentNode==this.graph.container;this.preferHtml||(n=this.state.getVisibleTerminalState(!0),n!=null&&(this.preferHtml=n.text!=null&&n.text.node.parentNode==this.graph.container),this.preferHtml||(t=this.state.getVisibleTerminalState(!1),t!=null&&(this.preferHtml=t.text!=null&&t.text.node.parentNode==this.graph.container)));this.parentHighlightEnabled&&(r=this.graph.model.getParent(this.state.cell),this.graph.model.isVertex(r)&&(i=this.graph.view.getState(r),i!=null&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(i.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))));(this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells||mxGraphHandler.prototype.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends()));this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape=this.createLabelHandleShape();this.initBend(this.labelShape);this.labelShape.setCursor(mxConstants.CURSOR_LABEL_HANDLE);this.customHandles=this.createCustomHandles();this.redraw()};mxEdgeHandler.prototype.createCustomHandles=function(){return null};mxEdgeHandler.prototype.isVirtualBendsEnabled=function(){return this.virtualBendsEnabled&&(this.state.style[mxConstants.STYLE_EDGE]==null||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.NONE||this.state.style[mxConstants.STYLE_NOEDGESTYLE]==1)&&mxUtils.getValue(this.state.style,mxConstants.STYLE_SHAPE,null)!="arrow"};mxEdgeHandler.prototype.isAddPointEvent=function(n){return mxEvent.isShiftDown(n)};mxEdgeHandler.prototype.isRemovePointEvent=function(n){return mxEvent.isShiftDown(n)};mxEdgeHandler.prototype.getSelectionPoints=function(n){return n.absolutePoints};mxEdgeHandler.prototype.createParentHighlightShape=function(n){var t=new mxRectangleShape(n,null,this.getSelectionColor());return t.strokewidth=this.getSelectionStrokeWidth(),t.isDashed=this.isSelectionDashed(),t};mxEdgeHandler.prototype.createSelectionShape=function(){var n=new this.state.shape.constructor;return n.outline=!0,n.apply(this.state),n.isDashed=this.isSelectionDashed(),n.stroke=this.getSelectionColor(),n.isShadow=!1,n};mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR};mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH};mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED};mxEdgeHandler.prototype.isConnectableCell=function(){return!0};mxEdgeHandler.prototype.getCellAt=function(n,t){return this.outlineConnect?null:this.graph.getCellAt(n,t)};mxEdgeHandler.prototype.createMarker=function(){var t=new mxCellMarker(this.graph),n=this;return t.getCell=function(t){var i=mxCellMarker.prototype.getCell.apply(this,arguments),r=n.getPointForEvent(t),u;return(i==n.state.cell||i==null)&&(i=n.getCellAt(r.x,r.y),n.state.cell==i&&(i=null)),u=n.graph.getModel(),(this.graph.isSwimlane(i)&&this.graph.hitsSwimlaneContent(i,r.x,r.y)||!n.isConnectableCell(i)||i==n.state.cell||i!=null&&!n.graph.connectableEdges&&u.isEdge(i)||u.isAncestor(n.state.cell,i))&&(i=null),i},t.isValidState=function(t){var u=n.graph.getModel(),i=n.graph.view.getTerminalPort(t,n.graph.view.getState(u.getTerminal(n.state.cell,!n.isSource)),!n.isSource),r=i!=null?i.cell:null,f=n.isSource?t.cell:r,e=n.isSource?r:t.cell;return n.error=n.validateConnection(f,e),n.error==null},t};mxEdgeHandler.prototype.validateConnection=function(n,t){return this.graph.getEdgeValidationError(this.state.cell,n,t)};mxEdgeHandler.prototype.createBends=function(){for(var r=this.state.cell,i=[],n=0;n<this.abspoints.length;n++)if(this.isHandleVisible(n)){var u=n==0,f=n==this.abspoints.length-1,t=u||f;(t||this.graph.isCellBendable(r))&&mxUtils.bind(this,function(r){var u=this.createHandleShape(r);this.initBend(u,mxUtils.bind(this,mxUtils.bind(this,function(){this.dblClickRemoveEnabled&&this.removePoint(this.state,r)})));this.isHandleEnabled(n)&&u.setCursor(t?mxConstants.CURSOR_TERMINAL_HANDLE:mxConstants.CURSOR_BEND_HANDLE);i.push(u);t||(this.points.push(new mxPoint(0,0)),u.node.style.visibility="hidden")})(n)}return i};mxEdgeHandler.prototype.createVirtualBends=function(){var r=this.state.cell,u=this.abspoints[0],i=[],n,t;if(this.graph.isCellBendable(r))for(n=1;n<this.abspoints.length;n++)t=this.createHandleShape(n),this.initBend(t),t.setCursor(mxConstants.CURSOR_VIRTUAL_BEND_HANDLE),i.push(t);return i};mxEdgeHandler.prototype.isHandleEnabled=function(){return!0};mxEdgeHandler.prototype.isHandleVisible=function(n){var i=this.state.getVisibleTerminalState(!0),r=this.state.getVisibleTerminalState(!1),t=this.graph.getCellGeometry(this.state.cell),u=t!=null?this.graph.view.getEdgeStyle(this.state,t.points,i,r):null;return u!=mxEdgeStyle.EntityRelation||n==0||n==this.abspoints.length-1};mxEdgeHandler.prototype.createHandleShape=function(){var t,n;return this.handleImage!=null?(t=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src),t.preserveImageAspect=!1,t):(n=mxConstants.HANDLE_SIZE,this.preferHtml&&(n-=1),new mxRectangleShape(new mxRectangle(0,0,n,n),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR))};mxEdgeHandler.prototype.createLabelHandleShape=function(){var n,t;return this.labelHandleImage!=null?(n=new mxImageShape(new mxRectangle(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src),n.preserveImageAspect=!1,n):(t=mxConstants.LABEL_HANDLE_SIZE,new mxRectangleShape(new mxRectangle(0,0,t,t),mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR))};mxEdgeHandler.prototype.initBend=function(n,t){this.preferHtml?(n.dialect=mxConstants.DIALECT_STRICTHTML,n.init(this.graph.container)):(n.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,n.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(n.node,this.graph,this.state,null,null,null,t);(mxClient.IS_QUIRKS||document.documentMode==8)&&mxEvent.addListener(n.node,"dragstart",function(n){return mxEvent.consume(n),!1});mxClient.IS_TOUCH&&n.node.setAttribute("pointer-events","none")};mxEdgeHandler.prototype.getHandleForEvent=function(n){function u(t){if(t!=null&&t.node.style.display!="none"&&t.node.style.visibility!="hidden"&&(n.isSource(t)||e!=null&&mxUtils.intersects(t.bounds,e))){var i=n.getGraphX()-t.bounds.getCenterX(),r=n.getGraphY()-t.bounds.getCenterY(),u=i*i+r*r;if(f==null||u<=f)return f=u,!0}return!1}var i=mxEvent.isMouseEvent(n.getEvent())?1:this.tolerance,e=this.allowHandleBoundsCheck&&(mxClient.IS_IE||i>0)?new mxRectangle(n.getGraphX()-i,n.getGraphY()-i,2*i,2*i):null,f=null,r=null,t;if(this.customHandles!=null&&this.isCustomHandleEvent(n))for(t=this.customHandles.length-1;t>=0;t--)if(u(this.customHandles[t].shape))return mxEvent.CUSTOM_HANDLE-t;if((n.isSource(this.state.text)||u(this.labelShape))&&(r=mxEvent.LABEL_HANDLE),this.bends!=null)for(t=0;t<this.bends.length;t++)u(this.bends[t])&&(r=t);if(this.virtualBends!=null&&this.isAddVirtualBendEvent(n))for(t=0;t<this.virtualBends.length;t++)u(this.virtualBends[t])&&(r=mxEvent.VIRTUAL_HANDLE-t);return r};mxEdgeHandler.prototype.isAddVirtualBendEvent=function(){return!0};mxEdgeHandler.prototype.isCustomHandleEvent=function(){return!0};mxEdgeHandler.prototype.mouseDown=function(n,t){var i=this.getHandleForEvent(t),r;this.bends!=null&&this.bends[i]!=null&&(r=this.bends[i].bounds,this.snapPoint=new mxPoint(r.getCenterX(),r.getCenterY()));this.addEnabled&&i==null&&this.isAddPointEvent(t.getEvent())?this.addPoint(this.state,t.getEvent()):i!=null&&!t.isConsumed()&&this.graph.isEnabled()&&(this.removeEnabled&&this.isRemovePointEvent(t.getEvent())?this.removePoint(this.state,i):(i!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(t.getCell()))&&(i<=mxEvent.VIRTUAL_HANDLE&&mxUtils.setOpacity(this.virtualBends[mxEvent.VIRTUAL_HANDLE-i].node,100),this.start(t.getX(),t.getY(),i)),t.consume())};mxEdgeHandler.prototype.start=function(n,t,i){var u,f,r;if(this.startX=n,this.startY=t,this.isSource=this.bends==null?!1:i==0,this.isTarget=this.bends==null?!1:i==this.bends.length-1,this.isLabel=i==mxEvent.LABEL_HANDLE,this.isSource||this.isTarget?(u=this.state.cell,f=this.graph.model.getTerminal(u,this.isSource),(f==null&&this.graph.isTerminalPointMovable(u,this.isSource)||f!=null&&this.graph.isCellDisconnectable(u,f,this.isSource))&&(this.index=i)):this.index=i,this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE&&this.customHandles!=null)for(r=0;r<this.customHandles.length;r++)r!=mxEvent.CUSTOM_HANDLE-this.index&&this.customHandles[r].setVisible(!1)};mxEdgeHandler.prototype.clonePreviewState=function(){return this.state.clone()};mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxEdgeHandler.prototype.updateHint=function(){};mxEdgeHandler.prototype.removeHint=function(){};mxEdgeHandler.prototype.roundLength=function(n){return Math.round(n)};mxEdgeHandler.prototype.isSnapToTerminalsEvent=function(n){return this.snapToTerminals&&!mxEvent.isAltDown(n.getEvent())};mxEdgeHandler.prototype.getPointForEvent=function(n){var u=this.graph.getView(),i=u.scale,t=new mxPoint(this.roundLength(n.getGraphX()/i)*i,this.roundLength(n.getGraphY()/i)*i),e=this.getSnapToTerminalTolerance(),o=!1,s=!1,f,r;if(e>0&&this.isSnapToTerminalsEvent(n)){function h(n){var i,r;n!=null&&(i=n.x,Math.abs(t.x-i)<e&&(t.x=i,o=!0),r=n.y,Math.abs(t.y-r)<e&&(t.y=r,s=!0))}function c(n){n!=null&&h.call(this,new mxPoint(u.getRoutingCenterX(n),u.getRoutingCenterY(n)))}if(c.call(this,this.state.getVisibleTerminalState(!0)),c.call(this,this.state.getVisibleTerminalState(!1)),this.state.absolutePoints!=null)for(f=0;f<this.state.absolutePoints.length;f++)h.call(this,this.state.absolutePoints[f])}return this.graph.isGridEnabledEvent(n.getEvent())&&(r=u.translate,o||(t.x=(this.graph.snap(t.x/i-r.x)+r.x)*i),s||(t.y=(this.graph.snap(t.y/i-r.y)+r.y)*i)),t};mxEdgeHandler.prototype.getPreviewTerminalState=function(n){var t;if(this.constraintHandler.update(n,this.isSource),this.constraintHandler.currentFocus!=null&&this.constraintHandler.currentConstraint!=null){this.marker.reset();var u=this.graph.getModel(),i=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(u.getTerminal(this.state.cell,!this.isSource)),!this.isSource),r=i!=null?i.cell:null,f=this.isSource?this.constraintHandler.currentFocus.cell:r,e=this.isSource?r:this.constraintHandler.currentFocus.cell;return this.error=this.validateConnection(f,e),t=null,this.error==null?t=this.constraintHandler.currentFocus:this.constraintHandler.reset(),t}return this.marker.process(n),this.marker.getValidState()};mxEdgeHandler.prototype.getPreviewPoints=function(n,t){var l=this.graph.getCellGeometry(this.state.cell),i=l.points!=null?l.points.slice():null,h=new mxPoint(n.x,n.y),e=null,s,c,a,r,u,f,o;if(this.isSource||this.isTarget)this.graph.resetEdgesOnConnect&&(i=null);else if(this.convertPoint(h,!1),i==null)i=[h];else{if(this.index<=mxEvent.VIRTUAL_HANDLE&&i.splice(mxEvent.VIRTUAL_HANDLE-this.index,0,h),!this.isSource&&!this.isTarget){for(s=0;s<this.bends.length;s++)s!=this.index&&(c=this.bends[s],c!=null&&mxUtils.contains(c.bounds,n.x,n.y)&&(this.index<=mxEvent.VIRTUAL_HANDLE?i.splice(mxEvent.VIRTUAL_HANDLE-this.index,1):i.splice(this.index-1,1),e=i));if(e==null&&this.straightRemoveEnabled&&(t==null||!mxEvent.isAltDown(t.getEvent()))){a=this.graph.tolerance*this.graph.tolerance;r=this.state.absolutePoints.slice();r[this.index]=n;u=this.state.getVisibleTerminalState(!0);u!=null&&(o=this.graph.getConnectionConstraint(this.state,u,!0),(o==null||this.graph.getConnectionPoint(u,o)==null)&&(r[0]=new mxPoint(u.view.getRoutingCenterX(u),u.view.getRoutingCenterY(u))));f=this.state.getVisibleTerminalState(!1);f!=null&&(o=this.graph.getConnectionConstraint(this.state,f,!1),(o==null||this.graph.getConnectionPoint(f,o)==null)&&(r[r.length-1]=new mxPoint(f.view.getRoutingCenterX(f),f.view.getRoutingCenterY(f))));function v(n,t){n>0&&n<r.length-1&&mxUtils.ptSegDistSq(r[n-1].x,r[n-1].y,r[n+1].x,r[n+1].y,t.x,t.y)<a&&(i.splice(n-1,1),e=i)}v(this.index,n)}}e==null&&this.index>mxEvent.VIRTUAL_HANDLE&&(i[this.index-1]=h)}return e!=null?e:i};mxEdgeHandler.prototype.isOutlineConnectEvent=function(n){return this.outlineConnect&&!mxEvent.isShiftDown(n.getEvent())&&(n.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(n.getEvent()))};mxEdgeHandler.prototype.updatePreviewState=function(n,t,i,r){var u=this.isSource?i:this.state.getVisibleTerminalState(!0),f=this.isTarget?i:this.state.getVisibleTerminalState(!1),o=this.graph.getConnectionConstraint(n,u,!0),s=this.graph.getConnectionConstraint(n,f,!1),e=this.constraintHandler.currentConstraint;e==null&&(i!=null&&this.isOutlineConnectEvent(r)?(e=this.graph.getOutlineConstraint(t,i,r),this.constraintHandler.currentConstraint=e,this.constraintHandler.currentFocus=i,this.constraintHandler.currentPoint=t):e=new mxConnectionConstraint);this.outlineConnect&&this.marker.highlight!=null&&this.marker.highlight.shape!=null&&(this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/this.state.view.scale/this.state.view.scale,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/this.state.view.scale/this.state.view.scale,this.marker.highlight.repaint()));this.isSource?o=e:this.isTarget&&(s=e);n.setVisibleTerminalState(u,!0);n.setVisibleTerminalState(f,!1);this.isSource&&u==null||n.view.updateFixedTerminalPoint(n,u,!0,o);this.isTarget&&f==null||n.view.updateFixedTerminalPoint(n,f,!1,s);(this.isSource||this.isTarget)&&i==null&&(n.setAbsoluteTerminalPoint(t,this.isSource),this.marker.getMarkedState()==null&&(this.error=this.graph.allowDanglingEdges?null:""));n.view.updatePoints(n,this.points,u,f);n.view.updateFloatingTerminalPoints(n,u,f)};mxEdgeHandler.prototype.mouseMove=function(n,t){var i,r,u,f;this.index!=null&&this.marker!=null?(i=this.getPointForEvent(t),this.error=null,mxEvent.isShiftDown(t.getEvent())&&this.snapPoint!=null&&(Math.abs(this.snapPoint.x-i.x)<Math.abs(this.snapPoint.y-i.y)?i.x=this.snapPoint.x:i.y=this.snapPoint.y),this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE?this.customHandles!=null&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(t):this.isLabel?(this.label.x=i.x,this.label.y=i.y):(this.points=this.getPreviewPoints(i,t),r=this.isSource||this.isTarget?this.getPreviewTerminalState(t):null,u=this.clonePreviewState(i,r!=null?r.cell:null),this.updatePreviewState(u,i,r,t),f=this.error==null?this.marker.validColor:this.marker.invalidColor,this.setPreviewColor(f),this.abspoints=u.absolutePoints,this.active=!0),this.drawPreview(),this.updateHint(t,i),mxEvent.consume(t.getEvent()),t.consume()):mxClient.IS_IE&&this.getHandleForEvent(t)!=null&&t.consume(!1)};mxEdgeHandler.prototype.mouseUp=function(n,t){var i,f,o,u,r,e;if(this.index!=null&&this.marker!=null){if(i=this.state.cell,t.getX()!=this.startX||t.getY()!=this.startY)if(f=this.graph.isCloneEvent(t.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable(),this.error!=null)this.error.length>0&&this.graph.validationAlert(this.error);else if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE){if(this.customHandles!=null){o=this.graph.getModel();o.beginUpdate();try{this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute()}finally{o.endUpdate()}}}else this.isLabel?this.moveLabel(this.state,this.label.x,this.label.y):this.isSource||this.isTarget?(u=null,this.constraintHandler.currentConstraint!=null&&this.constraintHandler.currentFocus!=null&&(u=this.constraintHandler.currentFocus.cell),u==null&&this.marker.hasValidState()&&(u=this.marker.validState.cell),u!=null?i=this.connect(i,u,this.isSource,f,t):this.graph.isAllowDanglingEdges()&&(r=this.abspoints[this.isSource?0:this.abspoints.length-1],r.x=this.roundLength(r.x/this.graph.view.scale-this.graph.view.translate.x),r.y=this.roundLength(r.y/this.graph.view.scale-this.graph.view.translate.y),e=this.graph.getView().getState(this.graph.getModel().getParent(i)),e!=null&&(r.x-=e.origin.x,r.y-=e.origin.y),r.x-=this.graph.panDx/this.graph.view.scale,r.y-=this.graph.panDy/this.graph.view.scale,i=this.changeTerminalPoint(i,r,this.isSource,f))):this.active?i=this.changePoints(i,this.points,f):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell));this.marker!=null&&(this.reset(),i!=this.state.cell&&this.graph.setSelectionCell(i));t.consume()}};mxEdgeHandler.prototype.reset=function(){var n;if(this.error=null,this.index=null,this.label=null,this.points=null,this.snapPoint=null,this.active=!1,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.livePreview&&this.sizers!=null)for(n=0;n<this.sizers.length;n++)this.sizers[n]!=null&&(this.sizers[n].node.style.display="");if(this.marker!=null&&this.marker.reset(),this.constraintHandler!=null&&this.constraintHandler.reset(),this.customHandles!=null)for(n=0;n<this.customHandles.length;n++)this.customHandles[n].reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR);this.removeHint();this.redraw()};mxEdgeHandler.prototype.setPreviewColor=function(n){this.shape!=null&&(this.shape.stroke=n)};mxEdgeHandler.prototype.convertPoint=function(n,t){var r=this.graph.getView().getScale(),u=this.graph.getView().getTranslate(),i;return t&&(n.x=this.graph.snap(n.x),n.y=this.graph.snap(n.y)),n.x=Math.round(n.x/r-u.x),n.y=Math.round(n.y/r-u.y),i=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell)),i!=null&&(n.x-=i.origin.x,n.y-=i.origin.y),n};mxEdgeHandler.prototype.moveLabel=function(n,t,i){var h=this.graph.getModel(),r=h.getGeometry(n.cell),f,u,c,l;if(r!=null){if(f=this.graph.getView().scale,r=r.clone(),r.relative)u=this.graph.getView().getRelativePoint(n,t,i),r.x=Math.round(u.x*1e4)/1e4,r.y=Math.round(u.y),r.offset=new mxPoint(0,0),u=this.graph.view.getPoint(n,r),r.offset=new mxPoint(Math.round((t-u.x)/f),Math.round((i-u.y)/f));else{var o=n.absolutePoints,e=o[0],s=o[o.length-1];e!=null&&s!=null&&(c=e.x+(s.x-e.x)/2,l=e.y+(s.y-e.y)/2,r.offset=new mxPoint(Math.round((t-c)/f),Math.round((i-l)/f)),r.x=0,r.y=0)}h.setGeometry(n.cell,r)}};mxEdgeHandler.prototype.connect=function(n,t,i,r){var u=this.graph.getModel(),o=u.getParent(n),f,s,e;u.beginUpdate();try{r&&(f=this.graph.cloneCells([n])[0],u.add(o,f,u.getChildCount(o)),s=u.getTerminal(n,!i),this.graph.connectCell(f,s,!i),n=f);e=this.constraintHandler.currentConstraint;e==null&&(e=new mxConnectionConstraint);this.graph.connectCell(n,t,i,e)}finally{u.endUpdate()}return n};mxEdgeHandler.prototype.changeTerminalPoint=function(n,t,i,r){var u=this.graph.getModel(),e,o,f;u.beginUpdate();try{r&&(e=u.getParent(n),o=u.getTerminal(n,!i),n=this.graph.cloneCells([n])[0],u.add(e,n,u.getChildCount(e)),u.setTerminal(n,o,!i));f=u.getGeometry(n);f!=null&&(f=f.clone(),f.setTerminalPoint(t,i),u.setGeometry(n,f),this.graph.connectCell(n,null,i,new mxConnectionConstraint))}finally{u.endUpdate()}return n};mxEdgeHandler.prototype.changePoints=function(n,t,i){var r=this.graph.getModel(),u;r.beginUpdate();try{if(i){var f=r.getParent(n),e=r.getTerminal(n,!0),o=r.getTerminal(n,!1);n=this.graph.cloneCells([n])[0];r.add(f,n,r.getChildCount(f));r.setTerminal(n,e,!0);r.setTerminal(n,o,!1)}u=r.getGeometry(n);u!=null&&(u=u.clone(),u.points=t,r.setGeometry(n,u))}finally{r.endUpdate()}return n};mxEdgeHandler.prototype.addPoint=function(n,t){var i=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(t),mxEvent.getClientY(t)),r=this.graph.isGridEnabledEvent(t);this.convertPoint(i,r);this.addPointAt(n,i.x,i.y);mxEvent.consume(t)};mxEdgeHandler.prototype.addPointAt=function(n,t,i){var r=this.graph.getCellGeometry(n.cell),u=new mxPoint(t,i),o,c;if(r!=null){r=r.clone();var s=this.graph.view.translate,f=this.graph.view.scale,e=new mxPoint(s.x*f,s.y*f),h=this.graph.model.getParent(this.state.cell);this.graph.model.isVertex(h)&&(o=this.graph.view.getState(h),e=new mxPoint(o.x,o.y));c=mxUtils.findNearestSegment(n,u.x*f+e.x,u.y*f+e.y);r.points==null?r.points=[u]:r.points.splice(c,0,u);this.graph.getModel().setGeometry(n.cell,r);this.refresh();this.redraw()}};mxEdgeHandler.prototype.removePoint=function(n,t){if(t>0&&t<this.abspoints.length-1){var i=this.graph.getCellGeometry(this.state.cell);i!=null&&i.points!=null&&(i=i.clone(),i.points.splice(t-1,1),this.graph.getModel().setGeometry(n.cell,i),this.refresh(),this.redraw())}};mxEdgeHandler.prototype.getHandleFillColor=function(n){var i=n==0,r=this.state.cell,t=this.graph.getModel().getTerminal(r,i),u=mxConstants.HANDLE_FILLCOLOR;return(t==null||this.graph.isCellDisconnectable(r,t,i))&&(t!=null||this.graph.isTerminalPointMovable(r,i))?t!=null&&this.graph.isCellDisconnectable(r,t,i)&&(u=mxConstants.CONNECT_HANDLE_FILLCOLOR):u=mxConstants.LOCKED_HANDLE_FILLCOLOR,u};mxEdgeHandler.prototype.redraw=function(){var i,t,n;if(this.abspoints=this.state.absolutePoints.slice(),this.redrawHandles(),i=this.graph.getModel().getGeometry(this.state.cell),t=i.points,this.bends!=null&&this.bends.length>0&&t!=null)for(this.points==null&&(this.points=[]),n=1;n<this.bends.length-1;n++)this.bends[n]!=null&&this.abspoints[n]!=null&&(this.points[n-1]=t[n-1]);this.drawPreview()};mxEdgeHandler.prototype.redrawHandles=function(){var s=this.state.cell,n=this.labelShape.bounds,u,r,t;if(this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-n.width/2),Math.round(this.label.y-n.height/2),n.width,n.height),u=this.graph.getLabel(s),this.labelShape.visible=u!=null&&u.length>0&&this.graph.isLabelMovable(s),this.bends!=null&&this.bends.length>0){var h=this.abspoints.length-1,f=this.abspoints[0],c=f.x,l=f.y;n=this.bends[0].bounds;this.bends[0].bounds=new mxRectangle(Math.round(c-n.width/2),Math.round(l-n.height/2),n.width,n.height);this.bends[0].fill=this.getHandleFillColor(0);this.bends[0].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);var e=this.abspoints[h],a=e.x,v=e.y,i=this.bends.length-1;n=this.bends[i].bounds;this.bends[i].bounds=new mxRectangle(Math.round(a-n.width/2),Math.round(v-n.height/2),n.width,n.height);this.bends[i].fill=this.getHandleFillColor(i);this.bends[i].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[i].bounds);this.redrawInnerBends(f,e)}if(this.abspoints!=null&&this.virtualBends!=null&&this.virtualBends.length>0)for(r=this.abspoints[0],t=0;t<this.virtualBends.length;t++)if(this.virtualBends[t]!=null&&this.abspoints[t+1]!=null){var o=this.abspoints[t+1],n=this.virtualBends[t],y=r.x+(o.x-r.x)/2,p=r.y+(o.y-r.y)/2;n.bounds=new mxRectangle(Math.round(y-n.bounds.width/2),Math.round(p-n.bounds.height/2),n.bounds.width,n.bounds.height);n.redraw();mxUtils.setOpacity(n.node,this.virtualBendOpacity);r=o;this.manageLabelHandle&&this.checkLabelHandle(n.bounds)}if(this.labelShape!=null&&this.labelShape.redraw(),this.customHandles!=null)for(t=0;t<this.customHandles.length;t++)this.customHandles[t].redraw()};mxEdgeHandler.prototype.setHandlesVisible=function(n){var t;if(this.bends!=null)for(t=0;t<this.bends.length;t++)this.bends[t].node.style.display=n?"":"none";if(this.virtualBends!=null)for(t=0;t<this.virtualBends.length;t++)this.virtualBends[t].node.style.display=n?"":"none";if(this.labelShape!=null&&(this.labelShape.node.style.display=n?"":"none"),this.customHandles!=null)for(t=0;t<this.customHandles.length;t++)this.customHandles[t].setVisible(n)};mxEdgeHandler.prototype.redrawInnerBends=function(){for(var n=1;n<this.bends.length-1;n++)if(this.bends[n]!=null)if(this.abspoints[n]!=null){var i=this.abspoints[n].x,r=this.abspoints[n].y,t=this.bends[n].bounds;this.bends[n].node.style.visibility="visible";this.bends[n].bounds=new mxRectangle(Math.round(i-t.width/2),Math.round(r-t.height/2),t.width,t.height);this.manageLabelHandle?this.checkLabelHandle(this.bends[n].bounds):this.handleImage==null&&this.labelShape.visible&&mxUtils.intersects(this.bends[n].bounds,this.labelShape.bounds)&&(w=mxConstants.HANDLE_SIZE+3,h=mxConstants.HANDLE_SIZE+3,this.bends[n].bounds=new mxRectangle(Math.round(i-w/2),Math.round(r-h/2),w,h));this.bends[n].redraw()}else this.bends[n].destroy(),this.bends[n]=null};mxEdgeHandler.prototype.checkLabelHandle=function(n){if(this.labelShape!=null){var t=this.labelShape.bounds;mxUtils.intersects(n,t)&&(t.y=n.getCenterY()<t.getCenterY()?n.y+n.height:n.y-t.height)}};mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var n=this.labelShape.bounds,t=new mxRectangle(Math.round(this.label.x-n.width/2),Math.round(this.label.y-n.height/2),n.width,n.height);this.labelShape.bounds=t;this.labelShape.redraw()}else this.shape!=null&&(this.shape.apply(this.state),this.shape.points=this.abspoints,this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokewidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.arrowStrokewidth=this.getSelectionStrokeWidth(),this.shape.isShadow=!1,this.shape.redraw());this.parentHighlight!=null&&this.parentHighlight.redraw()};mxEdgeHandler.prototype.refresh=function(){this.abspoints=this.getSelectionPoints(this.state);this.points=[];this.shape!=null&&(this.shape.points=this.abspoints);this.bends!=null&&(this.destroyBends(this.bends),this.bends=this.createBends());this.virtualBends!=null&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends());this.customHandles!=null&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles());this.labelShape!=null&&this.labelShape.node!=null&&this.labelShape.node.parentNode!=null&&this.labelShape.node.parentNode.appendChild(this.labelShape.node)};mxEdgeHandler.prototype.destroyBends=function(n){if(n!=null)for(var t=0;t<n.length;t++)n[t]!=null&&n[t].destroy()};mxEdgeHandler.prototype.destroy=function(){this.escapeHandler!=null&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null);this.marker!=null&&(this.marker.destroy(),this.marker=null);this.shape!=null&&(this.shape.destroy(),this.shape=null);this.parentHighlight!=null&&(this.parentHighlight.destroy(),this.parentHighlight=null);this.labelShape!=null&&(this.labelShape.destroy(),this.labelShape=null);this.constraintHandler!=null&&(this.constraintHandler.destroy(),this.constraintHandler=null);this.destroyBends(this.virtualBends);this.virtualBends=null;this.destroyBends(this.customHandles);this.customHandles=null;this.destroyBends(this.bends);this.bends=null;this.removeHint()};mxUtils.extend(mxElbowEdgeHandler,mxEdgeHandler);mxElbowEdgeHandler.prototype=new mxEdgeHandler;mxElbowEdgeHandler.prototype.constructor=mxElbowEdgeHandler;mxElbowEdgeHandler.prototype.flipEnabled=!0;mxElbowEdgeHandler.prototype.doubleClickOrientationResource=mxClient.language!="none"?"doubleClickOrientation":"";mxElbowEdgeHandler.prototype.createBends=function(){var t=[],n=this.createHandleShape(0);return this.initBend(n),n.setCursor(mxConstants.CURSOR_BEND_HANDLE),t.push(n),t.push(this.createVirtualBend(mxUtils.bind(this,function(n){!mxEvent.isConsumed(n)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,n),mxEvent.consume(n))}))),this.points.push(new mxPoint(0,0)),n=this.createHandleShape(2),this.initBend(n),n.setCursor(mxConstants.CURSOR_BEND_HANDLE),t.push(n),t};mxElbowEdgeHandler.prototype.createVirtualBend=function(n){var t=this.createHandleShape();return this.initBend(t,n),t.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(t.node.style.display="none"),t};mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"};mxElbowEdgeHandler.prototype.getTooltipForNode=function(n){var t=null;return this.bends!=null&&this.bends[1]!=null&&(n==this.bends[1].node||n.parentNode==this.bends[1].node)&&(t=this.doubleClickOrientationResource,t=mxResources.get(t)||t),t};mxElbowEdgeHandler.prototype.convertPoint=function(n,t){var i=this.graph.getView().getScale(),r=this.graph.getView().getTranslate(),u=this.state.origin;return t&&(n.x=this.graph.snap(n.x),n.y=this.graph.snap(n.y)),n.x=Math.round(n.x/i-r.x-u.x),n.y=Math.round(n.y/i-r.y-u.y),n};mxElbowEdgeHandler.prototype.redrawInnerBends=function(n,t){var o=this.graph.getModel().getGeometry(this.state.cell),r=this.state.absolutePoints,i=null;r.length>1?(n=r[1],t=r[r.length-2]):o.points!=null&&o.points.length>0&&(i=r[0]);i=i==null?new mxPoint(n.x+(t.x-n.x)/2,n.y+(t.y-n.y)/2):new mxPoint(this.graph.getView().scale*(i.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(i.y+this.graph.getView().translate.y+this.state.origin.y));var s=this.bends[1].bounds,u=s.width,f=s.height,e=new mxRectangle(Math.round(i.x-u/2),Math.round(i.y-f/2),u,f);this.manageLabelHandle?this.checkLabelHandle(e):this.handleImage==null&&this.labelShape.visible&&mxUtils.intersects(e,this.labelShape.bounds)&&(u=mxConstants.HANDLE_SIZE+3,f=mxConstants.HANDLE_SIZE+3,e=new mxRectangle(Math.round(i.x-u/2),Math.round(i.y-f/2),u,f));this.bends[1].bounds=e;this.bends[1].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)};mxUtils.extend(mxEdgeSegmentHandler,mxEdgeHandler);mxEdgeSegmentHandler.prototype=new mxElbowEdgeHandler;mxEdgeSegmentHandler.prototype.constructor=mxEdgeSegmentHandler;mxEdgeSegmentHandler.prototype.getCurrentPoints=function(){var n=this.state.absolutePoints,t,i;return n!=null&&(n.length==2||n.length==3&&(n[0].x==n[1].x&&n[1].x==n[2].x||n[0].y==n[1].y&&n[1].y==n[2].y))&&(t=n[0].x+(n[n.length-1].x-n[0].x)/2,i=n[0].y+(n[n.length-1].y-n[0].y)/2,n=[n[0],new mxPoint(t,i),new mxPoint(t,i),n[n.length-1]]),n};mxEdgeSegmentHandler.prototype.getPreviewPoints=function(n){var f,r,t,u,i;if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);for(f=this.getCurrentPoints(),r=this.convertPoint(f[0].clone(),!1),n=this.convertPoint(n.clone(),!1),t=[],u=1;u<f.length;u++)i=this.convertPoint(f[u].clone(),!1),u==this.index&&(Math.round(r.x-i.x)==0&&(r.x=n.x,i.x=n.x),Math.round(r.y-i.y)==0&&(r.y=n.y,i.y=n.y)),u<f.length-1&&t.push(i),r=i;if(t.length==1){var e=this.state.getVisibleTerminalState(!0),o=this.state.getVisibleTerminalState(!1),s=this.state.view.getScale(),h=this.state.view.getTranslate(),c=t[0].x*s+h.x,l=t[0].y*s+h.y;(e!=null&&mxUtils.contains(e,c,l)||o!=null&&mxUtils.contains(o,c,l))&&(t=[n,n])}return t};mxEdgeSegmentHandler.prototype.updatePreviewState=function(n,t){var s,h,v,y,r;if(mxEdgeHandler.prototype.updatePreviewState.apply(this,arguments),!this.isSource&&!this.isTarget){t=this.convertPoint(t.clone(),!1);var i=n.absolutePoints,a=i[0],u=i[1],o=[];for(s=2;s<i.length;s++)h=i[s],(Math.round(a.x-u.x)!=0||Math.round(u.x-h.x)!=0)&&(Math.round(a.y-u.y)!=0||Math.round(u.y-h.y)!=0)&&o.push(this.convertPoint(u.clone(),!1)),a=u,u=h;var f=this.state.getVisibleTerminalState(!0),e=this.state.getVisibleTerminalState(!1),c=this.state.absolutePoints;if(o.length==0&&(Math.round(i[0].x-i[i.length-1].x)==0||Math.round(i[0].y-i[i.length-1].y)==0))o=[t,t];else if(i.length==5&&o.length==2&&f!=null&&e!=null&&c!=null&&Math.round(c[0].x-c[c.length-1].x)==0){var l=this.graph.getView(),p=l.getScale(),w=l.getTranslate(),b=l.getRoutingCenterY(f)/p-w.y,k=this.graph.getConnectionConstraint(n,f,!0);k!=null&&(r=this.graph.getConnectionPoint(f,k),r!=null&&(this.convertPoint(r,!1),b=r.y));v=l.getRoutingCenterY(e)/p-w.y;y=this.graph.getConnectionConstraint(n,e,!1);y&&(r=this.graph.getConnectionPoint(e,y),r!=null&&(this.convertPoint(r,!1),v=r.y));o=[new mxPoint(t.x,b),new mxPoint(t.x,v)]}this.points=o;n.view.updateFixedTerminalPoints(n,f,e);n.view.updatePoints(n,this.points,f,e);n.view.updateFloatingTerminalPoints(n,f,e)}};mxEdgeSegmentHandler.prototype.connect=function(n){for(var f,r,n,i,u=this.abspoints,e=u[0],t=u[1],s=[],o=2;o<u.length;o++)f=u[o],(Math.round(e.x-t.x)!=0||Math.round(t.x-f.x)!=0)&&(Math.round(e.y-t.y)!=0||Math.round(t.y-f.y)!=0)&&s.push(this.convertPoint(t.clone(),!1)),e=t,t=f;r=this.graph.getModel();r.beginUpdate();try{n=mxEdgeHandler.prototype.connect.apply(this,arguments);i=r.getGeometry(n);i!=null&&(i=i.clone(),i.points=s,r.setGeometry(n,i))}finally{r.endUpdate()}return n};mxEdgeSegmentHandler.prototype.getTooltipForNode=function(){return null};mxEdgeSegmentHandler.prototype.start=function(n,t,i){mxEdgeHandler.prototype.start.apply(this,arguments);this.bends[i]==null||this.isSource||this.isTarget||mxUtils.setOpacity(this.bends[i].node,100)};mxEdgeSegmentHandler.prototype.createBends=function(){var r=[],n=this.createHandleShape(0),t,i,u;if(this.initBend(n),n.setCursor(mxConstants.CURSOR_BEND_HANDLE),r.push(n),t=this.getCurrentPoints(),this.graph.isCellBendable(this.state.cell))for(this.points==null&&(this.points=[]),i=0;i<t.length-1;i++)n=this.createVirtualBend(),r.push(n),u=Math.round(t[i].x-t[i+1].x)==0,Math.round(t[i].y-t[i+1].y)==0&&i<t.length-2&&(u=Math.round(t[i].x-t[i+2].x)==0),n.setCursor(u?"col-resize":"row-resize"),this.points.push(new mxPoint(0,0));return n=this.createHandleShape(t.length),this.initBend(n),n.setCursor(mxConstants.CURSOR_BEND_HANDLE),r.push(n),r};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};mxEdgeSegmentHandler.prototype.redrawInnerBends=function(n,t){var i,f,e,o,r;if(this.graph.isCellBendable(this.state.cell)&&(i=this.getCurrentPoints(),i!=null&&i.length>1)){for(f=!1,i.length==4&&Math.round(i[1].x-i[2].x)==0&&Math.round(i[1].y-i[2].y)==0&&(f=!0,Math.round(i[0].y-i[i.length-1].y)==0?(e=i[0].x+(i[i.length-1].x-i[0].x)/2,i[1]=new mxPoint(e,i[1].y),i[2]=new mxPoint(e,i[2].y)):(o=i[0].y+(i[i.length-1].y-i[0].y)/2,i[1]=new mxPoint(i[1].x,o),i[2]=new mxPoint(i[2].x,o))),r=0;r<i.length-1;r++)if(this.bends[r+1]!=null){var n=i[r],t=i[r+1],s=new mxPoint(n.x+(t.x-n.x)/2,n.y+(t.y-n.y)/2),u=this.bends[r+1].bounds;this.bends[r+1].bounds=new mxRectangle(Math.round(s.x-u.width/2),Math.round(s.y-u.height/2),u.width,u.height);this.bends[r+1].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[r+1].bounds)}f&&(mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity),mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity))}};mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;mxKeyHandler.prototype.normalKeys=null;mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=!0;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(n){this.enabled=n};mxKeyHandler.prototype.bindKey=function(n,t){this.normalKeys[n]=t};mxKeyHandler.prototype.bindShiftKey=function(n,t){this.shiftKeys[n]=t};mxKeyHandler.prototype.bindControlKey=function(n,t){this.controlKeys[n]=t};mxKeyHandler.prototype.bindControlShiftKey=function(n,t){this.controlShiftKeys[n]=t};mxKeyHandler.prototype.isControlDown=function(n){return mxEvent.isControlDown(n)};mxKeyHandler.prototype.getFunction=function(n){return n!=null?this.isControlDown(n)?mxEvent.isShiftDown(n)?this.controlShiftKeys[n.keyCode]:this.controlKeys[n.keyCode]:mxEvent.isShiftDown(n)?this.shiftKeys[n.keyCode]:this.normalKeys[n.keyCode]:null};mxKeyHandler.prototype.isGraphEvent=function(n){var t=mxEvent.getSource(n);return t==this.target||t.parentNode==this.target||this.graph.cellEditor!=null&&this.graph.cellEditor.isEventSource(n)?!0:mxUtils.isAncestorNode(this.graph.container,t)};mxKeyHandler.prototype.keyDown=function(n){if(this.graph.isEnabled()&&!mxEvent.isConsumed(n)&&this.isGraphEvent(n)&&this.isEnabled())if(n.keyCode==27)this.escape(n);else if(!this.isEventIgnored(n)){var t=this.getFunction(n);t!=null&&(t(n),mxEvent.consume(n))}};mxKeyHandler.prototype.isEventIgnored=function(){return this.graph.isEditing()};mxKeyHandler.prototype.escape=function(n){this.graph.isEscapeEnabled()&&this.graph.escape(n)};mxKeyHandler.prototype.destroy=function(){this.target!=null&&this.keydownHandler!=null&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null);this.target=null};mxTooltipHandler.prototype.zIndex=10005;mxTooltipHandler.prototype.graph=null;mxTooltipHandler.prototype.delay=null;mxTooltipHandler.prototype.ignoreTouchEvents=!0;mxTooltipHandler.prototype.hideOnHover=!1;mxTooltipHandler.prototype.destroyed=!1;mxTooltipHandler.prototype.enabled=!0;mxTooltipHandler.prototype.isEnabled=function(){return this.enabled};mxTooltipHandler.prototype.setEnabled=function(n){this.enabled=n};mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover};mxTooltipHandler.prototype.setHideOnHover=function(n){this.hideOnHover=n};mxTooltipHandler.prototype.init=function(){document.body!=null&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(){this.hideTooltip()})))};mxTooltipHandler.prototype.mouseDown=function(n,t){this.reset(t,!1);this.hideTooltip()};mxTooltipHandler.prototype.mouseMove=function(n,t){(t.getX()!=this.lastX||t.getY()!=this.lastY)&&(this.reset(t,!0),(this.isHideOnHover()||t.getState()!=this.state||t.getSource()!=this.node&&(!this.stateSource||t.getState()!=null&&this.stateSource==(t.isSource(t.getState().shape)||!t.isSource(t.getState().text))))&&this.hideTooltip());this.lastX=t.getX();this.lastY=t.getY()};mxTooltipHandler.prototype.mouseUp=function(n,t){this.reset(t,!0);this.hideTooltip()};mxTooltipHandler.prototype.resetTimer=function(){this.thread!=null&&(window.clearTimeout(this.thread),this.thread=null)};mxTooltipHandler.prototype.reset=function(n,t){if((!this.ignoreTouchEvents||mxEvent.isMouseEvent(n.getEvent()))&&(this.resetTimer(),t&&this.isEnabled()&&n.getState()!=null&&(this.div==null||this.div.style.visibility=="hidden"))){var i=n.getState(),r=n.getSource(),u=n.getX(),f=n.getY(),e=n.isSource(i.shape)||n.isSource(i.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){if(!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()&&!this.graph.isMouseDown){var n=this.graph.getTooltip(i,r,u,f);this.show(n,u,f);this.state=i;this.node=r;this.stateSource=e}}),this.delay)}};mxTooltipHandler.prototype.hide=function(){this.resetTimer();this.hideTooltip()};mxTooltipHandler.prototype.hideTooltip=function(){this.div!=null&&(this.div.style.visibility="hidden")};mxTooltipHandler.prototype.show=function(n,t,i){if(!this.destroyed&&n!=null&&n.length>0){this.div==null&&this.init();var r=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex;this.div.style.left=t+r.x+"px";this.div.style.top=i+mxConstants.TOOLTIP_VERTICAL_OFFSET+r.y+"px";mxUtils.isNode(n)?(this.div.innerHTML="",this.div.appendChild(n)):this.div.innerHTML=n.replace(/\n/g,"<br>");this.div.style.visibility="";mxUtils.fit(this.div)}};mxTooltipHandler.prototype.destroy=function(){this.destroyed||(this.graph.removeMouseListener(this),mxEvent.release(this.div),this.div!=null&&this.div.parentNode!=null&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)};mxUtils.extend(mxCellTracker,mxCellMarker);mxCellTracker.prototype.mouseDown=function(){};mxCellTracker.prototype.mouseMove=function(n,t){this.isEnabled()&&this.process(t)};mxCellTracker.prototype.mouseUp=function(){this.reset()};mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))};mxCellHighlight.prototype.keepOnTop=!1;mxCellHighlight.prototype.graph=!0;mxCellHighlight.prototype.state=null;mxCellHighlight.prototype.spacing=2;mxCellHighlight.prototype.resetHandler=null;mxCellHighlight.prototype.setHighlightColor=function(n){this.highlightColor=n;this.shape!=null&&(this.shape.stroke=n)};mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape();this.repaint();this.keepOnTop||this.shape.node.parentNode.firstChild==this.shape.node||this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)};mxCellHighlight.prototype.createShape=function(){var n=this.graph.cellRenderer.createShape(this.state);return n.scale=this.state.view.scale,n.outline=!0,n.points=this.state.absolutePoints,n.apply(this.state),n.strokewidth=this.strokeWidth/this.state.view.scale/this.state.view.scale,n.arrowStrokewidth=this.strokeWidth,n.stroke=this.highlightColor,n.isDashed=this.dashed,n.isShadow=!1,n.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,n.init(this.graph.getView().getOverlayPane()),mxEvent.redirectMouseEvents(n.node,this.graph,this.state),this.graph.dialect!=mxConstants.DIALECT_SVG?n.pointerEvents=!1:n.svgPointerEvents="stroke",n};mxCellHighlight.prototype.repaint=function(){this.state!=null&&this.shape!=null&&(this.graph.model.isEdge(this.state.cell)?this.shape.points=this.state.absolutePoints:(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),this.state.shape!=null&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())};mxCellHighlight.prototype.hide=function(){this.highlight(null)};mxCellHighlight.prototype.highlight=function(n){this.state!=n&&(this.shape!=null&&(this.shape.destroy(),this.shape=null),this.state=n,this.state!=null&&this.drawHighlight())};mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getView().removeListener(this.repaintHandler);this.graph.getModel().removeListener(this.repaintHandler);this.shape!=null&&(this.shape.destroy(),this.shape=null)};mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;mxDefaultKeyHandler.prototype.bindAction=function(n,t,i){var r=mxUtils.bind(this,function(){this.editor.execute(t)});i?this.handler.bindControlKey(n,r):this.handler.bindKey(n,r)};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;mxDefaultPopupMenu.prototype.createMenu=function(n,t,i,r){if(this.config!=null){var u=this.createConditions(n,i,r),f=this.config.firstChild;this.addItems(n,t,i,r,u,f,null)}};mxDefaultPopupMenu.prototype.addItems=function(n,t,i,r,u,f,e){for(var h=!1,c,o,a;f!=null;){if(f.nodeName=="add"){if(c=f.getAttribute("if"),c==null||u[c]){o=f.getAttribute("as");o=mxResources.get(o)||o;var v=mxUtils.eval(mxUtils.getTextContent(f)),y=f.getAttribute("action"),s=f.getAttribute("icon"),p=f.getAttribute("iconCls"),l=f.getAttribute("enabled-if"),w=l==null||u[l];h&&(t.addSeparator(e),h=!1);s!=null&&this.imageBasePath&&(s=this.imageBasePath+s);a=this.addAction(t,n,o,s,v,y,i,e,p,w);this.addItems(n,t,i,r,u,f.firstChild,a)}}else f.nodeName=="separator"&&(h=!0);f=f.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(n,t,i,r,u,f,e,o,s,h){var c=function(n){typeof u=="function"&&u.call(t,t,e,n);f!=null&&t.execute(f,e,n)};return n.addItem(i,r,c,o,s,h)};mxDefaultPopupMenu.prototype.createConditions=function(n,t,i){var o=n.graph.getModel(),c=o.getChildCount(t),r=[],u,e,f,s,h;for(r.nocell=t==null,r.ncells=n.graph.getSelectionCount()>1,r.notRoot=o.getRoot()!=o.getParent(n.graph.getDefaultParent()),r.cell=t!=null,u=t!=null&&n.graph.getSelectionCount()==1,r.nonEmpty=u&&c>0,r.expandable=u&&n.graph.isCellFoldable(t,!1),r.collapsable=u&&n.graph.isCellFoldable(t,!0),r.validRoot=u&&n.graph.isValidRoot(t),r.emptyValidRoot=r.validRoot&&c==0,r.swimlane=u&&n.graph.isSwimlane(t),e=this.config.getElementsByTagName("condition"),f=0;f<e.length;f++)s=mxUtils.eval(mxUtils.getTextContent(e[f])),h=e[f].getAttribute("name"),h!=null&&typeof s=="function"&&(r[h]=s(n,t,i));return r};mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=!1;mxDefaultToolbar.prototype.init=function(n){n!=null&&(this.toolbar=new mxToolbar(n),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(n,t){var i=t.getProperty("function");this.editor.insertFunction=i!=null?mxUtils.bind(this,function(){i.apply(this,arguments);this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){this.toolbar!=null&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,this.resetHandler))};mxDefaultToolbar.prototype.addItem=function(n,t,i,r){var u=mxUtils.bind(this,function(){i!=null&&i.length>0&&this.editor.execute(i)});return this.toolbar.addItem(n,t,u,r)};mxDefaultToolbar.prototype.addSeparator=function(n){n=n||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(n)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(n){return this.toolbar.addActionCombo(n)};mxDefaultToolbar.prototype.addActionOption=function(n,t,i){var r=mxUtils.bind(this,function(){this.editor.execute(i)});this.addOption(n,t,r)};mxDefaultToolbar.prototype.addOption=function(n,t,i){return this.toolbar.addOption(n,t,i)};mxDefaultToolbar.prototype.addMode=function(n,t,i,r,u){var f=mxUtils.bind(this,function(){this.editor.setMode(i);u!=null&&u(this.editor)});return this.toolbar.addSwitchMode(n,t,f,r)};mxDefaultToolbar.prototype.addPrototype=function(n,t,i,r,u,f){var e=mxUtils.bind(this,function(){return typeof i=="function"?i():i!=null?this.editor.graph.cloneCells([i])[0]:null}),o=mxUtils.bind(this,function(n,t){typeof u=="function"?u(this.editor,e(),n,t):this.drop(e(),n,t);this.toolbar.resetMode();mxEvent.consume(n)}),s=this.toolbar.addMode(n,t,o,r,null,f),h=function(n,t,i){o(t,i)};return this.installDropHandler(s,h),s};mxDefaultToolbar.prototype.drop=function(n,t,i){var r=this.editor.graph,u=r.getModel();if(i!=null&&!u.isEdge(i)&&this.connectOnDrop&&r.isCellConnectable(i))this.connect(n,t,i);else{while(i!=null&&!r.isValidDropTarget(i,[n],t))i=u.getParent(i);this.insert(n,t,i)}};mxDefaultToolbar.prototype.insert=function(n,t,i){var r=this.editor.graph;if(r.canImportCell(n)){var f=mxEvent.getClientX(t),e=mxEvent.getClientY(t),u=mxUtils.convertPoint(r.container,f,e);return r.isSplitEnabled()&&r.isSplitTarget(i,[n],t)?r.splitEdge(i,[n],null,u.x,u.y):this.editor.addVertex(i,n,u.x,u.y)}return null};mxDefaultToolbar.prototype.connect=function(n,t,i){var u=this.editor.graph,f=u.getModel(),o,e,r,s,h,c,l;if(i!=null&&u.isCellConnectable(n)&&u.isEdgeValid(null,i,n)){o=null;f.beginUpdate();try{e=f.getGeometry(i);r=f.getGeometry(n).clone();r.x=e.x+(e.width-r.width)/2;r.y=e.y+(e.height-r.height)/2;s=this.spacing*u.gridSize;h=f.getDirectedEdgeCount(i,!0)*20;this.editor.horizontalFlow?r.x+=(r.width+e.width)/2+s+h:r.y+=(r.height+e.height)/2+s+h;n.setGeometry(r);c=f.getParent(i);u.addCell(n,c);u.constrainChild(n);o=this.editor.createEdge(i,n);f.getGeometry(o)==null&&(l=new mxGeometry,l.relative=!0,f.setGeometry(o,l));u.addEdge(o,c,i,n)}finally{f.endUpdate()}u.setSelectionCells([n,o]);u.scrollCellToVisible(n)}};mxDefaultToolbar.prototype.installDropHandler=function(n,t){var i=document.createElement("img"),r;i.setAttribute("src",n.getAttribute("src"));r=mxUtils.bind(this,function(){i.style.width=2*n.offsetWidth+"px";i.style.height=2*n.offsetHeight+"px";mxUtils.makeDraggable(n,this.editor.graph,t,i);mxEvent.removeListener(i,"load",r)});mxClient.IS_IE?r():mxEvent.addListener(i,"load",r)};mxDefaultToolbar.prototype.destroy=function(){this.resetHandler!=null&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null);this.toolbar!=null&&(this.toolbar.destroy(),this.toolbar=null)};mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor");mxEditor.prototype=new mxEventSource;mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource=mxClient.language!="none"?"askZoom":"";mxEditor.prototype.lastSavedResource=mxClient.language!="none"?"lastSaved":"";mxEditor.prototype.currentFileResource=mxClient.language!="none"?"currentFile":"";mxEditor.prototype.propertiesResource=mxClient.language!="none"?"properties":"";mxEditor.prototype.tasksResource=mxClient.language!="none"?"tasks":"";mxEditor.prototype.helpResource=mxClient.language!="none"?"help":"";mxEditor.prototype.outlineResource=mxClient.language!="none"?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.status=null;mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=!1;mxEditor.prototype.disableContextMenu=!0;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=!1;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=!0;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.horizontalFlow=!1;mxEditor.prototype.layoutDiagram=!1;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=!1;mxEditor.prototype.layoutSwimlanes=!1;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=!1;mxEditor.prototype.validating=!1;mxEditor.prototype.modified=!1;mxEditor.prototype.isModified=function(){return this.modified};mxEditor.prototype.setModified=function(n){this.modified=n};mxEditor.prototype.addActions=function(){this.addAction("save",function(n){n.save()});this.addAction("print",function(n){var t=new mxPrintPreview(n.graph,1);t.open()});this.addAction("show",function(n){mxUtils.show(n.graph,null,10,10)});this.addAction("exportImage",function(n){var t=n.getUrlImage(),i,r;t==null||mxClient.IS_LOCAL?n.execute("show"):(i=mxUtils.getViewXml(n.graph,1),r=mxUtils.getXml(i,"\n"),mxUtils.submit(t,n.postParameterName+"="+encodeURIComponent(r),document,"_blank"))});this.addAction("refresh",function(n){n.graph.refresh()});this.addAction("cut",function(n){n.graph.isEnabled()&&mxClipboard.cut(n.graph)});this.addAction("copy",function(n){n.graph.isEnabled()&&mxClipboard.copy(n.graph)});this.addAction("paste",function(n){n.graph.isEnabled()&&mxClipboard.paste(n.graph)});this.addAction("delete",function(n){n.graph.isEnabled()&&n.graph.removeCells()});this.addAction("group",function(n){n.graph.isEnabled()&&n.graph.setSelectionCell(n.groupCells())});this.addAction("ungroup",function(n){n.graph.isEnabled()&&n.graph.setSelectionCells(n.graph.ungroupCells())});this.addAction("removeFromParent",function(n){n.graph.isEnabled()&&n.graph.removeCellsFromParent()});this.addAction("undo",function(n){n.graph.isEnabled()&&n.undo()});this.addAction("redo",function(n){n.graph.isEnabled()&&n.redo()});this.addAction("zoomIn",function(n){n.graph.zoomIn()});this.addAction("zoomOut",function(n){n.graph.zoomOut()});this.addAction("actualSize",function(n){n.graph.zoomActual()});this.addAction("fit",function(n){n.graph.fit()});this.addAction("showProperties",function(n,t){n.showProperties(t)});this.addAction("selectAll",function(n){n.graph.isEnabled()&&n.graph.selectAll()});this.addAction("selectNone",function(n){n.graph.isEnabled()&&n.graph.clearSelection()});this.addAction("selectVertices",function(n){n.graph.isEnabled()&&n.graph.selectVertices()});this.addAction("selectEdges",function(n){n.graph.isEnabled()&&n.graph.selectEdges()});this.addAction("edit",function(n,t){n.graph.isEnabled()&&n.graph.isCellEditable(t)&&n.graph.startEditingAtCell(t)});this.addAction("toBack",function(n){n.graph.isEnabled()&&n.graph.orderCells(!0)});this.addAction("toFront",function(n){n.graph.isEnabled()&&n.graph.orderCells(!1)});this.addAction("enterGroup",function(n,t){n.graph.enterGroup(t)});this.addAction("exitGroup",function(n){n.graph.exitGroup()});this.addAction("home",function(n){n.graph.home()});this.addAction("selectPrevious",function(n){n.graph.isEnabled()&&n.graph.selectPreviousCell()});this.addAction("selectNext",function(n){n.graph.isEnabled()&&n.graph.selectNextCell()});this.addAction("selectParent",function(n){n.graph.isEnabled()&&n.graph.selectParentCell()});this.addAction("selectChild",function(n){n.graph.isEnabled()&&n.graph.selectChildCell()});this.addAction("collapse",function(n){n.graph.isEnabled()&&n.graph.foldCells(!0)});this.addAction("collapseAll",function(n){if(n.graph.isEnabled()){var t=n.graph.getChildVertices();n.graph.foldCells(!0,!1,t)}});this.addAction("expand",function(n){n.graph.isEnabled()&&n.graph.foldCells(!1)});this.addAction("expandAll",function(n){if(n.graph.isEnabled()){var t=n.graph.getChildVertices();n.graph.foldCells(!1,!1,t)}});this.addAction("bold",function(n){n.graph.isEnabled()&&n.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)});this.addAction("italic",function(n){n.graph.isEnabled()&&n.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)});this.addAction("underline",function(n){n.graph.isEnabled()&&n.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)});this.addAction("alignCellsLeft",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_LEFT)});this.addAction("alignCellsCenter",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_CENTER)});this.addAction("alignCellsRight",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_RIGHT)});this.addAction("alignCellsTop",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_TOP)});this.addAction("alignCellsMiddle",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_MIDDLE)});this.addAction("alignCellsBottom",function(n){n.graph.isEnabled()&&n.graph.alignCells(mxConstants.ALIGN_BOTTOM)});this.addAction("alignFontLeft",function(n){n.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(n){n.graph.isEnabled()&&n.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)});this.addAction("alignFontRight",function(n){n.graph.isEnabled()&&n.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)});this.addAction("alignFontTop",function(n){n.graph.isEnabled()&&n.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)});this.addAction("alignFontMiddle",function(n){n.graph.isEnabled()&&n.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)});this.addAction("alignFontBottom",function(n){n.graph.isEnabled()&&n.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)});this.addAction("zoom",function(n){var i=n.graph.getView().scale*100,t=parseFloat(mxUtils.prompt(mxResources.get(n.askZoomResource)||n.askZoomResource,i))/100;isNaN(t)||n.graph.getView().setScale(t)});this.addAction("toggleTasks",function(n){n.tasks!=null?n.tasks.setVisible(!n.tasks.isVisible()):n.showTasks()});this.addAction("toggleHelp",function(n){n.help!=null?n.help.setVisible(!n.help.isVisible()):n.showHelp()});this.addAction("toggleOutline",function(n){n.outline==null?n.showOutline():n.outline.setVisible(!n.outline.isVisible())});this.addAction("toggleConsole",function(){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.configure=function(n){if(n!=null){var t=new mxCodec(n.ownerDocument);t.decode(n,this);this.resetHistory()}};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(!1)};mxEditor.prototype.addAction=function(n,t){this.actions[n]=t};mxEditor.prototype.execute=function(n){var i=this.actions[n],t;if(i!=null)try{t=arguments;t[0]=this;i.apply(this,t)}catch(r){mxUtils.error("Cannot execute "+n+": "+r.message,280,!0);throw r;}else mxUtils.error("Cannot find action "+n,280,!0)};mxEditor.prototype.addTemplate=function(n,t){this.templates[n]=t};mxEditor.prototype.getTemplate=function(n){return this.templates[n]};mxEditor.prototype.createGraph=function(){var n=new mxGraph(null,null,this.graphRenderHint);return n.setTooltips(!0),n.setPanning(!0),this.installDblClickHandler(n),this.installUndoHandler(n),this.installDrillHandler(n),this.installChangeHandler(n),this.installInsertHandler(n),n.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(n,t,i){return this.createPopupMenu(n,t,i)}),n.connectionHandler.factoryMethod=mxUtils.bind(this,function(n,t){return this.createEdge(n,t)}),this.createSwimlaneManager(n),this.createLayoutManager(n),n};mxEditor.prototype.createSwimlaneManager=function(n){var t=new mxSwimlaneManager(n,!1);return t.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow}),t.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes}),t};mxEditor.prototype.createLayoutManager=function(n){var i=new mxLayoutManager(n),t=this;return i.getLayout=function(i){var r=null,u=t.graph.getModel();return u.getParent(i)!=null&&(t.layoutSwimlanes&&n.isSwimlane(i)?(t.swimlaneLayout==null&&(t.swimlaneLayout=t.createSwimlaneLayout()),r=t.swimlaneLayout):t.layoutDiagram&&(n.isValidRoot(i)||u.getParent(u.getParent(i))==null)&&(t.diagramLayout==null&&(t.diagramLayout=t.createDiagramLayout()),r=t.diagramLayout)),r},i};mxEditor.prototype.setGraphContainer=function(n){this.graph.container==null&&(this.graph.init(n),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(n),mxClient.IS_QUIRKS&&new mxDivResizer(n))};mxEditor.prototype.installDblClickHandler=function(n){n.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(t,i){var r=i.getProperty("cell");r!=null&&n.isEnabled()&&this.dblClickAction!=null&&(this.execute(this.dblClickAction,r),i.consume())}))};mxEditor.prototype.installUndoHandler=function(n){var i=mxUtils.bind(this,function(n,t){var i=t.getProperty("edit");this.undoManager.undoableEditHappened(i)}),t;n.getModel().addListener(mxEvent.UNDO,i);n.getView().addListener(mxEvent.UNDO,i);t=function(t,i){var r=i.getProperty("edit").changes;n.setSelectionCells(n.getSelectionCellsForChanges(r))};this.undoManager.addListener(mxEvent.UNDO,t);this.undoManager.addListener(mxEvent.REDO,t)};mxEditor.prototype.installDrillHandler=function(n){var t=mxUtils.bind(this,function(){this.fireEvent(new mxEventObject(mxEvent.ROOT))});n.getView().addListener(mxEvent.DOWN,t);n.getView().addListener(mxEvent.UP,t)};mxEditor.prototype.installChangeHandler=function(n){var t=mxUtils.bind(this,function(t,i){var f,u,r;for(this.setModified(!0),this.validating==!0&&n.validateGraph(),f=i.getProperty("edit").changes,u=0;u<f.length;u++)if(r=f[u],r instanceof mxRootChange||r instanceof mxValueChange&&r.cell==this.graph.model.root||r instanceof mxCellAttributeChange&&r.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}});n.getModel().addListener(mxEvent.CHANGE,t)};mxEditor.prototype.installInsertHandler=function(n){var t=this,i={mouseDown:function(n,i){t.insertFunction!=null&&!i.isPopupTrigger()&&(t.forcedInserting||i.getState()==null)&&(t.graph.clearSelection(),t.insertFunction(i.getEvent(),i.getCell()),this.isActive=!0,i.consume())},mouseMove:function(n,t){this.isActive&&t.consume()},mouseUp:function(n,t){this.isActive&&(this.isActive=!1,t.consume())}};n.addMouseListener(i)};mxEditor.prototype.createDiagramLayout=function(){var t=this.graph.gridSize,n=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*t,2*t);return n.isVertexIgnored=function(t){return!n.graph.isSwimlane(t)},n};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};mxEditor.prototype.setToolbarContainer=function(n){this.toolbar.init(n);mxClient.IS_QUIRKS&&new mxDivResizer(n)};mxEditor.prototype.setStatusContainer=function(n){this.status==null&&(this.status=n,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var n=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+n)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(n))};mxEditor.prototype.setStatus=function(n){this.status!=null&&n!=null&&(this.status.innerHTML=n)};mxEditor.prototype.setTitleContainer=function(n){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){n.innerHTML=this.getTitle()}));mxClient.IS_QUIRKS&&new mxDivResizer(n)};mxEditor.prototype.treeLayout=function(n,t){if(n!=null){var i=new mxCompactTreeLayout(this.graph,t);i.execute(n)}};mxEditor.prototype.getTitle=function(){for(var i="",n=this.graph,t=n.getCurrentRoot(),r;t!=null&&n.getModel().getParent(n.getModel().getParent(t))!=null;)n.isValidRoot(t)&&(i=" > "+n.convertValueToString(t)+i),t=n.getModel().getParent(t);return r=this.getRootTitle(),r+i};mxEditor.prototype.getRootTitle=function(){var n=this.graph.getModel().getRoot();return this.graph.convertValueToString(n)};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};mxEditor.prototype.groupCells=function(){var n=this.groupBorderSize!=null?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),n)};mxEditor.prototype.createGroup=function(){var n=this.graph.getModel();return n.cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(n){if(n!=null){var t=mxUtils.load(n).getXml();this.readGraphModel(t.documentElement);this.filename=n;this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",n))}};mxEditor.prototype.readGraphModel=function(n){var t=new mxCodec(n.ownerDocument);t.decode(n,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(n,t){if(n=n||this.getUrlPost(),n!=null&&n.length>0){var i=this.writeGraphModel(t);this.postDiagram(n,i);this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",n))};mxEditor.prototype.postDiagram=function(n,t){this.escapePostData&&(t=encodeURIComponent(t));mxUtils.post(n,this.postParameterName+"="+t,mxUtils.bind(this,function(i){this.fireEvent(new mxEventObject(mxEvent.POST,"request",i,"url",n,"data",t))}))};mxEditor.prototype.writeGraphModel=function(n){n=n!=null?n:this.linefeed;var t=new mxCodec,i=t.encode(this.graph.getModel());return mxUtils.getXml(i,n)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};mxEditor.prototype.swapStyles=function(n,t){var i=this.graph.getStylesheet().styles[t];this.graph.getView().getStylesheet().putCellStyle(t,this.graph.getStylesheet().styles[n]);this.graph.getStylesheet().putCellStyle(n,i);this.graph.refresh()};mxEditor.prototype.showProperties=function(n){var t,u;if(n=n||this.graph.getSelectionCell(),n==null&&(n=this.graph.getCurrentRoot(),n==null&&(n=this.graph.getModel().getRoot())),n!=null){this.graph.stopEditing(!0);var f=mxUtils.getOffset(this.graph.container),i=f.x+10,r=f.y;this.properties==null||this.movePropertiesDialog?(t=this.graph.getCellBounds(n),t!=null&&(i+=t.x+Math.min(200,t.width),r+=t.y)):(i=this.properties.getX(),r=this.properties.getY());this.hideProperties();u=this.createProperties(n);u!=null&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,u,i,r,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}};mxEditor.prototype.isPropertiesVisible=function(){return this.properties!=null};mxEditor.prototype.createProperties=function(n){var i=this.graph.getModel(),e=i.getValue(n),r,o,u,y,p,w;if(mxUtils.isNode(e)){r=new mxForm("properties");o=r.addText("ID",n.getId());o.setAttribute("readonly","true");var t=null,s=null,h=null,c=null,l=null;i.isVertex(n)&&(t=i.getGeometry(n),t!=null&&(s=r.addText("top",t.y),h=r.addText("left",t.x),c=r.addText("width",t.width),l=r.addText("height",t.height)));var b=i.getStyle(n),a=r.addText("Style",b||""),f=e.attributes,v=[];for(u=0;u<f.length;u++)y=f[u].value,v[u]=r.addTextarea(f[u].nodeName,y,f[u].nodeName=="label"?4:2);return p=mxUtils.bind(this,function(){var r,u;this.hideProperties();i.beginUpdate();try{for(t!=null&&(t=t.clone(),t.x=parseFloat(h.value),t.y=parseFloat(s.value),t.width=parseFloat(c.value),t.height=parseFloat(l.value),i.setGeometry(n,t)),a.value.length>0?i.setStyle(n,a.value):i.setStyle(n,null),r=0;r<f.length;r++)u=new mxCellAttributeChange(n,f[r].nodeName,v[r].value),i.execute(u);this.graph.isAutoSizeCell(n)&&this.graph.updateCellSize(n)}finally{i.endUpdate()}}),w=mxUtils.bind(this,function(){this.hideProperties()}),r.addButtons(p,w),r.table}return null};mxEditor.prototype.hideProperties=function(){this.properties!=null&&(this.properties.destroy(),this.properties=null)};mxEditor.prototype.showTasks=function(){var n,r,t,i;this.tasks==null&&(n=document.createElement("div"),n.style.padding="4px",n.style.paddingLeft="20px",r=document.body.clientWidth,t=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,n,r-220,this.tasksTop,200),t.setClosable(!0),t.destroyOnClose=!1,i=mxUtils.bind(this,function(){mxEvent.release(n);n.innerHTML="";this.createTasks(n)}),this.graph.getModel().addListener(mxEvent.CHANGE,i),this.graph.getSelectionModel().addListener(mxEvent.CHANGE,i),this.graph.addListener(mxEvent.ROOT,i),this.tasksWindowImage!=null&&t.setImage(this.tasksWindowImage),this.tasks=t,this.createTasks(n));this.tasks.setVisible(!0)};mxEditor.prototype.refreshTasks=function(n){if(this.tasks!=null){var n=this.tasks.content;mxEvent.release(n);n.innerHTML="";this.createTasks(n)}};mxEditor.prototype.createTasks=function(){};mxEditor.prototype.showHelp=function(){var t,i;if(this.help==null){t=document.createElement("iframe");t.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);t.setAttribute("height","100%");t.setAttribute("width","100%");t.setAttribute("frameBorder","0");t.style.backgroundColor="white";var r=document.body.clientWidth,u=document.body.clientHeight||document.documentElement.clientHeight,n=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,t,(r-this.helpWidth)/2,(u-this.helpHeight)/3,this.helpWidth,this.helpHeight);n.setMaximizable(!0);n.setClosable(!0);n.destroyOnClose=!1;n.setResizable(!0);this.helpWindowImage!=null&&n.setImage(this.helpWindowImage);mxClient.IS_NS&&(i=function(){var i=n.div.offsetHeight;t.setAttribute("height",i-26+"px")},n.addListener(mxEvent.RESIZE_END,i),n.addListener(mxEvent.MAXIMIZE,i),n.addListener(mxEvent.NORMALIZE,i),n.addListener(mxEvent.SHOW,i));this.help=n}this.help.setVisible(!0)};mxEditor.prototype.showOutline=function(){var r=this.outline==null,n,t,i;r&&(n=document.createElement("div"),n.style.overflow="hidden",n.style.position="relative",n.style.width="100%",n.style.height="100%",n.style.background="white",n.style.cursor="move",document.documentMode==8&&(n.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)"),t=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,n,600,480,200,200,!1),i=new mxOutline(this.graph,n),t.setClosable(!0),t.setResizable(!0),t.destroyOnClose=!1,t.addListener(mxEvent.RESIZE_END,function(){i.update()}),this.outline=t,this.outline.outline=i);this.outline.setVisible(!0);this.outline.outline.update(!0)};mxEditor.prototype.setMode=function(n){n=="select"?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):n=="connect"?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):n=="pan"&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))};mxEditor.prototype.createPopupMenu=function(n,t,i){this.popupHandler.createMenu(this,n,t,i)};mxEditor.prototype.createEdge=function(){var n=null,r,t,i;return this.defaultEdge!=null?(r=this.graph.getModel(),n=r.cloneCell(this.defaultEdge)):(n=new mxCell(""),n.setEdge(!0),t=new mxGeometry,t.relative=!0,n.setGeometry(t)),i=this.getEdgeStyle(),i!=null&&n.setStyle(i),n};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};mxEditor.prototype.consumeCycleAttribute=function(n){return this.cycleAttributeValues!=null&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(n)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(n){if(this.cycleAttributeName!=null){var t=this.consumeCycleAttribute(n);t!=null&&n.setStyle(n.getStyle()+";"+this.cycleAttributeName+"="+t)}};mxEditor.prototype.addVertex=function(n,t,i,r){for(var o=this.graph.getModel(),u;n!=null&&!this.graph.isValidDropTarget(n);)n=o.getParent(n);n=n!=null?n:this.graph.getSwimlaneAt(i,r);var e=this.graph.getView().scale,f=o.getGeometry(t),h=o.getGeometry(n);if(this.graph.isSwimlane(t)&&!this.graph.swimlaneNesting)n=null;else{if(n==null&&this.swimlaneRequired)return null;if(n!=null&&h!=null)if(u=this.graph.getView().getState(n),u!=null){if(i-=u.origin.x*e,r-=u.origin.y*e,this.graph.isConstrainedMoving){var c=f.width,l=f.height,s=u.x+u.width;i+c>s&&(i-=i+c-s);s=u.y+u.height;r+l>s&&(r-=r+l-s)}}else h!=null&&(i-=h.x*e,r-=h.y*e)}f=f.clone();f.x=this.graph.snap(i/e-this.graph.getView().translate.x-this.graph.gridSize/2);f.y=this.graph.snap(r/e-this.graph.getView().translate.y-this.graph.gridSize/2);t.setGeometry(f);n==null&&(n=this.graph.getDefaultParent());this.cycleAttribute(t);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",t,"parent",n));o.beginUpdate();try{t=this.graph.addCell(t,n);t!=null&&(this.graph.constrainChild(t),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",t)))}finally{o.endUpdate()}return t!=null&&(this.graph.setSelectionCell(t),this.graph.scrollCellToVisible(t),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",t))),t};mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.tasks!=null&&this.tasks.destroy(),this.outline!=null&&this.outline.destroy(),this.properties!=null&&this.properties.destroy(),this.keyHandler!=null&&this.keyHandler.destroy(),this.rubberband!=null&&this.rubberband.destroy(),this.toolbar!=null&&this.toolbar.destroy(),this.graph!=null&&this.graph.destroy(),this.status=null,this.templates=null)};mxCodecRegistry={codecs:[],aliases:[],register:function(n){var t,i;return n!=null&&(t=n.getName(),mxCodecRegistry.codecs[t]=n,i=mxUtils.getFunctionName(n.template.constructor),i!=t&&mxCodecRegistry.addAlias(i,t)),n},addAlias:function(n,t){mxCodecRegistry.aliases[n]=t},getCodec:function(n){var t=null,i,r;if(n!=null&&(i=mxUtils.getFunctionName(n),r=mxCodecRegistry.aliases[i],r!=null&&(i=r),t=mxCodecRegistry.codecs[i],t==null))try{t=new mxObjectCodec(new n);mxCodecRegistry.register(t)}catch(u){}return t}};mxCodec.prototype.document=null;mxCodec.prototype.objects=null;mxCodec.prototype.elements=null;mxCodec.prototype.encodeDefaults=!1;mxCodec.prototype.putObject=function(n,t){return this.objects[n]=t,t};mxCodec.prototype.getObject=function(n){var t=null,i;return n!=null&&(t=this.objects[n],t==null&&(t=this.lookup(n),t==null&&(i=this.getElementById(n),i!=null&&(t=this.decode(i))))),t};mxCodec.prototype.lookup=function(){return null};mxCodec.prototype.getElementById=function(n){return this.elements==null&&(this.elements={},this.addElement(this.document.documentElement)),this.elements[n]};mxCodec.prototype.addElement=function(n){if(n.nodeType==mxConstants.NODETYPE_ELEMENT){var t=n.getAttribute("id");t!=null&&this.elements[t]==null&&(this.elements[t]=n)}for(n=n.firstChild;n!=null;)this.addElement(n),n=n.nextSibling};mxCodec.prototype.getId=function(n){var t=null;return n!=null&&(t=this.reference(n),t==null&&n instanceof mxCell&&(t=n.getId(),t==null&&(t=mxCellPath.create(n),t.length==0&&(t="root")))),t};mxCodec.prototype.reference=function(){return null};mxCodec.prototype.encode=function(n){var t=null,i;return n!=null&&n.constructor!=null&&(i=mxCodecRegistry.getCodec(n.constructor),i!=null?t=i.encode(this,n):mxUtils.isNode(n)?t=mxUtils.importNode(this.document,n,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(n.constructor))),t};mxCodec.prototype.decode=function(n,t){var i=null,r,u;if(n!=null&&n.nodeType==mxConstants.NODETYPE_ELEMENT){r=null;try{r=window[n.nodeName]}catch(f){}u=mxCodecRegistry.getCodec(r);u!=null?i=u.decode(this,n,t):(i=n.cloneNode(!0),i.removeAttribute("as"))}return i};mxCodec.prototype.encodeCell=function(n,t,i){var u,r;if(t.appendChild(this.encode(n)),i==null||i)for(u=n.getChildCount(),r=0;r<u;r++)this.encodeCell(n.getChildAt(r),t)};mxCodec.prototype.isCellCodec=function(n){return n!=null&&typeof n.isCellCodec=="function"?n.isCellCodec():!1};mxCodec.prototype.decodeCell=function(n,t){var u,i,r;if(t=t!=null?t:!0,u=null,n!=null&&n.nodeType==mxConstants.NODETYPE_ELEMENT){if(i=mxCodecRegistry.getCodec(n.nodeName),!this.isCellCodec(i))for(r=n.firstChild;r!=null&&!this.isCellCodec(i);)i=mxCodecRegistry.getCodec(r.nodeName),r=r.nextSibling;this.isCellCodec(i)||(i=mxCodecRegistry.getCodec(mxCell));u=i.decode(this,n);t&&this.insertIntoGraph(u)}return u};mxCodec.prototype.insertIntoGraph=function(n){var t=n.parent,i=n.getTerminal(!0),r=n.getTerminal(!1);n.setTerminal(null,!1);n.setTerminal(null,!0);n.parent=null;t!=null&&t.insert(n);i!=null&&i.insertEdge(n,!0);r!=null&&r.insertEdge(n,!1)};mxCodec.prototype.setAttribute=function(n,t,i){t!=null&&i!=null&&n.setAttribute(t,i)};mxObjectCodec.allowEval=!1;mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor};mxObjectCodec.prototype.getFieldName=function(n){if(n!=null){var t=this.reverse[n];t!=null&&(n=t)}return n};mxObjectCodec.prototype.getAttributeName=function(n){if(n!=null){var t=this.mapping[n];t!=null&&(n=t)}return n};mxObjectCodec.prototype.isExcluded=function(n,t){return t==mxObjectIdentity.FIELD_NAME||mxUtils.indexOf(this.exclude,t)>=0};mxObjectCodec.prototype.isReference=function(n,t){return mxUtils.indexOf(this.idrefs,t)>=0};mxObjectCodec.prototype.encode=function(n,t){var i=n.document.createElement(this.getName());return t=this.beforeEncode(n,t,i),this.encodeObject(n,t,i),this.afterEncode(n,t,i)};mxObjectCodec.prototype.encodeObject=function(n,t,i){var f,r,u;n.setAttribute(i,"id",n.getId(t));for(f in t)r=f,u=t[r],u==null||this.isExcluded(t,r,u,!0)||(mxUtils.isInteger(r)&&(r=null),this.encodeValue(n,t,r,u,i))};mxObjectCodec.prototype.encodeValue=function(n,t,i,r,u){var f,e;if(r!=null){if(this.isReference(t,i,r,!0)){if(f=n.getId(r),f==null){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+i+"="+r);return}r=f}e=this.template[i];(i==null||n.encodeDefaults||e!=r)&&(i=this.getAttributeName(i),this.writeAttribute(n,t,i,r,u))}};mxObjectCodec.prototype.writeAttribute=function(n,t,i,r,u){typeof r!="object"?this.writePrimitiveAttribute(n,t,i,r,u):this.writeComplexAttribute(n,t,i,r,u)};mxObjectCodec.prototype.writePrimitiveAttribute=function(n,t,i,r,u){if(r=this.convertAttributeToXml(n,t,i,r,u),i==null){var f=n.document.createElement("add");typeof r=="function"?f.appendChild(n.document.createTextNode(r)):n.setAttribute(f,"value",r);u.appendChild(f)}else typeof r!="function"&&n.setAttribute(u,i,r)};mxObjectCodec.prototype.writeComplexAttribute=function(n,t,i,r,u){var f=n.encode(r);f!=null?(i!=null&&f.setAttribute("as",i),u.appendChild(f)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+i+": "+r)};mxObjectCodec.prototype.convertAttributeToXml=function(n,t,i,r){return this.isBooleanAttribute(n,t,i,r)&&(r=r==!0?"1":"0"),r};mxObjectCodec.prototype.isBooleanAttribute=function(n,t,i,r){return typeof r.length=="undefined"&&(r==!0||r==!1)};mxObjectCodec.prototype.convertAttributeFromXml=function(n,t,i){var r=t.value;return this.isNumericAttribute(n,t,i)&&(r=parseFloat(r)),r};mxObjectCodec.prototype.isNumericAttribute=function(n,t){return mxUtils.isNumeric(t.value)};mxObjectCodec.prototype.beforeEncode=function(n,t){return t};mxObjectCodec.prototype.afterEncode=function(n,t,i){return i};mxObjectCodec.prototype.decode=function(n,t,i){var u=t.getAttribute("id"),r=n.objects[u];return r==null&&(r=i||this.cloneTemplate(),u!=null&&n.putObject(u,r)),t=this.beforeDecode(n,t,r),this.decodeNode(n,t,r),this.afterDecode(n,t,r)};mxObjectCodec.prototype.decodeNode=function(n,t,i){t!=null&&(this.decodeAttributes(n,t,i),this.decodeChildren(n,t,i))};mxObjectCodec.prototype.decodeAttributes=function(n,t,i){var u=t.attributes,r;if(u!=null)for(r=0;r<u.length;r++)this.decodeAttribute(n,u[r],i)};mxObjectCodec.prototype.decodeAttribute=function(n,t,i){var u=t.nodeName,r,e,f;if(u!="as"&&u!="id"){if(r=this.convertAttributeFromXml(n,t,i),e=this.getFieldName(u),this.isReference(i,e,r,!1)){if(f=n.getObject(r),f==null){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+u+"="+r);return}r=f}this.isExcluded(i,u,r,!1)||(i[u]=r)}};mxObjectCodec.prototype.decodeChildren=function(n,t,i){for(var r=t.firstChild,u;r!=null;)u=r.nextSibling,r.nodeType!=mxConstants.NODETYPE_ELEMENT||this.processInclude(n,r,i)||this.decodeChild(n,r,i),r=u};mxObjectCodec.prototype.decodeChild=function(n,t,i){var u=this.getFieldName(t.getAttribute("as")),f,r;u!=null&&this.isExcluded(i,u,t,!1)||(f=this.getFieldTemplate(i,u,t),r=null,t.nodeName=="add"?(r=t.getAttribute("value"),r==null&&mxObjectCodec.allowEval&&(r=mxUtils.eval(mxUtils.getTextContent(t)))):r=n.decode(t,f),this.addObjectValue(i,u,r,f))};mxObjectCodec.prototype.getFieldTemplate=function(n,t){var i=n[t];return i instanceof Array&&i.length>0&&(i=null),i};mxObjectCodec.prototype.addObjectValue=function(n,t,i,r){i!=null&&i!=r&&(t!=null&&t.length>0?n[t]=i:n.push(i))};mxObjectCodec.prototype.processInclude=function(n,t,i){var r,u;if(t.nodeName=="include"){if(r=t.getAttribute("name"),r!=null)try{u=mxUtils.load(r).getDocumentElement();u!=null&&n.decode(u,i)}catch(f){}return!0}return!1};mxObjectCodec.prototype.beforeDecode=function(n,t){return t};mxObjectCodec.prototype.afterDecode=function(n,t,i){return i};mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);return n.isCellCodec=function(){return!0},n.isNumericAttribute=function(n,t){return t.nodeName!=="value"&&mxObjectCodec.prototype.isNumericAttribute.apply(this,arguments)},n.isExcluded=function(n,t,i,r){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||r&&t=="value"&&i.nodeType==mxConstants.NODETYPE_ELEMENT},n.afterEncode=function(n,t,i){var r,u;return t.value!=null&&t.value.nodeType==mxConstants.NODETYPE_ELEMENT&&(r=i,i=mxUtils.importNode(n.document,t.value,!0),i.appendChild(r),u=r.getAttribute("id"),i.setAttribute("id",u),r.removeAttribute("id")),i},n.beforeDecode=function(n,t,i){var u=t,l=this.getName(),r,c,e,o,f,s,h,a;if(t.nodeName!=l?(r=t.getElementsByTagName(l)[0],r!=null&&r.parentNode==t?(mxUtils.removeWhitespace(r,!0),mxUtils.removeWhitespace(r,!1),r.parentNode.removeChild(r),u=r):u=null,i.value=t.cloneNode(!0),c=i.value.getAttribute("id"),c!=null&&(i.setId(c),i.value.removeAttribute("id"))):i.setId(t.getAttribute("id")),u!=null)for(e=0;e<this.idrefs.length;e++)o=this.idrefs[e],f=u.getAttribute(o),f!=null&&(u.removeAttribute(o),s=n.objects[f]||n.lookup(f),s==null&&(h=n.getElementById(f),h!=null&&(a=mxCodecRegistry.codecs[h.nodeName]||this,s=a.decode(n,h))),i[o]=s);return u},n}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxGraphModel);return n.encodeObject=function(n,t,i){var r=n.document.createElement("root");n.encodeCell(t.getRoot(),r);i.appendChild(r)},n.decodeChild=function(n,t,i){t.nodeName=="root"?this.decodeRoot(n,t,i):mxObjectCodec.prototype.decodeChild.apply(this,arguments)},n.decodeRoot=function(n,t,i){for(var f=null,r=t.firstChild,u;r!=null;)u=n.decodeCell(r),u!=null&&u.getParent()==null&&(f=u),r=r.nextSibling;f!=null&&i.setRoot(f)},n}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxRootChange,["model","previous","root"]);return n.afterEncode=function(n,t,i){return n.encodeCell(t.root,i),i},n.beforeDecode=function(n,t,i){var r,u;if(t.firstChild!=null&&t.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT)for(t=t.cloneNode(!0),r=t.firstChild,i.root=n.decodeCell(r,!1),u=r.nextSibling,r.parentNode.removeChild(r),r=u;r!=null;)u=r.nextSibling,n.decodeCell(r),r.parentNode.removeChild(r),r=u;return t},n.afterDecode=function(n,t,i){return i.previous=i.root,i},n}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);return n.isReference=function(n,t,i,r){return t=="child"&&(n.previous!=null||!r)?!0:mxUtils.indexOf(this.idrefs,t)>=0},n.afterEncode=function(n,t,i){return this.isReference(t,"child",t.child,!0)?i.setAttribute("child",n.getId(t.child)):n.encodeCell(t.child,i),i},n.beforeDecode=function(n,t,i){var r,u,f,e;if(t.firstChild!=null&&t.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT)for(t=t.cloneNode(!0),r=t.firstChild,i.child=n.decodeCell(r,!1),u=r.nextSibling,r.parentNode.removeChild(r),r=u;r!=null;)u=r.nextSibling,r.nodeType==mxConstants.NODETYPE_ELEMENT&&(f=r.getAttribute("id"),n.lookup(f)==null&&n.decodeCell(r)),r.parentNode.removeChild(r),r=u;else e=t.getAttribute("child"),i.child=n.getObject(e);return t},n.afterDecode=function(n,t,i){return i.child.parent=i.previous,i.previous=i.parent,i.previousIndex=i.index,i},n}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);return n.afterDecode=function(n,t,i){return i.previous=i.terminal,i},n}());mxGenericChangeCodec=function(n,t){var i=new mxObjectCodec(n,["model","previous"],["cell"]);return i.afterDecode=function(n,i,r){return mxUtils.isNode(r.cell)&&(r.cell=n.decodeCell(r.cell,!1)),r.previous=r[t],r},i};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value"));mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style"));mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed"));mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value"));mxCodecRegistry.register(function(){return new mxObjectCodec(new mxGraph,["graphListeners","eventListeners","view","container","cellRenderer","editor","selection"])}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxGraphView);return n.encode=function(n,t){return this.encodeCell(n,t,t.graph.getModel().getRoot())},n.encodeCell=function(n,t,i){var h=t.graph.getModel(),f=t.getState(i),a=h.getParent(i),r,b,c,e,o,v,l,u,y;if(a==null||f!=null){var p=h.getChildCount(i),w=t.graph.getCellGeometry(i),s=null;if(a==h.getRoot()?s="layer":a==null?s="graph":h.isEdge(i)?s="edge":p>0&&w!=null?s="group":h.isVertex(i)&&(s="vertex"),s!=null){if(r=n.document.createElement(s),b=t.graph.getLabel(i),b!=null&&(r.setAttribute("label",t.graph.getLabel(i)),t.graph.isHtmlLabel(i)&&r.setAttribute("html",!0)),a==null)c=t.getGraphBounds(),c!=null&&(r.setAttribute("x",Math.round(c.x)),r.setAttribute("y",Math.round(c.y)),r.setAttribute("width",Math.round(c.width)),r.setAttribute("height",Math.round(c.height))),r.setAttribute("scale",t.scale);else if(f!=null&&w!=null){for(u in f.style)e=f.style[u],typeof e=="function"&&typeof e=="object"&&(e=mxStyleRegistry.getName(e)),e!=null&&typeof e!="function"&&typeof e!="object"&&r.setAttribute(u,e);if(o=f.absolutePoints,o!=null&&o.length>0){for(v=Math.round(o[0].x)+","+Math.round(o[0].y),u=1;u<o.length;u++)v+=" "+Math.round(o[u].x)+","+Math.round(o[u].y);r.setAttribute("points",v)}else r.setAttribute("x",Math.round(f.x)),r.setAttribute("y",Math.round(f.y)),r.setAttribute("width",Math.round(f.width)),r.setAttribute("height",Math.round(f.height));l=f.absoluteOffset;l!=null&&(l.x!=0&&r.setAttribute("dx",Math.round(l.x)),l.y!=0&&r.setAttribute("dy",Math.round(l.y)))}for(u=0;u<p;u++)y=this.encodeCell(n,t,h.getChildAt(i,u)),y!=null&&r.appendChild(y)}}return r},n}());mxStylesheetCodec=mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxStylesheet);return n.encode=function(n,t){var s=n.document.createElement(this.getName()),r,e,i,u,o,f;for(r in t.styles)if(e=t.styles[r],i=n.document.createElement("add"),r!=null){i.setAttribute("as",r);for(u in e)o=this.getStringValue(u,e[u]),o!=null&&(f=n.document.createElement("add"),f.setAttribute("value",o),f.setAttribute("as",u),i.appendChild(f));i.childNodes.length>0&&s.appendChild(i)}return s},n.getStringValue=function(n,t){var i=typeof t;return i=="function"?t=mxStyleRegistry.getName(style[j]):i=="object"&&(t=null),t},n.decode=function(n,t,i){var e=i||new this.template.constructor,l=t.getAttribute("id"),h,o,f,r,c,s,u;for(l!=null&&(n.objects[l]=e),t=t.firstChild;t!=null;){if(!this.processInclude(n,t,e)&&t.nodeName=="add"&&(h=t.getAttribute("as"),h!=null)){for(o=t.getAttribute("extend"),f=o!=null?mxUtils.clone(e.styles[o]):null,f==null&&(o!=null&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+o+" not found to extend"),f={}),r=t.firstChild;r!=null;)r.nodeType==mxConstants.NODETYPE_ELEMENT&&(c=r.getAttribute("as"),r.nodeName=="add"?(s=mxUtils.getTextContent(r),u=null,s!=null&&s.length>0&&mxStylesheetCodec.allowEval?u=mxUtils.eval(s):(u=r.getAttribute("value"),mxUtils.isNumeric(u)&&(u=parseFloat(u))),u!=null&&(f[c]=u)):r.nodeName=="remove"&&delete f[c]),r=r.nextSibling;e.putCellStyle(h,f)}t=t.nextSibling}return e},n}());mxStylesheetCodec.allowEval=!0;mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxDefaultKeyHandler);return n.encode=function(){return null},n.decode=function(n,t,i){var r;if(i!=null)for(r=i.editor,t=t.firstChild;t!=null;){if(!this.processInclude(n,t,i)&&t.nodeName=="add"){var u=t.getAttribute("as"),f=t.getAttribute("action"),e=t.getAttribute("control");i.bindAction(u,f,e)}t=t.nextSibling}return i},n}());mxDefaultToolbarCodec=mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxDefaultToolbar);return n.encode=function(){return null},n.decode=function(n,t,i){var o,u,w,h,b,k,c,d,g,rt,f,r,v;if(i!=null)for(o=i.editor,t=t.firstChild;t!=null;){if(t.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(n,t,i))if(t.nodeName=="separator")i.addSeparator();else if(t.nodeName=="br")i.toolbar.addBreak();else if(t.nodeName=="hr")i.toolbar.addLine();else if(t.nodeName=="add"){u=t.getAttribute("as");u=mxResources.get(u)||u;var l=t.getAttribute("icon"),y=t.getAttribute("pressedIcon"),nt=t.getAttribute("action"),tt=t.getAttribute("mode"),p=t.getAttribute("template"),it=t.getAttribute("toggle")!="0",s=mxUtils.getTextContent(t),a=null;if(nt!=null)a=i.addItem(u,l,nt,y);else if(tt!=null)w=mxDefaultToolbarCodec.allowEval?mxUtils.eval(s):null,a=i.addMode(u,l,tt,y,w);else if(p!=null||s!=null&&s.length>0)h=o.templates[p],b=t.getAttribute("style"),h!=null&&b!=null&&(h=o.graph.cloneCells([h])[0],h.setStyle(b)),k=null,s!=null&&s.length>0&&mxDefaultToolbarCodec.allowEval&&(k=mxUtils.eval(s)),a=i.addPrototype(u,l,h,y,k,it);else if(c=mxUtils.getChildNodes(t),c.length>0)if(l==null)for(d=i.addActionCombo(u),f=0;f<c.length;f++)r=c[f],r.nodeName=="separator"?i.addOption(d,"---"):r.nodeName=="add"&&(g=r.getAttribute("as"),rt=r.getAttribute("action"),i.addActionOption(d,g,rt));else{var e=null,ut=function(){var n=o.templates[e.value],t,i;return n!=null?(t=n.clone(),i=e.options[e.selectedIndex].cellStyle,i!=null&&t.setStyle(i),t):(mxLog.warn("Template "+n+" not found"),null)},ft=i.addPrototype(u,l,ut,null,null,it);for(e=i.addCombo(),mxEvent.addListener(e,"change",function(){i.toolbar.selectMode(ft,function(n){var t=mxUtils.convertPoint(o.graph.container,mxEvent.getClientX(n),mxEvent.getClientY(n));return o.addVertex(null,w(),t.x,t.y)});i.toolbar.noReset=!1}),f=0;f<c.length;f++)if(r=c[f],r.nodeName=="separator")i.addOption(e,"---");else if(r.nodeName=="add"){var g=r.getAttribute("as"),et=r.getAttribute("template"),ot=i.addOption(e,g,et||p);ot.cellStyle=r.getAttribute("style")}}a!=null&&(v=t.getAttribute("id"),v!=null&&v.length>0&&a.setAttribute("id",v))}t=t.nextSibling}return i},n}());mxDefaultToolbarCodec.allowEval=!0;mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxDefaultPopupMenu);return n.encode=function(){return null},n.decode=function(n,t,i){var r=t.getElementsByTagName("include")[0];return r!=null?this.processInclude(n,r,i):i!=null&&(i.config=t),i},n}());mxCodecRegistry.register(function(){var n=new mxObjectCodec(new mxEditor,["modified","lastSnapshot","ignoredChanges","undoManager","graphContainer","toolbarContainer"]);return n.afterDecode=function(n,t,i){var u=t.getAttribute("defaultEdge"),r;return u!=null&&(t.removeAttribute("defaultEdge"),i.defaultEdge=i.templates[u]),r=t.getAttribute("defaultGroup"),r!=null&&(t.removeAttribute("defaultGroup"),i.defaultGroup=i.templates[r]),i},n.decodeChild=function(n,t,i){if(t.nodeName=="Array"){var r=t.getAttribute("as");if(r=="templates"){this.decodeTemplates(n,t,i);return}}else if(t.nodeName=="ui"){this.decodeUi(n,t,i);return}mxObjectCodec.prototype.decodeChild.apply(this,arguments)},n.decodeUi=function(n,t,i){for(var r=t.firstChild,s;r!=null;){if(r.nodeName=="add"){var f=r.getAttribute("as"),o=r.getAttribute("element"),e=r.getAttribute("style"),u=null;if(o!=null)u=document.getElementById(o),u!=null&&e!=null&&(u.style.cssText+=";"+e);else{var h=parseInt(r.getAttribute("x")),c=parseInt(r.getAttribute("y")),l=r.getAttribute("width"),a=r.getAttribute("height");u=document.createElement("div");u.style.cssText=e;s=new mxWindow(mxResources.get(f)||f,u,h,c,l,a,!1,!0);s.setVisible(!0)}f=="graph"?i.setGraphContainer(u):f=="toolbar"?i.setToolbarContainer(u):f=="title"?i.setTitleContainer(u):f=="status"?i.setStatusContainer(u):f=="map"&&i.setMapContainer(u)}else r.nodeName=="resource"?mxResources.add(r.getAttribute("basename")):r.nodeName=="stylesheet"&&mxClient.link("stylesheet",r.getAttribute("name"));r=r.nextSibling}},n.decodeTemplates=function(n,t,i){var f,u,e,r;for(i.templates==null&&(i.templates=[]),f=mxUtils.getChildNodes(t),u=0;u<f.length;u++){for(e=f[u].getAttribute("as"),r=f[u].firstChild;r!=null&&r.nodeType!=1;)r=r.nextSibling;r!=null&&(i.templates[e]=n.decodeCell(r))}},n}());
//# sourceMappingURL=mxClient.min.js.map
