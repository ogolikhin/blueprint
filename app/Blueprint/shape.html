<html>
<head>
	<title>Shape example for mxGraph</title>

	<!-- Sets the basepath for the library if not in same directory -->
	<script type="text/javascript">
		mxBasePath = '../src';
	</script>

	<!-- Loads and initializes the library -->
	<script type="text/javascript" src="../src/js/mxClient.js"></script>
    <script src="scripts/mxClient.min.js"></script>

	<!-- Example custom shape -->
	<script type="text/javascript">

		function ResposeShape()
		{
			mxCloud.call(this); // use mxHexagon MT
		};

		/*
		   	The next lines use an mxCylinder instance to augment the
		   	prototype of the shape ("inheritance") and reset the
		   	constructor to the topmost function of the c'tor chain.
		*/
		mxUtils.extend(ResposeShape, mxCloud);
		
		// Defines the extrusion of the response as a "static class variable"
			
		/*
		     -----------------
		     |               | 
		     |               | 
		     |               | 
		     |               | 
		     |               | 
		     \-------  ------/
		             \/
		*/
		ResposeShape.prototype.redrawPath = function(path, x, y, w, h)
		{
            path.setFillColor("#CCCCCC");

			path.moveTo(0, h - 10);
			path.lineTo(0, 0);
			path.lineTo(w, 0);
			path.lineTo(w, h - 10);
			path.lineTo(w/2 + 10, h - 10);
			path.curveTo(w/2 + 10, h - 10, w/2 + 1, h - 9, w/2, h);
			path.curveTo(w/2, h, w/2 - 1, h - 9, w/2 - 10, h - 10);
			path.lineTo(0, h - 10);

			// path.moveTo(0, 15);
			// path.lineTo(w, 15);

			// path.moveTo(w/2, h);
			// path.curveTo(w/2, h, w/2 - 1, h - 9, w/2 - 10, h - 10);
			//path.moveTo(0, h - 10);
			//path.lineTo(w/2 - 10, h - 10);

			//path.moveTo(w/2, h);
			//path.curveTo(w/2, h, w/2 + 1, h - 9, w/2 + 10, h - 10);
			//path.moveTo(w/2 + 10, h - 10);
			//path.lineTo(w, h - 10);


			//path.curveTo(w/2 + 10, h - 10, w/2 + 1, h - 9, w/2, h);

			for (var i = 0; i++; i < 10)
			{

			}
		};
		
		/*
			The custom shape can be registered globally or in each cellRenderer
			instance. In this example, the shape is registered globally. For
			registering the shape in a cellRenderer instance, the following
			code can be used:

			graph.cellRenderer.registerShape('response', ResposeShape);
		*/
		mxCellRenderer.prototype.defaultShapes['response'] = ResposeShape;
	</script>

	<!-- Example code -->
	<script type="text/javascript">

		// Program starts here. Creates a sample graph in the
		// DOM node with the specified ID. This function is invoked
		// from the onLoad event handler of the document (see below).
		function main(container)
		{
			// Checks if browser is supported
			if (!mxClient.isBrowserSupported())
			{
				// Displays an error message if the browser is
				// not supported.
				mxUtils.error('Browser is not supported!', 200, false);
			}
			else
			{
				// Creates the graph inside the DOM node.
				var graph = new mxGraph(container);
				
				// Disables basic selection and cell handling
				graph.setEnabled(false);

				// Changes the default style for vertices "in-place"
				// to use the custom shape.
				//var style = graph.getStylesheet().getDefaultVertexStyle();
				//style[mxConstants.STYLE_SHAPE] = 'response';

				var parent = graph.getDefaultParent();
								
				var highlight = new mxCellTracker(graph, '#0092D9');
				graph.getLabel = function(cell)
				{

					if (typeof cell.value == "string") {
						return cell.value;
					} else {
						return cell.getAttribute('label', 'Unknown'); //value.attributes.getNamedItem('label').value;
						var table = document.createElement('table');
						table.style.height = '100%';
						table.style.width = '100%';
						table.style.verticalAlign = 'top';

						var body = document.createElement('tbody');
						
						var tr1 = document.createElement('tr');
						var td1 = document.createElement('td');
						td1.style.textAlign = 'center';
						td1.style.fontSize = '10px';
						td1.style.color = '#774400';
						td1.style.valign="top";
						mxUtils.write(td1, cell.value.first);
						
						var tr2 = document.createElement('tr');
						var td2 = document.createElement('td');
						td2.style.textAlign = 'center';
						td2.style.fontSize = '10px';
						td2.style.color = '#774400';
						mxUtils.write(td2, " 1 ");
						
						var tr3 = document.createElement('tr');
						var td3 = document.createElement('td');
						td3.style.textAlign = 'center';
						td3.style.fontSize = '10px';
						td3.style.color = '#774400';
						mxUtils.write(td3, cell.value.second);
						
						tr1.appendChild(td1);
						tr2.appendChild(td2);
						tr3.appendChild(td3);
						body.appendChild(tr1);
						body.appendChild(tr2);
						body.appendChild(tr3);
						table.appendChild(body);
					
						return table;
					}
				};			

				// Sample user objects with 2 fields
				var value = new Object();
				value.first = 'First value';
				value.second = 'Second value';					

				// Adds cells to the model in a single step
				graph.getModel().beginUpdate();
				try
				{
					var doc = mxUtils.createXmlDocument();
					var node = doc.createElement('Node')
					node.setAttribute('label', 'Label 1');
					node.setAttribute('attribute1', 'value1');					
					var v1 = graph.insertVertex(parent, null, node, 20, 20, 70, 60);

					node = doc.createElement('Node')
					node.setAttribute('label', 'Label 2');
					node.setAttribute('attribute1', 'value2');					
					var v2 = graph.insertVertex(parent, null, node, 160, 110, 70, 60, 'shape=response');
					var e1 = graph.insertEdge(parent, null, '', v1, v2);

					var v3 = graph.insertVertex(parent, null, 'ellipse', 230, 180, 70, 60, 'shape=ellipse');
					//v3.style = graph.getStylesheet().getDefaultVertexStyle(); 
					//v3.style[mxConstants.STYLE_SHAPE] = 'mxConstants.SHAPE_LABEL';

				}
				finally
				{
					// Updates the display
					graph.getModel().endUpdate();
				}

		function showModalWindow(graph, title, content, width, height)
		{
			var background = document.createElement('div');
			background.style.position = 'absolute';
			background.style.left = '0px';
			background.style.top = '0px';
			background.style.right = '0px';
			background.style.bottom = '0px';
			background.style.background = 'black';
			mxUtils.setOpacity(background, 50);
			document.body.appendChild(background);
			
			if (mxClient.IS_IE)
			{
				new mxDivResizer(background);
			}
			
			var x = Math.max(0, document.body.scrollWidth/2-width/2);
			var y = Math.max(10, (document.body.scrollHeight ||
						document.documentElement.scrollHeight)/2-height*2/3);
			var wnd = new mxWindow(title, content, x, y, width, height, false, true);
			wnd.setClosable(true);
			
			// Fades the background out after after the window has been closed
			wnd.addListener(mxEvent.DESTROY, function(evt)
			{
				graph.setEnabled(true);
				mxEffects.fadeOut(background, 50, true, 
					10, 30, true);
			});

			//graph.setEnabled(false);
			//graph.tooltipHandler.hide();
			wnd.setVisible(true);
		};
				document.body.appendChild(mxUtils.button('Show XML',
					function(evt)
					{
						var textarea = document.createElement('textarea');
						textarea.style.width = '400px';
						textarea.style.height = '400px';
						var enc = new mxCodec(mxUtils.createXmlDocument());
						var node = enc.encode(graph.getModel());
						textarea.value = mxUtils.getPrettyXml(node);
						showModalWindow(graph, 'XML', textarea, 410, 440);						
					}
				));

				var headerSize = 100;
				var footerSize = 100;
				document.body.appendChild(mxUtils.button('Print',
					function(evt)
					{
						// Matches actual printer paper size and avoids blank pages
						var scale = 0.5;

						// Applies scale to page
						var pf = mxRectangle.fromRectangle(graph.pageFormat || mxConstants.PAGE_FORMAT_A4_PORTRAIT);
						pf.width = Math.round(pf.width * scale * graph.pageScale);
						pf.height = Math.round(pf.height * scale * graph.pageScale);

						// Finds top left corner of top left page
						var bounds = mxRectangle.fromRectangle(graph.getGraphBounds());
						bounds.x -= graph.view.translate.x * graph.view.scale;
						bounds.y -= graph.view.translate.y * graph.view.scale;

						var x0 = Math.floor(bounds.x / pf.width) * pf.width;
						var y0 = Math.floor(bounds.y / pf.height) * pf.height;
					
				 		var preview = new mxPrintPreview(graph, scale, pf, 0, -x0, -y0);
					 	preview.marginTop = headerSize * scale * graph.pageScale;
					 	preview.marginBottom = footerSize * scale * graph.pageScale;
					 	preview.autoOrigin = false;
					 	
						var oldRenderPage = preview.renderPage;
						preview.renderPage = function(w, h, x, y, content, pageNumber)
						{
							var div = oldRenderPage.apply(this, arguments);

							var header = document.createElement('div');
							header.style.position = 'absolute';
							header.style.boxSizing = 'border-box';
							header.style.fontFamily = 'Arial,Helvetica';
							header.style.height = (this.marginTop - 10) + 'px';
							header.style.textAlign = 'center';
							header.style.verticalAlign = 'middle';
							header.style.marginTop = 'auto';
							header.style.fontSize = '12px';
							header.style.width = '100%';

							// Vertical centering for text in header/footer
							header.style.lineHeight = (this.marginTop - 10) + 'px';
							
							var footer = header.cloneNode(true);

							mxUtils.write(header, 'Page ' + pageNumber + ' - Header');
							header.style.borderBottom = '1px solid gray';
							header.style.top = '0px';
														
							mxUtils.write(footer, 'Page ' + pageNumber + ' - Footer');
							footer.style.borderTop = '1px solid gray';
							footer.style.bottom = '0px';

							div.firstChild.appendChild(footer);
							div.firstChild.appendChild(header);
							
							return div;
						};
					 	
					 	preview.open();
					}
				));


			}
		};
	</script>
</head>

<!-- Page passes the container for the graph to the program -->
<body onload="main(document.getElementById('graphContainer'))">

	<!-- Creates a container for the graph with a grid wallpaper -->
	<div id="graphContainer"
		style="overflow:hidden;width:321px;height:241px;background:url('editors/images/grid.gif')">
	</div>
</body>
</html>
